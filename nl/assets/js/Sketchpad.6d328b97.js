(self.webpackChunk=self.webpackChunk||[]).push([[5050],{279779:function(e,t,n){"use strict";n.d(t,{xV:function(){return j},W4:function(){return G},sN:function(){return F}});n(382139);var o=n(264659),a=n(904730),s=n(673989),i=n(175663),r=n(750591),l=n(575630),c=n(151119),d=(n(175115),n(202784)),u=n(213980),h=n.n(u),p=n(72779),v=n.n(p);n(296253),n(66108);function g(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return"function"==typeof e&&e.apply(void 0,n)}function f(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var m="react-contextmenu",w="react-contextmenu--visible",y="react-contextmenu-wrapper",Z="react-contextmenu-item",b="react-contextmenu-item--active",P="react-contextmenu-item--disabled",x="react-contextmenu-item--divider",S="react-contextmenu-item--selected",k="react-contextmenu-submenu",M={},E=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),C="REACT_CONTEXTMENU_SHOW",D="REACT_CONTEXTMENU_HIDE";function R(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;"function"==typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),o&&(o.dispatchEvent(n),Object.assign(M,t))}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;R(C,Object.assign({},e,{type:C}),t)}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;R(D,Object.assign({},e,{type:D}),t)}var O=new function e(){var t=this;(0,o.Z)(this,e),(0,c.Z)(this,"handleShowEvent",(function(e){for(var n in t.callbacks)f(t.callbacks,n)&&t.callbacks[n].show(e)})),(0,c.Z)(this,"handleHideEvent",(function(e){for(var n in t.callbacks)f(t.callbacks,n)&&t.callbacks[n].hide(e)})),(0,c.Z)(this,"register",(function(e,n){var o=Math.random().toString(36).substring(7);return t.callbacks[o]={show:e,hide:n},o})),(0,c.Z)(this,"unregister",(function(e){e&&t.callbacks[e]&&delete t.callbacks[e]})),this.callbacks={},E&&(window.addEventListener(C,this.handleShowEvent),window.addEventListener(D,this.handleHideEvent))},z=(n(319371),n(607560));function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,r.Z)(this,n)}}var L=function(e){(0,i.Z)(n,e);var t=N(n);function n(){var e;(0,o.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),(0,c.Z)((0,s.Z)(e),"handleClick",(function(t){0!==t.button&&1!==t.button&&t.preventDefault(),e.props.disabled||e.props.divider||(g(e.props.onClick,t,Object.assign({},e.props.data,M.data),M.target),e.props.preventClose||T())})),e}return(0,a.Z)(n,[{key:"render",value:function(){var e,t=this,n=this.props,o=n.attributes,a=n.children,s=n.className,i=n.disabled,r=n.divider,l=n.selected,u=v()(s,Z,o.className,(e={},(0,c.Z)(e,v()(P,o.disabledClassName),i),(0,c.Z)(e,v()(x,o.dividerClassName),r),(0,c.Z)(e,v()(S,o.selectedClassName),l),e));return d.createElement("div",(0,z.Z)({},o,{className:u,role:"menuitem",tabIndex:"-1","aria-disabled":i?"true":"false",ref:function(e){t.ref=e},onMouseMove:this.props.onMouseMove,onMouseLeave:this.props.onMouseLeave,onTouchEnd:this.handleClick,onClick:this.handleClick}),r?null:a)}}]),n}(d.Component);(0,c.Z)(L,"defaultProps",{attributes:{},children:null,className:"",data:{},disabled:!1,divider:!1,onClick:function(){return null},onMouseMove:function(){return null},onMouseLeave:function(){return null},preventClose:!1,selected:!1});var F=L;function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,r.Z)(this,n)}}var H=function(e){(0,i.Z)(n,e);var t=B(n);function n(e){var a;return(0,o.Z)(this,n),a=t.call(this,e),(0,c.Z)((0,s.Z)(a),"handleKeyNavigation",(function(e){if(!1!==a.state.isVisible)switch(e.keyCode){case 37:case 27:e.preventDefault(),a.hideMenu(e);break;case 38:e.preventDefault(),a.selectChildren(!0);break;case 40:e.preventDefault(),a.selectChildren(!1);break;case 39:a.tryToOpenSubMenu(e);break;case 13:e.preventDefault(),a.tryToOpenSubMenu(e);var t=a.seletedItemRef&&a.seletedItemRef.props&&a.seletedItemRef.props.disabled;a.seletedItemRef&&a.seletedItemRef.ref instanceof HTMLElement&&!t?a.seletedItemRef.ref.click():a.hideMenu(e)}})),(0,c.Z)((0,s.Z)(a),"handleForceClose",(function(){a.setState({forceSubMenuOpen:!1})})),(0,c.Z)((0,s.Z)(a),"tryToOpenSubMenu",(function(e){a.state.selectedItem&&a.state.selectedItem.type===a.getSubMenuType()&&(e.preventDefault(),a.setState({forceSubMenuOpen:!0}))})),(0,c.Z)((0,s.Z)(a),"selectChildren",(function(e){var t=a.state.selectedItem,n=[],o=0,s={};if(d.Children.forEach(a.props.children,(function e(t,i){t&&([F,a.getSubMenuType()].indexOf(t.type)<0?d.Children.forEach(t.props?t.props.children:[],e):t.props.divider||(t.props.disabled&&(++o,s[i]=!0),n.push(t)))})),o!==n.length){var i=function(t){var o=t;do{e?--o:++o,o<0?o=n.length-1:o>=n.length&&(o=0)}while(o!==t&&s[o]);return o===t?null:o}(n.indexOf(t));null!==i&&a.setState({selectedItem:n[i],forceSubMenuOpen:!1})}})),(0,c.Z)((0,s.Z)(a),"onChildMouseMove",(function(e){a.state.selectedItem!==e&&a.setState({selectedItem:e,forceSubMenuOpen:!1})})),(0,c.Z)((0,s.Z)(a),"onChildMouseLeave",(function(){a.setState({selectedItem:null,forceSubMenuOpen:!1})})),(0,c.Z)((0,s.Z)(a),"renderChildren",(function(e){return d.Children.map(e,(function(e){var t={};return d.isValidElement(e)?[F,a.getSubMenuType()].indexOf(e.type)<0?(t.children=a.renderChildren(e.props?e.props.children:[]),d.cloneElement(e,t)):(t.onMouseLeave=a.onChildMouseLeave.bind((0,s.Z)(a)),e.type===a.getSubMenuType()&&(t.forceOpen=a.state.forceSubMenuOpen&&a.state.selectedItem===e,t.forceClose=a.handleForceClose,t.parentKeyNavigationHandler=a.handleKeyNavigation),e.props.divider||a.state.selectedItem!==e?(t.onMouseMove=function(){return a.onChildMouseMove(e)},d.cloneElement(e,t)):(t.selected=!0,t.ref=function(e){a.seletedItemRef=e},d.cloneElement(e,t))):e}))})),a.seletedItemRef=null,a.state={selectedItem:null,forceSubMenuOpen:!1},a}return n}(d.Component);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,r.Z)(this,n)}}var W=function(e){(0,i.Z)(n,e);var t=U(n);function n(e){var a;return(0,o.Z)(this,n),a=t.call(this,e),(0,c.Z)((0,s.Z)(a),"getMenuPosition",(function(){var e=window,t=e.innerWidth,n=e.innerHeight,o=a.subMenu.getBoundingClientRect(),s={};return o.bottom>n?s.bottom=0:s.top=0,o.right<t?s.left="100%":s.right="100%",s})),(0,c.Z)((0,s.Z)(a),"getRTLMenuPosition",(function(){var e=window.innerHeight,t=a.subMenu.getBoundingClientRect(),n={};return t.bottom>e?n.bottom=0:n.top=0,t.left<0?n.left="100%":n.right="100%",n})),(0,c.Z)((0,s.Z)(a),"hideMenu",(function(e){e.preventDefault(),a.hideSubMenu(e)})),(0,c.Z)((0,s.Z)(a),"hideSubMenu",(function(e){e.detail&&e.detail.id&&a.menu&&e.detail.id!==a.menu.id||(a.props.forceOpen&&a.props.forceClose(),a.setState({visible:!1,selectedItem:null}),a.unregisterHandlers())})),(0,c.Z)((0,s.Z)(a),"handleClick",(function(e){e.preventDefault(),a.props.disabled||(g(a.props.onClick,e,Object.assign({},a.props.data,M.data),M.target),a.props.onClick&&!a.props.preventCloseOnClick&&T())})),(0,c.Z)((0,s.Z)(a),"handleMouseEnter",(function(){a.closetimer&&clearTimeout(a.closetimer),a.props.disabled||a.state.visible||(a.opentimer=setTimeout((function(){return a.setState({visible:!0,selectedItem:null})}),a.props.hoverDelay))})),(0,c.Z)((0,s.Z)(a),"handleMouseLeave",(function(){a.opentimer&&clearTimeout(a.opentimer),a.state.visible&&(a.closetimer=setTimeout((function(){return a.setState({visible:!1,selectedItem:null})}),a.props.hoverDelay))})),(0,c.Z)((0,s.Z)(a),"menuRef",(function(e){a.menu=e})),(0,c.Z)((0,s.Z)(a),"subMenuRef",(function(e){a.subMenu=e})),(0,c.Z)((0,s.Z)(a),"registerHandlers",(function(){document.removeEventListener("keydown",a.props.parentKeyNavigationHandler),document.addEventListener("keydown",a.handleKeyNavigation)})),(0,c.Z)((0,s.Z)(a),"unregisterHandlers",(function(e){document.removeEventListener("keydown",a.handleKeyNavigation),e||document.addEventListener("keydown",a.props.parentKeyNavigationHandler)})),a.state=Object.assign({},a.state,{visible:!1}),a}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){this.listenId=O.register((function(){}),this.hideSubMenu)}},{key:"getSubMenuType",value:function(){return n}},{key:"shouldComponentUpdate",value:function(e,t){return this.isVisibilityChange=!(this.state.visible===t.visible&&this.props.forceOpen===e.forceOpen||this.state.visible&&e.forceOpen||this.props.forceOpen&&t.visible),!0}},{key:"componentDidUpdate",value:function(){var e=this;if(this.isVisibilityChange)if(this.props.forceOpen||this.state.visible){(window.requestAnimationFrame||setTimeout)((function(){var t=e.props.rtl?e.getRTLMenuPosition():e.getMenuPosition();e.subMenu.style.removeProperty("top"),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("left"),e.subMenu.style.removeProperty("right"),f(t,"top")&&(e.subMenu.style.top=t.top),f(t,"left")&&(e.subMenu.style.left=t.left),f(t,"bottom")&&(e.subMenu.style.bottom=t.bottom),f(t,"right")&&(e.subMenu.style.right=t.right),e.subMenu.classList.add(w),e.registerHandlers(),e.setState({selectedItem:null})}))}else{this.subMenu.addEventListener("transitionend",(function t(){e.subMenu.removeEventListener("transitionend",t),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("right"),e.subMenu.style.top=0,e.subMenu.style.left="100%",e.unregisterHandlers()})),this.subMenu.classList.remove(w)}}},{key:"componentWillUnmount",value:function(){this.listenId&&O.unregister(this.listenId),this.opentimer&&clearTimeout(this.opentimer),this.closetimer&&clearTimeout(this.closetimer),this.unregisterHandlers(!0)}},{key:"render",value:function(){var e,t=this.props,n=t.children,o=t.attributes,a=t.disabled,s=t.title,i=t.selected,r=this.state.visible,l={ref:this.menuRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,className:v()(Z,k,o.listClassName),style:{position:"relative"}},u={className:v()(Z,o.className,(e={},(0,c.Z)(e,v()(P,o.disabledClassName),a),(0,c.Z)(e,v()(b,o.visibleClassName),r),(0,c.Z)(e,v()(S,o.selectedClassName),i),e)),onMouseMove:this.props.onMouseMove,onMouseOut:this.props.onMouseOut,onClick:this.handleClick},h={ref:this.subMenuRef,style:{position:"absolute",transition:"opacity 1ms",top:0,left:"100%"},className:v()(m,this.props.className)};return d.createElement("nav",(0,z.Z)({},l,{role:"menuitem",tabIndex:"-1","aria-haspopup":"true"}),d.createElement("div",(0,z.Z)({},o,u),s),d.createElement("nav",(0,z.Z)({},h,{role:"menu",tabIndex:"-1"}),this.renderChildren(n)))}}]),n}(H);(0,c.Z)(W,"propTypes",{children:h().node.isRequired,attributes:h().object,title:h().node.isRequired,className:h().string,disabled:h().bool,hoverDelay:h().number,rtl:h().bool,selected:h().bool,onMouseMove:h().func,onMouseOut:h().func,forceOpen:h().bool,forceClose:h().func,parentKeyNavigationHandler:h().func}),(0,c.Z)(W,"defaultProps",{disabled:!1,hoverDelay:500,attributes:{},className:"",rtl:!1,selected:!1,onMouseMove:function(){return null},onMouseOut:function(){return null},forceOpen:!1,forceClose:function(){return null},parentKeyNavigationHandler:function(){return null}});var A=W;function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,r.Z)(this,n)}}var X=function(e){(0,i.Z)(n,e);var t=Y(n);function n(e){var a;return(0,o.Z)(this,n),a=t.call(this,e),(0,c.Z)((0,s.Z)(a),"registerHandlers",(function(){document.addEventListener("mousedown",a.handleOutsideClick),document.addEventListener("touchstart",a.handleOutsideClick),a.props.preventHideOnScroll||document.addEventListener("scroll",a.handleHide),a.props.preventHideOnContextMenu||document.addEventListener("contextmenu",a.handleHide),document.addEventListener("keydown",a.handleKeyNavigation),a.props.preventHideOnResize||window.addEventListener("resize",a.handleHide)})),(0,c.Z)((0,s.Z)(a),"unregisterHandlers",(function(){document.removeEventListener("mousedown",a.handleOutsideClick),document.removeEventListener("touchstart",a.handleOutsideClick),document.removeEventListener("scroll",a.handleHide),document.removeEventListener("contextmenu",a.handleHide),document.removeEventListener("keydown",a.handleKeyNavigation),window.removeEventListener("resize",a.handleHide)})),(0,c.Z)((0,s.Z)(a),"handleShow",(function(e){if(e.detail.id===a.props.id&&!a.state.isVisible){var t=e.detail.position,n=t.x,o=t.y;a.setState({isVisible:!0,x:n,y:o}),a.registerHandlers(),g(a.props.onShow,e)}})),(0,c.Z)((0,s.Z)(a),"handleHide",(function(e){!a.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==a.props.id||(a.unregisterHandlers(),a.setState({isVisible:!1,selectedItem:null,forceSubMenuOpen:!1}),g(a.props.onHide,e))})),(0,c.Z)((0,s.Z)(a),"handleOutsideClick",(function(e){a.menu.contains(e.target)||T()})),(0,c.Z)((0,s.Z)(a),"handleMouseLeave",(function(e){e.preventDefault(),g(a.props.onMouseLeave,e,Object.assign({},a.props.data,M.data),M.target),a.props.hideOnLeave&&T()})),(0,c.Z)((0,s.Z)(a),"handleContextMenu",(function(e){e.preventDefault(),a.handleHide(e)})),(0,c.Z)((0,s.Z)(a),"hideMenu",(function(e){27!==e.keyCode&&13!==e.keyCode||T()})),(0,c.Z)((0,s.Z)(a),"getMenuPosition",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!a.menu)return n;var o=window,s=o.innerWidth,i=o.innerHeight,r=a.menu.getBoundingClientRect();return t+r.height>i&&(n.top-=r.height),e+r.width>s&&(n.left-=r.width),n.top<0&&(n.top=r.height<i?(i-r.height)/2:0),n.left<0&&(n.left=r.width<s?(s-r.width)/2:0),n})),(0,c.Z)((0,s.Z)(a),"getRTLMenuPosition",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!a.menu)return n;var o=window,s=o.innerWidth,i=o.innerHeight,r=a.menu.getBoundingClientRect();return n.left=e-r.width,t+r.height>i&&(n.top-=r.height),n.left<0&&(n.left+=r.width),n.top<0&&(n.top=r.height<i?(i-r.height)/2:0),n.left+r.width>s&&(n.left=r.width<s?(s-r.width)/2:0),n})),(0,c.Z)((0,s.Z)(a),"menuRef",(function(e){a.menu=e})),a.state=Object.assign({},a.state,{x:0,y:0,isVisible:!1}),a}return(0,a.Z)(n,[{key:"getSubMenuType",value:function(){return A}},{key:"componentDidMount",value:function(){this.listenId=O.register(this.handleShow,this.handleHide)}},{key:"componentDidUpdate",value:function(){var e=this,t=window.requestAnimationFrame||setTimeout;this.state.isVisible?t((function(){var n=e.state,o=n.x,a=n.y,s=e.props.rtl?e.getRTLMenuPosition(o,a):e.getMenuPosition(o,a),i=s.top,r=s.left;t((function(){e.menu&&(e.menu.style.top="".concat(i,"px"),e.menu.style.left="".concat(r,"px"),e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))})):t((function(){e.menu&&(e.menu.style.opacity=0,e.menu.style.pointerEvents="none")}))}},{key:"componentWillUnmount",value:function(){this.listenId&&O.unregister(this.listenId),this.unregisterHandlers()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,o=e.style,a=this.state.isVisible,s=Object.assign({},o,{position:"fixed",opacity:0,pointerEvents:"none"}),i=v()(m,n,(0,c.Z)({},w,a));return d.createElement("nav",{role:"menu",tabIndex:"-1",ref:this.menuRef,style:s,className:i,onContextMenu:this.handleContextMenu,onMouseLeave:this.handleMouseLeave},this.renderChildren(t))}}]),n}(H);(0,c.Z)(X,"propTypes",{id:h().string.isRequired,children:h().node.isRequired,data:h().object,className:h().string,hideOnLeave:h().bool,rtl:h().bool,onHide:h().func,onMouseLeave:h().func,onShow:h().func,preventHideOnContextMenu:h().bool,preventHideOnResize:h().bool,preventHideOnScroll:h().bool,style:h().object}),(0,c.Z)(X,"defaultProps",{className:"",data:{},hideOnLeave:!1,rtl:!1,onHide:function(){return null},onMouseLeave:function(){return null},onShow:function(){return null},preventHideOnContextMenu:!1,preventHideOnResize:!1,preventHideOnScroll:!1,style:{}});var j=X;function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,r.Z)(this,n)}}var J=["input","textarea"],V=function(e){(0,i.Z)(n,e);var t=K(n);function n(){var e;(0,o.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),(0,c.Z)((0,s.Z)(e),"touchHandled",!1),(0,c.Z)((0,s.Z)(e),"handleMouseDown",(function(t){e.props.holdToDisplay>=0&&0===t.button&&(t.persist(),t.stopPropagation(),e.mouseDownTimeoutId=setTimeout((function(){return e.handleContextClick(t)}),e.props.holdToDisplay)),g(e.props.attributes.onMouseDown,t)})),(0,c.Z)((0,s.Z)(e),"handleMouseUp",(function(t){0===t.button&&clearTimeout(e.mouseDownTimeoutId),g(e.props.attributes.onMouseUp,t)})),(0,c.Z)((0,s.Z)(e),"handleMouseOut",(function(t){0===t.button&&clearTimeout(e.mouseDownTimeoutId),g(e.props.attributes.onMouseOut,t)})),(0,c.Z)((0,s.Z)(e),"handleTouchstart",(function(t){e.touchHandled=!1,e.props.holdToDisplay>=0&&(t.persist(),t.stopPropagation(),e.touchstartTimeoutId=setTimeout((function(){e.handleContextClick(t),e.touchHandled=!0}),e.props.holdToDisplay)),g(e.props.attributes.onTouchStart,t)})),(0,c.Z)((0,s.Z)(e),"handleTouchEnd",(function(t){e.touchHandled&&t.preventDefault(),clearTimeout(e.touchstartTimeoutId),g(e.props.attributes.onTouchEnd,t)})),(0,c.Z)((0,s.Z)(e),"handleContextMenu",(function(t){t.button===e.props.mouseButton&&e.handleContextClick(t),g(e.props.attributes.onContextMenu,t)})),(0,c.Z)((0,s.Z)(e),"handleMouseClick",(function(t){t.button===e.props.mouseButton?e.handleContextClick(t):e.props.holdToDisplay>0&&T(),g(e.props.attributes.onClick,t)})),(0,c.Z)((0,s.Z)(e),"handleContextClick",(function(t){if(!(e.props.disable||e.props.disableIfShiftIsPressed&&t.shiftKey)){var n=document.activeElement;if(!(n&&(-1!==J.indexOf(n.tagName.toLowerCase())||n.isContentEditable))&&"CANVAS"!==n.tagName){t.preventDefault(),t.stopPropagation();var o=t.clientX||t.touches&&t.touches[0].pageX,a=t.clientY||t.touches&&t.touches[0].pageY;e.props.posX&&(o-=e.props.posX),e.props.posY&&(a-=e.props.posY),T();var s=g(e.props.collect,e.props),i={position:{x:o,y:a},target:e.elem,id:e.props.id};s&&"function"==typeof s.then?s.then((function(e){i.data=Object.assign({},e,{target:t.target}),I(i)})):(i.data=Object.assign({},s,{target:t.target}),I(i))}}})),(0,c.Z)((0,s.Z)(e),"elemRef",(function(t){e.elem=t})),e}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.renderTag,n=e.attributes,o=e.children,a=Object.assign({},n,{className:v()(y,n.className),onContextMenu:this.handleContextMenu,onClick:this.handleMouseClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onTouchStart:this.handleTouchstart,onTouchEnd:this.handleTouchEnd,onMouseOut:this.handleMouseOut,ref:this.elemRef});return d.createElement(t,a,o)}}]),n}(d.Component);V.defaultProps={attributes:{},collect:function(){return null},disable:!1,holdToDisplay:1e3,renderTag:"div",posX:0,posY:0,mouseButton:2,disableIfShiftIsPressed:!1};var G=V;n(462773)},397738:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Mt}});n(382139),n(627476),n(95767),n(694882),n(298351);var o=n(607560),a=n(711746),s=n(264659),i=n(904730),r=n(673989),l=n(175663),c=n(750591),d=n(575630),u=n(151119),h=n(858255),p=(n(448977),n(296253),n(940851),n(319371),n(6059),n(283946),n(21466),n(111246),n(762850),n(462773),n(39115),n(856997),n(991181),n(898837),n(202784)),v=(n(213980),n(198)),g=n(912895),f=n.n(g),m=n(911755),w=n.n(m),y=n(366441),Z=n.n(y),b=n(780594),P=n.n(b),x=n(279779),S=n(260952),k=n(109361),M=n(435376),E=n(175891),C=n(203858),D=n(423184),R=n(770561),I=n(81982),T=n(931776),O=n(891719),z=n.n(O),N=n(561647),L=n.n(N),F=n(785745),B=n(150275),H=n(228856),U=n(309765),W=n(588703),A=n.n(W),Y=n(287013),X=n.n(Y),j=n(830324),K=n.n(j),J=n(409961),V=n.n(J),G=n(686605),$=n.n(G),_=n(32593),q=n.n(_),Q=n(557106),ee=n.n(Q),te=n(783158),ne=n.n(te),oe=n(695688),ae=n.n(oe),se=n(306830),ie=n.n(se),re=n(635314),le=n.n(re),ce=n(437069),de=n.n(ce),ue=n(302467),he=n.n(ue),pe=n(42111),ve=n(42720),ge=n(423879),fe=n(603107),me=n(778886),we=n(193679),ye=n(172245),Ze=n(344843),be=n.n(Ze),Pe=n(38226),xe=n.n(Pe);var Se=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:126,o=new Array(e),a=0;a<e;a++)o[a]=xe()(t,n);return be().apply(null,o)},ke=n(741319),Me=JSON.parse('[{"command":"nextPage","trigger":"next","description":"Go to next page"},{"command":"prevPage","trigger":"previous","description":"Go to the previous next page"},{"command":"firstPage","trigger":["first","First"],"description":"Jump to the first page"},{"command":"lastPage","trigger":"last","description":"Jump to the last page"}]'),Ee=(n(570162),n(850110),w()("isle:sketchpad:curve"));var Ce,De,Re,Ie,Te,Oe,ze=function(e,t,n,o,a,s,i){if(Ee("Received points: "+t.length),void 0===t||t.length<2)return new Float32Array(0);var r;a="number"==typeof a?a:.9,s="number"==typeof s?s:30;var l=1,c=t.length,d=0,u=new Float32Array((c-2)*s+2+(i?2*s:0)),h=new Float32Array(s+2<<2),p=4;t=t.slice(0);for(var v=0;v<t.length;v+=2)t[v]=t[v]*n,t[v+1]=t[v+1]*o;for(r=t.slice(0),i?(r.unshift(t[c-1]),r.unshift(t[c-2]),r.push(t[0],t[1])):(r.unshift(t[1]),r.unshift(t[0]),r.push(t[c-2],t[c-1])),h[0]=1;l<s;l++){var g=l/s,f=g*g,m=f*g,w=2*m,y=3*f;h[p++]=w-y+1,h[p++]=y-w,h[p++]=m-2*f+g,h[p++]=m-f}function Z(e,t,n,o){for(var a,i=2;i<n;i+=2){var r=e[i],l=e[i+1],c=e[i+2],h=e[i+3],p=(c-e[i-2])*o,v=(h-e[i-1])*o,g=(e[i+4]-r)*o,f=(e[i+5]-l)*o,m=0;for(a=0;a<s;a++){var w=t[m++],y=t[m++],Z=t[m++],b=t[m++];u[d++]=w*r+y*c+Z*p+b*g,u[d++]=w*l+y*h+Z*v+b*f}}}for(h[++p]=1,Z(r,h,c,a),i&&((r=[]).push(t[c-4],t[c-3],t[c-2],t[c-1],t[0],t[1],t[2],t[3]),Z(r,h,4,a)),c=i?0:t.length-2,u[d++]=t[c++],u[d]=t[c],l=0,c=u.length;l<c;l+=2){var b=(u[l]+u[l+2])/2,P=(u[l+1]+u[l+3])/2;e.lineTo(u[l],u[l+1],b,P)}return e.lineTo(u[l],u[l+1],u[l+2],u[l+3]),u},Ne=function(e){var t=e.tooltip,n=e.onClick,o=e.glyph,a=e.label,s=e.disabled,i=e.size,r=e.variant,l=void 0===r?"light":r;return(0,h.Z)(B.Z,{placement:"bottom",tooltip:t},void 0,(0,h.Z)(R.Z,{variant:l,size:i,onClick:n,disabled:s,"aria-label":t},void 0,o?(0,h.Z)("div",{className:"fa fa-".concat(o)}):null,a))},Le=n(65420),Fe=n(226010),Be=n(155061);function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,d.Z)(e);if(t){var a=(0,d.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,c.Z)(this,n)}}var Ue=["#000000","#FF6900","#FCB900","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#9900EF"],We=[4,5,6,7,8,9,10,11,12,14,18,20,22,24,30,36,42],Ae=[8,9,10,11,12,14,18,24,30,36,48,60,72],Ye=function(e){(0,l.Z)(n,e);var t=He(n);function n(e){var o;return(0,s.Z)(this,n),o=t.call(this,e),(0,u.Z)((0,r.Z)(o),"toggleColorPicker",(function(){o.setState({showColorPicker:!o.state.showColorPicker})})),(0,u.Z)((0,r.Z)(o),"toggleDrawingMode",(function(){o.props.onModeChange("drawing"===o.props.mode?"none":"drawing")})),(0,u.Z)((0,r.Z)(o),"toggleDragMode",(function(){o.props.onModeChange("drag"===o.props.mode?"none":"drag")})),(0,u.Z)((0,r.Z)(o),"toggleDeleteMode",(function(){o.props.onModeChange("delete"===o.props.mode?"none":"delete")})),(0,u.Z)((0,r.Z)(o),"togglePointerMode",(function(){o.props.onModeChange("pointer"===o.props.mode?"none":"pointer")})),(0,u.Z)((0,r.Z)(o),"toggleZoomMode",(function(){o.props.onModeChange("zoom"===o.props.mode?"none":"zoom")})),(0,u.Z)((0,r.Z)(o),"toggleTextMode",(function(){o.props.onModeChange("text"===o.props.mode?"none":"text")})),(0,u.Z)((0,r.Z)(o),"handleColorChange",(function(e){o.props.onColorChange(e.hex),o.setState({showColorPicker:!o.state.showColorPicker})})),o.state={showColorPicker:!1},o}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.props.t;return(0,h.Z)(p.Fragment,{},void 0,(0,h.Z)(D.Z,{size:"sm",className:"sketch-drag-delete-modes sketch-button-group"},void 0,(0,h.Z)(Ne,{tooltip:e("drag-mode"),size:"sm",variant:"drag"===this.props.mode?"success":"secondary",onClick:this.toggleDragMode,glyph:"arrows-alt"}),(0,h.Z)(Ne,{tooltip:e("delete-mode"),size:"sm",variant:"delete"===this.props.mode?"success":"secondary",onClick:this.toggleDeleteMode,glyph:"times"}),(0,h.Z)(Ne,{tooltip:e("magnifying-glass"),size:"sm",variant:"zoom"===this.props.mode?"success":"secondary",onClick:this.toggleZoomMode,glyph:"search-plus"}),(0,h.Z)(Ne,{tooltip:e("pointer-mode"),size:"sm",variant:"pointer"===this.props.mode?"success":"secondary",onClick:this.togglePointerMode,glyph:"circle"})),(0,h.Z)(D.Z,{size:"sm",className:"sketch-drawing-buttons"},void 0,(0,h.Z)(Ne,{tooltip:e("drawing-mode"),glyph:"paint-brush",size:"sm",variant:"drawing"===this.props.mode?"success":"secondary",onClick:this.toggleDrawingMode}),(0,h.Z)(Fe.Z,{id:"sketch-brush-size-dropdown",size:"sm",variant:"light",title:this.props.brushSize,onSelect:this.props.onBrushSelect},void 0,We.map((function(e,t){return(0,h.Z)(Be.Z,{eventKey:e},t,e)})))),(0,h.Z)(D.Z,{size:"sm"},void 0,(0,h.Z)(B.Z,{placement:"right",tooltip:e("change-brush-color")},void 0,(0,h.Z)(R.Z,{size:"sm",onClick:this.toggleColorPicker,style:{background:this.props.color,color:"white"}},void 0,"Col"))),(0,h.Z)(D.Z,{size:"sm",className:"sketch-text-buttons"},void 0,(0,h.Z)(Ne,{size:"sm",variant:"text"===this.props.mode?"success":"secondary",onClick:this.toggleTextMode,tooltip:e("text-mode"),glyph:"font"}),(0,h.Z)(Fe.Z,{id:"sketch-font-dropdown",size:"sm",variant:"text"===this.props.mode?"success":"secondary",title:this.props.fontFamily,onSelect:this.props.onFontFamilySelect},void 0,Ce||(Ce=(0,h.Z)(Be.Z,{eventKey:"Arial"},void 0,"Arial")),De||(De=(0,h.Z)(Be.Z,{eventKey:"Helvetica"},void 0,"Helvetica")),Re||(Re=(0,h.Z)(Be.Z,{eventKey:"Times"},void 0,"Times")),Ie||(Ie=(0,h.Z)(Be.Z,{eventKey:"Courier"},void 0,"Courier")),Te||(Te=(0,h.Z)(Be.Z,{eventKey:"Verdana"},void 0,"Verdana")),Oe||(Oe=(0,h.Z)(Be.Z,{eventKey:"Palatino"},void 0,"Palatino"))),(0,h.Z)(Fe.Z,{id:"sketch-font-size-dropdown",size:"sm",variant:"light",title:this.props.fontSize,onSelect:this.props.onFontSizeSelect},void 0,Ae.map((function(e,t){return(0,h.Z)(Be.Z,{eventKey:e},t,e)})))),(0,h.Z)("div",{className:"sketch-colorpicker",style:{display:this.state.showColorPicker?"initial":"none"}},void 0,(0,h.Z)(Le.Z,{color:this.props.color,colors:Ue,onChangeComplete:this.handleColorChange,triangle:"top-right"})))}}]),n}(p.Component),Xe=w()("isle:sketchpad:harmonize-sketchpad-elements");var je=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];n=n.map((function(e){return e.page})),o=o.map((function(e){return e.page}));for(var a=0;a<n.length;a++){var s=n[a];o.includes(s)||(Xe("Removing elements from page "+s),e.splice(s,1),t.splice(s,1))}for(var i=0;i<o.length;i++){var r=o[i];n.includes(r)||(Xe("Adding an empty page at position "+r),e.splice(r,0,[]),t.splice(r,0,0))}},Ke=n(844601),Je=n(543414),Ve=n(220517),Ge=n(921455),$e=n(5140),_e=n(964909),qe=n(432261);function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,d.Z)(e);if(t){var a=(0,d.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,c.Z)(this,n)}}var et=w()("isle:lesson:sketchpad-contextmenu"),tt=function(e){(0,l.Z)(n,e);var t=Qe(n);function n(){var e;(0,s.Z)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,u.Z)((0,r.Z)(e),"copyToClipboard",(function(){var t;if(et("Copying page to clipboard... "),e.props.canvas){var n=e.props.canvas.toDataURL();t='<img alt="Sketchpad Page" src="'.concat(n,'" />'),document.addEventListener("copy",o),document.execCommand("copy"),document.removeEventListener("copy",o)}function o(e){e.clipboardData.setData("text/html ",t),e.clipboardData.setData("text/plain ",t),e.preventDefault()}})),e}return(0,i.Z)(n,[{key:"render",value:function(){return(0,h.Z)(x.xV,{id:"sketchpadWindow"},void 0,(0,h.Z)(x.sN,{onClick:this.copyToClipboard},void 0,this.props.t("copy")))}}]),n}(p.Component);tt.defaultProps={canvas:null};var nt,ot,at=(0,v.Z)("sketchpad")(tt),st=JSON.parse('[{"target":".sketch-drawing-buttons","content":"In the drawing mode, you can draw lines on the sketchpad. Try it out. Also try changing the brush size and brush color."},{"target":".sketch-pages","content":"Use the + button to insert a new page and the other buttons for navigation."},{"target":".sketch-text-buttons","content":"In the text mode, you can insert text annotations. Click on a point on the sketchpad to create a note and insert it by hitting ENTER."},{"target":".sketch-drag-delete-modes","content":"The drag and delete modes allow you to move around and delete created elements, respectively. Once either mode is selected, simply click on an element on the page to drag or delete it. The laser pointer and magnifying glass may be used to highlight and zoom in on parts of the current slide."},{"target":".sketch-undo-redo","content":"The undo button allows you to revert the last additions you made to the slides, while the redo button can redraw elements which were previously undone."},{"target":".sketch-save-buttons","content":"You can either export the current page as an image file or all pages as a PDF document. Alternatively, your notes can also be uploaded directly to the ISLE server by clicking the button to the right. Once the upload is finished, make sure to save the displayed link to the uploaded file."},{"target":".sketch-save-buttons","content":"Your notes are autosaved in the cloud and will be accessible when opening the lesson again in the future. However, to make sure the latest changes are saved, you are advised to click the \\"Save in browser\\" button before closing the page."}]');function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,d.Z)(e);if(t){var a=(0,d.Z)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return(0,c.Z)(this,n)}}var ct=n(932976),dt=(0,Ke.Z)((function(){return n.e(3512).then(n.bind(n,977898))})),ut=(0,Ke.Z)((function(){return n.e(1217).then(n.bind(n,963978))})),ht=(0,Ke.Z)((function(){return n.e(3471).then(n.bind(n,332369))})),pt=(0,Ke.Z)((function(){return n.e(4553).then(n.bind(n,510675))})),vt=(0,Ke.Z)((function(){return n.e(2087).then(n.bind(n,428373))})),gt=w()("isle:sketchpad"),ft=(0,pe.Z)("sketchpad"),mt=["isExporting","showColorPicker","showUploadModal","showNavigationModal","showResetModal","showFeedbackModal","showSaveModal","hideInputButtons","hideNavigationButtons","hideSaveButtons","hideTransmitButtons"],wt=/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&//=]*))/g,yt=/([a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,})/gi,Zt=window.devicePixelRatio||1;function bt(e){e.preventDefault()}function Pt(e,t){for(var n=!1,o=0;o<t.length;o++){t[o].page===e&&(n=!0)}return n}function xt(e){e.setLineDash([2,15]),e.lineWidth=2,e.strokeStyle="orange",e.lineCap="round",e.lineJoin="round",e.shadowBlur=0}ct&&ct.GlobalWorkerOptions&&(ct.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js");var St=function(e){gt("Rendering overlays...");for(var t=de()(e.nodes),n=[],o=e.toOriginalPage(e.currentPage),a=0;a<t.length;a++){var s=e.nodes[t[a]],i="invisible-page";t[a]===String(o+1)&&(i="sketch-node-container"),K()(s)&&s.component?s.style?(t[a]===String(o+1)&&(i="sketch-node-container-basic"),n.push((0,h.Z)("div",{style:s.style,className:i,onKeyDown:Ge.Z},a,s.component))):n.push((0,h.Z)("div",{className:i,onKeyDown:Ge.Z},a,s.component)):n.push((0,h.Z)("div",{className:i,onKeyDown:Ge.Z},a,s))}return(0,h.Z)("div",{className:"sketchpad-overlays"},void 0,n)},kt=function(e){(0,l.Z)(n,e);var t=lt(n);function n(e,o){var i;(0,s.Z)(this,n),i=t.call(this,e),(0,u.Z)((0,r.Z)(i),"handleHashChange",(function(){var e=i.readURL();e>0&&i.gotoPage(e)})),(0,u.Z)((0,r.Z)(i),"handleResize",(function(){i.setState({canvasHeight:window.innerHeight-i.state.verticalOffset,canvasWidth:window.innerWidth-40},(function(){i.debouncedRedraw()}))})),(0,u.Z)((0,r.Z)(i),"retrieveData",(function(e){if(gt("Retrieved data from previous session..."),K()(e)){if(A()(e.elements))for(var t=0;t<e.elements.length;t++)i.elements[t]=e.elements[t];if(A()(e.nUndos))for(var n=0;n<e.nUndos.length;n++)i.nUndos[n]=e.nUndos[n];if(A()(e.sharedElements)){for(var o=0;o<e.sharedElements.length;o++)i.sharedElements[o]=e.sharedElements[o];i.context.anonymous&&je(i.elements,i.nUndos,i.state.insertedPages,e.state.insertedPages)}else i.sharedElements=new Array(e.elements.length).fill([]);for(var a=0;a<e.state.insertedPages.length;a++){var s=e.state.insertedPages[a].page;i.backgrounds.splice(s,0,null)}var r=Ve.Z?0:i.readURL();gt("Go to page "+r),e.state.currentPage=r,e.state.noPages=i.backgrounds.length,e.state=le()(e.state,mt),e.state.hasRetrievedData=!0,i.setState(e.state,(function(){i.debouncedRedraw()}))}else i.setState({hasRetrievedData:!0},(function(){i.debouncedRedraw()}))})),(0,u.Z)((0,r.Z)(i),"toggleGroupMode",(function(){i.setState({groupMode:!i.state.groupMode})})),(0,u.Z)((0,r.Z)(i),"hidePointer",(function(){var e={id:i.id,type:$e.Ty,value:!0,noSave:!0};i.context.log(e,"members"),i.pointer.style.opacity=0})),(0,u.Z)((0,r.Z)(i),"hideZoom",(function(){var e={id:i.id,type:$e.FK,value:!0,noSave:!0};i.context.log(e,"members"),i.zoom.style.display="none"})),(0,u.Z)((0,r.Z)(i),"preventDefaultTouch",(function(e){e.target!==i.canvas&&e.target!==i.textLayer&&e.target!==i.canvasWrapper||e.preventDefault()})),(0,u.Z)((0,r.Z)(i),"handleVisibilityChange",(function(){document.hidden||i.debouncedRedraw()})),(0,u.Z)((0,r.Z)(i),"renderBackground",(function(e){i.renderingTask&&i.renderingTask.cancel();var t=i.canvas,n=i.ctx,o=i.backgrounds[e];if(o){var a;gt("Found background for page ".concat(e,"..."));var s=o.getViewport({scale:1}),r=i.state.fill||(s.width>s.height?"vertical":"horizontal");a="vertical"===r?i.state.canvasHeight/s.height:i.state.canvasWidth/s.width;for(var l=o.getViewport({scale:a}),c=i.textLayer;c.firstChild;)c.removeChild(c.firstChild);"vertical"===r?(i.canvas.height=l.height*Zt,i.canvas.width=l.width*Zt,i.canvas.style.left="".concat((i.state.canvasWidth-l.width)/2,"px"),i.canvas.style["border-style"]="solid",i.canvas.style["border-color"]="black",i.canvas.style["border-width"]="0px 1px 0px 1px",i.canvas.style.width="".concat(l.width,"px"),i.canvas.style.height="".concat(l.height,"px"),c.style.width="".concat(l.width,"px"),c.style.height="".concat(l.height,"px"),i.leftMargin=(i.state.canvasWidth-l.width)/2,c.style.left="".concat(i.leftMargin,"px")):(i.canvas.height=l.height*Zt,i.canvas.width=(l.width-15)*Zt,i.canvas.style.left="0px",i.canvas.style.border="none",i.canvas.style.height="".concat(l.height,"px"),i.canvas.style.width="".concat(l.width-15,"px"),c.style.width="".concat(l.width-15,"px"),c.style.height="".concat(l.height,"px"),i.leftMargin=0,c.style.left="0px");var d=ae()(i.canvas.width*i.canvas.width+i.canvas.height*i.canvas.height);i.scaleRatio=d/(1768*Zt),i.ctx.setTransform(Zt,0,0,Zt,0,0);var u={canvasContext:i.ctx,viewport:l};return o.getTextContent().then((function(e){ct.renderTextLayer({textContent:e,container:c,viewport:l,textDivs:[]}).promise.then((function(){var e=c.innerHTML,t=he()(e,wt,'<a href="$1">$1</a>');t=he()(t,yt,'<a href="mailto:$1">$1</a>'),c.innerHTML=t}))})),i.renderingTask=o.render(u),i.renderingTask.promise.then((function(){i.backgroundData=i.ctx.getImageData(0,0,i.canvas.width,i.canvas.height),gt("Background rendered for page ".concat(e))})).catch((function(e){gt("Encountered error in `renderBackground`: "+e.message)}))}return i.backgroundData=null,n&&(i.props.pdf||n.setTransform(Zt,0,0,Zt,0,0),n.clearRect(0,0,t.width,t.height)),Promise.resolve()})),(0,u.Z)((0,r.Z)(i),"redraw",(function(){var e=i.state.currentPage;gt("Redrawing page ".concat(e+1));var t=i.nUndos[e];i.renderBackground(e).then((function(){var n=i.sharedElements[e];if(i.state.showInstructorAnnotations){gt("Rendering ".concat(n.length," shared elements on page ").concat(e,"..."));for(var o=0;o<n.length;o++)i.drawElement(n[o])}n=i.elements[e],gt("Rendering ".concat(n.length," own elements on page ").concat(e,"..."));for(var a=0;a<n.length-t;a++)i.drawElement(n[a]);i.renderingTask=null})).catch((function(e){i.renderingTask=null}))})),(0,u.Z)((0,r.Z)(i),"onlyRedrawElements",(function(){i.backgroundData?i.ctx.putImageData(i.backgroundData,0,0):i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);var e=i.state.currentPage,t=i.sharedElements[e];if(i.state.showInstructorAnnotations){gt("Rendering ".concat(t.length," shared elements on page ").concat(e,"..."));for(var n=0;n<t.length;n++)i.drawElement(t[n])}t=i.elements[e],gt("Rendering ".concat(t.length," own elements on page ").concat(e,"..."));for(var o=i.nUndos[e],a=0;a<t.length-o;a++)i.drawElement(t[a])})),(0,u.Z)((0,r.Z)(i),"redrawWhenDragging",(function(){if(!i.canvasBuffer){i.canvasBuffer=document.createElement("canvas"),i.canvasBuffer.width=i.canvas.width,i.canvasBuffer.height=i.canvas.height,gt("Prepare data for non-dragged elements..."),i.backgroundData?i.ctx.putImageData(i.backgroundData,0,0):(i.ctx.fillStyle="white",i.ctx.fillRect(0,0,i.canvas.width,i.canvas.height));var e=i.state.currentPage,t=i.sharedElements[e];if(i.state.showInstructorAnnotations){gt("Rendering ".concat(t.length," shared elements on page ").concat(e,"..."));for(var n=0;n<t.length;n++)i.drawElement(t[n])}t=i.elements[e],gt("Rendering ".concat(t.length," own elements on page ").concat(e,"..."));for(var o=i.nUndos[e],a=0;a<t.length-o;a++)i.selectedElements&&X()(i.selectedElements,t[a])||i.drawElement(t[a]);var s=i.canvasBuffer.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(i.canvas,0,0,i.canvas.width/Zt,i.canvas.height/Zt)}i.ctx.drawImage(i.canvasBuffer,0,0);var r=i.selectedElements;if(r)for(var l=0;l<r.length;l++)i.drawElement(r[l]);var c=i.ctx;if(c.beginPath(),xt(c),i.dragPoints)for(var d=0;d<i.dragPoints.length;d+=2){var u=i.dragPoints[d],h=i.dragPoints[d+1];i.ctx.lineTo(u,h)}c.stroke(),c.closePath(),c.setLineDash([])})),(0,u.Z)((0,r.Z)(i),"drawPage",(function(e){var t=i.ctx,n=i.canvas;t&&t.clearRect(0,0,n.width,n.height),i.renderBackground(e);var o=i.sharedElements[e];if(i.state.showInstructorAnnotations)for(var a=0;a<o.length;a++)i.drawElement(o[a]);o=i.elements[e];for(var s=i.nUndos[e],r=0;r<o.length-s;r++)i.drawElement(o[r])})),(0,u.Z)((0,r.Z)(i),"mousePosition",(function(e){var t=e.clientX,n=e.clientY;e.touches&&e.touches.length>0&&(t=e.touches[0].clientX,n=e.touches[0].clientY);var o=i.canvas.getBoundingClientRect();return{x:t-o.left,y:n-o.top}})),(0,u.Z)((0,r.Z)(i),"clearPage",(function(e){if(Pt(e,i.state.insertedPages)){gt("Clear an inserted page; deleting it completely..."),i.elements.splice(e,1),i.backgrounds.splice(e,1),i.nUndos.splice(e,1),i.sharedElements.splice(e,1);for(var t=[],n=0;n<i.state.insertedPages.length;n++){var o=i.state.insertedPages[n];e!==o.page&&(o.page>e&&(o.page-=1),t.push(o))}gt("New inserted pages are: "+t.join(", ")),i.setState({noPages:i.state.noPages-1,insertedPages:t,selectedPage:i.state.selectedPage-1},(function(){i.debouncedRedraw()}))}else i.elements[e]=[],i.debouncedRedraw()})),(0,u.Z)((0,r.Z)(i),"clear",(function(){var e=i.state.currentPage;i.clearPage(e);var t=i.context,n={id:i.id,type:$e.wi,value:JSON.stringify({page:e,sessionID:t.sessionID})};i.hasChangedSinceLastSave=!0,t.isOwner()&&i.state.transmitOwner?t.log(n,"members"):t.log(n,"owners")})),(0,u.Z)((0,r.Z)(i),"clearAll",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i.context,n=i.canvas,o=i.ctx;if(o&&o.clearRect(0,0,n.width,n.height),t.store.removeItem(i.id+"_sketchpad"),i.props.pdf)i.initializePDF().then((function(){i.debouncedRedraw(),i.setState({insertedPages:[]})}));else{var a=i.props.noPages;i.elements=new Array(a),i.backgrounds=new Array(a),i.sharedElements=new Array(a),i.nUndos=new Array(a);for(var s=0;s<a;s++)i.elements[s]=[],i.sharedElements[s]=[],i.backgrounds[s]=null,i.nUndos[s]=0;i.setState({currentPage:0,noPages:a,insertedPages:[]})}var r={id:i.id,type:$e.Wp,value:t.sessionID};e||(i.hasChangedSinceLastSave=!0,t.isOwner()&&i.state.transmitOwner?t.log(r,"members"):t.log(r,"owners"))})),(0,u.Z)((0,r.Z)(i),"undo",(function(){var e=i.state.currentPage,t=i.elements[e],n=i.sharedElements[e],o=i.nUndos[e],a=i.ctx,s=i.canvas;a&&a.clearRect(0,0,s.width,s.height),i.renderBackground(e).then((function(){o+=1;for(var a=-1,s=t.length-1,r=s;r>=0;r--){if((a+=1)===o){s=r;break}0===r&&(o=a+1,s=null)}if(gt("Current number of undos: "+o),i.nUndos[e]=o,i.hasChangedSinceLastSave=!0,!V()(s)){gt("UNDO: Redrawing elements 0 to ".concat(s," out of ").concat(t.length," elements"));for(var l=0;l<=s;l++)i.drawElement(t[l])}for(var c=0;c<n.length;c++)i.drawElement(n[c])}))})),(0,u.Z)((0,r.Z)(i),"redo",(function(){var e=i.state.currentPage,t=i.elements[e],n=i.sharedElements[e],o=i.nUndos[e];if(o>0){var a=ne()(t.length-o,0);if(gt("Line index: "+a),a>=0){var s=-1,r=t.length-1;o-=1;for(var l=r;l>=0;l--)if((s+=1)===o){r=l;break}gt("REDO: Redrawing elements ".concat(a," to ").concat(r," out of ").concat(t.length," elements"));for(var c=a;c<=r;c++)i.drawElement(t[c]);i.nUndos[e]=o;for(var d=0;d<n.length;d++)i.drawElement(n[d]);i.hasChangedSinceLastSave=!0}}})),(0,u.Z)((0,r.Z)(i),"drawElement",(function(e){e&&("line"===e.type?i.drawLine(e):"text"===e.type?i.drawText(e):"curve"===e.type&&i.drawCurve(e))})),(0,u.Z)((0,r.Z)(i),"drawLine",(function(e){var t=e.startX,n=e.startY,o=e.endX,a=e.endY,s=e.color,r=e.lineWidth,l=e.selected,c=i.ctx;c&&(c.lineWidth=r*i.scaleRatio,c.lineCap="round",c.lineJoin="round",c.shadowBlur=1.5*c.lineWidth,c.strokeStyle=l?"orange":s,c.beginPath(),c.moveTo(t,n),c.lineTo(o,a),c.stroke(),c.closePath())})),(0,u.Z)((0,r.Z)(i),"drawCurve",(function(e){var t=e.points,n=e.color,o=e.lineWidth,a=e.selected,s=i.ctx;s&&(s.lineWidth=o*i.scaleRatio,s.lineCap="round",s.lineJoin="round",a?(s.strokeStyle="orange",s.beginPath(),ze(s,t,i.canvas.width/Zt,i.canvas.height/Zt,.9,1),s.stroke(),s.closePath()):(s.shadowColor="rgba(128, 128, 128, 0.2)",s.shadowBlur=2*s.lineWidth,s.strokeStyle=n,s.beginPath(),ze(s,t,i.canvas.width/Zt,i.canvas.height/Zt),s.stroke(),s.closePath()))})),(0,u.Z)((0,r.Z)(i),"drawStart",(function(e){if(e.stopPropagation(),gt("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1)return i.swipeStartX=e.touches[0].screenX,void(i.swipeStartY=e.touches[0].screenY);var t=i.mousePosition(e),n=t.x,o=t.y;if(i.currentPoints=[],i.x=n,i.y=o,i.isMouseDown=!0,i.imageData=i.ctx.getImageData(0,0,i.canvas.width,i.canvas.height),"drawing"===i.state.mode){var a=i.state.currentPage,s=i.nUndos[a];if(s>0){var r=i.elements[a];r.splice(r.length-s),gt("Page ".concat(a," now has ").concat(r.length," elements")),i.nUndos[a]=0,i.hasChangedSinceLastSave=!0}i.draw(e)}else if("drag"===i.state.mode){var l=i.ctx;l.isPointInPath(n*Zt,o*Zt)||(i.deselectElements(),i.onlyRedrawElements()),l.beginPath(),i.draw(e)}else z()&&i.handleClick(e)})),(0,u.Z)((0,r.Z)(i),"drawEnd",(function(e){if(e.stopPropagation(),q()(i.swipeEndX-i.swipeStartX)>45&&q()(i.swipeEndY-i.swipeStartY)<40)return i.swipeEndX>i.swipeStartX?i.previousPage():i.nextPage(),i.swipeEndX=0,i.swipeEndY=0,i.swipeStartX=0,i.swipeStartY=0,void(i.isMouseDown=!1);if("drawing"===i.state.mode&&i.isMouseDown){var t=i.elements[i.state.currentPage],n=i.context,o=n.user.email||n.anonymousIdentifier,a=i.currentPoints,s=i.canvas,r=s.width,l=s.height;a[0]/=r/Zt,a[1]/=l/Zt;for(var c=2;c<a.length-2;c+=2){var d=(a[c]+a[c+2])/2,u=(a[c+1]+a[c+3])/2;a[c]=d/(r/Zt),a[c+1]=u/(l/Zt)}a[a.length-2]/=r/Zt,a[a.length-1]/=l/Zt;var h={points:a,color:i.state.color,lineWidth:i.state.brushSize*(1+i.force)*.5,page:i.state.currentPage,time:i.time,type:"curve",drawID:Se(6),user:o};t.push(h),i.props.onChange(t),i.ctx.putImageData(i.imageData,0,0),i.drawCurve(h);var p={id:i.id,type:$e.D$,value:JSON.stringify(h),noSave:!0};i.hasChangedSinceLastSave=!0,i.state.groupMode||n.isOwner()&&i.state.transmitOwner?n.log(p,"members"):n.log(p,"owners"),i.currentPoints=[]}else if("drag"===i.state.mode&&i.isMouseDown){if(i.ctx.stroke(),i.ctx.closePath(),i.ctx.setLineDash([]),!i.selectedElements){gt("Select elements...");var v=i.elements[i.state.currentPage],g=i.nUndos[i.state.currentPage];i.selectedElements=null;for(var f=[],m=0;m<v.length-g;m++){var w=v[m];w.selected=!1;var y=w.points;if(y)for(var Z=0,b=y.length;Z<b;Z+=2){var P=y[Z]*i.canvas.width,x=y[Z+1]*i.canvas.height;if(i.ctx.isPointInPath(P,x)){w.selected=!0,f.push(w);break}}else w.x&&w.y&&i.ctx.isPointInPath(w.x*i.canvas.width,w.y*i.canvas.height)&&(w.selected=!0,f.push(w))}f.length>0&&(i.selectedElements=f,i.dragPoints=i.currentPoints)}i.redrawWhenDragging()}i.isMouseDown=!1})),(0,u.Z)((0,r.Z)(i),"draw",(function(e){if(e.stopPropagation(),i.state.swiping&&e.touches&&e.touches.length>1){i.swipeEndX=e.touches[0].screenX,i.swipeEndY=e.touches[0].screenY,i.isMouseDown=!1;var t=i.swipeEndY-i.swipeStartY;i.verticalScroll(t)}else{var n=i.context,o=i.mousePosition(e),a=o.x,s=o.y;if("drag"===i.state.mode&&i.selectedElements&&i.isMouseDown){gt("Drag elements around...");for(var r=(a-i.x)/(i.canvas.width/Zt),l=(s-i.y)/(i.canvas.height/Zt),c=i.selectedElements,d=0;d<c.length;d++){var u=c[d];if("curve"===u.type)for(var h=u.points,p=0;p<h.length;p++)h[p]+=p%2==0?r:l;else"text"===u.type&&(u.x+=r,u.y+=l)}for(var v=0;v<i.dragPoints.length;v+=2)i.dragPoints[v]+=a-i.x,i.dragPoints[v+1]+=s-i.y;var g=n.user.email||n.anonymousIdentifier,f={id:i.id,type:$e.bW,value:JSON.stringify({dx:r,dy:l,page:i.state.currentPage,drawIDs:c.map((function(e){return e.drawID})),user:g,sessionID:n.sessionID}),noSave:!0};return i.hasChangedSinceLastSave=!0,n.isOwner()||i.state.groupMode?n.log(f,"members"):n.log(f),i.x=a,i.y=s,i.redrawWhenDragging()}if(i.isMouseDown&&!i.props.disabled){if("delete"===i.state.mode)return gt("Check whether to delete element..."),i.checkDeletion(e);if(i.currentPoints.push(a),i.currentPoints.push(s),"drawing"===i.state.mode){var m={color:i.state.color,lineWidth:i.state.brushSize*(1+i.force)*.5,startX:i.x,startY:i.y,endX:a,endY:s,shadow:0,type:"line"};i.drawElement(m)}else"drag"!==i.state.mode||i.selectedElements||(xt(i.ctx),i.ctx.lineTo(a,s),i.ctx.stroke());i.x=a,i.y=s}}})),(0,u.Z)((0,r.Z)(i),"toggleTransmit",(function(){i.setState({transmitOwner:!i.state.transmitOwner})})),(0,u.Z)((0,r.Z)(i),"uploadSketches",(function(){i.setState({isExporting:!0},(function(){i.preparePDF((function(e,t){var n=i.context;t.getBase64((function(e){gt("Processing base64 string of PDF document");var t=new FormData,o=i.id+".pdf",a=(0,ge.Z)(e,"application/pdf"),s=new File([a],o,{type:"application/pdf"});t.append("file",s);n.uploadFile({formData:t,callback:function(e,t){var o;if(e)i.setState({isExporting:!1,showUploadModal:!0,modalMessage:e.message});else{var a=t.filename,s=n.server+"/"+a;i.setState({isExporting:!1,showUploadModal:!0,modalMessage:(0,h.Z)("span",{},void 0,i.props.t("upload-successful"),": ",o||(o=(0,h.Z)("a",{href:s,target:"_blank",rel:"noopener noreferrer"},void 0,s)))});var r={text:"".concat(i.props.t("upload-email",{name:n.user.name}),'<a href="').concat(s,'">').concat(s,"</a>."),subject:i.props.t("pdf-uploaded")};n.sendMail(r,n.user.email)}}})}))}))}))})),(0,u.Z)((0,r.Z)(i),"saveAsPNG",(function(){var e=i.state.currentPage,t=i.id+"_"+(e+1)+".png",n=i.canvas;i.backgrounds[e]||(i.ctx.fillStyle="white",i.ctx.fillRect(0,0,n.width,n.height)),n.toBlob((function(e){(0,ve.Z)(e,t)}))})),(0,u.Z)((0,r.Z)(i),"preparePDF",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie();gt("Assembling PDF document object...");var t={content:[],pageSize:{width:i.canvas.width,height:i.canvas.height},pageMargins:[0,0,0,0]},n=0,o=function o(){gt("Creating page ".concat(n+1)),i.renderBackground(n).then((function(){var a=i.sharedElements[n];if(a&&a.length>0)for(var s=0;s<a.length;s++)i.drawElement(a[s]);a=i.elements[n];var r=i.nUndos[n];if(a&&a.length>0){var l=a.length-r;gt("Rendering ".concat(a.length," elements on page ").concat(n,"..."));for(var c=0;c<l;c++)i.drawElement(a[c])}var d=i.canvas.toDataURL();if(t.content.push({image:d,width:i.canvas.width}),!((n+=1)<i.state.noPages))return gt("Creating PDF..."),e(null,f().createPdf(t));o()}))};o()})),(0,u.Z)((0,r.Z)(i),"toggleSaveModal",(function(){i.setState({showSaveModal:!i.state.showSaveModal})})),(0,u.Z)((0,r.Z)(i),"saveAsPDF",(function(){i.setState({isExporting:!0},(function(){i.preparePDF((function(e,t){var n=i.id;t.download(n+".pdf",(function(){i.setState({isExporting:!1}),i.debouncedRedraw()}))}))}))})),(0,u.Z)((0,r.Z)(i),"insertPage",(function(e,t){"text"===i.state.mode&&i.insertTextFromInput(),i.elements.splice(e,0,[]),i.backgrounds.splice(e,0,null),i.sharedElements.splice(e,0,0),i.nUndos.splice(e,0,0);for(var n=document.querySelector(".textLayer");n.firstChild;)n.removeChild(n.firstChild);var o=i.context,a=i.state.insertedPages;a.push({page:e,email:t||o.user.email}),i.setState({noPages:i.state.noPages+1,currentPage:e,insertedPages:a},(function(){i.updateURL(i.state.currentPage),i.debouncedRedraw(),t||(i.hasChangedSinceLastSave=!0,o.log({id:i.id,type:$e.bM,value:JSON.stringify({pos:e})},o.isOwner()?"members":o.user.email))}))})),(0,u.Z)((0,r.Z)(i),"insertTextFromInput",(function(){var e=parseInt(i.textInput.style.left,10)-i.leftMargin,t=parseInt(i.textInput.style.top,10)-1.2*i.state.fontSize,n=i.textInput.value;i.textInput.value="",i.textInput.style.top=String(parseInt(i.textInput.style.top,10)+1.2*i.state.fontSize)+"px";var o=i.context,a=o.user.email||o.anonymousIdentifier,s=i.state.currentPage,r={value:n,x:e/(i.canvas.width/Zt),y:t/(i.canvas.height/Zt),color:i.state.color,fontSize:i.state.fontSize,fontFamily:i.state.fontFamily,time:i.time,type:"text",page:s,user:a,drawID:Se(6)};i.drawText(r);var l=i.elements[s],c=i.nUndos[s];c>0&&(l.splice(l.length-c),gt("Page ".concat(s," now has ").concat(l.length," elements")),i.nUndos[s]=0),r.shouldLog=!1,l.push(r),i.props.onChange(l)})),(0,u.Z)((0,r.Z)(i),"handleEnter",(function(e){gt("Check if user hit ENTER..."),13===e.keyCode&&i.insertTextFromInput()})),(0,u.Z)((0,r.Z)(i),"drawText",(function(e){var t=e.x,n=e.y,o=e.value,a=e.color,s=e.drawID,r=e.user,l=e.fontSize,c=e.fontFamily,d=e.selected,u=e.shouldLog,h=void 0===u||u,p=i.ctx;p.font="".concat(l,"px ").concat(c),p.shadowBlur=0,p.fillStyle=d?"orange":a;var v=$()(t*(i.canvas.width/Zt)),g=$()(n*(i.canvas.height/Zt))+l;gt("Draw text at x: ".concat(v," and y: ").concat(g)),p.fillText(o,v,g);var f=i.context;if(h){var m={id:i.id,type:$e.nO,value:JSON.stringify({x:t,y:n,value:o,color:a,fontSize:l,fontFamily:c,page:i.state.currentPage,drawID:s,user:r,type:"text"})};i.hasChangedSinceLastSave=!0,f.isOwner()||i.state.groupMode?f.log(m,"members"):f.log(m)}})),(0,u.Z)((0,r.Z)(i),"handleClick",(function(e){if(gt("Handle click event..."),"text"===i.state.mode){var t=i.mousePosition(e),n=t.x,o=t.y,a=i.textInput;a.style.left=String(n+i.leftMargin)+"px",a.style.width=String(window.innerWidth-(n+i.leftMargin))+"px",a.style.top=o+"px";var s=ee()(i.state.canvasWidth-n,60);gt("Resize to width ".concat(s,"...")),a.style.width="".concat(s,"px"),a.focus()}else"deletion"===i.state.mode&&(gt("Checking whether a shape has been selected..."),i.checkDeletion(e))})),(0,u.Z)((0,r.Z)(i),"checkDeletion",(function(e){for(var t=i.mousePosition(e),n=t.x,o=t.y,a=i.elements[i.state.currentPage],s=i.nUndos[i.state.currentPage],r=null,l=0;l<a.length-s;l++){var c=a[l];if("curve"===c.type){var d=c.points;if(i.ctx.beginPath(),i.ctx.lineCap="round",i.ctx.lineWidth=ee()(c.lineWidth,16),ze(i.ctx,d,i.canvas.width/Zt,i.canvas.height/Zt,.9,1),i.ctx.closePath(),i.ctx.isPointInStroke(n*Zt,o*Zt)){gt("Point (".concat(n,", ").concat(o,") is in path of element with ID ").concat(c.drawID)),r=l;break}}else if("text"===c.type){var u=i.ctx.measureText(c.value).width,h=$()(c.x*(i.canvas.width/Zt)),p=$()(c.y*(i.canvas.height/Zt));if(h<=n&&n<=h+u&&p<=o&&o<=p+c.fontSize){r=l;break}}}if(!V()(r)){var v=a[r].drawID;i.deleteElement(v,r);var g=i.context,f=g.user.email||g.anonymousIdentifier,m={id:i.id,type:$e.jd,value:JSON.stringify({drawID:v,page:i.state.currentPage,user:f,sessionID:g.sessionID})};i.hasChangedSinceLastSave=!0,g.isOwner()&&i.state.transmitOwner||i.state.groupMode?g.log(m,"members"):g.log(m,"owners")}})),(0,u.Z)((0,r.Z)(i),"deleteElement",(function(e,t){for(var n,o,s=i.elements[i.state.currentPage],r="delete"===i.state.mode,l=i.nUndos[i.state.currentPage],c=t;c<s.length-l&&s[c].drawID===e;c++)o=c,s[c].selected=!r;for(var d=t;d>=0&&s[d].drawID===e;d--)n=d,s[d].selected=!r;if(r){gt("Delete elements ".concat(n," to ").concat(o));var u=s.splice(n,o-n+1);s.splice.apply(s,[s.length-l,0].concat((0,a.Z)(u))),i.nUndos[i.state.currentPage]=l+u.length,i.onlyRedrawElements()}})),(0,u.Z)((0,r.Z)(i),"firstPage",(function(){0!==i.state.currentPage&&(i.canvasWrapper.scrollTop=0,i.selectedElements&&i.deselectElements(),i.setState({currentPage:0},(function(){i.updateURL(i.state.currentPage),i.debouncedRedraw(),i.context.log({id:i.id,type:$e.QS,value:i.state.currentPage})})))})),(0,u.Z)((0,r.Z)(i),"lastPage",(function(){i.state.currentPage!==i.state.noPages-1&&(i.canvasWrapper.scrollTop=0,i.selectedElements&&i.deselectElements(),i.setState({currentPage:i.state.noPages-1},(function(){i.updateURL(i.state.currentPage),i.debouncedRedraw(),i.context.log({id:i.id,type:$e.$M,value:i.state.currentPage})})))})),(0,u.Z)((0,r.Z)(i),"readURL",(function(){var e=window.location.hash,t=encodeURI(i.id),n=new RegExp(t+"=(\\d+)"),o=e.match(n);return o?ee()(Number(o[1])-1,0):0})),(0,u.Z)((0,r.Z)(i),"updateURL",(function(e){var t=String(window.location.hash);if(!Ve.Z){var n=encodeURI(i.id);if(t)if(t.includes(n)){var o=new RegExp("("+n+")=\\d+");window.location.hash=he()(t,o,"$1=".concat(e+1))}else window.location.hash+="&".concat(n,"=").concat(e+1);else window.location.hash="#/?".concat(n,"=").concat(e+1)}})),(0,u.Z)((0,r.Z)(i),"nextPage",(function(){if(i.state.currentPage<i.state.noPages-1){gt("Should go to next page..."),i.canvasWrapper.scrollTop=0;var e=i.state.currentPage+1;i.selectedElements&&i.deselectElements(),i.props.nodes[i.state.currentPage]&&(0,Je.Z)(i.canvasWrapper),"text"===i.state.mode&&i.insertTextFromInput(),i.setState({currentPage:e},(function(){i.updateURL(i.state.currentPage),i.debouncedRedraw(),i.context.log({id:i.id,type:$e.tn,value:i.state.currentPage})}))}})),(0,u.Z)((0,r.Z)(i),"previousPage",(function(){if(i.state.currentPage>0){i.canvasWrapper.scrollTop=0;var e=i.state.currentPage-1;i.selectedElements&&i.deselectElements(),i.props.nodes[i.state.currentPage]&&(0,Je.Z)(i.canvasWrapper),"text"===i.state.mode&&i.insertTextFromInput(),i.setState({currentPage:e},(function(){i.updateURL(i.state.currentPage),i.debouncedRedraw(),i.context.log({id:i.id,type:$e.YF,value:i.state.currentPage})}))}})),(0,u.Z)((0,r.Z)(i),"gotoPage",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];gt("Should go to page ".concat(e,"...")),(e=parseInt(e,10))!==i.state.currentPage?(i.canvasWrapper&&(i.canvasWrapper.scrollTop=0),i.selectedElements&&i.deselectElements(),i.props.nodes[i.state.currentPage]&&(0,Je.Z)(i.canvasWrapper),"text"===i.state.mode&&i.insertTextFromInput(),i.setState({currentPage:e,showNavigationModal:!1},(function(){(i.updateURL(i.state.currentPage),i.debouncedRedraw(),t)&&i.context.log({id:i.id,type:$e.Db,value:e})}))):i.setState({showNavigationModal:!1})})),(0,u.Z)((0,r.Z)(i),"loadPDF",(function(){var e=document.createElement("input");e.type="file",e.accept=".pdf",e.addEventListener("change",i.handlePDFUpload,!1),e.click()})),(0,u.Z)((0,r.Z)(i),"handlePDFUpload",(function(e){var t=i.context,n=e.target.files,o=new FormData;o.append("file",n[0]),t.uploadFile({formData:o,callback:function(e,n){var o=n.filename,a=t.server+"/"+o;t.updateMetadata("store",i.id,a),i.initializePDF()}})})),(0,u.Z)((0,r.Z)(i),"initializePDF",(function(){gt("Initialize PDF document at ".concat(i.props.pdf,"..."));var e=i.context;return new Promise((function(t,n){var o=e.metadata.store[i.id];ct.getDocument({url:i.props.pdf||o,disableFontFace:!1}).promise.then((function(e){gt("Retrieved PDF document... "),i.processPDF(e,(function(e){e?(gt("Encountered error in 'processPDF': ".concat(e.message)),n(e)):t()}))})).catch((function(e){gt("Encountered an error in 'initializePDF': ".concat(e.message))}))}))})),(0,u.Z)((0,r.Z)(i),"processPDF",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie();gt("PDF loaded...");for(var n=e.numPages,o=new Array(n),a=new Array(n),s=new Array(n),r=new Array(n),l=0;l<n;l++)o[l]=[],a[l]=e.getPage(l+1),s[l]=[],r[l]=0;return Promise.all(a).then((function(e){gt("Retrieved all pages..."),i.backgrounds=e,i.elements=o,i.sharedElements=s,i.nUndos=r,i.setState({currentPage:Ve.Z?0:i.readURL(),noPages:n},(function(){i.state.hasRetrievedData&&i.drawPage(i.state.currentPage)})),t(null)})).catch((function(e){gt(e),t(e)}))})),(0,u.Z)((0,r.Z)(i),"save",(function(){if(!i.hasChangedSinceLastSave)return new Promise((function(e){e()}));var e=i.context,t=le()(i.state,mt),n={elements:i.elements,nUndos:i.nUndos,state:t};return i.hasChangedSinceLastSave=!1,e.anonymous?(gt("Save created elements to local storage..."),e.store.setItem(i.id,n)):(gt("Saving data on server..."),e.saveSketchpadData(i.id,n))})),(0,u.Z)((0,r.Z)(i),"closeResponseModal",(function(){i.setState({showUploadModal:!1,modalMessage:null})})),(0,u.Z)((0,r.Z)(i),"toggleNavigationModal",(function(){i.setState({showNavigationModal:!i.state.showNavigationModal})})),(0,u.Z)((0,r.Z)(i),"toggleDeletePageModal",(function(){i.setState({showDeletePageModal:!i.state.showDeletePageModal})})),(0,u.Z)((0,r.Z)(i),"toggleResetModal",(function(){i.setState({showResetModal:!i.state.showResetModal})})),(0,u.Z)((0,r.Z)(i),"toggleTutorial",(function(){i.setState({showTutorial:!i.state.showTutorial})})),(0,u.Z)((0,r.Z)(i),"toggleSwiping",(function(){i.setState({swiping:!i.state.swiping})})),(0,u.Z)((0,r.Z)(i),"movePointerStart",(function(e){e.stopPropagation(),gt("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1&&(i.swipeStartX=e.touches[0].screenX,i.swipeStartY=e.touches[0].screenY)})),(0,u.Z)((0,r.Z)(i),"movePointerEnd",(function(e){e.stopPropagation(),q()(i.swipeEndX-i.swipeStartX)>45&&q()(i.swipeEndY-i.swipeStartY)<40&&(i.swipeEndX>i.swipeStartX?i.previousPage():i.nextPage(),i.swipeEndX=0,i.swipeEndY=0,i.swipeStartX=0,i.swipeStartY=0),i.hideZoom(),i.hidePointer()})),(0,u.Z)((0,r.Z)(i),"movePointer",(function(e){if(e.stopPropagation(),i.state.swiping&&e.touches&&e.touches.length>1){i.swipeEndX=e.touches[0].screenX,i.swipeEndY=e.touches[0].screenY,i.isMouseDown=!1;var t=i.swipeEndY-i.swipeStartY;i.verticalScroll(t)}else{var n=i.context,o=i.mousePosition(e),a=o.x,s=o.y;if("pointer"===i.state.mode)i.pointer.style.opacity=.7,i.pointer.style.left="".concat(a+i.leftMargin,"px"),i.pointer.style.top="".concat(s,"px");else if("zoom"===i.state.mode){var r=i.zoom,l=r.width,c=r.height,d=l/(2*Zt),u=c/(2*Zt);i.zoomCtx.clearRect(0,0,l,c);var h=l/Zt,p=c/Zt,v=a*Zt-d/2,g=s*Zt-u/2,f=0,m=0;v<0&&(f-=v,h+=h/d*(v=0),d+=v),g<0&&(m-=g,p+=p/u*(g=0),u+=g),i.zoomCtx.drawImage(i.canvas,v,g,d,u,f,m,h,p),i.zoom.style.display="block",i.zoom.style.left="".concat(a-d+i.leftMargin,"px"),i.zoom.style.top="".concat(s-u,"px")}var w={id:i.id,type:"pointer"===i.state.mode?$e.$h:$e.fT,value:JSON.stringify({x:a/(i.canvas.width/Zt),y:s/(i.canvas.height/Zt),sessionID:n.sessionID}),noSave:!0};n.log(w,"members")}})),(0,u.Z)((0,r.Z)(i),"toLocalPage",(function(e,t){for(var n=i.state.insertedPages,o=e,a=0;a<n.length;a++){var s=n[a],r=s.page,l=s.email;r<e&&l!==t&&(o+=1)}return o})),(0,u.Z)((0,r.Z)(i),"toOriginalPage",(function(e){for(var t=i.state.insertedPages,n=e,o=0;o<t.length;o++){var a=t[o].page;if(a===e)return null;a<e&&(n-=1)}return gt("Page with index ".concat(e," corresponds to original page number ").concat(n,"...")),n})),i.force=1,i.scaleRatio=1,i.elements=new Array(e.noPages),i.backgrounds=new Array(e.noPages),i.sharedElements=new Array(e.noPages),i.nUndos=new Array(e.noPages);for(var l=0;l<e.noPages;l++)i.elements[l]=[],i.backgrounds[l]=null,i.sharedElements[l]=[],i.nUndos[l]=0;i.hasChangedSinceLastSave=!1,i.canvas=null,i.ctx=null,i.id=e.id||ft(e);var c=Ve.Z?0:i.readURL();return i.state={color:e.color,brushSize:e.brushSize,currentPage:c,fill:e.fill,fontFamily:e.fontFamily,fontSize:e.fontSize,groupMode:e.groupMode,hideInputButtons:e.hideInputButtons||o.presentationMode,hideNavigationButtons:e.hideNavigationButtons||o.presentationMode,hideSaveButtons:e.hideSaveButtons||o.presentationMode,hideTransmitButtons:e.hideTransmitButtons||o.presentationMode,isExporting:!1,modalMessage:null,noPages:e.noPages,insertedPages:[],showUploadModal:!1,mode:"none",showNavigationModal:!1,transmitOwner:e.transmitOwner,showInstructorAnnotations:!0,receiveFrom:{},showDeletePageModal:!1,showResetModal:!1,showTutorial:e.showTutorial,showFeedbackModal:!1,showSaveModal:!1,swiping:!0,verticalOffset:60,hasRetrievedData:!1},i.isMouseDown=!1,i.leftMargin=0,i.debouncedRedraw=P()(i.redraw,100),i}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.context;this.zoomCtx&&this.zoomCtx.setTransform(Zt,0,0,Zt,0,0),this.ctx&&this.ctx.setTransform(Zt,0,0,Zt,0,0),this.props.fullscreen&&window.addEventListener("resize",this.handleResize),window.addEventListener("unload",this.save),(this.props.pdf||t.metadata.store[this.id]?this.initializePDF():Promise.resolve()).then((function(){(t.anonymous?t.getSketchpadVisitorData(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){gt(e)}))})),Z().set(".sketch-canvas",{change:function(t){e.force=t}}),t&&(this.unsubscribe=t.subscribe((function(n,o){n!==_e.Fw&&n!==_e.E7||(t.anonymous?t.store.getItem(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){gt(e)}));if(n===_e.KI&&e.initializePDF(),n===$e.x$){gt("Hide control buttons in presentation mode...");var a={hideInputButtons:t.presentationMode,hideNavigationButtons:t.presentationMode,hideSaveButtons:t.presentationMode,hideTransmitButtons:t.presentationMode};e.props.fullscreen&&(a.verticalOffset=t.presentationMode?30:60,a.canvasHeight=window.innerHeight-a.verticalOffset,a.canvasWidth=window.innerWidth-40),e.setState(a,(function(){e.debouncedRedraw()}))}else if(n===_e.Wh){if(o.id!==e.id)return;var s=o.type;if(gt("Received member action of type: "+s),o.email===t.user.email)if(s===$e.$h){var i=JSON.parse(o.value),r=i.x,l=i.y;i.sessionID!==t.sessionID&&(r*=e.canvas.width/Zt,l*=e.canvas.height/Zt,r="".concat(r+e.leftMargin,"px"),l="".concat(l,"px"),e.pointer.style.left=r,e.pointer.style.top=l,e.pointer.style.opacity=.7)}else if(s===$e.Ty)e.pointer.style.opacity=0;else if(s===$e.fT){var c=JSON.parse(o.value),d=c.x,u=c.y;if(c.sessionID!==t.sessionID){d*=e.canvas.width/Zt,u*=e.canvas.height/Zt;var h=e.zoom,p=h.width,v=h.height,g=p/(2*Zt),f=v/(2*Zt);e.zoomCtx.clearRect(0,0,p,v);var m=p/Zt,w=v/Zt,y=d*Zt-g/2,Z=u*Zt-f/2,b=0,P=0;y<0&&(b-=y,m+=m/g*(y=0),g+=y),Z<0&&(P-=Z,w+=w/f*(Z=0),f+=Z),e.zoomCtx.drawImage(e.canvas,y,Z,g,f,b,P,m,w);var x="".concat(d-g+e.leftMargin,"px"),S="".concat(u-f,"px");e.zoom.style.top=S,e.zoom.style.left=x,e.zoom.style.display="block"}}else if(s===$e.FK)e.zoom.style.display="none";else if(s===$e.Qr){var k=JSON.parse(o.value),M=k.diffY;k.sessionID!==t.sessionID&&(M*=e.canvas.height,e.canvasWrapper.scrollTop-=.1*M)}if(t.isOwner()){if(e.state.receiveFrom.name!==o.name&&!o.owner&&!e.state.groupMode)return;o.email===t.user.email&&(s!==$e.tn&&s!==$e.YF&&s!==$e.Db&&s!==$e.QS&&s!==$e.$M||(gt("Go to page ".concat(o.value,"...")),e.gotoPage(o.value,!1)))}if(s===$e.nO||s===$e.D$){var E=JSON.parse(o.value),C=e.elements[E.page],D=e.sharedElements[E.page],R=!1;if(E.user===t.user.email||E.user===t.anonymousIdentifier)for(var I=0;I<C.length;I++)if(C[I].drawID===E.drawID){R=!0;break}R||(E.shouldLog=!1,E.page===e.state.currentPage&&e.state.showInstructorAnnotations&&("text"===E.type?e.drawText(E):e.drawCurve(E)),E.user===t.user.email?C.push(E):D.push(E),e.props.onChange(C))}else if(s===$e.bM){var T=JSON.parse(o.value).pos;o.email!==t.user.email&&(T=e.toLocalPage(T,o.email)),Pt(T,e.state.insertedPages)||(gt("Should insert page at ".concat(T,"...")),e.insertPage(T,o.email))}else if(s===$e.jd){var O=JSON.parse(o.value),z=O.drawID,N=O.page,L=O.user,F=O.sessionID;if(gt("Should delete element with id ".concat(z," by user ").concat(L)),F!==t.sessionID){for(var B,H=o.email===t.user.email?e.elements[N]:e.sharedElements[N],W=0;W<H.length;W++)if(H[W].drawID===z&&H[W].user===L){B=W;break}(0,U.isPrimitive)(B)&&(H.splice(B,1),e.debouncedRedraw())}}else if(s===$e.bW){var A=JSON.parse(o.value),Y=A.drawIDs,j=A.user,K=A.page,J=A.dx,V=A.dy,G=A.sessionID;if(gt("Should drag specified elements by dx: ".concat(J," and dy: ").concat(V,"...")),G!==t.sessionID){for(var $=o.email===t.user.email?e.elements[K]:e.sharedElements[K],_=0;_<$.length;_++){var q=$[_];if(X()(Y,q.drawID)&&q.user===j)if("curve"===q.type)for(var Q=q.points,ee=0;ee<Q.length;ee++)Q[ee]+=ee%2==0?J:V;else"text"===q.type&&(q.x+=J,q.y+=V)}e.debouncedRedraw()}}else if(s===$e.wi){var te=JSON.parse(o.value),ne=te.page,oe=te.sessionID,ae=o.email;if(oe!==t.sessionID)if(ae===t.user.email)e.clearPage(ne);else{for(var se=e.sharedElements[ne],ie=[],re=0;re<se.length;re++){var le=se[re];le.user!==ae&&ie.push(le)}e.sharedElements[ne]=ie,e.debouncedRedraw()}}else if(s===$e.Wp&&o.value!==t.sessionID)if(o.email===t.user.email)e.clearAll(!0);else{for(var ce=o.email,de=0;de<e.state.noPages;de++){for(var ue=e.sharedElements[de],he=[],pe=0;pe<ue.length;pe++){var ve=ue[pe];ve.user!==ce&&he.push(ve)}e.sharedElements[de]=he}e.debouncedRedraw()}}}))),this.props.autoSave&&(this.saveInterval=setInterval(this.save,this.props.intervalTime));var n={passive:!1,capture:!0};document.addEventListener("touchstart",this.preventDefaultTouch,n),document.addEventListener("touchend",this.preventDefaultTouch,n),document.addEventListener("touchmove",this.preventDefaultTouch,n),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.props.fullscreen&&document.body.addEventListener("gesturestart",bt),Ve.Z||window.addEventListener("hashchange",this.handleHashChange)}},{key:"componentDidUpdate",value:function(e){var t=this;if(gt("Component did update..."),e.noPages!==this.props.noPages){this.elements=new Array(this.props.noPages),this.backgrounds=new Array(this.props.noPages),this.sharedElements=new Array(this.props.noPages),this.nUndos=new Array(this.props.noPages);for(var n=0;n<this.props.noPages;n++)this.elements[n]=[],this.backgrounds[n]=null,this.sharedElements[n]=[],this.nUndos[n]=0;this.setState({noPages:this.props.noPages},(function(){t.debouncedRedraw()}))}e.pdf!==this.props.pdf&&this.initializePDF(),this.props.canvasWidth===e.canvasWidth&&this.props.canvasHeight===e.canvasHeight||this.debouncedRedraw(),this.props.fill!==e.fill&&this.setState({fill:this.props.fill},this.redraw)}},{key:"componentWillUnmount",value:function(){this.save(),this.saveInterval&&clearInterval(this.saveInterval),this.unsubscribe&&this.unsubscribe(),window.removeEventListener("resize",this.handleResize),Ve.Z||window.removeEventListener("hashchange",this.handleHashChange),window.removeEventListener("unload",this.save);var e={passive:!1};document.removeEventListener("touchstart",this.preventDefaultTouch,e),document.removeEventListener("touchend",this.preventDefaultTouch,e),document.removeEventListener("touchmove",this.preventDefaultTouch,e),document.removeEventListener("visibilitychange",this.handleVisibilityChange,e),this.props.fullscreen&&document.removeEventListener("gesturestart",bt)}},{key:"deselectElements",value:function(){gt("Deselect elements...");var e=this.selectedElements;if(e)for(var t=0;t<e.length;t++)e[t].selected=!1;this.selectedElements=null,this.dragPoints=null,this.canvasBuffer=null}},{key:"renderProgressModal",value:function(){return this.state.isExporting?(0,h.Z)(I.Z,{show:this.state.isExporting,onHide:ie()},void 0,(0,h.Z)(I.Z.Header,{},void 0,(0,h.Z)(I.Z.Title,{},void 0,this.props.t("generate-pdf")))):null}},{key:"renderUploadModal",value:function(){return this.state.showUploadModal?(0,h.Z)(I.Z,{show:this.state.showUploadModal,onHide:this.closeResponseModal},void 0,(0,h.Z)(I.Z.Header,{closeButton:!0},void 0,(0,h.Z)(I.Z.Title,{},void 0,this.props.t("server-response"))),(0,h.Z)(I.Z.Body,{},void 0,this.state.modalMessage),(0,h.Z)(I.Z.Footer,{},void 0,(0,h.Z)(R.Z,{onClick:this.closeResponseModal},void 0,this.props.t("close")))):null}},{key:"renderPagination",value:function(){var e=this;if(this.state.hideNavigationButtons)return null;var t=this.props.t,n=this.state.currentPage;return this.props.dynamicallyHideButtons&&this.state.canvasWidth<600?(0,h.Z)(D.Z,{size:"sm",className:"sketch-pages"},void 0,(0,h.Z)(R.Z,{variant:"light",onClick:this.toggleNavigationModal},void 0,n+1,"/",this.state.noPages),(0,h.Z)(me.Z,{owner:!0},void 0,(0,h.Z)(Ne,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"}))):(0,h.Z)(D.Z,{size:"sm",className:"sketch-pages"},void 0,(0,h.Z)(R.Z,{variant:"light",onClick:this.toggleNavigationModal},void 0,n+1,"/",this.state.noPages),(0,h.Z)(Ne,{tooltip:t("goto-first"),onClick:this.firstPage,glyph:"fast-backward",size:"sm"}),(0,h.Z)(Ne,{tooltip:t("goto-previous"),onClick:this.previousPage,glyph:"backward",size:"sm"}),(0,h.Z)(Ne,{tooltip:t("goto-next"),onClick:this.nextPage,glyph:"forward",size:"sm"}),(0,h.Z)(Ne,{tooltip:t("goto-last"),onClick:this.lastPage,glyph:"fast-forward",size:"sm"}),(0,h.Z)(me.Z,{owner:!0},void 0,(0,h.Z)(Ne,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"})))}},{key:"renderInputButtons",value:function(){var e=this;return this.state.hideInputButtons?null:(0,h.Z)(Ye,{brushSize:this.state.brushSize,color:this.state.color,mode:this.state.mode,fontFamily:this.state.fontFamily,fontSize:this.state.fontSize,onModeChange:function(t){"drag"===e.state.mode&&"drag"!==t?(e.deselectElements(),e.onlyRedrawElements()):"text"===e.state.mode&&e.insertTextFromInput(),e.setState({mode:t}),"pointer"!==t?e.pointer.style.opacity=0:"pointer"===t&&(e.pointer.style.opacity=.7)},onColorChange:function(t){e.setState({color:t})},onBrushSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),"text"===e.state.mode&&e.insertTextFromInput(),e.setState({brushSize:Number(t),mode:"drawing"})},onFontFamilySelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontFamily:t,mode:"text"})},onFontSizeSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontSize:Number(t),mode:"text"})},t:this.props.t})}},{key:"renderRemoveButtons",value:function(){if(this.state.hideInputButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<900)return null;var e=this.props.t;return(0,h.Z)(D.Z,{size:"sm",className:"sketch-undo-redo sketch-button-group"},void 0,(0,h.Z)(Ne,{tooltip:e("undo"),onClick:this.undo,glyph:"step-backward",size:"sm"}),(0,h.Z)(Ne,{tooltip:e("redo"),glyph:"step-forward",onClick:this.redo,size:"sm"}),(0,h.Z)(Ne,{tooltip:e("clear-current"),onClick:this.toggleDeletePageModal,glyph:"eraser",size:"sm"}),(0,h.Z)(Ne,{tooltip:e("reset-pages"),onClick:this.toggleResetModal,glyph:"power-off",size:"sm"}))}},{key:"renderSaveButtons",value:function(){var e=this;if(this.state.hideSaveButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<775)return null;var t=this.context,n=this.props.t;return(0,h.Z)(D.Z,{size:"sm",className:"sketch-save-buttons sketch-button-group"},void 0,this.props.pdf?null:(0,h.Z)(Ne,{tooltip:n("load-pdf"),onClick:this.loadPDF,size:"sm",glyph:"file"}),(0,h.Z)(Ne,{tooltip:n("download"),onClick:this.toggleSaveModal,glyph:"file-pdf",size:"sm"}),(0,h.Z)(Ne,{tooltip:t.anonymous?n("save-local"):n("save-server"),onClick:function(){e.save().then((function(){t.addNotification({title:n("saved"),message:t.anonymous?n("saved-local"):n("saved-server"),level:"success",position:"tr"})})).catch((function(e){t.addNotification({title:n("encountered-error"),message:e.message,level:"error",position:"tr"})}))},glyph:"save",size:"sm"}),(0,h.Z)(Ne,{tooltip:n("upload-to-server"),onClick:this.uploadSketches,glyph:"upload",size:"sm"}),z()?(0,h.Z)(Ne,{tooltip:this.state.swiping?n("disable-swiping"):n("enable-swiping"),variant:this.state.swiping?"success":"secondary",onClick:this.toggleSwiping,glyph:"fingerprint",size:"sm"}):null)}},{key:"renderTransmitButtons",value:function(){var e=this;if(this.state.hideTransmitButtons||this.state.canvasWidth<650)return null;var t,n=this.context.userList.filter((function(e){return V()(e.exitTime)})).map((function(e){return{value:e.name,label:e.name}})),o=(0,h.Z)(M.Z,{id:"popover-positioned-right"},void 0,(0,h.Z)(C.Z,{},void 0,this.props.t("remote-control-by")),(0,h.Z)(E.Z,{},void 0,(0,h.Z)(T.ZP,{isClearable:!0,inline:!0,options:n,onChange:function(t){e.setState({receiveFrom:t})}}),(0,h.Z)(F.Z,{defaultValue:this.state.groupMode,onChange:this.toggleGroupMode,legend:this.props.t("group-mode")})));this.props.pdf&&(t=(0,h.Z)(Ne,{size:"sm",tooltip:"vertical"===this.state.fill?this.props.t("fill-entire-width"):this.props.t("fit-page"),onClick:function(){var t;t="vertical"===e.state.fill?"horizontal":"vertical",e.setState({fill:t},e.redraw)},glyph:"vertical"===this.state.fill?"fas fa-grip-lines":"fas fa-grip-lines-vertical"}));var a=this.props.t;return(0,h.Z)(p.Fragment,{},void 0,(0,h.Z)(me.Z,{owner:!0},void 0,(0,h.Z)(D.Z,{size:"sm",className:"sketch-button-group"},void 0,(0,h.Z)(Ne,{size:"sm",tooltip:this.state.transmitOwner?a("disable-transmissions"):a("enable-transmissions"),variant:this.state.transmitOwner?"success":"light",onClick:this.toggleTransmit,glyph:"bullhorn"}),(0,h.Z)(k.Z,{trigger:"click",placement:"bottom",rootClose:!0,overlay:o},void 0,nt||(nt=(0,h.Z)(R.Z,{size:"sm",variant:"light"},void 0,(0,h.Z)("div",{className:"fa fa-eye"})))),t)),(0,h.Z)(me.Z,{notOwner:!0},void 0,(0,h.Z)(D.Z,{size:"sm",className:"sketch-button-group"},void 0,(0,h.Z)(Ne,{size:"sm",tooltip:this.state.showInstructorAnnotations?a("show-only-own-annotations"):a("show-all-annotations"),variant:this.state.showInstructorAnnotations?"success":"light",onClick:function(){e.setState({showInstructorAnnotations:!e.state.showInstructorAnnotations},(function(){e.debouncedRedraw()}))},glyph:this.state.showInstructorAnnotations?"fa fa-toggle-on":"fa fa-toggle-off"}),t)))}},{key:"verticalScroll",value:function(e){if(e>30||e<-30){var t=this.context,n={id:this.id,type:$e.Qr,value:JSON.stringify({diffY:e/this.canvas.height,sessionID:t.sessionID}),noSave:!0};t.log(n,"members"),this.canvasWrapper.scrollTop-=.1*e}}},{key:"renderFeedbackButtons",value:function(){var e=this,t=this.toOriginalPage(this.state.currentPage);return!this.props.feedbackButtons||V()(t)?null:(0,h.Z)(p.Fragment,{},void 0,(0,h.Z)(H.Z,{id:"".concat(this.id,"-slide-").concat(t),customFeedback:!1,vertical:!0,style:{zIndex:3,position:"absolute",top:35,right:20}},"".concat(this.id,"-slide-").concat(t)),(0,h.Z)(me.Z,{owner:!0},void 0,(0,h.Z)(B.Z,{tooltip:this.props.t("open-slide-feedback"),placement:"left"},void 0,(0,h.Z)(R.Z,{onClick:function(){return e.setState({showFeedbackModal:!e.state.showFeedbackModal})},variant:"secondary",size:"sm",style:{right:20,top:175,position:"absolute",zIndex:3}},void 0,this.props.t("show")))))}},{key:"render",value:function(){var e,t,n=this;switch(gt("Render sketchpad with height ".concat(this.props.canvasHeight," and width ").concat(this.props.canvasWidth)),this.state.mode){case"drawing":e="crosshair";break;case"text":e="text";break;case"drag":e="move";break;case"delete":e="not-allowed";break;default:e="default"}if("pointer"===this.state.mode||"zoom"===this.state.mode)t={onMouseDown:this.movePointerStart,onMouseMove:this.movePointer,onMouseOut:this.movePointerEnd,onMouseUp:this.movePointerEnd,onTouchCancel:this.movePointerEnd,onTouchEnd:this.movePointerEnd,onTouchMove:this.movePointer,onTouchStart:this.movePointerStart};else if("none"===this.state.mode){var a=function(e){e.stopPropagation(),q()(n.swipeEndX-n.swipeStartX)>45&&q()(n.swipeEndY-n.swipeStartY)<40&&(n.swipeEndX>n.swipeStartX?n.previousPage():n.nextPage(),n.swipeEndX=0,n.swipeEndY=0,n.swipeStartX=0,n.swipeStartY=0)};t={onTouchCancel:a,onTouchEnd:a,onTouchMove:function(e){if(e.stopPropagation(),n.state.swiping&&e.touches&&e.touches.length>1){n.swipeEndX=e.touches[0].screenX,n.swipeEndY=e.touches[0].screenY,n.isMouseDown=!1;var t=n.swipeEndY-n.swipeStartY;n.verticalScroll(t)}},onTouchStart:function(e){e.stopPropagation(),e.touches&&e.touches.length>1&&(n.swipeStartX=e.touches[0].screenX,n.swipeStartY=e.touches[0].screenY)}}}else t={onClick:this.handleClick,onMouseDown:this.drawStart,onMouseMove:this.draw,onMouseOut:this.drawEnd,onMouseUp:this.drawEnd,onTouchCancel:this.drawEnd,onTouchEnd:this.drawEnd,onTouchMove:this.draw,onTouchStart:this.drawStart};var s=p.createElement("canvas",(0,o.Z)({id:"".concat(this.id,"-canvas"),className:"sketch-canvas",width:this.state.canvasWidth*Zt,height:this.state.canvasHeight*Zt,style:rt({cursor:e,width:this.state.canvasWidth,height:this.state.canvasHeight},this.props.style),ref:function(e){e&&(n.canvas=e,n.ctx=e.getContext("2d"))}},t)),i=p.createElement("canvas",{className:"sketchpad-magnifying-glass",width:this.state.canvasWidth*Zt/4,height:this.state.canvasHeight*Zt/4,style:{width:this.state.canvasWidth/4,height:this.state.canvasHeight/4},ref:function(e){e&&(n.zoom=e,n.zoomCtx=e.getContext("2d"),n.zoomCtx.imageSmoothingQuality="high")}});return(0,h.Z)(p.Fragment,{},void 0,p.createElement(S.Z,{id:this.id,ref:function(e){n.sketchpadPanel=e},className:"modal-container",style:{width:this.state.canvasWidth+2,position:"relative",marginBottom:this.props.fullscreen?"0px":"20px",marginLeft:"auto",marginRight:"auto"},tabIndex:"0"},(0,h.Z)("div",{className:"sketch-panel-heading clearfix unselectable"},void 0,this.renderPagination(),this.renderInputButtons(),this.renderRemoveButtons(),this.renderTransmitButtons(),this.renderSaveButtons(),this.context.presentationMode?null:(0,h.Z)(Ne,{tooltip:this.state.showTutorial?this.props.t("stop-tutorial"):this.props.t("start-tutorial"),onClick:this.toggleTutorial,glyph:"question",size:"sm"}),(0,h.Z)(ye.Z,{reference:this,id:this.props.voiceID,commands:Me})),this.renderFeedbackButtons(),(0,h.Z)(St,{nodes:this.props.nodes,currentPage:this.state.currentPage,toOriginalPage:this.toOriginalPage},"overlays"),p.createElement("div",{className:"canvas-wrapper",style:{width:this.state.canvasWidth,height:this.state.canvasHeight},key:"".concat(this.state.canvasWidth,"-").concat(this.state.canvasHeight),ref:function(e){n.canvasWrapper=e}},(0,h.Z)(x.W4,{id:"sketchpadWindow",disabled:L()},void 0,s),i,p.createElement("div",(0,o.Z)({className:"textLayer",ref:function(e){n.textLayer=e},style:{pointerEvents:"none"!==this.state.mode?"none":"auto"}},t)),p.createElement("div",{ref:function(e){n.pointer=e},className:"sketch-pointer"})),p.createElement("input",{type:"text",className:"sketch-text-input",style:{display:"text"===this.state.mode?"inline-block":"none",fontSize:this.state.fontSize,fontFamily:this.state.fontFamily,color:this.state.color,width:this.state.canvasWidth},onKeyDown:this.handleEnter,ref:function(e){n.textInput=e}}),this.renderUploadModal(),this.state.showNavigationModal?(0,h.Z)(ht,{show:this.state.showNavigationModal,onSelect:this.gotoPage,noPages:this.state.noPages,onHide:this.toggleNavigationModal,t:this.props.t}):null,this.renderProgressModal(),this.state.showResetModal?(0,h.Z)(dt,{show:this.state.showResetModal,onSubmit:this.clearAll,onHide:function(){n.setState({showResetModal:!1})},t:this.props.t}):null,this.state.showDeletePageModal?(0,h.Z)(ut,{show:this.state.showDeletePageModal,onSubmit:this.clear,onHide:function(){n.setState({showDeletePageModal:!1})},t:this.props.t}):null,this.state.showSaveModal?(0,h.Z)(vt,{show:this.state.showSaveModal,saveAsPDF:this.saveAsPDF,saveAsPNG:this.saveAsPNG,onHide:this.toggleSaveModal,pdf:this.props.pdf,session:this.context,id:this.id,t:this.props.t}):null,this.state.showFeedbackModal?(0,h.Z)(pt,{session:this.context,show:this.state.showFeedbackModal,onHide:function(){n.setState({showFeedbackModal:!n.state.showFeedbackModal})},id:this.id,noPages:this.state.noPages,toOriginalPage:this.toOriginalPage,gotoPage:this.gotoPage,t:this.props.t}):null,this.state.showTutorial?ot||(ot=(0,h.Z)(fe.ZP,{steps:st,showProgress:!0,run:!0})):null),this.sketchpadPanel?(0,h.Z)(we.Z,{container:this.sketchpadPanel,actions:{ArrowDown:this.nextPage,ArrowUp:this.previousPage}}):null,(0,h.Z)(at,{canvas:this.canvas}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.fullscreen?{canvasHeight:window.innerHeight-t.verticalOffset,canvasWidth:window.innerWidth-40}:t.canvasHeight!==e.canvasHeight||t.canvasWidth!==e.canvasWidth?{canvasHeight:e.canvasHeight,canvasWidth:e.canvasWidth}:null}}]),n}(p.Component);kt.defaultProps={autoSave:!0,feedbackButtons:!1,intervalTime:1e4,hideInputButtons:!1,hideNavigationButtons:!1,hideSaveButtons:!1,hideTransmitButtons:!1,brushSize:4,color:"#444444",canvasWidth:1200,canvasHeight:700,fullscreen:!1,fill:"vertical",disabled:!1,fontFamily:"Arial",fontSize:24,nodes:{},noPages:1,pdf:null,showTutorial:!1,dynamicallyHideButtons:!1,transmitOwner:!0,groupMode:!1,voiceID:null,style:{},onChange:function(){}},kt.contextType=ke.Z;var Mt=(0,v.Z)("sketchpad")((0,qe.W)(kt))},423879:function(e,t,n){"use strict";n(850110),n(446964);t.Z=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,o=atob(e),a=[],s=0;s<o.length;s+=n){for(var i=o.slice(s,s+n),r=new Array(i.length),l=0;l<i.length;l++)r[l]=i.charCodeAt(l);var c=new Uint8Array(r);a.push(c)}var d=new Blob(a,{type:t});return d}},543414:function(e,t,n){"use strict";var o=n(928316),a=n(569257),s=n.n(a),i=n(320765);t.Z=function(e){if(e){var t=(0,o.findDOMNode)(e);if(t)for(var n=t.getElementsByClassName("hint-button"),a=0;a<n.length;a++)s()(n[a].innerText,i.a.t("components:close"))&&n[a].click()}}},42720:function(e,t,n){"use strict";n(59357),n(6059);var o=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i;function a(e){setImmediate((function(){throw e}),0)}function s(e){return o.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}var i=function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t,n=e.document,o=!1;n&&n.createElementNS&&(t=n.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in t);var i=/constructor/i.test(e.HTMLElement)||e.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),l=e.setImmediate||e.setTimeout,c=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=s(e)),navigator.msSaveOrOpenBlob(e,t)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=null,c.onwritestart=null,c.onprogress=null,c.onwrite=null,c.onabort=null,c.onerror=null,c.onwriteend=null,function(e,t,n){return new h(e,t||e.name||"download",n)})}function d(){return e.URL||e.webkitURL||e}function u(e){setTimeout((function(){"string"==typeof e?d().revokeObjectURL(e):e.remove()}),4e4)}function h(n,c,h){h||(n=s(n));var p,v=this,g="application/octet-stream"===n.type;function f(){!function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var s=e["on"+t[o]];if("function"==typeof s)try{s.call(e,n||e)}catch(i){a(i)}}}(v,"writestart progress write writeend".split(" "))}if(v.readyState=v.INIT,o)return p=d().createObjectURL(n),void l((function(){var e,n;t.href=p,t.download=c,e=t,n=new MouseEvent("click"),e.dispatchEvent(n),f(),u(p),v.readyState=v.DONE}),0);!function(){if((r||g&&i)&&e.FileReader){var t=new FileReader;return t.onloadend=function(){var n=r?t.result:t.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(n,"_blank")||(e.location.href=n),n=void 0,v.readyState=v.DONE,f()},t.readAsDataURL(n),void(v.readyState=v.INIT)}p||(p=d().createObjectURL(n)),g?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),v.readyState=v.DONE,f(),u(p)}()}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.Z=i},921455:function(e,t){"use strict";t.Z=function(e){e.stopPropagation()}},995729:function(){},535635:function(){},737684:function(){},286339:function(){},347629:function(){},891940:function(){}}]);