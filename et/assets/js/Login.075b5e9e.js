"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[74438],{603396:function(e,t,s){s.r(t);var a=s(202784),o=s(928316),n=s(510201),i=s(213980),r=s.n(i),l=s(690299),h=s.n(l),p=s(498614),m=s(770561),d=s(26266),c=s(10863),u=s(830650),w=s(889969),g=s(875084),f=s(715318),y=s(435376),v=s(992500),S=s(862816),E=s(123103),I=Object.defineProperty,Z=(e,t,s)=>(((e,t,s)=>{t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const C=h()("isle:login");class P extends a.Component{constructor(e){super(e),Z(this,"handleInputChange",(e=>{e.stopPropagation();const t=e.target,s=t.value,a=t.name;this.setState({[a]:s})})),Z(this,"handleForgotPassword",(e=>{if(e.preventDefault(),""===this.state.email)this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.emailInput),invalidInputMessage:this.props.t("enter-email-before-password-reset")});else{this.context.forgotPassword(this.state.email)}})),Z(this,"hideAfterDelay",(()=>{setTimeout((()=>{this.setState({showInputOverlay:!1})}),2e3)})),Z(this,"handleKeyPress",(e=>{e.stopPropagation(),13===e.charCode&&this.handleSubmit(e)})),Z(this,"handleSubmit",(e=>{e.preventDefault();const t={password:this.state.password,email:this.state.email};if(this.state.showTFA){t.token=this.state.token;return this.context.login(t,((e,t,s)=>{e||"ok"!==s.message||this.props.onClose()}))}if(""===t.email)C("Email input field is empty, show message..."),this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.emailInput),invalidInputMessage:this.props.t("enter-email")},this.hideAfterDelay);else if(""===t.password)C("Password input field is empty, show message..."),this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.passwordInput),invalidInputMessage:this.props.t("enter-password")},this.hideAfterDelay);else{this.context.login(t,((e,t,s)=>{if(!e){const{message:e,type:t}=s;"ok"===e?this.props.onClose():"finish-login-via-tfa"===e?this.setState({showTFA:!0}):this.setState({showInputOverlay:!0,overlayTarget:"no_user"===t?this.emailInput:this.passwordInput,invalidInputMessage:e},this.hideAfterDelay)}}))}})),this.state={email:"",password:"",show:e.show,showTFA:!1,token:"",hasSSO:!1}}static getDerivedStateFromProps(e,t){return e.show!==t.show?{email:"",password:"",show:e.show,showTFA:!1}:null}componentDidMount(){const e=this.context;n.Z.get(e.server+"/saml-xmw/login-type").then((t=>{"SSO"===t.data?window.location.assign(e.server+"/saml-xmw/login-choice?url=/"+e.namespaceName+"/"+e.lessonName):"Both"===t.data&&this.setState({hasSSO:!0})})).catch((e=>{C(e)}))}render(){const e=this.context;return a.createElement(f.Z,{show:this.props.show,className:"login-modal",onHide:this.props.onClose},a.createElement(f.Z.Header,{closeButton:!0},a.createElement(f.Z.Title,{as:"h3"},this.props.t("login"))),a.createElement(f.Z.Body,null,a.createElement(w.Z,{horizontal:!0,className:"d-grid gap-3"},a.createElement(c.Z,{controlId:"form-email"},a.createElement(u.Z,null,this.props.t("email")),a.createElement(d.Z,{name:"email",type:"email",placeholder:"Email",autoComplete:"username",onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,ref:e=>{this.emailInput=e},disabled:this.state.showTFA})),a.createElement(c.Z,{controlId:"form-password"},a.createElement(u.Z,null,this.props.t("password")),a.createElement(d.Z,{name:"password",type:"password",placeholder:"Password",autoComplete:"current-password",onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,ref:e=>{this.passwordInput=e},disabled:this.state.showTFA})),this.state.showTFA?a.createElement(c.Z,{controlId:"form-tfa"},a.createElement(u.Z,null,this.props.t("enter-tfa-token")),a.createElement(d.Z,{name:"token",type:"text",placeholder:this.props.t("enter-token"),onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,autoFocus:!0})):null,a.createElement(m.Z,{variant:"primary",type:"submit",onClick:this.handleSubmit},this.props.t("signin")))),a.createElement(f.Z.Footer,null,a.createElement("button",{className:"forgot-password-button",onClick:this.handleForgotPassword},this.props.t("forgot-password")),this.state.hasSSO?a.createElement("a",{className:"sso-link",href:e.server+"/saml-xmw/login-choice?url=/"+e.namespaceName+"/"+e.lessonName},this.props.t("login-with-sso")):null,!1!==e.settings.allowUserRegistrations?a.createElement(m.Z,{onClick:this.props.onShowSignup,variant:"secondary"},this.props.t("create-account")):null),a.createElement(g.Z,{show:this.state.showInputOverlay,target:this.state.overlayTarget,placement:"right",containerPadding:20},a.createElement(y.Z,{id:"popover-contained"},a.createElement(v.Z,null,this.props.t("invalid")),a.createElement(S.Z,null,this.state.invalidInputMessage))))}}P.defaultProps={onClose(){},onShowSignup(){},show:!1},P.propTypes={onClose:r().func,onShowSignup:r().func,show:r().bool},P.contextType=E.Z,t.default=(0,p.Zh)("internal/login")(P)}}]);