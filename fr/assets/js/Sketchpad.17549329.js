(self.webpackChunk=self.webpackChunk||[]).push([[65050],{19085:function(e,t,s){"use strict";s.d(t,{xV:function(){return ce},W4:function(){return me},sN:function(){return A}});var i=s(202784),n=s(213980),o=s.n(n),a=s(72779),r=s.n(a);function h(e,...t){return"function"==typeof e&&e(...t)}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const c="react-contextmenu",d="react-contextmenu--visible",p="react-contextmenu-wrapper",u="react-contextmenu-item",g="react-contextmenu-item--active",m="react-contextmenu-item--disabled",f="react-contextmenu-item--divider",v="react-contextmenu-item--selected",w="react-contextmenu-submenu",b={},y=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),E="REACT_CONTEXTMENU_SHOW",P="REACT_CONTEXTMENU_HIDE";function S(e,t,s=window){let i;"function"==typeof window.CustomEvent?i=new window.CustomEvent(e,{detail:t}):(i=document.createEvent("CustomEvent"),i.initCustomEvent(e,!1,!0,t)),s&&(s.dispatchEvent(i),Object.assign(b,t))}function x(e={},t){S(E,Object.assign({},e,{type:E}),t)}function M(e={},t){S(P,Object.assign({},e,{type:P}),t)}var k=Object.defineProperty,C=(e,t,s)=>(((e,t,s)=>{t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);var D=new class{constructor(){C(this,"handleShowEvent",(e=>{for(const t in this.callbacks)l(this.callbacks,t)&&this.callbacks[t].show(e)})),C(this,"handleHideEvent",(e=>{for(const t in this.callbacks)l(this.callbacks,t)&&this.callbacks[t].hide(e)})),C(this,"register",((e,t)=>{const s=Math.random().toString(36).substring(7);return this.callbacks[s]={show:e,hide:t},s})),C(this,"unregister",(e=>{e&&this.callbacks[e]&&delete this.callbacks[e]})),this.callbacks={},y&&(window.addEventListener(E,this.handleShowEvent),window.addEventListener(P,this.handleHideEvent))}},I=Object.defineProperty,O=Object.defineProperties,T=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,L=(e,t,s)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,F=(e,t,s)=>(L(e,"symbol"!=typeof t?t+"":t,s),s);class H extends i.Component{constructor(){super(...arguments),F(this,"handleClick",(e=>{0!==e.button&&1!==e.button&&e.preventDefault(),this.props.disabled||this.props.divider||(h(this.props.onClick,e,Object.assign({},this.props.data,b.data),b.target),this.props.preventClose||M())}))}render(){const{attributes:e,children:t,className:s,disabled:n,divider:o,selected:a}=this.props,h=r()(s,u,e.className,{[r()(m,e.disabledClassName)]:n,[r()(f,e.dividerClassName)]:o,[r()(v,e.selectedClassName)]:a});return i.createElement("div",(l=((e,t)=>{for(var s in t||(t={}))z.call(t,s)&&L(e,s,t[s]);if(R)for(var s of R(t))N.call(t,s)&&L(e,s,t[s]);return e})({},e),c={className:h,role:"menuitem",tabIndex:"-1","aria-disabled":n?"true":"false",ref:e=>{this.ref=e},onMouseMove:this.props.onMouseMove,onMouseLeave:this.props.onMouseLeave,onTouchEnd:this.handleClick,onClick:this.handleClick},O(l,T(c))),o?null:t);var l,c}}F(H,"propTypes",{attributes:o().object,children:o().node,className:o().string,data:o().object,disabled:o().bool,divider:o().bool,onClick:o().func,onMouseLeave:o().func,onMouseMove:o().func,preventClose:o().bool,selected:o().bool}),F(H,"defaultProps",{attributes:{},children:null,className:"",data:{},disabled:!1,divider:!1,onClick:()=>null,onMouseMove:()=>null,onMouseLeave:()=>null,preventClose:!1,selected:!1});var A=H,B=Object.defineProperty,$=(e,t,s)=>(((e,t,s)=>{t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class U extends i.Component{constructor(e){super(e),$(this,"handleKeyNavigation",(e=>{if(!1!==this.state.isVisible)switch(e.keyCode){case 37:case 27:e.preventDefault(),this.hideMenu(e);break;case 38:e.preventDefault(),this.selectChildren(!0);break;case 40:e.preventDefault(),this.selectChildren(!1);break;case 39:this.tryToOpenSubMenu(e);break;case 13:e.preventDefault(),this.tryToOpenSubMenu(e);{const t=this.seletedItemRef&&this.seletedItemRef.props&&this.seletedItemRef.props.disabled;this.seletedItemRef&&this.seletedItemRef.ref instanceof HTMLElement&&!t?this.seletedItemRef.ref.click():this.hideMenu(e)}}})),$(this,"handleForceClose",(()=>{this.setState({forceSubMenuOpen:!1})})),$(this,"tryToOpenSubMenu",(e=>{this.state.selectedItem&&this.state.selectedItem.type===this.getSubMenuType()&&(e.preventDefault(),this.setState({forceSubMenuOpen:!0}))})),$(this,"selectChildren",(e=>{const{selectedItem:t}=this.state,s=[];let n=0,o={};const a=(e,t)=>{e&&([A,this.getSubMenuType()].indexOf(e.type)<0?i.Children.forEach(e.props?e.props.children:[],a):e.props.divider||(e.props.disabled&&(++n,o[t]=!0),s.push(e)))};if(i.Children.forEach(this.props.children,a),n===s.length)return;const r=function(t){let i=t;do{e?--i:++i,i<0?i=s.length-1:i>=s.length&&(i=0)}while(i!==t&&o[i]);return i===t?null:i}(s.indexOf(t));null!==r&&this.setState({selectedItem:s[r],forceSubMenuOpen:!1})})),$(this,"onChildMouseMove",(e=>{this.state.selectedItem!==e&&this.setState({selectedItem:e,forceSubMenuOpen:!1})})),$(this,"onChildMouseLeave",(()=>{this.setState({selectedItem:null,forceSubMenuOpen:!1})})),$(this,"renderChildren",(e=>i.Children.map(e,(e=>{const t={};return i.isValidElement(e)?[A,this.getSubMenuType()].indexOf(e.type)<0?(t.children=this.renderChildren(e.props?e.props.children:[]),i.cloneElement(e,t)):(t.onMouseLeave=this.onChildMouseLeave.bind(this),e.type===this.getSubMenuType()&&(t.forceOpen=this.state.forceSubMenuOpen&&this.state.selectedItem===e,t.forceClose=this.handleForceClose,t.parentKeyNavigationHandler=this.handleKeyNavigation),e.props.divider||this.state.selectedItem!==e?(t.onMouseMove=()=>this.onChildMouseMove(e),i.cloneElement(e,t)):(t.selected=!0,t.ref=e=>{this.seletedItemRef=e},i.cloneElement(e,t))):e})))),this.seletedItemRef=null,this.state={selectedItem:null,forceSubMenuOpen:!1}}}$(U,"propTypes",{children:o().node.isRequired});var Z=U,W=s(690299),j=s.n(W),X=s(557106),Y=s.n(X),K=Object.defineProperty,J=Object.defineProperties,V=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,Q=(e,t,s)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ee=(e,t)=>{for(var s in t||(t={}))_.call(t,s)&&Q(e,s,t[s]);if(q)for(var s of q(t))G.call(t,s)&&Q(e,s,t[s]);return e},te=(e,t)=>J(e,V(t)),se=(e,t,s)=>(Q(e,"symbol"!=typeof t?t+"":t,s),s);const ie=j()("isle:contextmenu"),ne=class extends Z{constructor(e){super(e),se(this,"getMenuPosition",(()=>{const{innerWidth:e,innerHeight:t}=window,s=this.subMenu.getBoundingClientRect(),i={};if(s.bottom>t){ie("Bottom of element is below height of window...");const e=`-${Y()(s.height-s.y,0)}px`;i.bottom=e}else ie("Bottom of element does not extend below window dimensions..."),i.top=0;return s.right<e?i.left="100%":i.right="100%",i})),se(this,"getRTLMenuPosition",(()=>{const{innerHeight:e}=window,t=this.subMenu.getBoundingClientRect(),s={};return t.bottom>e?s.bottom=0:s.top=0,t.left<0?s.left="100%":s.right="100%",s})),se(this,"hideMenu",(e=>{e.preventDefault(),this.hideSubMenu(e)})),se(this,"hideSubMenu",(e=>{e.detail&&e.detail.id&&this.menu&&e.detail.id!==this.menu.id||(this.props.forceOpen&&this.props.forceClose(),this.setState({visible:!1,selectedItem:null}),this.unregisterHandlers())})),se(this,"handleClick",(e=>{e.preventDefault(),this.props.disabled||(h(this.props.onClick,e,Object.assign({},this.props.data,b.data),b.target),this.props.onClick&&!this.props.preventCloseOnClick&&M())})),se(this,"handleMouseEnter",(()=>{this.closetimer&&clearTimeout(this.closetimer),this.props.disabled||this.state.visible||(this.opentimer=setTimeout((()=>this.setState({visible:!0,selectedItem:null})),this.props.hoverDelay))})),se(this,"handleMouseLeave",(()=>{this.opentimer&&clearTimeout(this.opentimer),this.state.visible&&(this.closetimer=setTimeout((()=>this.setState({visible:!1,selectedItem:null})),this.props.hoverDelay))})),se(this,"menuRef",(e=>{this.menu=e})),se(this,"subMenuRef",(e=>{this.subMenu=e})),se(this,"registerHandlers",(()=>{document.removeEventListener("keydown",this.props.parentKeyNavigationHandler),document.addEventListener("keydown",this.handleKeyNavigation)})),se(this,"unregisterHandlers",(e=>{document.removeEventListener("keydown",this.handleKeyNavigation),e||document.addEventListener("keydown",this.props.parentKeyNavigationHandler)})),this.state=Object.assign({},this.state,{visible:!1})}componentDidMount(){this.listenId=D.register((()=>{}),this.hideSubMenu)}getSubMenuType(){return ne}shouldComponentUpdate(e,t){return this.isVisibilityChange=!(this.state.visible===t.visible&&this.props.forceOpen===e.forceOpen||this.state.visible&&e.forceOpen||this.props.forceOpen&&t.visible),!0}componentDidUpdate(){if(this.isVisibilityChange)if(this.props.forceOpen||this.state.visible){(window.requestAnimationFrame||setTimeout)((()=>{const e=this.props.rtl?this.getRTLMenuPosition():this.getMenuPosition();this.subMenu.style.removeProperty("top"),this.subMenu.style.removeProperty("bottom"),this.subMenu.style.removeProperty("left"),this.subMenu.style.removeProperty("right"),l(e,"top")&&(this.subMenu.style.top=e.top),l(e,"left")&&(this.subMenu.style.left=e.left),l(e,"bottom")&&(this.subMenu.style.bottom=e.bottom),l(e,"right")&&(this.subMenu.style.right=e.right),this.subMenu.classList.add(d),this.registerHandlers(),this.setState({selectedItem:null})}))}else{const e=()=>{this.subMenu.removeEventListener("transitionend",e),this.subMenu.style.removeProperty("bottom"),this.subMenu.style.removeProperty("right"),this.subMenu.style.top=0,this.subMenu.style.left="100%",this.unregisterHandlers()};this.subMenu.addEventListener("transitionend",e),this.subMenu.classList.remove(d)}}componentWillUnmount(){this.listenId&&D.unregister(this.listenId),this.opentimer&&clearTimeout(this.opentimer),this.closetimer&&clearTimeout(this.closetimer),this.unregisterHandlers(!0)}render(){const{children:e,attributes:t,disabled:s,title:n,selected:o}=this.props,{visible:a}=this.state,h={ref:this.menuRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,className:r()(u,w,t.listClassName),style:{position:"relative"}},l={className:r()(u,t.className,{[r()(m,t.disabledClassName)]:s,[r()(g,t.visibleClassName)]:a,[r()(v,t.selectedClassName)]:o}),onMouseMove:this.props.onMouseMove,onMouseOut:this.props.onMouseOut,onClick:this.handleClick},d={ref:this.subMenuRef,style:{position:"absolute",transition:"opacity 1ms",top:0,left:"100%"},className:r()(c,this.props.className)};return i.createElement("nav",te(ee({},h),{role:"menuitem",tabIndex:"-1","aria-haspopup":"true"}),i.createElement("div",ee(ee({},t),l),n),i.createElement("nav",te(ee({},d),{role:"menu",tabIndex:"-1"}),this.renderChildren(e)))}};let oe=ne;se(oe,"propTypes",{children:o().node.isRequired,attributes:o().object,title:o().node.isRequired,className:o().string,disabled:o().bool,hoverDelay:o().number,rtl:o().bool,selected:o().bool,onMouseMove:o().func,onMouseOut:o().func,forceOpen:o().bool,forceClose:o().func,parentKeyNavigationHandler:o().func}),se(oe,"defaultProps",{disabled:!1,hoverDelay:500,attributes:{},className:"",rtl:!1,selected:!1,onMouseMove:()=>null,onMouseOut:()=>null,forceOpen:!1,forceClose:()=>null,parentKeyNavigationHandler:()=>null});var ae=oe,re=Object.defineProperty,he=(e,t,s)=>(((e,t,s)=>{t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class le extends Z{constructor(e){super(e),he(this,"registerHandlers",(()=>{document.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("touchstart",this.handleOutsideClick),this.props.preventHideOnScroll||document.addEventListener("scroll",this.handleHide),this.props.preventHideOnContextMenu||document.addEventListener("contextmenu",this.handleHide),document.addEventListener("keydown",this.handleKeyNavigation),this.props.preventHideOnResize||window.addEventListener("resize",this.handleHide)})),he(this,"unregisterHandlers",(()=>{document.removeEventListener("mousedown",this.handleOutsideClick),document.removeEventListener("touchstart",this.handleOutsideClick),document.removeEventListener("scroll",this.handleHide),document.removeEventListener("contextmenu",this.handleHide),document.removeEventListener("keydown",this.handleKeyNavigation),window.removeEventListener("resize",this.handleHide)})),he(this,"handleShow",(e=>{if(e.detail.id!==this.props.id||this.state.isVisible)return;const{x:t,y:s}=e.detail.position;this.setState({isVisible:!0,x:t,y:s}),this.registerHandlers(),h(this.props.onShow,e)})),he(this,"handleHide",(e=>{!this.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==this.props.id||(this.unregisterHandlers(),this.setState({isVisible:!1,selectedItem:null,forceSubMenuOpen:!1}),h(this.props.onHide,e))})),he(this,"handleOutsideClick",(e=>{this.menu.contains(e.target)||M()})),he(this,"handleMouseLeave",(e=>{e.preventDefault(),h(this.props.onMouseLeave,e,Object.assign({},this.props.data,b.data),b.target),this.props.hideOnLeave&&M()})),he(this,"handleContextMenu",(e=>{e.preventDefault(),this.handleHide(e)})),he(this,"hideMenu",(e=>{27!==e.keyCode&&13!==e.keyCode||M()})),he(this,"getMenuPosition",((e=0,t=0)=>{let s={top:t,left:e};if(!this.menu)return s;const{innerWidth:i,innerHeight:n}=window,o=this.menu.getBoundingClientRect();return t+o.height>n&&(s.top-=o.height),e+o.width>i&&(s.left-=o.width),s.top<0&&(s.top=o.height<n?(n-o.height)/2:0),s.left<0&&(s.left=o.width<i?(i-o.width)/2:0),s})),he(this,"getRTLMenuPosition",((e=0,t=0)=>{let s={top:t,left:e};if(!this.menu)return s;const{innerWidth:i,innerHeight:n}=window,o=this.menu.getBoundingClientRect();return s.left=e-o.width,t+o.height>n&&(s.top-=o.height),s.left<0&&(s.left+=o.width),s.top<0&&(s.top=o.height<n?(n-o.height)/2:0),s.left+o.width>i&&(s.left=o.width<i?(i-o.width)/2:0),s})),he(this,"menuRef",(e=>{this.menu=e})),this.state=Object.assign({},this.state,{x:0,y:0,isVisible:!1})}getSubMenuType(){return ae}componentDidMount(){this.listenId=D.register(this.handleShow,this.handleHide)}componentDidUpdate(){const e=window.requestAnimationFrame||setTimeout;this.state.isVisible?e((()=>{const{x:t,y:s}=this.state,{top:i,left:n}=this.props.rtl?this.getRTLMenuPosition(t,s):this.getMenuPosition(t,s);e((()=>{this.menu&&(this.menu.style.top=`${i}px`,this.menu.style.left=`${n}px`,this.menu.style.opacity=1,this.menu.style.pointerEvents="auto")}))})):e((()=>{this.menu&&(this.menu.style.opacity=0,this.menu.style.pointerEvents="none")}))}componentWillUnmount(){this.listenId&&D.unregister(this.listenId),this.unregisterHandlers()}render(){const{children:e,className:t,style:s}=this.props,{isVisible:n}=this.state,o=Object.assign({},s,{position:"fixed",opacity:0,pointerEvents:"none"}),a=r()(c,t,{[d]:n});return i.createElement("nav",{role:"menu",tabIndex:"-1",ref:this.menuRef,style:o,className:a,onContextMenu:this.handleContextMenu,onMouseLeave:this.handleMouseLeave},this.renderChildren(e))}}he(le,"propTypes",{id:o().string.isRequired,children:o().node.isRequired,data:o().object,className:o().string,hideOnLeave:o().bool,rtl:o().bool,onHide:o().func,onMouseLeave:o().func,onShow:o().func,preventHideOnContextMenu:o().bool,preventHideOnResize:o().bool,preventHideOnScroll:o().bool,style:o().object}),he(le,"defaultProps",{className:"",data:{},hideOnLeave:!1,rtl:!1,onHide:()=>null,onMouseLeave:()=>null,onShow:()=>null,preventHideOnContextMenu:!1,preventHideOnResize:!1,preventHideOnScroll:!1,style:{}});var ce=le,de=Object.defineProperty,pe=(e,t,s)=>(((e,t,s)=>{t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const ue=["input","textarea"];class ge extends i.Component{constructor(){super(...arguments),pe(this,"touchHandled",!1),pe(this,"handleMouseDown",(e=>{this.props.holdToDisplay>=0&&0===e.button&&(e.persist(),e.stopPropagation(),this.mouseDownTimeoutId=setTimeout((()=>this.handleContextClick(e)),this.props.holdToDisplay)),h(this.props.attributes.onMouseDown,e)})),pe(this,"handleMouseUp",(e=>{0===e.button&&clearTimeout(this.mouseDownTimeoutId),h(this.props.attributes.onMouseUp,e)})),pe(this,"handleMouseOut",(e=>{0===e.button&&clearTimeout(this.mouseDownTimeoutId),h(this.props.attributes.onMouseOut,e)})),pe(this,"handleTouchstart",(e=>{this.touchHandled=!1,this.props.holdToDisplay>=0&&(e.persist(),e.stopPropagation(),this.touchstartTimeoutId=setTimeout((()=>{this.handleContextClick(e),this.touchHandled=!0}),this.props.holdToDisplay)),h(this.props.attributes.onTouchStart,e)})),pe(this,"handleTouchEnd",(e=>{this.touchHandled&&e.preventDefault(),clearTimeout(this.touchstartTimeoutId),h(this.props.attributes.onTouchEnd,e)})),pe(this,"handleContextMenu",(e=>{e.button===this.props.mouseButton&&this.handleContextClick(e),h(this.props.attributes.onContextMenu,e)})),pe(this,"handleMouseClick",(e=>{e.button===this.props.mouseButton?this.handleContextClick(e):this.props.holdToDisplay>0&&M(),h(this.props.attributes.onClick,e)})),pe(this,"handleContextClick",(e=>{if(this.props.disable)return;if(this.props.disableIfShiftIsPressed&&e.shiftKey)return;const t=document.activeElement;if(t&&(-1!==ue.indexOf(t.tagName.toLowerCase())||t.isContentEditable)||"CANVAS"===t.tagName)return;e.preventDefault(),e.stopPropagation();let s=e.clientX||e.touches&&e.touches[0].pageX,i=e.clientY||e.touches&&e.touches[0].pageY;this.props.posX&&(s-=this.props.posX),this.props.posY&&(i-=this.props.posY),M();let n=h(this.props.collect,this.props),o={position:{x:s,y:i},target:this.elem,id:this.props.id};n&&"function"==typeof n.then?n.then((t=>{o.data=Object.assign({},t,{target:e.target}),x(o)})):(o.data=Object.assign({},n,{target:e.target}),x(o))})),pe(this,"elemRef",(e=>{this.elem=e}))}render(){const{renderTag:e,attributes:t,children:s}=this.props,n=Object.assign({},t,{className:r()(p,t.className),onContextMenu:this.handleContextMenu,onClick:this.handleMouseClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onTouchStart:this.handleTouchstart,onTouchEnd:this.handleTouchEnd,onMouseOut:this.handleMouseOut,ref:this.elemRef});return i.createElement(e,n,s)}}ge.propTypes={id:o().string.isRequired,children:o().node.isRequired,attributes:o().object,collect:o().func,disable:o().bool,holdToDisplay:o().number,posX:o().number,posY:o().number,renderTag:o().elementType,mouseButton:o().number,disableIfShiftIsPressed:o().bool},ge.defaultProps={attributes:{},collect:()=>null,disable:!1,holdToDisplay:1e3,renderTag:"div",posX:0,posY:0,mouseButton:2,disableIfShiftIsPressed:!1};var me=ge;Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable},800519:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return gt}});var i=s(202784),n=s(213980),o=s.n(n),a=s(198),r=s(912895),h=s.n(r),l=s(690299),c=s.n(l),d=s(366441),p=s.n(d),u=s(780594),g=s.n(u),m=s(19085),f=s(790817),v=s(461298),w=s(435376),b=s(862816),y=s(992500),E=s(423184),P=s(770561),S=s(715318),x=s(931776),M=s(891719),k=s.n(M),C=s(561647),D=s.n(C),I=s(351375),O=s(112114),T=s(172888),R=s(309765),z=s(588703),N=s.n(z),L=s(287013),F=s.n(L),H=s(830324),A=s.n(H),B=s(409961),$=s.n(B),U=s(686605),Z=s.n(U),W=s(32593),j=s.n(W),X=s(557106),Y=s.n(X),K=s(783158),J=s.n(K),V=s(695688),q=s.n(V),_=s(306830),G=s.n(_),Q=s(635314),ee=s.n(Q),te=s(437069),se=s.n(te),ie=s(302467),ne=s.n(ie),oe=s(55257),ae=s(708984),re=s(321880),he=s(770149),le=s(113545),ce=s(344843),de=s.n(ce),pe=s(38226),ue=s.n(pe);var ge=function(e=32,t=48,s=126){const i=new Array(e);for(let n=0;n<e;n++)i[n]=ue()(t,s);return de().apply(null,i)},me=s(123103);const fe=c()("isle:sketchpad:curve");var ve=function(e,t,s,i,n,o,a){if(fe("Received points: "+t.length),void 0===t||t.length<2)return new Float32Array(0);let r;n="number"==typeof n?n:.9,o="number"==typeof o?o:30;let h=1,l=t.length,c=0,d=new Float32Array((l-2)*o+2+(a?2*o:0)),p=new Float32Array(o+2<<2),u=4;t=t.slice(0);for(let m=0;m<t.length;m+=2)t[m]=t[m]*s,t[m+1]=t[m+1]*i;for(r=t.slice(0),a?(r.unshift(t[l-1]),r.unshift(t[l-2]),r.push(t[0],t[1])):(r.unshift(t[1]),r.unshift(t[0]),r.push(t[l-2],t[l-1])),p[0]=1;h<o;h++){const e=h/o,t=e*e,s=t*e,i=2*s,n=3*t;p[u++]=i-n+1,p[u++]=n-i,p[u++]=s-2*t+e,p[u++]=s-t}function g(e,t,s,i){for(let n,a=2;a<s;a+=2){const s=e[a],r=e[a+1],h=e[a+2],l=e[a+3],p=(h-e[a-2])*i,u=(l-e[a-1])*i,g=(e[a+4]-s)*i,m=(e[a+5]-r)*i;let f=0;for(n=0;n<o;n++){const e=t[f++],i=t[f++],n=t[f++],o=t[f++];d[c++]=e*s+i*h+n*p+o*g,d[c++]=e*r+i*l+n*u+o*m}}}for(p[++u]=1,g(r,p,l,n),a&&(r=[],r.push(t[l-4],t[l-3],t[l-2],t[l-1],t[0],t[1],t[2],t[3]),g(r,p,4,n)),l=a?0:t.length-2,d[c++]=t[l++],d[c]=t[l],h=0,l=d.length;h<l;h+=2){const t=(d[h]+d[h+2])/2,s=(d[h+1]+d[h+3])/2;e.lineTo(d[h],d[h+1],t,s)}return e.lineTo(d[h],d[h+1],d[h+2],d[h+3]),d};var we=({tooltip:e,onClick:t,glyph:s,label:n,disabled:o,size:a,variant:r="light"})=>i.createElement(O.Z,{placement:"bottom",tooltip:e},i.createElement(P.Z,{variant:r,size:a,onClick:t,disabled:o,"aria-label":e},s?i.createElement("div",{className:`fa fa-${s}`}):null,n)),be=s(65420),ye=s(185610),Ee=s(155061),Pe=Object.defineProperty,Se=(e,t,s)=>(((e,t,s)=>{t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const xe=["#000000","#FF6900","#FCB900","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#9900EF"],Me=[4,5,6,7,8,9,10,11,12,14,18,20,22,24,30,36,42],ke=[8,9,10,11,12,14,18,24,30,36,48,60,72];class Ce extends i.Component{constructor(e){super(e),Se(this,"toggleColorPicker",(()=>{this.setState({showColorPicker:!this.state.showColorPicker})})),Se(this,"toggleDrawingMode",(()=>{this.props.onModeChange("drawing"===this.props.mode?"none":"drawing")})),Se(this,"toggleDragMode",(()=>{this.props.onModeChange("drag"===this.props.mode?"none":"drag")})),Se(this,"toggleDeleteMode",(()=>{this.props.onModeChange("delete"===this.props.mode?"none":"delete")})),Se(this,"togglePointerMode",(()=>{this.props.onModeChange("pointer"===this.props.mode?"none":"pointer")})),Se(this,"toggleZoomMode",(()=>{this.props.onModeChange("zoom"===this.props.mode?"none":"zoom")})),Se(this,"toggleTextMode",(()=>{this.props.onModeChange("text"===this.props.mode?"none":"text")})),Se(this,"handleColorChange",(e=>{this.props.onColorChange(e.hex),this.setState({showColorPicker:!this.state.showColorPicker})})),this.state={showColorPicker:!1}}render(){const{t:e}=this.props;return i.createElement(i.Fragment,null,i.createElement(E.Z,{size:"sm",className:"sketch-drag-delete-modes sketch-button-group"},i.createElement(we,{tooltip:e("drag-mode"),size:"sm",variant:"drag"===this.props.mode?"success":"secondary",onClick:this.toggleDragMode,glyph:"arrows-alt"}),i.createElement(we,{tooltip:e("delete-mode"),size:"sm",variant:"delete"===this.props.mode?"success":"secondary",onClick:this.toggleDeleteMode,glyph:"times"}),i.createElement(we,{tooltip:e("magnifying-glass"),size:"sm",variant:"zoom"===this.props.mode?"success":"secondary",onClick:this.toggleZoomMode,glyph:"search-plus"}),i.createElement(we,{tooltip:e("pointer-mode"),size:"sm",variant:"pointer"===this.props.mode?"success":"secondary",onClick:this.togglePointerMode,glyph:"circle"})),i.createElement(E.Z,{size:"sm",className:"sketch-drawing-buttons"},i.createElement(we,{tooltip:e("drawing-mode"),glyph:"paint-brush",size:"sm",variant:"drawing"===this.props.mode?"success":"secondary",onClick:this.toggleDrawingMode}),i.createElement(ye.Z,{id:"sketch-brush-size-dropdown",size:"sm",variant:"light",title:this.props.brushSize,onSelect:this.props.onBrushSelect},Me.map(((e,t)=>i.createElement(Ee.Z,{key:t,eventKey:e},e))))),i.createElement(E.Z,{size:"sm"},i.createElement(O.Z,{placement:"right",tooltip:e("change-brush-color")},i.createElement(P.Z,{size:"sm",onClick:this.toggleColorPicker,style:{background:this.props.color,color:"white"}},"Col"))),i.createElement(E.Z,{size:"sm",className:"sketch-text-buttons"},i.createElement(we,{size:"sm",variant:"text"===this.props.mode?"success":"secondary",onClick:this.toggleTextMode,tooltip:e("text-mode"),glyph:"font"}),i.createElement(ye.Z,{id:"sketch-font-dropdown",size:"sm",variant:"text"===this.props.mode?"success":"secondary",title:this.props.fontFamily,onSelect:this.props.onFontFamilySelect},i.createElement(Ee.Z,{eventKey:"Arial"},"Arial"),i.createElement(Ee.Z,{eventKey:"Helvetica"},"Helvetica"),i.createElement(Ee.Z,{eventKey:"Times"},"Times"),i.createElement(Ee.Z,{eventKey:"Courier"},"Courier"),i.createElement(Ee.Z,{eventKey:"Verdana"},"Verdana"),i.createElement(Ee.Z,{eventKey:"Palatino"},"Palatino")),i.createElement(ye.Z,{id:"sketch-font-size-dropdown",size:"sm",variant:"light",title:this.props.fontSize,onSelect:this.props.onFontSizeSelect},ke.map(((e,t)=>i.createElement(Ee.Z,{key:t,eventKey:e},e))))),i.createElement("div",{className:"sketch-colorpicker",style:{display:this.state.showColorPicker?"initial":"none"}},i.createElement(be.Z,{color:this.props.color,colors:xe,onChangeComplete:this.handleColorChange,triangle:"top-right"})))}}Ce.propTypes={brushSize:o().number.isRequired,color:o().string.isRequired,fontFamily:o().string.isRequired,fontSize:o().number.isRequired,mode:o().string.isRequired,onBrushSelect:o().func.isRequired,onColorChange:o().func.isRequired,onFontFamilySelect:o().func.isRequired,onFontSizeSelect:o().func.isRequired,onModeChange:o().func.isRequired};var De=Ce;const Ie=c()("isle:sketchpad:harmonize-sketchpad-elements");var Oe=function(e,t,s=[],i=[]){s=s.map((e=>e.page)),i=i.map((e=>e.page));for(let n=0;n<s.length;n++){const o=s[n];i.includes(o)||(Ie("Removing elements from page "+o),e.splice(o,1),t.splice(o,1))}for(let n=0;n<i.length;n++){const o=i[n];s.includes(o)||(Ie("Adding an empty page at position "+o),e.splice(o,0,[]),t.splice(o,0,0))}},Te=s(217431),Re=s(783235),ze=s(539365),Ne=s(387226),Le=s(691334),Fe=s(302108),He=s(741082),Ae=s(487890),Be=Object.defineProperty,$e=(e,t,s)=>(((e,t,s)=>{t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const Ue=c()("isle:lesson:sketchpad-contextmenu");class Ze extends i.Component{constructor(){super(...arguments),$e(this,"copyToClipboard",(()=>{let e;if(Ue("Copying page to clipboard... "),this.props.canvas){const s=this.props.canvas.toDataURL();e=`<img alt="Sketchpad Page" src="${s}" />`,document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}function t(t){t.clipboardData.setData("text/html ",e),t.clipboardData.setData("text/plain ",e),t.preventDefault()}}))}render(){return i.createElement(m.xV,{id:"sketchpadWindow"},i.createElement(m.sN,{onClick:this.copyToClipboard},this.props.t("copy")))}}Ze.propTypes={canvas:o().object},Ze.defaultProps={canvas:null};var We=(0,a.Z)("sketchpad")(Ze),je=JSON.parse('[{"target":".sketch-drawing-buttons","content":"In the drawing mode, you can draw lines on the sketchpad. Try it out. Also try changing the brush size and brush color."},{"target":".sketch-pages","content":"Use the + button to insert a new page and the other buttons for navigation."},{"target":".sketch-text-buttons","content":"In the text mode, you can insert text annotations. Click on a point on the sketchpad to create a note and insert it by hitting ENTER."},{"target":".sketch-drag-delete-modes","content":"The drag and delete modes allow you to move around and delete created elements, respectively. Once either mode is selected, simply click on an element on the page to drag or delete it. The laser pointer and magnifying glass may be used to highlight and zoom in on parts of the current slide."},{"target":".sketch-undo-redo","content":"The undo button allows you to revert the last additions you made to the slides, while the redo button can redraw elements which were previously undone."},{"target":".sketch-save-buttons","content":"You can either export the current page as an image file or all pages as a PDF document. Alternatively, your notes can also be uploaded directly to the ISLE server by clicking the button to the right. Once the upload is finished, make sure to save the displayed link to the uploaded file."},{"target":".sketch-save-buttons","content":"Your notes are autosaved in the cloud and will be accessible when opening the lesson again in the future. However, to make sure the latest changes are saved, you are advised to click the \\"Save in browser\\" button before closing the page."}]'),Xe=Object.defineProperty,Ye=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,Ve=(e,t,s)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,qe=(e,t)=>{for(var s in t||(t={}))Ke.call(t,s)&&Ve(e,s,t[s]);if(Ye)for(var s of Ye(t))Je.call(t,s)&&Ve(e,s,t[s]);return e},_e=(e,t,s)=>(Ve(e,"symbol"!=typeof t?t+"":t,s),s);const Ge=s(932976),Qe=(0,Te.Z)((()=>s.e(73512).then(s.bind(s,605673)))),et=(0,Te.Z)((()=>s.e(51217).then(s.bind(s,551716)))),tt=(0,Te.Z)((()=>s.e(3471).then(s.bind(s,586410)))),st=(0,Te.Z)((()=>s.e(84553).then(s.bind(s,898669)))),it=(0,Te.Z)((()=>s.e(72087).then(s.bind(s,549843)))),nt=c()("isle:sketchpad"),ot=["isExporting","showColorPicker","showUploadModal","showNavigationModal","showResetModal","showFeedbackModal","showSaveModal","hideInputButtons","hideNavigationButtons","hideSaveButtons","hideTransmitButtons"],at=/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&//=]*))/g,rt=/([a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,})/gi,ht=window.devicePixelRatio||1;function lt(e){e.preventDefault()}function ct(e,t){let s=!1;for(let i=0;i<t.length;i++){const{page:n}=t[i];n===e&&(s=!0)}return s}function dt(e){e.setLineDash([2,15]),e.lineWidth=2,e.strokeStyle="orange",e.lineCap="round",e.lineJoin="round",e.shadowBlur=0}Ge&&Ge.GlobalWorkerOptions&&(Ge.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/legacy/build/pdf.worker.min.js");const pt=e=>{nt("Rendering overlays...");const t=se()(e.nodes),s=[],n=e.toOriginalPage(e.currentPage);for(let o=0;o<t.length;o++){let a=e.nodes[t[o]],r="invisible-page";t[o]===String(n+1)&&(r="sketch-node-container"),A()(a)&&a.component?a.style?(t[o]===String(n+1)&&(r="sketch-node-container-basic"),s.push(i.createElement("div",{key:o,style:a.style,className:r,onKeyDown:Ne.Z},a.component))):s.push(i.createElement("div",{key:o,className:r,onKeyDown:Ne.Z},a.component)):s.push(i.createElement("div",{key:o,className:r,onKeyDown:Ne.Z},a))}return i.createElement("div",{className:"sketchpad-overlays"},s)};class ut extends i.Component{constructor(e,t){super(e),_e(this,"handleHashChange",(()=>{const e=this.readURL();e>0&&this.gotoPage(e)})),_e(this,"handleResize",(()=>{this.setState({canvasHeight:window.innerHeight-this.state.verticalOffset,canvasWidth:window.innerWidth-40},(()=>{this.debouncedRedraw()}))})),_e(this,"retrieveData",(e=>{if(nt("Retrieved data from previous session..."),A()(e)){if(N()(e.elements))for(let s=0;s<e.elements.length;s++)this.elements[s]=e.elements[s];if(N()(e.nUndos))for(let s=0;s<e.nUndos.length;s++)this.nUndos[s]=e.nUndos[s];if(N()(e.sharedElements)){for(let t=0;t<e.sharedElements.length;t++)this.sharedElements[t]=e.sharedElements[t];this.context.anonymous&&Oe(this.elements,this.nUndos,this.state.insertedPages,e.state.insertedPages)}else this.sharedElements=new Array(e.elements.length).fill([]);for(let s=0;s<e.state.insertedPages.length;s++){const{page:t}=e.state.insertedPages[s];this.backgrounds.splice(t,0,null)}const t=ze.Z?0:this.readURL();nt("Go to page "+t),e.state.currentPage=t,e.state.noPages=this.backgrounds.length,e.state=ee()(e.state,ot),e.state.hasRetrievedData=!0,this.setState(e.state,(()=>{this.debouncedRedraw()}))}else this.setState({hasRetrievedData:!0},(()=>{this.debouncedRedraw()}))})),_e(this,"toggleGroupMode",(()=>{this.setState({groupMode:!this.state.groupMode})})),_e(this,"hidePointer",(()=>{this.props.logAction(Le.gm,!0,{noSave:!0},"members"),this.pointer.style.opacity=0})),_e(this,"hideZoom",(()=>{this.props.logAction(Le.XR,!0,{noSave:!0},"members"),this.zoom.style.display="none"})),_e(this,"preventDefaultTouch",(e=>{e.target!==this.canvas&&e.target!==this.textLayer&&e.target!==this.canvasWrapper||e.preventDefault()})),_e(this,"handleVisibilityChange",(()=>{document.hidden||this.debouncedRedraw()})),_e(this,"renderBackground",(e=>{this.renderingTask&&this.renderingTask.cancel();const t=this.canvas,s=this.ctx,i=this.backgrounds[e];if(i){let t;nt(`Found background for page ${e}...`);const s=i.getViewport({scale:1,dontFlip:!1}),n=this.state.fill||(s.width>s.height?"vertical":"horizontal");t="vertical"===n?this.state.canvasHeight/s.height:this.state.canvasWidth/s.width;const o=i.getViewport({scale:t,dontFlip:!1}),a=this.textLayer;for(;a.firstChild;)a.removeChild(a.firstChild);"vertical"===n?(this.canvas.height=o.height*ht,this.canvas.width=o.width*ht,this.canvas.style.left=(this.state.canvasWidth-o.width)/2+"px",this.canvas.style["border-style"]="solid",this.canvas.style["border-color"]="black",this.canvas.style["border-width"]="0px 1px 0px 1px",this.canvas.style.width=`${o.width}px`,this.canvas.style.height=`${o.height}px`,a.style.width=`${o.width}px`,a.style.height=`${o.height}px`,this.leftMargin=(this.state.canvasWidth-o.width)/2,a.style.left=`${this.leftMargin}px`):(this.canvas.height=o.height*ht,this.canvas.width=(o.width-15)*ht,this.canvas.style.left="0px",this.canvas.style.border="none",this.canvas.style.height=`${o.height}px`,this.canvas.style.width=o.width-15+"px",a.style.width=o.width-15+"px",a.style.height=`${o.height}px`,this.leftMargin=0,a.style.left="0px");const r=q()(this.canvas.width*this.canvas.width+this.canvas.height*this.canvas.height);this.scaleRatio=r/(1768*ht),this.ctx.setTransform(ht,0,0,ht,0,0);const h={canvasContext:this.ctx,viewport:o};return i.getTextContent().then((e=>{Ge.renderTextLayer({textContent:e,container:a,viewport:o,textDivs:[]}).promise.then((()=>{const e=a.innerHTML;let t=ne()(e,at,'<a href="$1">$1</a>');t=ne()(t,rt,'<a href="mailto:$1">$1</a>'),a.innerHTML=t}))})),this.renderingTask=i.render(h),this.renderingTask.promise.then((()=>{this.backgroundData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),nt(`Background rendered for page ${e}`)})).catch((e=>{nt("Encountered error in `renderBackground`: "+e.message)}))}return this.backgroundData=null,s&&(this.props.pdf||s.setTransform(ht,0,0,ht,0,0),s.clearRect(0,0,t.width,t.height)),Promise.resolve()})),_e(this,"redraw",(()=>{const e=this.state.currentPage;nt(`Redrawing page ${e+1}`);const t=this.nUndos[e];this.renderBackground(e).then((()=>{let s=this.sharedElements[e];if(this.state.showInstructorAnnotations){nt(`Rendering ${s.length} shared elements on page ${e}...`);for(let e=0;e<s.length;e++)this.drawElement(s[e])}s=this.elements[e],nt(`Rendering ${s.length} own elements on page ${e}...`);for(let e=0;e<s.length-t;e++)this.drawElement(s[e]);this.renderingTask=null})).catch((e=>{this.renderingTask=null}))})),_e(this,"onlyRedrawElements",(()=>{this.backgroundData?this.ctx.putImageData(this.backgroundData,0,0):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const e=this.state.currentPage;let t=this.sharedElements[e];if(this.state.showInstructorAnnotations){nt(`Rendering ${t.length} shared elements on page ${e}...`);for(let e=0;e<t.length;e++)this.drawElement(t[e])}t=this.elements[e],nt(`Rendering ${t.length} own elements on page ${e}...`);const s=this.nUndos[e];for(let i=0;i<t.length-s;i++)this.drawElement(t[i])})),_e(this,"redrawWhenDragging",(()=>{if(!this.canvasBuffer){this.canvasBuffer=document.createElement("canvas"),this.canvasBuffer.width=this.canvas.width,this.canvasBuffer.height=this.canvas.height,nt("Prepare data for non-dragged elements..."),this.backgroundData?this.ctx.putImageData(this.backgroundData,0,0):(this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height));const e=this.state.currentPage;let t=this.sharedElements[e];if(this.state.showInstructorAnnotations){nt(`Rendering ${t.length} shared elements on page ${e}...`);for(let e=0;e<t.length;e++)this.drawElement(t[e])}t=this.elements[e],nt(`Rendering ${t.length} own elements on page ${e}...`);const s=this.nUndos[e];for(let n=0;n<t.length-s;n++)this.selectedElements&&F()(this.selectedElements,t[n])||this.drawElement(t[n]);const i=this.canvasBuffer.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(this.canvas,0,0,this.canvas.width/ht,this.canvas.height/ht)}this.ctx.drawImage(this.canvasBuffer,0,0);const e=this.selectedElements;if(e)for(let s=0;s<e.length;s++)this.drawElement(e[s]);const t=this.ctx;if(t.beginPath(),dt(t),this.dragPoints)for(let s=0;s<this.dragPoints.length;s+=2){const e=this.dragPoints[s],t=this.dragPoints[s+1];this.ctx.lineTo(e,t)}t.stroke(),t.closePath(),t.setLineDash([])})),_e(this,"drawPage",(e=>{const t=this.ctx,s=this.canvas;t&&t.clearRect(0,0,s.width,s.height),this.renderBackground(e);let i=this.sharedElements[e];if(this.state.showInstructorAnnotations)for(let o=0;o<i.length;o++)this.drawElement(i[o]);i=this.elements[e];const n=this.nUndos[e];for(let o=0;o<i.length-n;o++)this.drawElement(i[o])})),_e(this,"mousePosition",(e=>{let t=e.clientX,s=e.clientY;e.touches&&e.touches.length>0&&(t=e.touches[0].clientX,s=e.touches[0].clientY);const i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:s-i.top}})),_e(this,"clearPage",(e=>{if(ct(e,this.state.insertedPages)){nt("Clear an inserted page; deleting it completely..."),this.elements.splice(e,1),this.backgrounds.splice(e,1),this.nUndos.splice(e,1),this.sharedElements.splice(e,1);const t=[];for(let s=0;s<this.state.insertedPages.length;s++){const i=this.state.insertedPages[s];e!==i.page&&(i.page>e&&(i.page-=1),t.push(i))}nt("New inserted pages are: "+t.join(", ")),this.setState({noPages:this.state.noPages-1,insertedPages:t,selectedPage:this.state.selectedPage-1},(()=>{this.debouncedRedraw()}))}else this.elements[e]=[],this.debouncedRedraw()})),_e(this,"clear",(()=>{const e=this.state.currentPage;this.clearPage(e);const t=this.context,s=JSON.stringify({page:e,sessionID:t.sessionID});this.hasChangedSinceLastSave=!0,t.isOwner()&&this.state.transmitOwner?this.props.logAction(Le.ki,s,{},"members"):this.props.logAction(Le.ki,s,{},"owners")})),_e(this,"clearAll",((e=!1)=>{const t=this.context,s=this.canvas,i=this.ctx;if(i&&i.clearRect(0,0,s.width,s.height),t.store.removeItem(this.props.id+"_sketchpad"),this.props.pdf)this.initializePDF().then((()=>{this.debouncedRedraw(),this.setState({insertedPages:[]})}));else{const e=this.props.noPages;this.elements=new Array(e),this.backgrounds=new Array(e),this.sharedElements=new Array(e),this.nUndos=new Array(e);for(let t=0;t<e;t++)this.elements[t]=[],this.sharedElements[t]=[],this.backgrounds[t]=null,this.nUndos[t]=0;this.setState({currentPage:0,noPages:e,insertedPages:[]})}e||(this.hasChangedSinceLastSave=!0,t.isOwner()&&this.state.transmitOwner?this.props.logAction(Le.Jl,t.sessionID,{},"members"):this.props.logAction(Le.Jl,t.sessionID,{},"owners"))})),_e(this,"undo",(()=>{const e=this.state.currentPage,t=this.elements[e],s=this.sharedElements[e];let i=this.nUndos[e];const n=this.ctx,o=this.canvas;n&&n.clearRect(0,0,o.width,o.height),this.renderBackground(e).then((()=>{i+=1;let n=-1,o=t.length-1;for(let e=o;e>=0;e--){if(n+=1,n===i){o=e;break}0===e&&(i=n+1,o=null)}if(nt("Current number of undos: "+i),this.nUndos[e]=i,this.hasChangedSinceLastSave=!0,!$()(o)){nt(`UNDO: Redrawing elements 0 to ${o} out of ${t.length} elements`);for(let e=0;e<=o;e++)this.drawElement(t[e])}for(let e=0;e<s.length;e++)this.drawElement(s[e])}))})),_e(this,"redo",(()=>{const e=this.state.currentPage,t=this.elements[e],s=this.sharedElements[e];let i=this.nUndos[e];if(i>0){const n=J()(t.length-i,0);if(nt("Line index: "+n),n>=0){let o=-1,a=t.length-1;i-=1;for(let e=a;e>=0;e--)if(o+=1,o===i){a=e;break}nt(`REDO: Redrawing elements ${n} to ${a} out of ${t.length} elements`);for(let e=n;e<=a;e++)this.drawElement(t[e]);this.nUndos[e]=i;for(let e=0;e<s.length;e++)this.drawElement(s[e]);this.hasChangedSinceLastSave=!0}}})),_e(this,"drawElement",(e=>{e&&("line"===e.type?this.drawLine(e):"text"===e.type?this.drawText(e):"curve"===e.type&&this.drawCurve(e))})),_e(this,"drawLine",(({startX:e,startY:t,endX:s,endY:i,color:n,lineWidth:o,selected:a})=>{const r=this.ctx;r&&(r.lineWidth=o*this.scaleRatio,r.lineCap="round",r.lineJoin="round",r.shadowBlur=1.5*r.lineWidth,r.strokeStyle=a?"orange":n,r.beginPath(),r.moveTo(e,t),r.lineTo(s,i),r.stroke(),r.closePath())})),_e(this,"drawCurve",(({points:e,color:t,lineWidth:s,selected:i})=>{const n=this.ctx;n&&(n.lineWidth=s*this.scaleRatio,n.lineCap="round",n.lineJoin="round",i?(n.strokeStyle="orange",n.beginPath(),ve(n,e,this.canvas.width/ht,this.canvas.height/ht,.9,1),n.stroke(),n.closePath()):(n.shadowColor="rgba(128, 128, 128, 0.2)",n.shadowBlur=2*n.lineWidth,n.strokeStyle=t,n.beginPath(),ve(n,e,this.canvas.width/ht,this.canvas.height/ht),n.stroke(),n.closePath()))})),_e(this,"drawStart",(e=>{if(e.stopPropagation(),nt("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1)return this.swipeStartX=e.touches[0].screenX,void(this.swipeStartY=e.touches[0].screenY);const{x:t,y:s}=this.mousePosition(e);if(this.currentPoints=[],this.x=t,this.y=s,this.isMouseDown=!0,this.imageData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),"drawing"===this.state.mode){const t=this.state.currentPage,s=this.nUndos[t];if(s>0){const e=this.elements[t];e.splice(e.length-s),nt(`Page ${t} now has ${e.length} elements`),this.nUndos[t]=0,this.hasChangedSinceLastSave=!0}this.draw(e)}else if("drag"===this.state.mode){const i=this.ctx;i.isPointInPath(t*ht,s*ht)||(this.deselectElements(),this.onlyRedrawElements()),i.beginPath(),this.draw(e)}else k()&&this.handleClick(e)})),_e(this,"drawEnd",(e=>{if(e.stopPropagation(),j()(this.swipeEndX-this.swipeStartX)>45&&j()(this.swipeEndY-this.swipeStartY)<40)return this.swipeEndX>this.swipeStartX?this.previousPage():this.nextPage(),this.swipeEndX=0,this.swipeEndY=0,this.swipeStartX=0,this.swipeStartY=0,void(this.isMouseDown=!1);if("drawing"===this.state.mode&&this.isMouseDown){const e=this.elements[this.state.currentPage],t=this.context,s=t.user.email||t.anonymousIdentifier,i=this.currentPoints,{width:n,height:o}=this.canvas;i[0]/=n/ht,i[1]/=o/ht;for(let r=2;r<i.length-2;r+=2){const e=(i[r]+i[r+2])/2,t=(i[r+1]+i[r+3])/2;i[r]=e/(n/ht),i[r+1]=t/(o/ht)}i[i.length-2]/=n/ht,i[i.length-1]/=o/ht;const a={points:i,color:this.state.color,lineWidth:this.state.brushSize*(1+this.force)*.5,page:this.state.currentPage,time:this.time,type:"curve",drawID:ge(6),user:s};e.push(a),this.props.onChange(e),this.ctx.putImageData(this.imageData,0,0),this.drawCurve(a),this.hasChangedSinceLastSave=!0,this.state.groupMode||t.isOwner()&&this.state.transmitOwner?this.props.logAction(Le.WP,JSON.stringify(a),{noSave:!0},"members"):this.props.logAction(Le.WP,JSON.stringify(a),{noSave:!0},"owners"),this.currentPoints=[]}else if("drag"===this.state.mode&&this.isMouseDown){if(this.ctx.stroke(),this.ctx.closePath(),this.ctx.setLineDash([]),!this.selectedElements){nt("Select elements...");const e=this.elements[this.state.currentPage],t=this.nUndos[this.state.currentPage];this.selectedElements=null;const s=[];for(let i=0;i<e.length-t;i++){const t=e[i];t.selected=!1;const n=t.points;if(n)for(let e=0,i=n.length;e<i;e+=2){const i=n[e]*this.canvas.width,o=n[e+1]*this.canvas.height;if(this.ctx.isPointInPath(i,o)){t.selected=!0,s.push(t);break}}else t.x&&t.y&&this.ctx.isPointInPath(t.x*this.canvas.width,t.y*this.canvas.height)&&(t.selected=!0,s.push(t))}s.length>0&&(this.selectedElements=s,this.dragPoints=this.currentPoints)}this.redrawWhenDragging()}this.isMouseDown=!1})),_e(this,"draw",(e=>{if(e.stopPropagation(),this.state.swiping&&e.touches&&e.touches.length>1){this.swipeEndX=e.touches[0].screenX,this.swipeEndY=e.touches[0].screenY,this.isMouseDown=!1;const t=this.swipeEndY-this.swipeStartY;return void this.verticalScroll(t)}const t=this.context;let{x:s,y:i}=this.mousePosition(e);if("drag"===this.state.mode&&this.selectedElements&&this.isMouseDown){nt("Drag elements around...");const e=(s-this.x)/(this.canvas.width/ht),n=(i-this.y)/(this.canvas.height/ht),o=this.selectedElements;for(let t=0;t<o.length;t++){const s=o[t];if("curve"===s.type){const t=s.points;for(let s=0;s<t.length;s++)t[s]+=s%2==0?e:n}else"text"===s.type&&(s.x+=e,s.y+=n)}for(let t=0;t<this.dragPoints.length;t+=2)this.dragPoints[t]+=s-this.x,this.dragPoints[t+1]+=i-this.y;const a=t.user.email||t.anonymousIdentifier;this.hasChangedSinceLastSave=!0;const r=JSON.stringify({dx:e,dy:n,page:this.state.currentPage,drawIDs:o.map((e=>e.drawID)),user:a,sessionID:t.sessionID});return t.isOwner()||this.state.groupMode?this.props.logAction(Le.hk,r,{noSave:!0},"members"):this.props.logAction(Le.hk,r,{noSave:!0}),this.x=s,this.y=i,this.redrawWhenDragging()}if(this.isMouseDown&&!this.props.disabled){if("delete"===this.state.mode)return nt("Check whether to delete element..."),this.checkDeletion(e);if(this.currentPoints.push(s),this.currentPoints.push(i),"drawing"===this.state.mode){const e={color:this.state.color,lineWidth:this.state.brushSize*(1+this.force)*.5,startX:this.x,startY:this.y,endX:s,endY:i,shadow:0,type:"line"};this.drawElement(e)}else"drag"!==this.state.mode||this.selectedElements||(dt(this.ctx),this.ctx.lineTo(s,i),this.ctx.stroke());this.x=s,this.y=i}})),_e(this,"toggleTransmit",(()=>{this.setState({transmitOwner:!this.state.transmitOwner})})),_e(this,"uploadSketches",(()=>{this.setState({isExporting:!0},(()=>{this.preparePDF(((e,t)=>{const s=this.context;t.getBase64((e=>{nt("Processing base64 string of PDF document");const t=new FormData,n=this.props.id+".pdf",o=(0,ae.Z)(e,"application/pdf"),a=new File([o],n,{type:"application/pdf"});t.append("file",a);s.uploadFile({formData:t,callback:(e,t)=>{if(e)this.setState({isExporting:!1,showUploadModal:!0,modalMessage:e.message});else{const e=t.filename,n=s.server+"/"+e;this.setState({isExporting:!1,showUploadModal:!0,modalMessage:i.createElement("span",null,this.props.t("upload-successful"),": ",i.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},n))});const o={text:`${this.props.t("upload-email",{name:s.user.name})}<a href="${n}">${n}</a>.`,subject:this.props.t("pdf-uploaded")};s.sendMail(o,s.user.email)}}})}))}))}))})),_e(this,"saveAsPNG",(()=>{const e=this.state.currentPage,t=this.props.id+"_"+(e+1)+".png",s=this.canvas;this.backgrounds[e]||(this.ctx.fillStyle="white",this.ctx.fillRect(0,0,s.width,s.height)),this.props.logAction(Le.eX,e+1),s.toBlob((function(e){(0,oe.Z)(e,t)}))})),_e(this,"preparePDF",((e=G())=>{nt("Assembling PDF document object...");const t={content:[],pageSize:{width:this.canvas.width,height:this.canvas.height},pageMargins:[0,0,0,0]};let s=0;const i=()=>{nt(`Creating page ${s+1}`),this.renderBackground(s).then((()=>{let n=this.sharedElements[s];if(n&&n.length>0)for(let e=0;e<n.length;e++)this.drawElement(n[e]);n=this.elements[s];const o=this.nUndos[s];if(n&&n.length>0){const e=n.length-o;nt(`Rendering ${n.length} elements on page ${s}...`);for(let t=0;t<e;t++)this.drawElement(n[t])}const a=this.canvas.toDataURL();if(t.content.push({image:a,width:this.canvas.width}),s+=1,!(s<this.state.noPages))return nt("Creating PDF..."),e(null,h().createPdf(t));i()}))};i()})),_e(this,"toggleSaveModal",(()=>{this.setState({showSaveModal:!this.state.showSaveModal})})),_e(this,"saveAsPDF",(()=>{this.setState({isExporting:!0},(()=>{this.preparePDF(((e,t)=>{const s=this.props.id;this.props.logAction(Le.JO,"all-annotations"),t.download(s+".pdf",(()=>{this.setState({isExporting:!1}),this.debouncedRedraw()}))}))}))})),_e(this,"insertPage",((e,t)=>{"text"===this.state.mode&&this.insertTextFromInput(),this.elements.splice(e,0,[]),this.backgrounds.splice(e,0,null),this.sharedElements.splice(e,0,0),this.nUndos.splice(e,0,0);const s=document.querySelector(".textLayer");for(;s.firstChild;)s.removeChild(s.firstChild);const i=this.context,n=this.state.insertedPages;n.push({page:e,email:t||i.user.email}),this.setState({noPages:this.state.noPages+1,currentPage:e,insertedPages:n},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),t||(this.hasChangedSinceLastSave=!0,this.props.logAction(Le.yr,JSON.stringify({pos:e}),{},i.isOwner()?"members":i.user.email))}))})),_e(this,"insertTextFromInput",(()=>{const e=parseInt(this.textInput.style.left,10)-this.leftMargin,t=parseInt(this.textInput.style.top,10)-1.2*this.state.fontSize,s=this.textInput.value;this.textInput.value="",this.textInput.style.top=String(parseInt(this.textInput.style.top,10)+1.2*this.state.fontSize)+"px";const i=this.context,n=i.user.email||i.anonymousIdentifier,o=this.state.currentPage,a={value:s,x:e/(this.canvas.width/ht),y:t/(this.canvas.height/ht),color:this.state.color,fontSize:this.state.fontSize,fontFamily:this.state.fontFamily,time:this.time,type:"text",page:o,user:n,drawID:ge(6)};this.drawText(a);const r=this.elements[o],h=this.nUndos[o];h>0&&(r.splice(r.length-h),nt(`Page ${o} now has ${r.length} elements`),this.nUndos[o]=0),a.shouldLog=!1,r.push(a),this.props.onChange(r)})),_e(this,"handleEnter",(e=>{nt("Check if user hit ENTER..."),13===e.keyCode&&this.insertTextFromInput()})),_e(this,"drawText",(({x:e,y:t,value:s,color:i,drawID:n,user:o,fontSize:a,fontFamily:r,selected:h,shouldLog:l=!0})=>{const c=this.ctx;c.font=`${a}px ${r}`,c.shadowBlur=0,c.fillStyle=h?"orange":i;const d=Z()(e*(this.canvas.width/ht)),p=Z()(t*(this.canvas.height/ht))+a;nt(`Draw text at x: ${d} and y: ${p}`),c.fillText(s,d,p);const u=this.context;if(l){this.hasChangedSinceLastSave=!0;const h=JSON.stringify({x:e,y:t,value:s,color:i,fontSize:a,fontFamily:r,page:this.state.currentPage,drawID:n,user:o,type:"text"});u.isOwner()||this.state.groupMode?this.props.logAction(Le.y7,h,{},"members"):this.props.logAction(Le.y7,h,{})}})),_e(this,"handleClick",(e=>{if(nt("Handle click event..."),"text"===this.state.mode){const{x:t,y:s}=this.mousePosition(e),i=this.textInput;i.style.left=String(t+this.leftMargin)+"px",i.style.width=String(window.innerWidth-(t+this.leftMargin))+"px",i.style.top=s+"px";const n=Y()(this.state.canvasWidth-t,60);nt(`Resize to width ${n}...`),i.style.width=`${n}px`,i.focus()}else"deletion"===this.state.mode&&(nt("Checking whether a shape has been selected..."),this.checkDeletion(e))})),_e(this,"checkDeletion",(e=>{const{x:t,y:s}=this.mousePosition(e),i=this.elements[this.state.currentPage],n=this.nUndos[this.state.currentPage];let o=null;for(let a=0;a<i.length-n;a++){const e=i[a];if("curve"===e.type){const i=e.points;if(this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.lineWidth=Y()(e.lineWidth,16),ve(this.ctx,i,this.canvas.width/ht,this.canvas.height/ht,.9,1),this.ctx.closePath(),this.ctx.isPointInStroke(t*ht,s*ht)){nt(`Point (${t}, ${s}) is in path of element with ID ${e.drawID}`),o=a;break}}else if("text"===e.type){const i=this.ctx.measureText(e.value).width,n=Z()(e.x*(this.canvas.width/ht)),r=Z()(e.y*(this.canvas.height/ht));if(n<=t&&t<=n+i&&r<=s&&s<=r+e.fontSize){o=a;break}}}if(!$()(o)){const e=i[o].drawID;this.deleteElement(e,o);const t=this.context,s=t.user.email||t.anonymousIdentifier,n=JSON.stringify({drawID:e,page:this.state.currentPage,user:s,sessionID:t.sessionID});this.hasChangedSinceLastSave=!0,t.isOwner()&&this.state.transmitOwner||this.state.groupMode?this.props.logAction(Le.zg,n,{},"members"):this.props.logAction(Le.zg,n,{},"owners")}})),_e(this,"deleteElement",((e,t)=>{let s,i;const n=this.elements[this.state.currentPage],o="delete"===this.state.mode,a=this.nUndos[this.state.currentPage];for(let r=t;r<n.length-a&&n[r].drawID===e;r++)i=r,n[r].selected=!o;for(let r=t;r>=0&&n[r].drawID===e;r--)s=r,n[r].selected=!o;if(o){nt(`Delete elements ${s} to ${i}`);const e=n.splice(s,i-s+1);n.splice(n.length-a,0,...e),this.nUndos[this.state.currentPage]=a+e.length,this.onlyRedrawElements()}})),_e(this,"firstPage",(()=>{0!==this.state.currentPage&&(this.canvasWrapper.scrollTop=0,this.selectedElements&&this.deselectElements(),this.setState({currentPage:0},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),this.props.logAction(Le.li,this.state.currentPage)})))})),_e(this,"lastPage",(()=>{this.state.currentPage!==this.state.noPages-1&&(this.canvasWrapper.scrollTop=0,this.selectedElements&&this.deselectElements(),this.setState({currentPage:this.state.noPages-1},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),this.props.logAction(Le.Xu,this.state.currentPage)})))})),_e(this,"readURL",(()=>{const e=window.location.hash,t=encodeURI(this.props.id),s=new RegExp(t+"=(\\d+)"),i=e.match(s);return i?Y()(Number(i[1])-1,0):0})),_e(this,"updateURL",(e=>{const t=String(window.location.hash);if(!ze.Z){const s=encodeURI(this.props.id);if(t)if(t.includes(s)){const i=new RegExp("("+s+")=\\d+");window.location.hash=ne()(t,i,`$1=${e+1}`)}else window.location.hash+=`&${s}=${e+1}`;else window.location.hash=`#/?${s}=${e+1}`}})),_e(this,"nextPage",(()=>{if(this.state.currentPage<this.state.noPages-1){nt("Should go to next page..."),this.canvasWrapper.scrollTop=0;const e=this.state.currentPage+1;this.selectedElements&&this.deselectElements(),this.props.nodes[this.state.currentPage]&&(0,Re.Z)(this.canvasWrapper),"text"===this.state.mode&&this.insertTextFromInput(),this.setState({currentPage:e},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),this.props.logAction(Le.wt,this.state.currentPage)}))}})),_e(this,"previousPage",(()=>{if(this.state.currentPage>0){this.canvasWrapper.scrollTop=0;const e=this.state.currentPage-1;this.selectedElements&&this.deselectElements(),this.props.nodes[this.state.currentPage]&&(0,Re.Z)(this.canvasWrapper),"text"===this.state.mode&&this.insertTextFromInput(),this.setState({currentPage:e},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),this.props.logAction(Le.mE,this.state.currentPage)}))}})),_e(this,"gotoPage",((e,t=!0)=>{nt(`Should go to page ${e}...`),(e=parseInt(e,10))!==this.state.currentPage?(this.canvasWrapper&&(this.canvasWrapper.scrollTop=0),this.selectedElements&&this.deselectElements(),this.props.nodes[this.state.currentPage]&&(0,Re.Z)(this.canvasWrapper),"text"===this.state.mode&&this.insertTextFromInput(),this.setState({currentPage:e,showNavigationModal:!1},(()=>{this.updateURL(this.state.currentPage),this.debouncedRedraw(),t&&this.props.logAction(Le.Mw,e)}))):this.setState({showNavigationModal:!1})})),_e(this,"loadPDF",(()=>{const e=document.createElement("input");e.type="file",e.accept=".pdf",e.addEventListener("change",this.handlePDFUpload,!1),e.click()})),_e(this,"handlePDFUpload",(e=>{const t=this.context,s=e.target.files,i=new FormData;i.append("file",s[0]),t.uploadFile({formData:i,callback:(e,s)=>{const i=s.filename,n=t.server+"/"+i;t.updateMetadata("store",this.props.id,n),this.initializePDF()}})})),_e(this,"initializePDF",(()=>{nt(`Initialize PDF document at ${this.props.pdf}...`);const e=this.context;return new Promise(((t,s)=>{const i=e.metadata.store[this.props.id];Ge.getDocument({url:this.props.pdf||i,disableFontFace:!1}).promise.then((e=>{nt("Retrieved PDF document... "),this.processPDF(e,(e=>{e?(nt(`Encountered error in 'processPDF': ${e.message}`),s(e)):t()}))})).catch((function(e){nt(`Encountered an error in 'initializePDF': ${e.message}`)}))}))})),_e(this,"processPDF",((e,t=G())=>{nt("PDF loaded..."),console.log(e);const s=e.numPages,i=new Array(s),n=new Array(s),o=new Array(s),a=new Array(s);for(let r=0;r<s;r++)i[r]=[],n[r]=e.getPage(r+1),o[r]=[],a[r]=0;return Promise.all(n).then((e=>{nt("Retrieved all pages..."),this.backgrounds=e,this.elements=i,this.sharedElements=o,this.nUndos=a,this.setState({currentPage:ze.Z?0:this.readURL(),noPages:s},(()=>{this.state.hasRetrievedData&&this.drawPage(this.state.currentPage)})),t(null)})).catch((e=>{nt(e),t(e)}))})),_e(this,"save",(()=>{if(!this.hasChangedSinceLastSave)return new Promise((e=>{e()}));const e=this.context,t=ee()(this.state,ot),s={elements:this.elements,nUndos:this.nUndos,state:t};this.hasChangedSinceLastSave=!1;return e.anonymous?(nt("Save created elements to local storage..."),e.store.setItem(this.props.id,s)):(nt("Saving data on server..."),e.saveSketchpadData(this.props.id,s))})),_e(this,"closeResponseModal",(()=>{this.setState({showUploadModal:!1,modalMessage:null})})),_e(this,"toggleNavigationModal",(()=>{this.setState({showNavigationModal:!this.state.showNavigationModal})})),_e(this,"toggleDeletePageModal",(()=>{this.setState({showDeletePageModal:!this.state.showDeletePageModal})})),_e(this,"toggleResetModal",(()=>{this.setState({showResetModal:!this.state.showResetModal})})),_e(this,"toggleTutorial",(()=>{this.setState({showTutorial:!this.state.showTutorial})})),_e(this,"toggleSwiping",(()=>{this.setState({swiping:!this.state.swiping})})),_e(this,"movePointerStart",(e=>{e.stopPropagation(),nt("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1&&(this.swipeStartX=e.touches[0].screenX,this.swipeStartY=e.touches[0].screenY)})),_e(this,"movePointerEnd",(e=>{e.stopPropagation(),j()(this.swipeEndX-this.swipeStartX)>45&&j()(this.swipeEndY-this.swipeStartY)<40&&(this.swipeEndX>this.swipeStartX?this.previousPage():this.nextPage(),this.swipeEndX=0,this.swipeEndY=0,this.swipeStartX=0,this.swipeStartY=0),this.hideZoom(),this.hidePointer()})),_e(this,"movePointer",(e=>{if(e.stopPropagation(),this.state.swiping&&e.touches&&e.touches.length>1){this.swipeEndX=e.touches[0].screenX,this.swipeEndY=e.touches[0].screenY,this.isMouseDown=!1;const t=this.swipeEndY-this.swipeStartY;return void this.verticalScroll(t)}const t=this.context;let{x:s,y:i}=this.mousePosition(e);if("pointer"===this.state.mode)this.pointer.style.opacity=.7,this.pointer.style.left=`${s+this.leftMargin}px`,this.pointer.style.top=`${i}px`;else if("zoom"===this.state.mode){let{width:e,height:t}=this.zoom,n=e/(2*ht),o=t/(2*ht);this.zoomCtx.clearRect(0,0,e,t);let a=e/ht,r=t/ht,h=s*ht-n/2,l=i*ht-o/2,c=0,d=0;h<0&&(c-=h,h=0,a+=a/n*h,n+=h),l<0&&(d-=l,l=0,r+=r/o*l,o+=l),this.zoomCtx.drawImage(this.canvas,h,l,n,o,c,d,a,r),this.zoom.style.display="block",this.zoom.style.left=`${s-n+this.leftMargin}px`,this.zoom.style.top=i-o+"px"}this.props.logAction("pointer"===this.state.mode?Le.yy:Le.mn,JSON.stringify({x:s/(this.canvas.width/ht),y:i/(this.canvas.height/ht),sessionID:t.sessionID}),{noSave:!0},"members")})),_e(this,"toLocalPage",((e,t)=>{const s=this.state.insertedPages;let i=e;for(let n=0;n<s.length;n++){const{page:o,email:a}=s[n];o<e&&a!==t&&(i+=1)}return i})),_e(this,"toOriginalPage",(e=>{const t=this.state.insertedPages;let s=e;for(let i=0;i<t.length;i++){const{page:n}=t[i];if(n===e)return null;n<e&&(s-=1)}return nt(`Page with index ${e} corresponds to original page number ${s}...`),s})),this.force=1,this.scaleRatio=1,this.elements=new Array(e.noPages),this.backgrounds=new Array(e.noPages),this.sharedElements=new Array(e.noPages),this.nUndos=new Array(e.noPages);for(let i=0;i<e.noPages;i++)this.elements[i]=[],this.backgrounds[i]=null,this.sharedElements[i]=[],this.nUndos[i]=0;this.hasChangedSinceLastSave=!1,this.canvas=null,this.ctx=null;const s=ze.Z?0:this.readURL();this.state={color:e.color,brushSize:e.brushSize,currentPage:s,fill:e.fill,fontFamily:e.fontFamily,fontSize:e.fontSize,groupMode:e.groupMode,hideInputButtons:e.hideInputButtons||t.presentationMode,hideNavigationButtons:e.hideNavigationButtons||t.presentationMode,hideSaveButtons:e.hideSaveButtons||t.presentationMode,hideTransmitButtons:e.hideTransmitButtons||t.presentationMode,isExporting:!1,modalMessage:null,noPages:e.noPages,insertedPages:[],showUploadModal:!1,mode:"none",showNavigationModal:!1,transmitOwner:e.transmitOwner,showInstructorAnnotations:!0,receiveFrom:{},showDeletePageModal:!1,showResetModal:!1,showTutorial:e.showTutorial,showFeedbackModal:!1,showSaveModal:!1,swiping:!0,verticalOffset:60,hasRetrievedData:!1},this.isMouseDown=!1,this.leftMargin=0,this.debouncedRedraw=g()(this.redraw,100)}static getDerivedStateFromProps(e,t){return e.fullscreen?{canvasHeight:window.innerHeight-t.verticalOffset,canvasWidth:window.innerWidth-40}:t.canvasHeight!==e.canvasHeight||t.canvasWidth!==e.canvasWidth?{canvasHeight:e.canvasHeight,canvasWidth:e.canvasWidth}:null}componentDidMount(){const e=this.context;let t;this.zoomCtx&&this.zoomCtx.setTransform(ht,0,0,ht,0,0),this.ctx&&this.ctx.setTransform(ht,0,0,ht,0,0),this.props.fullscreen&&window.addEventListener("resize",this.handleResize),window.addEventListener("unload",this.save),t=this.props.pdf||e.metadata.store[this.props.id]?this.initializePDF():Promise.resolve(),t.then((()=>{(e.anonymous?e.getSketchpadVisitorData(this.props.id):e.getSketchpadUserData(this.props.id)).then(this.retrieveData).catch((e=>{nt(e)}))})),p().set(".sketch-canvas",{change:e=>{this.force=e}}),e&&(this.unsubscribe=e.subscribe(((t,s)=>{if(t===Fe.Fw||t===Fe.E7){(e.anonymous?e.store.getItem(this.props.id):e.getSketchpadUserData(this.props.id)).then(this.retrieveData).catch((e=>{nt(e)}))}if(t===Fe.KI&&this.initializePDF(),t===Le.x$){nt("Hide control buttons in presentation mode...");const t={hideInputButtons:e.presentationMode,hideNavigationButtons:e.presentationMode,hideSaveButtons:e.presentationMode,hideTransmitButtons:e.presentationMode};this.props.fullscreen&&(t.verticalOffset=e.presentationMode?30:60,t.canvasHeight=window.innerHeight-t.verticalOffset,t.canvasWidth=window.innerWidth-40),this.setState(t,(()=>{this.debouncedRedraw()}))}}))),this.actionUnsubscribe=this.props.onAction((t=>{const s=t.type;if(t.email===e.user.email)if(s===Le.yy){let{x:s,y:i,sessionID:n}=JSON.parse(t.value);n!==e.sessionID&&(s*=this.canvas.width/ht,i*=this.canvas.height/ht,s=`${s+this.leftMargin}px`,i=`${i}px`,this.pointer.style.left=s,this.pointer.style.top=i,this.pointer.style.opacity=.7)}else if(s===Le.gm)this.pointer.style.opacity=0;else if(s===Le.mn){let{x:s,y:i,sessionID:n}=JSON.parse(t.value);if(n!==e.sessionID){s*=this.canvas.width/ht,i*=this.canvas.height/ht;const{width:e,height:t}=this.zoom;let n=e/(2*ht),o=t/(2*ht);this.zoomCtx.clearRect(0,0,e,t);let a=e/ht,r=t/ht,h=s*ht-n/2,l=i*ht-o/2,c=0,d=0;h<0&&(c-=h,h=0,a+=a/n*h,n+=h),l<0&&(d-=l,l=0,r+=r/o*l,o+=l),this.zoomCtx.drawImage(this.canvas,h,l,n,o,c,d,a,r);const p=`${s-n+this.leftMargin}px`,u=i-o+"px";this.zoom.style.top=u,this.zoom.style.left=p,this.zoom.style.display="block"}}else if(s===Le.XR)this.zoom.style.display="none";else if(s===Le.Am){let{diffY:s,sessionID:i}=JSON.parse(t.value);i!==e.sessionID&&(s*=this.canvas.height,this.canvasWrapper.scrollTop-=.1*s)}if(e.isOwner()){if(this.state.receiveFrom.name!==t.name&&!t.owner&&!this.state.groupMode)return;t.email===e.user.email&&(s!==Le.wt&&s!==Le.mE&&s!==Le.Mw&&s!==Le.li&&s!==Le.Xu||(nt(`Go to page ${t.value}...`),this.gotoPage(t.value,!1)))}if(s===Le.y7||s===Le.WP){let s=JSON.parse(t.value);const i=this.elements[s.page],n=this.sharedElements[s.page];let o=!1;if(s.user===e.user.email||s.user===e.anonymousIdentifier)for(let e=0;e<i.length;e++)if(i[e].drawID===s.drawID){o=!0;break}o||(s.shouldLog=!1,s.page===this.state.currentPage&&this.state.showInstructorAnnotations&&("text"===s.type?this.drawText(s):this.drawCurve(s)),s.user===e.user.email?i.push(s):n.push(s),this.props.onChange(i))}else if(s===Le.yr){let{pos:s}=JSON.parse(t.value);t.email!==e.user.email&&(s=this.toLocalPage(s,t.email));ct(s,this.state.insertedPages)||(nt(`Should insert page at ${s}...`),this.insertPage(s,t.email))}else if(s===Le.zg){const{drawID:s,page:i,user:n,sessionID:o}=JSON.parse(t.value);if(nt(`Should delete element with id ${s} by user ${n}`),o!==e.sessionID){const o=t.email===e.user.email?this.elements[i]:this.sharedElements[i];let a;for(let e=0;e<o.length;e++)if(o[e].drawID===s&&o[e].user===n){a=e;break}(0,R.isPrimitive)(a)&&(o.splice(a,1),this.debouncedRedraw())}}else if(s===Le.hk){const{drawIDs:s,user:i,page:n,dx:o,dy:a,sessionID:r}=JSON.parse(t.value);if(nt(`Should drag specified elements by dx: ${o} and dy: ${a}...`),r!==e.sessionID){const r=t.email===e.user.email?this.elements[n]:this.sharedElements[n];for(let e=0;e<r.length;e++){const t=r[e];if(F()(s,t.drawID)&&t.user===i)if("curve"===t.type){const e=t.points;for(let t=0;t<e.length;t++)e[t]+=t%2==0?o:a}else"text"===t.type&&(t.x+=o,t.y+=a)}this.debouncedRedraw()}}else if(s===Le.ki){const{page:s,sessionID:i}=JSON.parse(t.value),n=t.email;if(i!==e.sessionID)if(n===e.user.email)this.clearPage(s);else{const e=this.sharedElements[s],t=[];for(let s=0;s<e.length;s++){const i=e[s];i.user!==n&&t.push(i)}this.sharedElements[s]=t,this.debouncedRedraw()}}else if(s===Le.Jl&&t.value!==e.sessionID)if(t.email===e.user.email)this.clearAll(!0);else{const e=t.email;for(let t=0;t<this.state.noPages;t++){const s=this.sharedElements[t],i=[];for(let t=0;t<s.length;t++){const n=s[t];n.user!==e&&i.push(n)}this.sharedElements[t]=i}this.debouncedRedraw()}})),this.props.autoSave&&(this.saveInterval=setInterval(this.save,this.props.intervalTime));const s={passive:!1,capture:!0};document.addEventListener("touchstart",this.preventDefaultTouch,s),document.addEventListener("touchend",this.preventDefaultTouch,s),document.addEventListener("touchmove",this.preventDefaultTouch,s),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.props.fullscreen&&document.body.addEventListener("gesturestart",lt),ze.Z||window.addEventListener("hashchange",this.handleHashChange)}componentDidUpdate(e){if(nt("Component did update..."),e.noPages!==this.props.noPages){this.elements=new Array(this.props.noPages),this.backgrounds=new Array(this.props.noPages),this.sharedElements=new Array(this.props.noPages),this.nUndos=new Array(this.props.noPages);for(let e=0;e<this.props.noPages;e++)this.elements[e]=[],this.backgrounds[e]=null,this.sharedElements[e]=[],this.nUndos[e]=0;this.setState({noPages:this.props.noPages},(()=>{this.debouncedRedraw()}))}e.pdf!==this.props.pdf&&this.initializePDF(),this.props.canvasWidth===e.canvasWidth&&this.props.canvasHeight===e.canvasHeight||this.debouncedRedraw(),this.props.fill!==e.fill&&this.setState({fill:this.props.fill},this.redraw)}componentWillUnmount(){this.save&&this.save(),this.saveInterval&&clearInterval(this.saveInterval),this.unsubscribe&&this.unsubscribe(),this.actionUnsubscribe&&this.actionUnsubscribe(),window.removeEventListener("resize",this.handleResize),ze.Z||window.removeEventListener("hashchange",this.handleHashChange),window.removeEventListener("unload",this.save);const e={passive:!1};document.removeEventListener("touchstart",this.preventDefaultTouch,e),document.removeEventListener("touchend",this.preventDefaultTouch,e),document.removeEventListener("touchmove",this.preventDefaultTouch,e),document.removeEventListener("visibilitychange",this.handleVisibilityChange,e),this.props.fullscreen&&document.removeEventListener("gesturestart",lt)}deselectElements(){nt("Deselect elements...");const e=this.selectedElements;if(e)for(let t=0;t<e.length;t++)e[t].selected=!1;this.selectedElements=null,this.dragPoints=null,this.canvasBuffer=null}renderProgressModal(){return this.state.isExporting?i.createElement(S.Z,{show:this.state.isExporting,onHide:G()},i.createElement(S.Z.Header,null,i.createElement(S.Z.Title,null,this.props.t("generate-pdf")))):null}renderUploadModal(){return this.state.showUploadModal?i.createElement(S.Z,{show:this.state.showUploadModal,onHide:this.closeResponseModal},i.createElement(S.Z.Header,{closeButton:!0},i.createElement(S.Z.Title,null,this.props.t("server-response"))),i.createElement(S.Z.Body,null,this.state.modalMessage),i.createElement(S.Z.Footer,null,i.createElement(P.Z,{onClick:this.closeResponseModal},this.props.t("close")))):null}renderPagination(){if(this.state.hideNavigationButtons)return null;const{t:e}=this.props,t=this.state.currentPage;return this.props.dynamicallyHideButtons&&this.state.canvasWidth<600?i.createElement(E.Z,{size:"sm",className:"sketch-pages"},i.createElement(P.Z,{variant:"light",onClick:this.toggleNavigationModal},t+1,"/",this.state.noPages),i.createElement(he.Z,{owner:!0,banner:null,showOwnerInPresentationMode:!1},i.createElement(we,{tooltip:e("insert-page"),onClick:()=>{const e=this.state.currentPage+1;this.insertPage(e)},glyph:"plus",size:"sm"}))):i.createElement(E.Z,{size:"sm",className:"sketch-pages"},i.createElement(P.Z,{variant:"light",onClick:this.toggleNavigationModal},t+1,"/",this.state.noPages),i.createElement(we,{tooltip:e("goto-first"),onClick:this.firstPage,glyph:"fast-backward",size:"sm"}),i.createElement(we,{tooltip:e("goto-previous"),onClick:this.previousPage,glyph:"backward",size:"sm"}),i.createElement(we,{tooltip:e("goto-next"),onClick:this.nextPage,glyph:"forward",size:"sm"}),i.createElement(we,{tooltip:e("goto-last"),onClick:this.lastPage,glyph:"fast-forward",size:"sm"}),i.createElement(he.Z,{owner:!0,banner:null,showOwnerInPresentationMode:!1},i.createElement(we,{tooltip:e("insert-page"),onClick:()=>{const e=this.state.currentPage+1;this.insertPage(e)},glyph:"plus",size:"sm"})))}renderInputButtons(){return this.state.hideInputButtons?null:i.createElement(De,{brushSize:this.state.brushSize,color:this.state.color,mode:this.state.mode,fontFamily:this.state.fontFamily,fontSize:this.state.fontSize,onModeChange:e=>{"drag"===this.state.mode&&"drag"!==e?(this.deselectElements(),this.onlyRedrawElements()):"text"===this.state.mode&&this.insertTextFromInput(),this.setState({mode:e}),"pointer"!==e?this.pointer.style.opacity=0:"pointer"===e&&(this.pointer.style.opacity=.7)},onColorChange:e=>{this.setState({color:e})},onBrushSelect:e=>{"drag"===this.state.mode&&(this.deselectElements(),this.onlyRedrawElements()),"text"===this.state.mode&&this.insertTextFromInput(),this.setState({brushSize:Number(e),mode:"drawing"})},onFontFamilySelect:e=>{"drag"===this.state.mode&&(this.deselectElements(),this.onlyRedrawElements()),this.setState({fontFamily:e,mode:"text"})},onFontSizeSelect:e=>{"drag"===this.state.mode&&(this.deselectElements(),this.onlyRedrawElements()),this.setState({fontSize:Number(e),mode:"text"})},t:this.props.t})}renderRemoveButtons(){if(this.state.hideInputButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<900)return null;const{t:e}=this.props;return i.createElement(E.Z,{size:"sm",className:"sketch-undo-redo sketch-button-group"},i.createElement(we,{tooltip:e("undo"),onClick:this.undo,glyph:"step-backward",size:"sm"}),i.createElement(we,{tooltip:e("redo"),glyph:"step-forward",onClick:this.redo,size:"sm"}),i.createElement(we,{tooltip:e("clear-current"),onClick:this.toggleDeletePageModal,glyph:"eraser",size:"sm"}),i.createElement(we,{tooltip:e("reset-pages"),onClick:this.toggleResetModal,glyph:"power-off",size:"sm"}))}renderSaveButtons(){if(this.state.hideSaveButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<775)return null;const e=this.context,{t:t}=this.props;return i.createElement(E.Z,{size:"sm",className:"sketch-save-buttons sketch-button-group"},this.props.pdf?null:i.createElement(we,{tooltip:t("load-pdf"),onClick:this.loadPDF,size:"sm",glyph:"file"}),i.createElement(we,{tooltip:t("download"),onClick:this.toggleSaveModal,glyph:"file-pdf",size:"sm"}),i.createElement(we,{tooltip:e.anonymous?t("save-local"):t("save-server"),onClick:()=>{this.save().then((()=>{e.addNotification({title:t("saved"),message:e.anonymous?t("saved-local"):t("saved-server"),level:"success",position:"tr"})})).catch((s=>{e.addNotification({title:t("encountered-error"),message:s.message,level:"error",position:"tr"})}))},glyph:"save",size:"sm"}),i.createElement(we,{tooltip:t("upload-to-server"),onClick:this.uploadSketches,glyph:"upload",size:"sm"}),k()?i.createElement(we,{tooltip:this.state.swiping?t("disable-swiping"):t("enable-swiping"),variant:this.state.swiping?"success":"secondary",onClick:this.toggleSwiping,glyph:"fingerprint",size:"sm"}):null)}renderTransmitButtons(){if(this.state.hideTransmitButtons||this.state.canvasWidth<650)return null;const e=this.context.userList.filter((e=>$()(e.exitTime))).map((e=>({value:e.name,label:e.name}))),t=i.createElement(w.Z,{id:"popover-positioned-right"},i.createElement(y.Z,null,this.props.t("remote-control-by")),i.createElement(b.Z,null,i.createElement(x.ZP,{isClearable:!0,inline:!0,options:e,onChange:e=>{this.setState({receiveFrom:e})}}),i.createElement(I.Z,{defaultValue:this.state.groupMode,onChange:this.toggleGroupMode,legend:this.props.t("group-mode")})));let s;this.props.pdf&&(s=i.createElement(we,{size:"sm",tooltip:"vertical"===this.state.fill?this.props.t("fill-entire-width"):this.props.t("fit-page"),onClick:()=>{let e;e="vertical"===this.state.fill?"horizontal":"vertical",this.setState({fill:e},this.redraw)},glyph:"vertical"===this.state.fill?"fas fa-grip-lines":"fas fa-grip-lines-vertical"}));const{t:n}=this.props;return i.createElement(i.Fragment,null,i.createElement(he.Z,{owner:!0,banner:null,showOwnerInPresentationMode:!1},i.createElement(E.Z,{size:"sm",className:"sketch-button-group"},i.createElement(we,{size:"sm",tooltip:this.state.transmitOwner?n("disable-transmissions"):n("enable-transmissions"),variant:this.state.transmitOwner?"success":"light",onClick:this.toggleTransmit,glyph:"bullhorn"}),i.createElement(v.Z,{trigger:"click",placement:"bottom",rootClose:!0,overlay:t},i.createElement(P.Z,{size:"sm",variant:"light"},i.createElement("div",{className:"fa fa-eye"}))),s)),i.createElement(he.Z,{notOwner:!0,banner:null},i.createElement(E.Z,{size:"sm",className:"sketch-button-group"},i.createElement(we,{size:"sm",tooltip:this.state.showInstructorAnnotations?n("show-only-own-annotations"):n("show-all-annotations"),variant:this.state.showInstructorAnnotations?"success":"light",onClick:()=>{this.setState({showInstructorAnnotations:!this.state.showInstructorAnnotations},(()=>{this.debouncedRedraw()}))},glyph:this.state.showInstructorAnnotations?"fa fa-toggle-on":"fa fa-toggle-off"}),s)))}verticalScroll(e){if(e>30||e<-30){const t=this.context;this.props.logAction("VERTICAL_SCROLL",JSON.stringify({diffY:e/this.canvas.height,sessionID:t.sessionID}),{noSave:!0},"members"),this.canvasWrapper.scrollTop-=.1*e}}renderFeedbackButtons(){const e=this.toOriginalPage(this.state.currentPage);return!this.props.feedbackButtons||$()(e)?null:i.createElement(i.Fragment,null,i.createElement(T.Z,{key:`${this.props.id}-slide-${e}`,id:`${this.props.id}-slide-${e}`,customFeedback:!1,vertical:!0,style:{zIndex:3,position:"absolute",top:35,right:20}}),i.createElement(he.Z,{owner:!0},i.createElement(O.Z,{tooltip:this.props.t("open-slide-feedback"),placement:"left"},i.createElement(P.Z,{onClick:()=>this.setState({showFeedbackModal:!this.state.showFeedbackModal}),variant:"secondary",size:"sm",style:{right:20,top:175,position:"absolute",zIndex:3}},this.props.t("show")))))}render(){let e,t;switch(nt(`Render sketchpad with height ${this.props.canvasHeight} and width ${this.props.canvasWidth}`),this.state.mode){case"drawing":e="crosshair";break;case"text":e="text";break;case"drag":e="move";break;case"delete":e="not-allowed";break;default:e="default"}if("pointer"===this.state.mode||"zoom"===this.state.mode)t={onMouseDown:this.movePointerStart,onMouseMove:this.movePointer,onMouseOut:this.movePointerEnd,onMouseUp:this.movePointerEnd,onTouchCancel:this.movePointerEnd,onTouchEnd:this.movePointerEnd,onTouchMove:this.movePointer,onTouchStart:this.movePointerStart};else if("none"===this.state.mode){const e=e=>{e.stopPropagation(),j()(this.swipeEndX-this.swipeStartX)>45&&j()(this.swipeEndY-this.swipeStartY)<40&&(this.swipeEndX>this.swipeStartX?this.previousPage():this.nextPage(),this.swipeEndX=0,this.swipeEndY=0,this.swipeStartX=0,this.swipeStartY=0)};t={onTouchCancel:e,onTouchEnd:e,onTouchMove:e=>{if(e.stopPropagation(),this.state.swiping&&e.touches&&e.touches.length>1){this.swipeEndX=e.touches[0].screenX,this.swipeEndY=e.touches[0].screenY,this.isMouseDown=!1;const t=this.swipeEndY-this.swipeStartY;this.verticalScroll(t)}},onTouchStart:e=>{e.stopPropagation(),e.touches&&e.touches.length>1&&(this.swipeStartX=e.touches[0].screenX,this.swipeStartY=e.touches[0].screenY)}}}else t={onClick:this.handleClick,onMouseDown:this.drawStart,onMouseMove:this.draw,onMouseOut:this.drawEnd,onMouseUp:this.drawEnd,onTouchCancel:this.drawEnd,onTouchEnd:this.drawEnd,onTouchMove:this.draw,onTouchStart:this.drawStart};const s=i.createElement("canvas",qe({id:`${this.props.id}-canvas`,key:`${this.props.id}-canvas-${this.state.canvasWidth}x${this.state.canvasHeight}`,className:"sketch-canvas",width:this.state.canvasWidth*ht,height:this.state.canvasHeight*ht,style:qe({cursor:e,width:this.state.canvasWidth,height:this.state.canvasHeight},this.props.style),ref:e=>{e&&(this.canvas=e,this.ctx=e.getContext("2d"))}},t)),n=i.createElement("canvas",{className:"sketchpad-magnifying-glass",width:this.state.canvasWidth*ht/4,height:this.state.canvasHeight*ht/4,style:{width:this.state.canvasWidth/4,height:this.state.canvasHeight/4},ref:e=>{e&&(this.zoom=e,this.zoomCtx=e.getContext("2d"),this.zoomCtx.imageSmoothingQuality="high")}});return i.createElement(i.Fragment,null,i.createElement(f.Z,{id:this.props.id,ref:e=>{this.sketchpadPanel=e},className:"modal-container",style:{width:this.state.canvasWidth+2,position:"relative",marginBottom:this.props.fullscreen?"0px":"20px",marginLeft:"auto",marginRight:"auto"},tabIndex:"0"},i.createElement("div",{className:"sketch-panel-heading clearfix unselectable"},this.renderPagination(),this.renderInputButtons(),this.renderRemoveButtons(),this.renderTransmitButtons(),this.renderSaveButtons(),this.context.presentationMode?null:i.createElement(we,{tooltip:this.state.showTutorial?this.props.t("stop-tutorial"):this.props.t("start-tutorial"),onClick:this.toggleTutorial,glyph:"question",size:"sm"})),this.renderFeedbackButtons(),i.createElement(pt,{nodes:this.props.nodes,currentPage:this.state.currentPage,toOriginalPage:this.toOriginalPage,key:"overlays"}),i.createElement("div",{className:"canvas-wrapper",style:{width:this.state.canvasWidth,height:this.state.canvasHeight},key:`${this.state.canvasWidth}-${this.state.canvasHeight}`,ref:e=>{this.canvasWrapper=e}},i.createElement(m.W4,{id:"sketchpadWindow",disabled:D()},s),n,i.createElement("div",qe({className:"textLayer",ref:e=>{this.textLayer=e},style:{pointerEvents:"none"!==this.state.mode?"none":"auto"}},t)),i.createElement("div",{ref:e=>{this.pointer=e},className:"sketch-pointer"})),i.createElement("input",{type:"text",className:"sketch-text-input",style:{display:"text"===this.state.mode?"inline-block":"none",fontSize:this.state.fontSize,fontFamily:this.state.fontFamily,color:this.state.color,width:this.state.canvasWidth},onKeyDown:this.handleEnter,ref:e=>{this.textInput=e}}),this.renderUploadModal(),this.state.showNavigationModal?i.createElement(tt,{show:this.state.showNavigationModal,onSelect:this.gotoPage,noPages:this.state.noPages,onHide:this.toggleNavigationModal,t:this.props.t}):null,this.renderProgressModal(),this.state.showResetModal?i.createElement(Qe,{show:this.state.showResetModal,onSubmit:this.clearAll,onHide:()=>{this.setState({showResetModal:!1})},t:this.props.t}):null,this.state.showDeletePageModal?i.createElement(et,{show:this.state.showDeletePageModal,onSubmit:this.clear,onHide:()=>{this.setState({showDeletePageModal:!1})},t:this.props.t}):null,this.state.showSaveModal?i.createElement(it,{show:this.state.showSaveModal,saveAsPDF:this.saveAsPDF,saveAsPNG:this.saveAsPNG,onHide:this.toggleSaveModal,pdf:this.props.pdf,session:this.context,logAction:this.props.logAction,id:this.props.id,t:this.props.t}):null,this.state.showFeedbackModal?i.createElement(st,{session:this.context,show:this.state.showFeedbackModal,onHide:()=>{this.setState({showFeedbackModal:!this.state.showFeedbackModal})},id:this.props.id,noPages:this.state.noPages,toOriginalPage:this.toOriginalPage,gotoPage:this.gotoPage,t:this.props.t}):null,this.state.showTutorial?i.createElement(re.ZP,{steps:je,showProgress:!0,run:!0}):null),this.sketchpadPanel?i.createElement(le.Z,{container:this.sketchpadPanel,actions:{ArrowDown:this.nextPage,ArrowUp:this.previousPage}}):null,i.createElement(We,{canvas:this.canvas}))}}ut.defaultProps={autoSave:!0,feedbackButtons:!1,intervalTime:1e4,hideInputButtons:!1,hideNavigationButtons:!1,hideSaveButtons:!1,hideTransmitButtons:!1,brushSize:4,color:"#444444",canvasWidth:1200,canvasHeight:700,fullscreen:!1,fill:"vertical",disabled:!1,fontFamily:"Arial",fontSize:24,nodes:{},noPages:1,pdf:null,showTutorial:!1,dynamicallyHideButtons:!1,transmitOwner:!0,groupMode:!1,style:{},onChange(){}},ut.propTypes={autoSave:o().bool,feedbackButtons:o().bool,intervalTime:o().number,hideInputButtons:o().bool,hideNavigationButtons:o().bool,hideSaveButtons:o().bool,hideTransmitButtons:o().bool,brushSize:o().number,color:o().string,canvasWidth:o().number,canvasHeight:o().number,fullscreen:o().bool,fill:o().oneOf(["vertical","horizontal"]),disabled:o().bool,fontFamily:o().string,fontSize:o().number,nodes:o().object,noPages:o().number,pdf:o().string,showTutorial:o().bool,dynamicallyHideButtons:o().bool,transmitOwner:o().bool,groupMode:o().bool,style:o().object,onChange:o().func},ut.contextType=me.Z;var gt=(0,Ae.D)("SKETCHPAD")((0,a.Z)("sketchpad")((0,He.W)(ut)))},708984:function(e,t){"use strict";t.Z=function(e,t="",s=512){const i=atob(e),n=[];for(let o=0;o<i.length;o+=s){const e=i.slice(o,o+s),t=new Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);const a=new Uint8Array(t);n.push(a)}return new Blob(n,{type:t})}},783235:function(e,t,s){"use strict";var i=s(928316),n=s(569257),o=s.n(n),a=s(922730);t.Z=function(e){if(!e)return;const t=(0,i.findDOMNode)(e);if(!t)return;const s=t.getElementsByClassName("hint-button");for(let i=0;i<s.length;i++)o()(s[i].innerText,a.a.t("components:close"))&&s[i].click()}},55257:function(e,t){"use strict";const s=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i;function i(e){setImmediate((function(){throw e}),0)}function n(e){return s.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}const o=function(e){if(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))return;const t=e.document;function s(){return e.URL||e.webkitURL||e}function o(e){setTimeout((function(){"string"==typeof e?s().revokeObjectURL(e):e.remove()}),4e4)}let a,r=!1;t&&t.createElementNS&&(a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in a);const h=/constructor/i.test(e.HTMLElement)||e.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent),c=e.setImmediate||e.setTimeout;function d(t,d,p){p||(t=n(t));const u=this,g="application/octet-stream"===t.type;let m;function f(){!function(e,t,s){let n=(t=[].concat(t)).length;for(;n--;){const a=e["on"+t[n]];if("function"==typeof a)try{a.call(e,s||e)}catch(o){i(o)}}}(u,"writestart progress write writeend".split(" "))}if(u.readyState=u.INIT,r)return m=s().createObjectURL(t),void c((function(){a.href=m,a.download=d,function(e){const t=new MouseEvent("click");e.dispatchEvent(t)}(a),f(),o(m),u.readyState=u.DONE}),0);!function(){if((l||g&&h)&&e.FileReader){const s=new FileReader;return s.onloadend=function(){let t=l?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,u.readyState=u.DONE,f()},s.readAsDataURL(t),void(u.readyState=u.INIT)}if(m||(m=s().createObjectURL(t)),g)e.location.href=m;else{e.open(m,"_blank")||(e.location.href=m)}u.readyState=u.DONE,f(),o(m)}()}const p=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,s){return t=t||e.name||"download",s||(e=n(e)),navigator.msSaveOrOpenBlob(e,t)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=null,p.onwritestart=null,p.onprogress=null,p.onwrite=null,p.onabort=null,p.onerror=null,p.onwriteend=null,function(e,t,s){return new d(e,t||e.name||"download",s)})}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.Z=o},387226:function(e,t){"use strict";t.Z=function(e){e.stopPropagation()}},995729:function(){},535635:function(){},737684:function(){},286339:function(){},347629:function(){},891940:function(){}}]);