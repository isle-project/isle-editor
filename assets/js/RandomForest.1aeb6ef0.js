"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[66634],{303428:function(e,t,n){n.d(t,{$F:function(){return i},PB:function(){return r}});function r(e){return`data-rr-ui-${e}`}function i(e){return`rrUi${e}`}},658092:function(e,t,n){n.d(t,{Z:function(){return i}});var r=Function.prototype.bind.call(Function.prototype.call,[].slice);function i(e,t){return r(e.querySelectorAll(t))}},609207:function(e,t,n){n.d(t,{DV:function(){return U},OI:function(){return J},tC:function(){return X},fA:function(){return Q}});var r=n(240054),i=n.n(r),s=n(287013),o=n.n(s),a=n(700601),c=n.n(a),l=n(798030),u=n.n(l),h=n(686605),p=n.n(h),m=n(605977),d=n.n(m),f=n(202784),y=n(198),g=n(457447),T=n(309765),v=n(844096),b=n.n(v),x=n(711768),C=n(394362),E=n(213980),M=n.n(E),w=n(770561),D=n(715318),I=n(112114),q=Object.defineProperty,N=(e,t,n)=>(((e,t,n)=>{t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class O extends f.Component{constructor(){super(),N(this,"toggleFullscreen",(()=>{this.setState({fullscreen:!this.state.fullscreen})})),this.state={fullscreen:!1}}render(){const{t:e}=this.props;return f.createElement(f.Fragment,null,f.createElement(I.Z,{id:"fullscreen_tooltip",placement:"bottom",tooltip:e("toggle-fullscreen")},f.createElement(w.Z,{variant:"outline-danger",size:"sm",onClick:this.toggleFullscreen,style:{position:"absolute",top:"10px",right:"32px"}},f.createElement("div",{className:"fa fa-window-maximize"}))),f.createElement(D.Z,{show:this.state.fullscreen,onHide:this.toggleFullscreen,dialogClassName:"modal-100w"},f.createElement(D.Z.Header,{closeButton:!0},f.createElement(D.Z.Title,{as:"h1"},e("decision-tree"))),f.createElement(D.Z.Body,{style:{height:.75*window.innerHeight,width:"100%",fontSize:32,overflow:"scroll"}},f.createElement("div",{className:"decision-tree decision-tree-fullscreen"},this.props.tree)),f.createElement(D.Z.Footer,null,f.createElement(w.Z,{onClick:this.toggleFullscreen},e("close")))))}}O.propTypes={tree:M().node.isRequired};var Z=(0,y.Z)("models")(O);const k=/^[+-]?[\d.]+e?[+-]?\d*$/;function P(e,t){if(!e)return null;if(e.category){let n=e.category;return((0,T.isPrimitive)(n)||k.test(n))&&(n=Number(n),b()(n)||(n=n.toFixed(6))),f.createElement("ul",null,f.createElement("li",null,f.createElement("span",{className:"decision-tree-leaf"},t("predict"),": ",n," ")))}return f.createElement("ul",null,f.createElement("li",null,f.createElement("span",null,f.createElement("b",null," ",e.attribute," ",e.predicateName," ",e.pivot," ?")),f.createElement("ul",null,f.createElement("li",null,f.createElement("span",null,t("no")," ( ",e.notMatchedCount," ",t("obs"),") "),P(e.notMatch,t)),f.createElement("li",null,f.createElement("span",null,t("yes")," ( ",e.matchedCount," ",t("obs"),") "),P(e.match,t)))))}class F extends f.Component{constructor(e){super(e),this.state={plotValue:null,plotKey:null,fullscreen:!1}}componentDidMount(){this.tree&&(this.treeWrapper.scrollLeft=.4*this.tree.clientWidth,(0,g.hi)(this.tree,{backgroundColor:"white",style:{fontSize:22}}).then((e=>{const t=`<img src="${e}" style="display: block; margin: 0 auto; max-width: 100%; max-height: 100%" />`;this.setState({plotKey:`\x3c!--IMAGE_LOG:${(0,x.Z)(6)}_${(0,x.Z)(6)}--\x3e`,plotValue:t})})))}render(){const{t:e}=this.props,t=P(this.props.tree,e);return f.createElement("div",{className:"decision-tree-wrapper",ref:e=>{this.treeWrapper=e}},f.createElement("button",{className:"decision-tree-draggable-bar",draggable:"true",onDragStart:e=>{e.dataTransfer.setData("text/html",this.state.plotValue),e.dataTransfer.setData("text/plain",this.state.plotKey)},onClick:()=>{(0,C.Z)(this.state.plotValue)},style:{float:"left"}},e("drag-plot")),f.createElement(Z,{variant:"outline-danger",size:"sm",onClick:()=>{this.setState({fullscreen:!this.state.fullscreen})},tree:t},f.createElement("div",{className:"fa fa-times"})),f.createElement("div",{className:"decision-tree",ref:e=>{this.tree=e}},t))}}var S=(0,y.Z)("models")(F);var B=function(e,t,n,r,i){const s=[],o=[],a=e[n];for(let c=t.length-1;c>=0;c--){const e=t[c];r(a[e],i)?s.push(e):o.push(e)}return{match:s,notMatch:o}};function R(e,t){const n={};for(let r=t.length-1;r>=0;r--){n[e[t[r]]]=0}for(let r=t.length-1;r>=0;r--){n[e[t[r]]]+=1}return n}function z(e,t){const n=R(e,t);let r,i=0;for(let s in n)n[s]>i&&(i=n[s],r=s);return r}function A(e,t){const n=R(e,t);let r=0;for(let i in n)if(c()(n,i)){const e=n[i]/t.length;r+=e*(1-e)}return r}function $(e,t){const n=R(e,t);let r=0;for(let i in n)if(c()(n,i)){const e=n[i]/t.length;r+=-e*u()(e)}return r}function j(e,t){const n=t.length;let r=0,i=0,s=0,o=0;if(!n)return null;if(n<2)return 0;for(let a=0;a<n;a++){const n=e[t[a]];o+=1,r=n-i,i+=r/o,s+=r*(n-i)}return s/(o-1)}function V(e,t){const n=t.length;if(!n)return null;let r=0;for(let i=0;i<n;i++){r+=(e[t[i]]-r)/(i+1)}return r}const H={"==":(e,t)=>e==t,">=":(e,t)=>e>=t};function W(e){const t=e.data[e.response].length;this.importances={};for(let n=0;n<e.predictors.length;n++)this.importances[e.predictors[n]]=0;this.root=K({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:d()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||p()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative,criterion:"gini"===e.criterion?A:$},this.importances),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=_(this.root,t,e);return r}return _(this.root,t,n)},this.type="classification",this.response=e.response}function K(e,t){const{data:n,predictors:r,indices:s,response:a,minItemsCount:c,scoreThreshold:l,maxTreeDepth:u,quantitative:h,criterion:p,minBucket:m,nTry:d}=e,f=s.length;if(0===u||f<=c)return{category:z(n[a],s)};const y=p(n[a],s),g={};let T={gain:0};d&&(r=i()(r,{size:d}));for(let i=f-1;i>=0;i--){const e=s[i];for(let t=0;t<r.length;t++){const i=r[t],c=n[i][e];let l;l=o()(h,i)?">=":"==";const u=i+l+c;if(g[u])continue;g[u]=!0;const d=H[l],v=B(n,s,i,d,c),b=p(n[a],v.match),x=p(n[a],v.notMatch);let C=0;C+=b*v.match.length,C+=x*v.notMatch.length,C/=f;const E=y-C;E>T.gain&&v.match.length>m&&v.notMatch.length>m&&(T=v,T.predicateName=l,T.predicate=d,T.attribute=i,T.pivot=c,T.gain=E)}}if(!T.gain||T.gain/y<l)return{category:z(n[a],s)};e.maxTreeDepth=u-1,t[T.attribute]+=T.gain,e.indices=T.match;const v=K(e,t);e.indices=T.notMatch;const b=K(e,t);return{attribute:T.attribute,predicate:T.predicate,predicateName:T.predicateName,pivot:T.pivot,match:v,notMatch:b,matchedCount:T.match.length,notMatchedCount:T.notMatch.length}}function L(e){const{data:t,predictors:n,indices:r,response:s,minItemsCount:a,scoreThreshold:c,maxTreeDepth:l,quantitative:u,minBucket:h,nTry:p}=e,m=r.length;if(0===l||m<=a)return{category:V(t[s],r)};const d=j(t[s],r),f={};let y={gain:0};p&&(n=i()(n,{size:p}));for(let i=m-1;i>=0;i--){const e=r[i];for(let i=0;i<n.length;i++){const a=n[i],c=t[a][e];let l;l=o()(u,a)?">=":"==";const p=a+l+c;if(f[p])continue;f[p]=!0;const g=H[l],T=B(t,r,a,g,c),v=j(t[s],T.match),b=j(t[s],T.notMatch);let x=0;x+=v*T.match.length,x+=b*T.notMatch.length,x/=m;const C=d-x;C>y.gain&&T.match.length>h&&T.notMatch.length>h&&(y=T,y.predicateName=l,y.predicate=g,y.attribute=a,y.pivot=c,y.gain=C)}}if(!y.gain||y.gain/d<c)return{category:V(t[s],r)};e.maxTreeDepth=l-1,e.indices=y.match;const g=L(e);e.indices=y.notMatch;const T=L(e);return{attribute:y.attribute,predicate:y.predicate,predicateName:y.predicateName,pivot:y.pivot,match:g,notMatch:T,matchedCount:y.match.length,notMatchedCount:y.notMatch.length}}function _(e,t,n){for(;;){if(e.category)return e.category;const r=t[e.attribute][n];e=(0,e.predicate)(r,e.pivot)?e.match:e.notMatch}}function G(e,t,n){const r={};for(let o=0;o<e.length;o++){const i=e[o].predict(t,n);r[i]=r[i]?r[i]+1:1}let i,s=-1;for(let o in r)c()(r,o)&&r[o]>s&&(s=r[o],i=o);return i}const U=W,X=function(e){const t=e.data[e.response].length;this.root=L({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:d()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||p()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative}),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=Number(_(this.root,t,e));return r}return Number(_(this.root,t,n))},this.type="regression",this.response=e.response},J=function(e){this.trees=function(e){const t=[],n=e.data[e.response].length,r=d()(0,n,1);for(let o=0;o<e.nTrees;o++)t[o]=i()(r);const s=[];for(let i=0;i<e.nTrees;i++){e.indices=t[i];const n=new W(e);s.push(n)}return s}(e),this.importances={};for(let t=0;t<e.predictors.length;t++){const n=e.predictors[t];this.importances[n]=0;for(let e=0;e<this.trees.length;e++)this.importances[n]+=this.trees[e].importances[n];this.importances[n]/=this.trees.length}this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=G(this.trees,t,e);return r}return G(this.trees,t,n)},this.type="classification",this.response=e.response},Q=S},113183:function(e,t,n){n.r(t);var r=n(202784),i=n(213980),s=n.n(i),o=n(198),a=n(822736),c=n(770561),l=n(588703),u=n.n(l),h=n(46739),p=n(112114),m=n(609207),d=n(741082),f=n(848285),y=Object.defineProperty,g=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,b=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>{for(var n in t||(t={}))T.call(t,n)&&b(e,n,t[n]);if(g)for(var n of g(t))v.call(t,n)&&b(e,n,t[n]);return e};let C=0;const E=({y:e,x:t,type:n,nTrees:r,nTry:i,impurityMeasure:s,data:o,quantitative:a,scoreThreshold:c,maxTreeDepth:l,minItemsCount:h})=>{try{let p,d;p=u()(t)?t:[t],"Classification"===n&&(d=new m.OI({response:e,predictors:p,data:o,quantitative:a,criterion:s,nTrees:r,nTry:i,scoreThreshold:c,maxTreeDepth:l,minItemsCount:h}));const f=[];for(let e=0;e<p.length;e++){const t=p[e];f.push(d.importances[t])}return{forest:d,predictors:p,importances:f}}catch(p){return{}}};class M extends r.Component{constructor(e){var t;super(e),b(this,"symbol"!=typeof(t="handlePredict")?t+"":t,(()=>{this.props.onPredict(this.state.forest,C)})),C+=1;const{y:n,x:r,type:i,nTrees:s,nTry:o,impurityMeasure:a,data:c,quantitative:l,scoreThreshold:u,maxTreeDepth:h,minItemsCount:p}=e;this.state=x(x({},E({y:n,x:r,type:i,nTrees:s,nTry:o,impurityMeasure:a,data:c,quantitative:l,scoreThreshold:u,maxTreeDepth:h,minItemsCount:p})),e)}static getDerivedStateFromProps(e,t){if(e.y!==t.y||e.x!==t.x||e.type!==t.type||e.nTrees!==t.nTrees||e.nTry!==t.nTry||e.impurityMeasure!==t.impurityMeasure||e.data!==t.data||e.quantitative!==t.quantitative||e.scoreThreshold!==t.scoreThreshold||e.maxTreeDepth!==t.maxTreeDepth||e.minItemsCount!==t.minItemsCount){const{y:t,x:n,type:r,nTrees:i,nTry:s,impurityMeasure:o,data:a,quantitative:c,scoreThreshold:l,maxTreeDepth:u,minItemsCount:h}=e;return x(x({},E({y:t,x:n,type:r,nTrees:i,nTry:s,impurityMeasure:o,data:a,quantitative:c,scoreThreshold:l,maxTreeDepth:u,minItemsCount:h})),e)}return null}render(){const{forest:e}=this.state,{t:t}=this.props;return e?r.createElement("div",{style:{overflowX:"auto",width:"100%"}},r.createElement("span",{className:"title"},t("random-forest-for",{y:this.props.y,counter:C})),r.createElement("p",null,t("created-from-trees",{nTrees:this.props.nTrees,nTry:this.props.nTry})),r.createElement(h.Z,{editable:!0,data:[{type:"bar",x:this.state.predictors,y:this.state.importances}],layout:{xaxis:{title:t("variable")},yaxis:{title:t("importance")}}}),this.props.onPredict?r.createElement(p.Z,{tooltip:t("predictions-attached")},r.createElement(c.Z,{variant:"secondary",size:"sm",style:{marginTop:10},onClick:this.handlePredict},this.props.t("use-model-to-predict"))):null):r.createElement(a.Z,{variant:"danger"},t("missing-attributes"))}}M.defaultProps={type:"Classification",nTrees:50,nTry:1,impurityMeasure:"gini",scoreThreshold:.01,maxTreeDepth:20,minItemsCount:50,onPredict:null},M.propTypes={data:s().object.isRequired,y:s().oneOfType([s().string,s().instanceOf(f.E)]).isRequired,x:s().oneOfType([s().arrayOf(s().oneOfType([s().string,s().instanceOf(f.E)])),s().string,s().instanceOf(f.E)]).isRequired,type:s().oneOf(["Classification","Regression"]),quantitative:s().arrayOf(s().string).isRequired,nTrees:s().number,nTry:s().number,impurityMeasure:s().oneOf(["gini","entropy"]),scoreThreshold:s().number,maxTreeDepth:s().number,minItemsCount:s().number,onPredict:s().func},t.default=(0,o.Z)("models")((0,d.W)(M))},394362:function(e,t){t.Z=function(e){const t=document.createElement("div");t.innerHTML=e,t.style.position="fixed",t.style.opacity=0,t.style.pointerEvents="none",document.body.appendChild(t),window.getSelection().removeAllRanges();const n=document.createRange();n.selectNode(t),window.getSelection().addRange(n),document.execCommand("copy"),document.body.removeChild(t)}}}]);