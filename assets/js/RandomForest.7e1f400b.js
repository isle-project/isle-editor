"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[66634],{303428:function(e,t,n){n.d(t,{$F:function(){return i},PB:function(){return r}});function r(e){return`data-rr-ui-${e}`}function i(e){return`rrUi${e}`}},658092:function(e,t,n){n.d(t,{Z:function(){return i}});var r=Function.prototype.bind.call(Function.prototype.call,[].slice);function i(e,t){return r(e.querySelectorAll(t))}},609207:function(e,t,n){n.d(t,{DV:function(){return K},OI:function(){return _},tC:function(){return L},fA:function(){return G}});var r=n(240054),i=n.n(r),s=n(798030),o=n.n(s),a=n(686605),c=n.n(a),l=n(605977),u=n.n(l),h=n(202784),p=n(498614),m=n(34002),d=n(309765),f=n(844096),g=n.n(f),y=n(711768),T=n(394362),b=n(213980),v=n.n(b),x=n(770561),E=n(715318),C=n(112114),w=Object.defineProperty,M=(e,t,n)=>(((e,t,n)=>{t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class I extends h.Component{constructor(){super(),M(this,"toggleFullscreen",(()=>{this.setState({fullscreen:!this.state.fullscreen})})),this.state={fullscreen:!1}}render(){const{t:e}=this.props;return h.createElement(h.Fragment,null,h.createElement(C.Z,{id:"fullscreen_tooltip",placement:"bottom",tooltip:e("toggle-fullscreen")},h.createElement(x.Z,{variant:"outline-danger",size:"sm",onClick:this.toggleFullscreen,style:{position:"absolute",top:"10px",right:"32px"}},h.createElement("div",{className:"fa fa-window-maximize"}))),h.createElement(E.Z,{show:this.state.fullscreen,onHide:this.toggleFullscreen,dialogClassName:"modal-100w"},h.createElement(E.Z.Header,{closeButton:!0},h.createElement(E.Z.Title,{as:"h1"},e("decision-tree"))),h.createElement(E.Z.Body,{style:{height:.75*window.innerHeight,width:"100%",fontSize:32,overflow:"scroll"}},h.createElement("div",{className:"decision-tree decision-tree-fullscreen"},this.props.tree)),h.createElement(E.Z.Footer,null,h.createElement(x.Z,{onClick:this.toggleFullscreen},e("close")))))}}I.propTypes={tree:v().node.isRequired};var D=(0,p.Zh)("models")(I);const N=/^[+-]?[\d.]+e?[+-]?\d*$/;function O(e,t){if(!e)return null;if(e.category){let n=e.category;return((0,d.isPrimitive)(n)||N.test(n))&&(n=Number(n),g()(n)||(n=n.toFixed(6))),h.createElement("ul",null,h.createElement("li",null,h.createElement("span",{className:"decision-tree-leaf"},t("predict"),": ",n," ")))}return h.createElement("ul",null,h.createElement("li",null,h.createElement("span",null,h.createElement("b",null," ",e.attribute," ",e.predicateName," ",e.pivot," ?")),h.createElement("ul",null,h.createElement("li",null,h.createElement("span",null,t("no")," ( ",e.notMatchedCount," ",t("obs"),") "),O(e.notMatch,t)),h.createElement("li",null,h.createElement("span",null,t("yes")," ( ",e.matchedCount," ",t("obs"),") "),O(e.match,t)))))}class q extends h.Component{constructor(e){super(e),this.state={plotValue:null,plotKey:null,fullscreen:!1}}componentDidMount(){this.tree&&(this.treeWrapper.scrollLeft=.4*this.tree.clientWidth,(0,m.hi)(this.tree,{backgroundColor:"white",style:{fontSize:22}}).then((e=>{const t=`<img src="${e}" style="display: block; margin: 0 auto; max-width: 100%; max-height: 100%" />`;this.setState({plotKey:`\x3c!--IMAGE_LOG:${(0,y.Z)(6)}_${(0,y.Z)(6)}--\x3e`,plotValue:t})})))}render(){const{t:e}=this.props,t=O(this.props.tree,e);return h.createElement("div",{className:"decision-tree-wrapper",ref:e=>{this.treeWrapper=e}},h.createElement("button",{className:"decision-tree-draggable-bar",draggable:"true",onDragStart:e=>{e.dataTransfer.setData("text/html",this.state.plotValue),e.dataTransfer.setData("text/plain",this.state.plotKey)},onClick:()=>{(0,T.Z)(this.state.plotValue)},style:{float:"left"}},e("drag-plot")),h.createElement(D,{variant:"outline-danger",size:"sm",onClick:()=>{this.setState({fullscreen:!this.state.fullscreen})},tree:t},h.createElement("div",{className:"fa fa-times"})),h.createElement("div",{className:"decision-tree",ref:e=>{this.tree=e}},t))}}var Z=(0,p.Zh)("models")(q);var k=function(e,t,n,r,i){const s=e[n],o=new Int32Array(t.length);let a=0;for(let c=t.length-1;c>=0;c--){const e=t[c];r(s[e],i)?(o[a]=e,a+=1):o[c+a]=e}return{match:new Int32Array(o.buffer,0,a),notMatch:new Int32Array(o.buffer,4*a,o.length-a)}};function P(e,t){const n={};for(let r=t.length-1;r>=0;r--){n[e[t[r]]]=0}for(let r=t.length-1;r>=0;r--){n[e[t[r]]]+=1}return n}function F(e,t){const n=P(e,t);let r,i=0;for(let s in n)n[s]>i&&(i=n[s],r=s);return r}function S(e,t){const n=P(e,t),r=t.length;let i=0;for(let s in n){const e=n[s]/r;i+=e*(1-e)}return i}function A(e,t){const n=P(e,t),r=t.length;let i=0;for(let s in n){const e=n[s]/r;i+=-e*o()(e)}return i}function B(e,t){const n=t.length;let r=0,i=0,s=0,o=0;if(!n)return null;if(n<2)return 0;for(let a=0;a<n;a++){const n=e[t[a]];o+=1,r=n-i,i+=r/o,s+=r*(n-i)}return s/(o-1)}function R(e,t){const n=t.length;if(!n)return null;let r=0;for(let i=0;i<n;i++){r+=(e[t[i]]-r)/(i+1)}return r}const z={"==":(e,t)=>e==t,">=":(e,t)=>e>=t};function $(e){const t=e.data[e.response].length;this.importances={};for(let n=0;n<e.predictors.length;n++)this.importances[e.predictors[n]]=0;this.root=j({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:u()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||c()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative,criterion:"gini"===e.criterion?S:A},this.importances),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=H(this.root,t,e);return r}return H(this.root,t,n)},this.type="classification",this.response=e.response}function j(e,t){const{data:n,predictors:r,indices:s,response:o,minItemsCount:a,scoreThreshold:c,maxTreeDepth:l,quantitative:u,criterion:h,minBucket:p,nTry:m}=e,d=s.length,f=n[o];if(0===l||d<=a)return{category:F(f,s)};const g=h(f,s),y=new Map,T=new Map;r.forEach((e=>{y.set(e,new Map),T.set(e,-1!==u.indexOf(e))}));let b={gain:0};m&&(r=i()(r,{size:m}));for(let i=d-1;i>=0;i--){const e=s[i];for(let t=0;t<r.length;t++){const i=r[t],o=n[i][e];let a,c;T.get(i)?(a=">=",c=Number(o>-1&&o<1?o.toPrecision(2):o.toFixed(2))):(a="==",c=o);const l=y.get(i);if(l.has(c))continue;l.set(c,!0);const u=z[a],m=k(n,s,i,u,c),v=h(f,m.match),x=h(f,m.notMatch);let E=0;E+=v*m.match.length,E+=x*m.notMatch.length,E/=d;const C=g-E;C>b.gain&&m.match.length>p&&m.notMatch.length>p&&(b=m,b.predicateName=a,b.predicate=u,b.attribute=i,b.pivot=c,b.gain=C)}}if(!b.gain||b.gain/g<c)return{category:F(f,s)};e.maxTreeDepth=l-1,t[b.attribute]+=b.gain,e.indices=b.match;const v=j(e,t);e.indices=b.notMatch;const x=j(e,t);return{attribute:b.attribute,predicate:b.predicate,predicateName:b.predicateName,pivot:b.pivot,match:v,notMatch:x,matchedCount:b.match.length,notMatchedCount:b.notMatch.length}}function V(e){const{data:t,predictors:n,indices:r,response:s,minItemsCount:o,scoreThreshold:a,maxTreeDepth:c,quantitative:l,minBucket:u,nTry:h}=e,p=r.length,m=t[s];if(0===c||p<=o)return{category:R(m,r)};const d=B(m,r),f=new Map,g=new Map;n.forEach((e=>{f.set(e,new Map),g.set(e,-1!==l.indexOf(e))}));let y={gain:0};h&&(n=i()(n,{size:h}));for(let i=p-1;i>=0;i--){const e=r[i];for(let i=0;i<n.length;i++){const s=n[i],o=t[s][e];let a,c;g.get(s)?(a=">=",c=Number(o>-1&&o<1?o.toPrecision(2):o.toFixed(2))):(a="==",c=o);const l=f.get(s);if(l.has(c))continue;l.set(c,!0);const h=z[a],T=k(t,r,s,h,c),b=B(m,T.match),v=B(m,T.notMatch);let x=0;x+=b*T.match.length,x+=v*T.notMatch.length,x/=p;const E=d-x;E>y.gain&&T.match.length>u&&T.notMatch.length>u&&(y=T,y.predicateName=a,y.predicate=h,y.attribute=s,y.pivot=c,y.gain=E)}}if(!y.gain||y.gain/d<a)return{category:R(m,r)};e.maxTreeDepth=c-1,e.indices=y.match;const T=V(e);e.indices=y.notMatch;const b=V(e);return{attribute:y.attribute,predicate:y.predicate,predicateName:y.predicateName,pivot:y.pivot,match:T,notMatch:b,matchedCount:y.match.length,notMatchedCount:y.notMatch.length}}function H(e,t,n){for(;;){if(e.category)return e.category;const r=t[e.attribute][n];e=(0,e.predicate)(r,e.pivot)?e.match:e.notMatch}}function W(e,t,n){const r={};for(let o=0;o<e.length;o++){const i=e[o].predict(t,n);r[i]=r[i]?r[i]+1:1}let i,s=-1;for(let o in r)r[o]>s&&(s=r[o],i=o);return i}const K=$,L=function(e){const t=e.data[e.response].length;this.root=V({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:u()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||c()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative}),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=Number(H(this.root,t,e));return r}return Number(H(this.root,t,n))},this.type="regression",this.response=e.response},_=function(e){this.trees=function(e){const t=[],n=e.data[e.response].length,r=u()(0,n,1);for(let o=0;o<e.nTrees;o++)t[o]=i()(r);const s=[];for(let i=0;i<e.nTrees;i++){e.indices=t[i];const n=new $(e);s.push(n)}return s}(e),this.importances={};for(let t=0;t<e.predictors.length;t++){const n=e.predictors[t];this.importances[n]=0;for(let e=0;e<this.trees.length;e++)this.importances[n]+=this.trees[e].importances[n];this.importances[n]/=this.trees.length}this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=W(this.trees,t,e);return r}return W(this.trees,t,n)},this.type="classification",this.response=e.response},G=Z},113183:function(e,t,n){n.r(t);var r=n(202784),i=n(213980),s=n.n(i),o=n(498614),a=n(822736),c=n(770561),l=n(588703),u=n.n(l),h=n(46739),p=n(112114),m=n(609207),d=n(741082),f=n(848285),g=Object.defineProperty,y=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,v=(e,t,n)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>{for(var n in t||(t={}))T.call(t,n)&&v(e,n,t[n]);if(y)for(var n of y(t))b.call(t,n)&&v(e,n,t[n]);return e};let E=0;const C=({y:e,x:t,type:n,nTrees:r,nTry:i,impurityMeasure:s,data:o,quantitative:a,scoreThreshold:c,maxTreeDepth:l,minItemsCount:h})=>{try{let p,d;p=u()(t)?t:[t],"Classification"===n&&(d=new m.OI({response:e,predictors:p,data:o,quantitative:a,criterion:s,nTrees:r,nTry:i,scoreThreshold:c,maxTreeDepth:l,minItemsCount:h}));const f=[];for(let e=0;e<p.length;e++){const t=p[e];f.push(d.importances[t])}return{forest:d,predictors:p,importances:f}}catch(p){return{}}};class w extends r.Component{constructor(e){var t;super(e),v(this,"symbol"!=typeof(t="handlePredict")?t+"":t,(()=>{this.props.onPredict(this.state.forest,E)})),E+=1;const{y:n,x:r,type:i,nTrees:s,nTry:o,impurityMeasure:a,data:c,quantitative:l,scoreThreshold:u,maxTreeDepth:h,minItemsCount:p}=e;this.state=x(x({},C({y:n,x:r,type:i,nTrees:s,nTry:o,impurityMeasure:a,data:c,quantitative:l,scoreThreshold:u,maxTreeDepth:h,minItemsCount:p})),e)}static getDerivedStateFromProps(e,t){if(e.y!==t.y||e.x!==t.x||e.type!==t.type||e.nTrees!==t.nTrees||e.nTry!==t.nTry||e.impurityMeasure!==t.impurityMeasure||e.data!==t.data||e.quantitative!==t.quantitative||e.scoreThreshold!==t.scoreThreshold||e.maxTreeDepth!==t.maxTreeDepth||e.minItemsCount!==t.minItemsCount){const{y:t,x:n,type:r,nTrees:i,nTry:s,impurityMeasure:o,data:a,quantitative:c,scoreThreshold:l,maxTreeDepth:u,minItemsCount:h}=e;return x(x({},C({y:t,x:n,type:r,nTrees:i,nTry:s,impurityMeasure:o,data:a,quantitative:c,scoreThreshold:l,maxTreeDepth:u,minItemsCount:h})),e)}return null}render(){const{forest:e}=this.state,{t:t}=this.props;return e?r.createElement("div",{style:{overflowX:"auto",width:"100%"}},r.createElement("span",{className:"title"},t("random-forest-for",{y:this.props.y,counter:E})),r.createElement("p",null,t("created-from-trees",{nTrees:this.props.nTrees,nTry:this.props.nTry})),r.createElement(h.Z,{editable:!0,data:[{type:"bar",x:this.state.predictors,y:this.state.importances}],layout:{xaxis:{title:t("variable")},yaxis:{title:t("importance")}}}),this.props.onPredict?r.createElement(p.Z,{tooltip:t("predictions-attached")},r.createElement(c.Z,{variant:"secondary",size:"sm",style:{marginTop:10},onClick:this.handlePredict},this.props.t("use-model-to-predict"))):null):r.createElement(a.Z,{variant:"danger"},t("missing-attributes"))}}w.defaultProps={type:"Classification",nTrees:50,nTry:1,impurityMeasure:"gini",scoreThreshold:.01,maxTreeDepth:20,minItemsCount:50,onPredict:null},w.propTypes={data:s().object.isRequired,y:s().oneOfType([s().string,s().instanceOf(f.E)]).isRequired,x:s().oneOfType([s().arrayOf(s().oneOfType([s().string,s().instanceOf(f.E)])),s().string,s().instanceOf(f.E)]).isRequired,type:s().oneOf(["Classification","Regression"]),quantitative:s().arrayOf(s().string).isRequired,nTrees:s().number,nTry:s().number,impurityMeasure:s().oneOf(["gini","entropy"]),scoreThreshold:s().number,maxTreeDepth:s().number,minItemsCount:s().number,onPredict:s().func},t.default=(0,o.Zh)("models")((0,d.W)(w))},394362:function(e,t){t.Z=function(e){const t=document.createElement("div");t.innerHTML=e,t.style.position="fixed",t.style.opacity=0,t.style.pointerEvents="none",document.body.appendChild(t),window.getSelection().removeAllRanges();const n=document.createRange();n.selectNode(t),window.getSelection().addRange(n),document.execCommand("copy"),document.body.removeChild(t)}}}]);