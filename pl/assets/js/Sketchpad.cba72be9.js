(self.webpackChunk=self.webpackChunk||[]).push([[5050],{109168:function(e,t,n){"use strict";n.d(t,{xV:function(){return he},W4:function(){return ve},sN:function(){return W}});var o=n(497326),a=n(894578),s=n(202784),i=n(213980),r=n.n(i),l=n(72779),c=n.n(l);function d(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return"function"==typeof e&&e.apply(void 0,n)}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var h="react-contextmenu",p="react-contextmenu--visible",g="react-contextmenu-wrapper",m="react-contextmenu-item",f="react-contextmenu-item--active",v="react-contextmenu-item--disabled",w="react-contextmenu-item--divider",y="react-contextmenu-item--selected",b="react-contextmenu-submenu",E={},P=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),S="REACT_CONTEXTMENU_SHOW",x="REACT_CONTEXTMENU_HIDE";function M(e,t,n){var o;void 0===n&&(n=window),"function"==typeof window.CustomEvent?o=new window.CustomEvent(e,{detail:t}):(o=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),n&&(n.dispatchEvent(o),Object.assign(E,t))}function k(e,t){void 0===e&&(e={}),M(S,Object.assign({},e,{type:S}),t)}function C(e,t){void 0===e&&(e={}),M(x,Object.assign({},e,{type:x}),t)}var D=Object.defineProperty,Z=function(e,t,n){return function(e,t,n){t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},I=new function(){var e=this;Z(this,"handleShowEvent",(function(t){for(var n in e.callbacks)u(e.callbacks,n)&&e.callbacks[n].show(t)})),Z(this,"handleHideEvent",(function(t){for(var n in e.callbacks)u(e.callbacks,n)&&e.callbacks[n].hide(t)})),Z(this,"register",(function(t,n){var o=Math.random().toString(36).substring(7);return e.callbacks[o]={show:t,hide:n},o})),Z(this,"unregister",(function(t){t&&e.callbacks[t]&&delete e.callbacks[t]})),this.callbacks={},P&&(window.addEventListener(S,this.handleShowEvent),window.addEventListener(x,this.handleHideEvent))},O=n(55196),T=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,H=function(e,t,n){return t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},B=function(e,t,n){return H(e,"symbol"!=typeof t?t+"":t,n),n},U=function(e){function t(){var t;return t=e.apply(this,arguments)||this,B((0,o.Z)(t),"handleClick",(function(e){0!==e.button&&1!==e.button&&e.preventDefault(),t.props.disabled||t.props.divider||(d(t.props.onClick,e,Object.assign({},t.props.data,E.data),E.target),t.props.preventClose||C())})),t}return(0,a.Z)(t,e),t.prototype.render=function(){var e,t,n,o=this,a=this.props,i=a.attributes,r=a.children,l=a.className,d=a.disabled,u=a.divider,h=a.selected,p=c()(l,m,i.className,((e={})[c()(v,i.disabledClassName)]=d,e[c()(w,i.dividerClassName)]=u,e[c()(y,i.selectedClassName)]=h,e));return s.createElement("div",(t=function(e,t){for(var n in t||(t={}))L.call(t,n)&&H(e,n,t[n]);if(N)for(var o,a=(0,O.Z)(N(t));!(o=a()).done;)n=o.value,F.call(t,n)&&H(e,n,t[n]);return e}({},i),n={className:p,role:"menuitem",tabIndex:"-1","aria-disabled":d?"true":"false",ref:function(e){o.ref=e},onMouseMove:this.props.onMouseMove,onMouseLeave:this.props.onMouseLeave,onTouchEnd:this.handleClick,onClick:this.handleClick},R(t,z(n))),u?null:r)},t}(s.Component);B(U,"propTypes",{attributes:r().object,children:r().node,className:r().string,data:r().object,disabled:r().bool,divider:r().bool,onClick:r().func,onMouseLeave:r().func,onMouseMove:r().func,preventClose:r().bool,selected:r().bool}),B(U,"defaultProps",{attributes:{},children:null,className:"",data:{},disabled:!1,divider:!1,onClick:function(){return null},onMouseMove:function(){return null},onMouseLeave:function(){return null},preventClose:!1,selected:!1});var W=U,A=Object.defineProperty,j=function(e,t,n){return function(e,t,n){t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Y=function(e){function t(t){var n;return n=e.call(this,t)||this,j((0,o.Z)(n),"handleKeyNavigation",(function(e){if(!1!==n.state.isVisible)switch(e.keyCode){case 37:case 27:e.preventDefault(),n.hideMenu(e);break;case 38:e.preventDefault(),n.selectChildren(!0);break;case 40:e.preventDefault(),n.selectChildren(!1);break;case 39:n.tryToOpenSubMenu(e);break;case 13:e.preventDefault(),n.tryToOpenSubMenu(e);var t=n.seletedItemRef&&n.seletedItemRef.props&&n.seletedItemRef.props.disabled;n.seletedItemRef&&n.seletedItemRef.ref instanceof HTMLElement&&!t?n.seletedItemRef.ref.click():n.hideMenu(e)}})),j((0,o.Z)(n),"handleForceClose",(function(){n.setState({forceSubMenuOpen:!1})})),j((0,o.Z)(n),"tryToOpenSubMenu",(function(e){n.state.selectedItem&&n.state.selectedItem.type===n.getSubMenuType()&&(e.preventDefault(),n.setState({forceSubMenuOpen:!0}))})),j((0,o.Z)(n),"selectChildren",(function(e){var t=n.state.selectedItem,o=[],a=0,i={};if(s.Children.forEach(n.props.children,(function e(t,r){t&&([W,n.getSubMenuType()].indexOf(t.type)<0?s.Children.forEach(t.props?t.props.children:[],e):t.props.divider||(t.props.disabled&&(++a,i[r]=!0),o.push(t)))})),a!==o.length){var r=function(t){var n=t;do{e?--n:++n,n<0?n=o.length-1:n>=o.length&&(n=0)}while(n!==t&&i[n]);return n===t?null:n}(o.indexOf(t));null!==r&&n.setState({selectedItem:o[r],forceSubMenuOpen:!1})}})),j((0,o.Z)(n),"onChildMouseMove",(function(e){n.state.selectedItem!==e&&n.setState({selectedItem:e,forceSubMenuOpen:!1})})),j((0,o.Z)(n),"onChildMouseLeave",(function(){n.setState({selectedItem:null,forceSubMenuOpen:!1})})),j((0,o.Z)(n),"renderChildren",(function(e){return s.Children.map(e,(function(e){var t={};return s.isValidElement(e)?[W,n.getSubMenuType()].indexOf(e.type)<0?(t.children=n.renderChildren(e.props?e.props.children:[]),s.cloneElement(e,t)):(t.onMouseLeave=n.onChildMouseLeave.bind((0,o.Z)(n)),e.type===n.getSubMenuType()&&(t.forceOpen=n.state.forceSubMenuOpen&&n.state.selectedItem===e,t.forceClose=n.handleForceClose,t.parentKeyNavigationHandler=n.handleKeyNavigation),e.props.divider||n.state.selectedItem!==e?(t.onMouseMove=function(){return n.onChildMouseMove(e)},s.cloneElement(e,t)):(t.selected=!0,t.ref=function(e){n.seletedItemRef=e},s.cloneElement(e,t))):e}))})),n.seletedItemRef=null,n.state={selectedItem:null,forceSubMenuOpen:!1},n}return(0,a.Z)(t,e),t}(s.Component);j(Y,"propTypes",{children:r().node.isRequired});var X=Y,K=n(690299),J=n.n(K),V=n(557106),q=n.n(V),G=Object.defineProperty,$=Object.defineProperties,_=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,ne=function(e,t,n){return t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},oe=function(e,t){for(var n in t||(t={}))ee.call(t,n)&&ne(e,n,t[n]);if(Q)for(var o,a=(0,O.Z)(Q(t));!(o=a()).done;){n=o.value;te.call(t,n)&&ne(e,n,t[n])}return e},ae=function(e,t){return $(e,_(t))},se=function(e,t,n){return ne(e,"symbol"!=typeof t?t+"":t,n),n},ie=J()("isle:contextmenu"),re=function(e){function t(t){var n;return n=e.call(this,t)||this,se((0,o.Z)(n),"getMenuPosition",(function(){var e=window,t=e.innerWidth,o=e.innerHeight,a=n.subMenu.getBoundingClientRect(),s={};if(a.bottom>o){ie("Bottom of element is below height of window...");var i="-"+q()(a.height-a.y,0)+"px";s.bottom=i}else ie("Bottom of element does not extend below window dimensions..."),s.top=0;return a.right<t?s.left="100%":s.right="100%",s})),se((0,o.Z)(n),"getRTLMenuPosition",(function(){var e=window.innerHeight,t=n.subMenu.getBoundingClientRect(),o={};return t.bottom>e?o.bottom=0:o.top=0,t.left<0?o.left="100%":o.right="100%",o})),se((0,o.Z)(n),"hideMenu",(function(e){e.preventDefault(),n.hideSubMenu(e)})),se((0,o.Z)(n),"hideSubMenu",(function(e){e.detail&&e.detail.id&&n.menu&&e.detail.id!==n.menu.id||(n.props.forceOpen&&n.props.forceClose(),n.setState({visible:!1,selectedItem:null}),n.unregisterHandlers())})),se((0,o.Z)(n),"handleClick",(function(e){e.preventDefault(),n.props.disabled||(d(n.props.onClick,e,Object.assign({},n.props.data,E.data),E.target),n.props.onClick&&!n.props.preventCloseOnClick&&C())})),se((0,o.Z)(n),"handleMouseEnter",(function(){n.closetimer&&clearTimeout(n.closetimer),n.props.disabled||n.state.visible||(n.opentimer=setTimeout((function(){return n.setState({visible:!0,selectedItem:null})}),n.props.hoverDelay))})),se((0,o.Z)(n),"handleMouseLeave",(function(){n.opentimer&&clearTimeout(n.opentimer),n.state.visible&&(n.closetimer=setTimeout((function(){return n.setState({visible:!1,selectedItem:null})}),n.props.hoverDelay))})),se((0,o.Z)(n),"menuRef",(function(e){n.menu=e})),se((0,o.Z)(n),"subMenuRef",(function(e){n.subMenu=e})),se((0,o.Z)(n),"registerHandlers",(function(){document.removeEventListener("keydown",n.props.parentKeyNavigationHandler),document.addEventListener("keydown",n.handleKeyNavigation)})),se((0,o.Z)(n),"unregisterHandlers",(function(e){document.removeEventListener("keydown",n.handleKeyNavigation),e||document.addEventListener("keydown",n.props.parentKeyNavigationHandler)})),n.state=Object.assign({},n.state,{visible:!1}),n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.listenId=I.register((function(){}),this.hideSubMenu)},n.getSubMenuType=function(){return t},n.shouldComponentUpdate=function(e,t){return this.isVisibilityChange=!(this.state.visible===t.visible&&this.props.forceOpen===e.forceOpen||this.state.visible&&e.forceOpen||this.props.forceOpen&&t.visible),!0},n.componentDidUpdate=function(){var e=this;if(this.isVisibilityChange)if(this.props.forceOpen||this.state.visible){(window.requestAnimationFrame||setTimeout)((function(){var t=e.props.rtl?e.getRTLMenuPosition():e.getMenuPosition();e.subMenu.style.removeProperty("top"),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("left"),e.subMenu.style.removeProperty("right"),u(t,"top")&&(e.subMenu.style.top=t.top),u(t,"left")&&(e.subMenu.style.left=t.left),u(t,"bottom")&&(e.subMenu.style.bottom=t.bottom),u(t,"right")&&(e.subMenu.style.right=t.right),e.subMenu.classList.add(p),e.registerHandlers(),e.setState({selectedItem:null})}))}else{this.subMenu.addEventListener("transitionend",(function t(){e.subMenu.removeEventListener("transitionend",t),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("right"),e.subMenu.style.top=0,e.subMenu.style.left="100%",e.unregisterHandlers()})),this.subMenu.classList.remove(p)}},n.componentWillUnmount=function(){this.listenId&&I.unregister(this.listenId),this.opentimer&&clearTimeout(this.opentimer),this.closetimer&&clearTimeout(this.closetimer),this.unregisterHandlers(!0)},n.render=function(){var e,t=this.props,n=t.children,o=t.attributes,a=t.disabled,i=t.title,r=t.selected,l=this.state.visible,d={ref:this.menuRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,className:c()(m,b,o.listClassName),style:{position:"relative"}},u={className:c()(m,o.className,(e={},e[c()(v,o.disabledClassName)]=a,e[c()(f,o.visibleClassName)]=l,e[c()(y,o.selectedClassName)]=r,e)),onMouseMove:this.props.onMouseMove,onMouseOut:this.props.onMouseOut,onClick:this.handleClick},p={ref:this.subMenuRef,style:{position:"absolute",transition:"opacity 1ms",top:0,left:"100%"},className:c()(h,this.props.className)};return s.createElement("nav",ae(oe({},d),{role:"menuitem",tabIndex:"-1","aria-haspopup":"true"}),s.createElement("div",oe(oe({},o),u),i),s.createElement("nav",ae(oe({},p),{role:"menu",tabIndex:"-1"}),this.renderChildren(n)))},t}(X);se(re,"propTypes",{children:r().node.isRequired,attributes:r().object,title:r().node.isRequired,className:r().string,disabled:r().bool,hoverDelay:r().number,rtl:r().bool,selected:r().bool,onMouseMove:r().func,onMouseOut:r().func,forceOpen:r().bool,forceClose:r().func,parentKeyNavigationHandler:r().func}),se(re,"defaultProps",{disabled:!1,hoverDelay:500,attributes:{},className:"",rtl:!1,selected:!1,onMouseMove:function(){return null},onMouseOut:function(){return null},forceOpen:!1,forceClose:function(){return null},parentKeyNavigationHandler:function(){return null}});var le=re,ce=Object.defineProperty,de=function(e,t,n){return function(e,t,n){t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},ue=function(e){function t(t){var n;return n=e.call(this,t)||this,de((0,o.Z)(n),"registerHandlers",(function(){document.addEventListener("mousedown",n.handleOutsideClick),document.addEventListener("touchstart",n.handleOutsideClick),n.props.preventHideOnScroll||document.addEventListener("scroll",n.handleHide),n.props.preventHideOnContextMenu||document.addEventListener("contextmenu",n.handleHide),document.addEventListener("keydown",n.handleKeyNavigation),n.props.preventHideOnResize||window.addEventListener("resize",n.handleHide)})),de((0,o.Z)(n),"unregisterHandlers",(function(){document.removeEventListener("mousedown",n.handleOutsideClick),document.removeEventListener("touchstart",n.handleOutsideClick),document.removeEventListener("scroll",n.handleHide),document.removeEventListener("contextmenu",n.handleHide),document.removeEventListener("keydown",n.handleKeyNavigation),window.removeEventListener("resize",n.handleHide)})),de((0,o.Z)(n),"handleShow",(function(e){if(e.detail.id===n.props.id&&!n.state.isVisible){var t=e.detail.position,o=t.x,a=t.y;n.setState({isVisible:!0,x:o,y:a}),n.registerHandlers(),d(n.props.onShow,e)}})),de((0,o.Z)(n),"handleHide",(function(e){!n.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==n.props.id||(n.unregisterHandlers(),n.setState({isVisible:!1,selectedItem:null,forceSubMenuOpen:!1}),d(n.props.onHide,e))})),de((0,o.Z)(n),"handleOutsideClick",(function(e){n.menu.contains(e.target)||C()})),de((0,o.Z)(n),"handleMouseLeave",(function(e){e.preventDefault(),d(n.props.onMouseLeave,e,Object.assign({},n.props.data,E.data),E.target),n.props.hideOnLeave&&C()})),de((0,o.Z)(n),"handleContextMenu",(function(e){e.preventDefault(),n.handleHide(e)})),de((0,o.Z)(n),"hideMenu",(function(e){27!==e.keyCode&&13!==e.keyCode||C()})),de((0,o.Z)(n),"getMenuPosition",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var o={top:t,left:e};if(!n.menu)return o;var a=window,s=a.innerWidth,i=a.innerHeight,r=n.menu.getBoundingClientRect();return t+r.height>i&&(o.top-=r.height),e+r.width>s&&(o.left-=r.width),o.top<0&&(o.top=r.height<i?(i-r.height)/2:0),o.left<0&&(o.left=r.width<s?(s-r.width)/2:0),o})),de((0,o.Z)(n),"getRTLMenuPosition",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var o={top:t,left:e};if(!n.menu)return o;var a=window,s=a.innerWidth,i=a.innerHeight,r=n.menu.getBoundingClientRect();return o.left=e-r.width,t+r.height>i&&(o.top-=r.height),o.left<0&&(o.left+=r.width),o.top<0&&(o.top=r.height<i?(i-r.height)/2:0),o.left+r.width>s&&(o.left=r.width<s?(s-r.width)/2:0),o})),de((0,o.Z)(n),"menuRef",(function(e){n.menu=e})),n.state=Object.assign({},n.state,{x:0,y:0,isVisible:!1}),n}(0,a.Z)(t,e);var n=t.prototype;return n.getSubMenuType=function(){return le},n.componentDidMount=function(){this.listenId=I.register(this.handleShow,this.handleHide)},n.componentDidUpdate=function(){var e=this,t=window.requestAnimationFrame||setTimeout;this.state.isVisible?t((function(){var n=e.state,o=n.x,a=n.y,s=e.props.rtl?e.getRTLMenuPosition(o,a):e.getMenuPosition(o,a),i=s.top,r=s.left;t((function(){e.menu&&(e.menu.style.top=i+"px",e.menu.style.left=r+"px",e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))})):t((function(){e.menu&&(e.menu.style.opacity=0,e.menu.style.pointerEvents="none")}))},n.componentWillUnmount=function(){this.listenId&&I.unregister(this.listenId),this.unregisterHandlers()},n.render=function(){var e,t=this.props,n=t.children,o=t.className,a=t.style,i=this.state.isVisible,r=Object.assign({},a,{position:"fixed",opacity:0,pointerEvents:"none"}),l=c()(h,o,((e={})[p]=i,e));return s.createElement("nav",{role:"menu",tabIndex:"-1",ref:this.menuRef,style:r,className:l,onContextMenu:this.handleContextMenu,onMouseLeave:this.handleMouseLeave},this.renderChildren(n))},t}(X);de(ue,"propTypes",{id:r().string.isRequired,children:r().node.isRequired,data:r().object,className:r().string,hideOnLeave:r().bool,rtl:r().bool,onHide:r().func,onMouseLeave:r().func,onShow:r().func,preventHideOnContextMenu:r().bool,preventHideOnResize:r().bool,preventHideOnScroll:r().bool,style:r().object}),de(ue,"defaultProps",{className:"",data:{},hideOnLeave:!1,rtl:!1,onHide:function(){return null},onMouseLeave:function(){return null},onShow:function(){return null},preventHideOnContextMenu:!1,preventHideOnResize:!1,preventHideOnScroll:!1,style:{}});var he=ue,pe=Object.defineProperty,ge=function(e,t,n){return function(e,t,n){t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},me=["input","textarea"],fe=function(e){function t(){var t;return t=e.apply(this,arguments)||this,ge((0,o.Z)(t),"touchHandled",!1),ge((0,o.Z)(t),"handleMouseDown",(function(e){t.props.holdToDisplay>=0&&0===e.button&&(e.persist(),e.stopPropagation(),t.mouseDownTimeoutId=setTimeout((function(){return t.handleContextClick(e)}),t.props.holdToDisplay)),d(t.props.attributes.onMouseDown,e)})),ge((0,o.Z)(t),"handleMouseUp",(function(e){0===e.button&&clearTimeout(t.mouseDownTimeoutId),d(t.props.attributes.onMouseUp,e)})),ge((0,o.Z)(t),"handleMouseOut",(function(e){0===e.button&&clearTimeout(t.mouseDownTimeoutId),d(t.props.attributes.onMouseOut,e)})),ge((0,o.Z)(t),"handleTouchstart",(function(e){t.touchHandled=!1,t.props.holdToDisplay>=0&&(e.persist(),e.stopPropagation(),t.touchstartTimeoutId=setTimeout((function(){t.handleContextClick(e),t.touchHandled=!0}),t.props.holdToDisplay)),d(t.props.attributes.onTouchStart,e)})),ge((0,o.Z)(t),"handleTouchEnd",(function(e){t.touchHandled&&e.preventDefault(),clearTimeout(t.touchstartTimeoutId),d(t.props.attributes.onTouchEnd,e)})),ge((0,o.Z)(t),"handleContextMenu",(function(e){e.button===t.props.mouseButton&&t.handleContextClick(e),d(t.props.attributes.onContextMenu,e)})),ge((0,o.Z)(t),"handleMouseClick",(function(e){e.button===t.props.mouseButton?t.handleContextClick(e):t.props.holdToDisplay>0&&C(),d(t.props.attributes.onClick,e)})),ge((0,o.Z)(t),"handleContextClick",(function(e){if(!(t.props.disable||t.props.disableIfShiftIsPressed&&e.shiftKey)){var n=document.activeElement;if(!(n&&(-1!==me.indexOf(n.tagName.toLowerCase())||n.isContentEditable))&&"CANVAS"!==n.tagName){e.preventDefault(),e.stopPropagation();var o=e.clientX||e.touches&&e.touches[0].pageX,a=e.clientY||e.touches&&e.touches[0].pageY;t.props.posX&&(o-=t.props.posX),t.props.posY&&(a-=t.props.posY),C();var s=d(t.props.collect,t.props),i={position:{x:o,y:a},target:t.elem,id:t.props.id};s&&"function"==typeof s.then?s.then((function(t){i.data=Object.assign({},t,{target:e.target}),k(i)})):(i.data=Object.assign({},s,{target:e.target}),k(i))}}})),ge((0,o.Z)(t),"elemRef",(function(e){t.elem=e})),t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.renderTag,n=e.attributes,o=e.children,a=Object.assign({},n,{className:c()(g,n.className),onContextMenu:this.handleContextMenu,onClick:this.handleMouseClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onTouchStart:this.handleTouchstart,onTouchEnd:this.handleTouchEnd,onMouseOut:this.handleMouseOut,ref:this.elemRef});return s.createElement(t,a,o)},t}(s.Component);fe.propTypes={id:r().string.isRequired,children:r().node.isRequired,attributes:r().object,collect:r().func,disable:r().bool,holdToDisplay:r().number,posX:r().number,posY:r().number,renderTag:r().elementType,mouseButton:r().number,disableIfShiftIsPressed:r().bool},fe.defaultProps={attributes:{},collect:function(){return null},disable:!1,holdToDisplay:1e3,renderTag:"div",posX:0,posY:0,mouseButton:2,disableIfShiftIsPressed:!1};var ve=fe;Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable},628276:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return bt}});var o=n(497326),a=n(894578),s=n(55196),i=n(202784),r=n(213980),l=n.n(r),c=n(198),d=n(912895),u=n.n(d),h=n(690299),p=n.n(h),g=n(366441),m=n.n(g),f=n(780594),v=n.n(f),w=n(109168),y=n(260952),b=n(109361),E=n(435376),P=n(175891),S=n(203858),x=n(423184),M=n(770561),k=n(81982),C=n(931776),D=n(891719),Z=n.n(D),I=n(561647),O=n.n(I),T=n(413262),R=n(708579),z=n(269891),N=n(309765),L=n(588703),F=n.n(L),H=n(287013),B=n.n(H),U=n(830324),W=n.n(U),A=n(409961),j=n.n(A),Y=n(686605),X=n.n(Y),K=n(32593),J=n.n(K),V=n(557106),q=n.n(V),G=n(783158),$=n.n(G),_=n(695688),Q=n.n(_),ee=n(306830),te=n.n(ee),ne=n(635314),oe=n.n(ne),ae=n(437069),se=n.n(ae),ie=n(302467),re=n.n(ie),le=n(24551),ce=n(675252),de=n(652501),ue=n(189263),he=n(476709),pe=n(884968),ge=n(923723),me=n(344843),fe=n.n(me),ve=n(38226),we=n.n(ve);var ye=function(e,t,n){void 0===e&&(e=32),void 0===t&&(t=48),void 0===n&&(n=126);for(var o=new Array(e),a=0;a<e;a++)o[a]=we()(t,n);return fe().apply(null,o)},be=n(267682),Ee=JSON.parse('[{"command":"nextPage","trigger":"next","description":"Go to next page"},{"command":"prevPage","trigger":"previous","description":"Go to the previous next page"},{"command":"firstPage","trigger":["first","First"],"description":"Jump to the first page"},{"command":"lastPage","trigger":"last","description":"Jump to the last page"}]'),Pe=p()("isle:sketchpad:curve");var Se=function(e,t,n,o,a,s,i){if(Pe("Received points: "+t.length),void 0===t||t.length<2)return new Float32Array(0);var r;a="number"==typeof a?a:.9,s="number"==typeof s?s:30;var l=1,c=t.length,d=0,u=new Float32Array((c-2)*s+2+(i?2*s:0)),h=new Float32Array(s+2<<2),p=4;t=t.slice(0);for(var g=0;g<t.length;g+=2)t[g]=t[g]*n,t[g+1]=t[g+1]*o;for(r=t.slice(0),i?(r.unshift(t[c-1]),r.unshift(t[c-2]),r.push(t[0],t[1])):(r.unshift(t[1]),r.unshift(t[0]),r.push(t[c-2],t[c-1])),h[0]=1;l<s;l++){var m=l/s,f=m*m,v=f*m,w=2*v,y=3*f;h[p++]=w-y+1,h[p++]=y-w,h[p++]=v-2*f+m,h[p++]=v-f}function b(e,t,n,o){for(var a,i=2;i<n;i+=2){var r=e[i],l=e[i+1],c=e[i+2],h=e[i+3],p=(c-e[i-2])*o,g=(h-e[i-1])*o,m=(e[i+4]-r)*o,f=(e[i+5]-l)*o,v=0;for(a=0;a<s;a++){var w=t[v++],y=t[v++],b=t[v++],E=t[v++];u[d++]=w*r+y*c+b*p+E*m,u[d++]=w*l+y*h+b*g+E*f}}}for(h[++p]=1,b(r,h,c,a),i&&((r=[]).push(t[c-4],t[c-3],t[c-2],t[c-1],t[0],t[1],t[2],t[3]),b(r,h,4,a)),c=i?0:t.length-2,u[d++]=t[c++],u[d]=t[c],l=0,c=u.length;l<c;l+=2){var E=(u[l]+u[l+2])/2,P=(u[l+1]+u[l+3])/2;e.lineTo(u[l],u[l+1],E,P)}return e.lineTo(u[l],u[l+1],u[l+2],u[l+3]),u},xe=function(e){var t=e.tooltip,n=e.onClick,o=e.glyph,a=e.label,s=e.disabled,r=e.size,l=e.variant,c=void 0===l?"light":l;return i.createElement(R.Z,{placement:"bottom",tooltip:t},i.createElement(M.Z,{variant:c,size:r,onClick:n,disabled:s,"aria-label":t},o?i.createElement("div",{className:"fa fa-"+o}):null,a))},Me=n(65420),ke=n(226010),Ce=n(155061),De=Object.defineProperty,Ze=function(e,t,n){return function(e,t,n){t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Ie=["#000000","#FF6900","#FCB900","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#9900EF"],Oe=[4,5,6,7,8,9,10,11,12,14,18,20,22,24,30,36,42],Te=[8,9,10,11,12,14,18,24,30,36,48,60,72],Re=function(e){function t(t){var n;return n=e.call(this,t)||this,Ze((0,o.Z)(n),"toggleColorPicker",(function(){n.setState({showColorPicker:!n.state.showColorPicker})})),Ze((0,o.Z)(n),"toggleDrawingMode",(function(){n.props.onModeChange("drawing"===n.props.mode?"none":"drawing")})),Ze((0,o.Z)(n),"toggleDragMode",(function(){n.props.onModeChange("drag"===n.props.mode?"none":"drag")})),Ze((0,o.Z)(n),"toggleDeleteMode",(function(){n.props.onModeChange("delete"===n.props.mode?"none":"delete")})),Ze((0,o.Z)(n),"togglePointerMode",(function(){n.props.onModeChange("pointer"===n.props.mode?"none":"pointer")})),Ze((0,o.Z)(n),"toggleZoomMode",(function(){n.props.onModeChange("zoom"===n.props.mode?"none":"zoom")})),Ze((0,o.Z)(n),"toggleTextMode",(function(){n.props.onModeChange("text"===n.props.mode?"none":"text")})),Ze((0,o.Z)(n),"handleColorChange",(function(e){n.props.onColorChange(e.hex),n.setState({showColorPicker:!n.state.showColorPicker})})),n.state={showColorPicker:!1},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this.props.t;return i.createElement(i.Fragment,null,i.createElement(x.Z,{size:"sm",className:"sketch-drag-delete-modes sketch-button-group"},i.createElement(xe,{tooltip:e("drag-mode"),size:"sm",variant:"drag"===this.props.mode?"success":"secondary",onClick:this.toggleDragMode,glyph:"arrows-alt"}),i.createElement(xe,{tooltip:e("delete-mode"),size:"sm",variant:"delete"===this.props.mode?"success":"secondary",onClick:this.toggleDeleteMode,glyph:"times"}),i.createElement(xe,{tooltip:e("magnifying-glass"),size:"sm",variant:"zoom"===this.props.mode?"success":"secondary",onClick:this.toggleZoomMode,glyph:"search-plus"}),i.createElement(xe,{tooltip:e("pointer-mode"),size:"sm",variant:"pointer"===this.props.mode?"success":"secondary",onClick:this.togglePointerMode,glyph:"circle"})),i.createElement(x.Z,{size:"sm",className:"sketch-drawing-buttons"},i.createElement(xe,{tooltip:e("drawing-mode"),glyph:"paint-brush",size:"sm",variant:"drawing"===this.props.mode?"success":"secondary",onClick:this.toggleDrawingMode}),i.createElement(ke.Z,{id:"sketch-brush-size-dropdown",size:"sm",variant:"light",title:this.props.brushSize,onSelect:this.props.onBrushSelect},Oe.map((function(e,t){return i.createElement(Ce.Z,{key:t,eventKey:e},e)})))),i.createElement(x.Z,{size:"sm"},i.createElement(R.Z,{placement:"right",tooltip:e("change-brush-color")},i.createElement(M.Z,{size:"sm",onClick:this.toggleColorPicker,style:{background:this.props.color,color:"white"}},"Col"))),i.createElement(x.Z,{size:"sm",className:"sketch-text-buttons"},i.createElement(xe,{size:"sm",variant:"text"===this.props.mode?"success":"secondary",onClick:this.toggleTextMode,tooltip:e("text-mode"),glyph:"font"}),i.createElement(ke.Z,{id:"sketch-font-dropdown",size:"sm",variant:"text"===this.props.mode?"success":"secondary",title:this.props.fontFamily,onSelect:this.props.onFontFamilySelect},i.createElement(Ce.Z,{eventKey:"Arial"},"Arial"),i.createElement(Ce.Z,{eventKey:"Helvetica"},"Helvetica"),i.createElement(Ce.Z,{eventKey:"Times"},"Times"),i.createElement(Ce.Z,{eventKey:"Courier"},"Courier"),i.createElement(Ce.Z,{eventKey:"Verdana"},"Verdana"),i.createElement(Ce.Z,{eventKey:"Palatino"},"Palatino")),i.createElement(ke.Z,{id:"sketch-font-size-dropdown",size:"sm",variant:"light",title:this.props.fontSize,onSelect:this.props.onFontSizeSelect},Te.map((function(e,t){return i.createElement(Ce.Z,{key:t,eventKey:e},e)})))),i.createElement("div",{className:"sketch-colorpicker",style:{display:this.state.showColorPicker?"initial":"none"}},i.createElement(Me.Z,{color:this.props.color,colors:Ie,onChangeComplete:this.handleColorChange,triangle:"top-right"})))},t}(i.Component);Re.propTypes={brushSize:l().number.isRequired,color:l().string.isRequired,fontFamily:l().string.isRequired,fontSize:l().number.isRequired,mode:l().string.isRequired,onBrushSelect:l().func.isRequired,onColorChange:l().func.isRequired,onFontFamilySelect:l().func.isRequired,onFontSizeSelect:l().func.isRequired,onModeChange:l().func.isRequired};var ze=Re,Ne=p()("isle:sketchpad:harmonize-sketchpad-elements");var Le=function(e,t,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]),n=n.map((function(e){return e.page})),o=o.map((function(e){return e.page}));for(var a=0;a<n.length;a++){var s=n[a];o.includes(s)||(Ne("Removing elements from page "+s),e.splice(s,1),t.splice(s,1))}for(var i=0;i<o.length;i++){var r=o[i];n.includes(r)||(Ne("Adding an empty page at position "+r),e.splice(r,0,[]),t.splice(r,0,0))}},Fe=n(525263),He=n(238904),Be=n(289973),Ue=n(907756),We=n(382617),Ae=n(10206),je=n(338664),Ye=Object.defineProperty,Xe=function(e,t,n){return function(e,t,n){t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Ke=p()("isle:lesson:sketchpad-contextmenu"),Je=function(e){function t(){var t;return t=e.apply(this,arguments)||this,Xe((0,o.Z)(t),"copyToClipboard",(function(){var e;if(Ke("Copying page to clipboard... "),t.props.canvas){var n=t.props.canvas.toDataURL();e='<img alt="Sketchpad Page" src="'+n+'" />',document.addEventListener("copy",o),document.execCommand("copy"),document.removeEventListener("copy",o)}function o(t){t.clipboardData.setData("text/html ",e),t.clipboardData.setData("text/plain ",e),t.preventDefault()}})),t}return(0,a.Z)(t,e),t.prototype.render=function(){return i.createElement(w.xV,{id:"sketchpadWindow"},i.createElement(w.sN,{onClick:this.copyToClipboard},this.props.t("copy")))},t}(i.Component);Je.propTypes={canvas:l().object},Je.defaultProps={canvas:null};var Ve=(0,c.Z)("sketchpad")(Je),qe=JSON.parse('[{"target":".sketch-drawing-buttons","content":"In the drawing mode, you can draw lines on the sketchpad. Try it out. Also try changing the brush size and brush color."},{"target":".sketch-pages","content":"Use the + button to insert a new page and the other buttons for navigation."},{"target":".sketch-text-buttons","content":"In the text mode, you can insert text annotations. Click on a point on the sketchpad to create a note and insert it by hitting ENTER."},{"target":".sketch-drag-delete-modes","content":"The drag and delete modes allow you to move around and delete created elements, respectively. Once either mode is selected, simply click on an element on the page to drag or delete it. The laser pointer and magnifying glass may be used to highlight and zoom in on parts of the current slide."},{"target":".sketch-undo-redo","content":"The undo button allows you to revert the last additions you made to the slides, while the redo button can redraw elements which were previously undone."},{"target":".sketch-save-buttons","content":"You can either export the current page as an image file or all pages as a PDF document. Alternatively, your notes can also be uploaded directly to the ISLE server by clicking the button to the right. Once the upload is finished, make sure to save the displayed link to the uploaded file."},{"target":".sketch-save-buttons","content":"Your notes are autosaved in the cloud and will be accessible when opening the lesson again in the future. However, to make sure the latest changes are saved, you are advised to click the \\"Save in browser\\" button before closing the page."}]'),Ge=Object.defineProperty,$e=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,et=function(e,t,n){return t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},tt=function(e,t){for(var n in t||(t={}))_e.call(t,n)&&et(e,n,t[n]);if($e)for(var o,a=(0,s.Z)($e(t));!(o=a()).done;){n=o.value;Qe.call(t,n)&&et(e,n,t[n])}return e},nt=function(e,t,n){return et(e,"symbol"!=typeof t?t+"":t,n),n},ot=n(932976),at=(0,Fe.Z)((function(){return n.e(3512).then(n.bind(n,229171))})),st=(0,Fe.Z)((function(){return n.e(1217).then(n.bind(n,930884))})),it=(0,Fe.Z)((function(){return n.e(3471).then(n.bind(n,343559))})),rt=(0,Fe.Z)((function(){return n.e(4553).then(n.bind(n,405728))})),lt=(0,Fe.Z)((function(){return n.e(2087).then(n.bind(n,497828))})),ct=p()("isle:sketchpad"),dt=(0,le.Z)("sketchpad"),ut=["isExporting","showColorPicker","showUploadModal","showNavigationModal","showResetModal","showFeedbackModal","showSaveModal","hideInputButtons","hideNavigationButtons","hideSaveButtons","hideTransmitButtons"],ht=/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&//=]*))/g,pt=/([a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,})/gi,gt=window.devicePixelRatio||1;function mt(e){e.preventDefault()}function ft(e,t){for(var n=!1,o=0;o<t.length;o++){t[o].page===e&&(n=!0)}return n}function vt(e){e.setLineDash([2,15]),e.lineWidth=2,e.strokeStyle="orange",e.lineCap="round",e.lineJoin="round",e.shadowBlur=0}ot&&ot.GlobalWorkerOptions&&(ot.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js");var wt=function(e){ct("Rendering overlays...");for(var t=se()(e.nodes),n=[],o=e.toOriginalPage(e.currentPage),a=0;a<t.length;a++){var s=e.nodes[t[a]],r="invisible-page";t[a]===String(o+1)&&(r="sketch-node-container"),W()(s)&&s.component?s.style?(t[a]===String(o+1)&&(r="sketch-node-container-basic"),n.push(i.createElement("div",{key:a,style:s.style,className:r,onKeyDown:Ue.Z},s.component))):n.push(i.createElement("div",{key:a,className:r,onKeyDown:Ue.Z},s.component)):n.push(i.createElement("div",{key:a,className:r,onKeyDown:Ue.Z},s))}return i.createElement("div",{className:"sketchpad-overlays"},n)},yt=function(e){function t(t,n){var a;a=e.call(this,t)||this,nt((0,o.Z)(a),"handleHashChange",(function(){var e=a.readURL();e>0&&a.gotoPage(e)})),nt((0,o.Z)(a),"handleResize",(function(){a.setState({canvasHeight:window.innerHeight-a.state.verticalOffset,canvasWidth:window.innerWidth-40},(function(){a.debouncedRedraw()}))})),nt((0,o.Z)(a),"retrieveData",(function(e){if(ct("Retrieved data from previous session..."),W()(e)){if(F()(e.elements))for(var t=0;t<e.elements.length;t++)a.elements[t]=e.elements[t];if(F()(e.nUndos))for(var n=0;n<e.nUndos.length;n++)a.nUndos[n]=e.nUndos[n];if(F()(e.sharedElements)){for(var o=0;o<e.sharedElements.length;o++)a.sharedElements[o]=e.sharedElements[o];a.context.anonymous&&Le(a.elements,a.nUndos,a.state.insertedPages,e.state.insertedPages)}else a.sharedElements=new Array(e.elements.length).fill([]);for(var s=0;s<e.state.insertedPages.length;s++){var i=e.state.insertedPages[s].page;a.backgrounds.splice(i,0,null)}var r=Be.Z?0:a.readURL();ct("Go to page "+r),e.state.currentPage=r,e.state.noPages=a.backgrounds.length,e.state=oe()(e.state,ut),e.state.hasRetrievedData=!0,a.setState(e.state,(function(){a.debouncedRedraw()}))}else a.setState({hasRetrievedData:!0},(function(){a.debouncedRedraw()}))})),nt((0,o.Z)(a),"toggleGroupMode",(function(){a.setState({groupMode:!a.state.groupMode})})),nt((0,o.Z)(a),"hidePointer",(function(){var e={id:a.id,type:We.Ty,value:!0,noSave:!0};a.context.log(e,"members"),a.pointer.style.opacity=0})),nt((0,o.Z)(a),"hideZoom",(function(){var e={id:a.id,type:We.FK,value:!0,noSave:!0};a.context.log(e,"members"),a.zoom.style.display="none"})),nt((0,o.Z)(a),"preventDefaultTouch",(function(e){e.target!==a.canvas&&e.target!==a.textLayer&&e.target!==a.canvasWrapper||e.preventDefault()})),nt((0,o.Z)(a),"handleVisibilityChange",(function(){document.hidden||a.debouncedRedraw()})),nt((0,o.Z)(a),"renderBackground",(function(e){a.renderingTask&&a.renderingTask.cancel();var t=a.canvas,n=a.ctx,o=a.backgrounds[e];if(o){var s;ct("Found background for page "+e+"...");var i=o.getViewport({scale:1}),r=a.state.fill||(i.width>i.height?"vertical":"horizontal");s="vertical"===r?a.state.canvasHeight/i.height:a.state.canvasWidth/i.width;for(var l=o.getViewport({scale:s}),c=a.textLayer;c.firstChild;)c.removeChild(c.firstChild);"vertical"===r?(a.canvas.height=l.height*gt,a.canvas.width=l.width*gt,a.canvas.style.left=(a.state.canvasWidth-l.width)/2+"px",a.canvas.style["border-style"]="solid",a.canvas.style["border-color"]="black",a.canvas.style["border-width"]="0px 1px 0px 1px",a.canvas.style.width=l.width+"px",a.canvas.style.height=l.height+"px",c.style.width=l.width+"px",c.style.height=l.height+"px",a.leftMargin=(a.state.canvasWidth-l.width)/2,c.style.left=a.leftMargin+"px"):(a.canvas.height=l.height*gt,a.canvas.width=(l.width-15)*gt,a.canvas.style.left="0px",a.canvas.style.border="none",a.canvas.style.height=l.height+"px",a.canvas.style.width=l.width-15+"px",c.style.width=l.width-15+"px",c.style.height=l.height+"px",a.leftMargin=0,c.style.left="0px");var d=Q()(a.canvas.width*a.canvas.width+a.canvas.height*a.canvas.height);a.scaleRatio=d/(1768*gt),a.ctx.setTransform(gt,0,0,gt,0,0);var u={canvasContext:a.ctx,viewport:l};return o.getTextContent().then((function(e){ot.renderTextLayer({textContent:e,container:c,viewport:l,textDivs:[]}).promise.then((function(){var e=c.innerHTML,t=re()(e,ht,'<a href="$1">$1</a>');t=re()(t,pt,'<a href="mailto:$1">$1</a>'),c.innerHTML=t}))})),a.renderingTask=o.render(u),a.renderingTask.promise.then((function(){a.backgroundData=a.ctx.getImageData(0,0,a.canvas.width,a.canvas.height),ct("Background rendered for page "+e)})).catch((function(e){ct("Encountered error in `renderBackground`: "+e.message)}))}return a.backgroundData=null,n&&(a.props.pdf||n.setTransform(gt,0,0,gt,0,0),n.clearRect(0,0,t.width,t.height)),Promise.resolve()})),nt((0,o.Z)(a),"redraw",(function(){var e=a.state.currentPage;ct("Redrawing page "+(e+1));var t=a.nUndos[e];a.renderBackground(e).then((function(){var n=a.sharedElements[e];if(a.state.showInstructorAnnotations){ct("Rendering "+n.length+" shared elements on page "+e+"...");for(var o=0;o<n.length;o++)a.drawElement(n[o])}n=a.elements[e],ct("Rendering "+n.length+" own elements on page "+e+"...");for(var s=0;s<n.length-t;s++)a.drawElement(n[s]);a.renderingTask=null})).catch((function(e){a.renderingTask=null}))})),nt((0,o.Z)(a),"onlyRedrawElements",(function(){a.backgroundData?a.ctx.putImageData(a.backgroundData,0,0):a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height);var e=a.state.currentPage,t=a.sharedElements[e];if(a.state.showInstructorAnnotations){ct("Rendering "+t.length+" shared elements on page "+e+"...");for(var n=0;n<t.length;n++)a.drawElement(t[n])}t=a.elements[e],ct("Rendering "+t.length+" own elements on page "+e+"...");for(var o=a.nUndos[e],s=0;s<t.length-o;s++)a.drawElement(t[s])})),nt((0,o.Z)(a),"redrawWhenDragging",(function(){if(!a.canvasBuffer){a.canvasBuffer=document.createElement("canvas"),a.canvasBuffer.width=a.canvas.width,a.canvasBuffer.height=a.canvas.height,ct("Prepare data for non-dragged elements..."),a.backgroundData?a.ctx.putImageData(a.backgroundData,0,0):(a.ctx.fillStyle="white",a.ctx.fillRect(0,0,a.canvas.width,a.canvas.height));var e=a.state.currentPage,t=a.sharedElements[e];if(a.state.showInstructorAnnotations){ct("Rendering "+t.length+" shared elements on page "+e+"...");for(var n=0;n<t.length;n++)a.drawElement(t[n])}t=a.elements[e],ct("Rendering "+t.length+" own elements on page "+e+"...");for(var o=a.nUndos[e],s=0;s<t.length-o;s++)a.selectedElements&&B()(a.selectedElements,t[s])||a.drawElement(t[s]);var i=a.canvasBuffer.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(a.canvas,0,0,a.canvas.width/gt,a.canvas.height/gt)}a.ctx.drawImage(a.canvasBuffer,0,0);var r=a.selectedElements;if(r)for(var l=0;l<r.length;l++)a.drawElement(r[l]);var c=a.ctx;if(c.beginPath(),vt(c),a.dragPoints)for(var d=0;d<a.dragPoints.length;d+=2){var u=a.dragPoints[d],h=a.dragPoints[d+1];a.ctx.lineTo(u,h)}c.stroke(),c.closePath(),c.setLineDash([])})),nt((0,o.Z)(a),"drawPage",(function(e){var t=a.ctx,n=a.canvas;t&&t.clearRect(0,0,n.width,n.height),a.renderBackground(e);var o=a.sharedElements[e];if(a.state.showInstructorAnnotations)for(var s=0;s<o.length;s++)a.drawElement(o[s]);o=a.elements[e];for(var i=a.nUndos[e],r=0;r<o.length-i;r++)a.drawElement(o[r])})),nt((0,o.Z)(a),"mousePosition",(function(e){var t=e.clientX,n=e.clientY;e.touches&&e.touches.length>0&&(t=e.touches[0].clientX,n=e.touches[0].clientY);var o=a.canvas.getBoundingClientRect();return{x:t-o.left,y:n-o.top}})),nt((0,o.Z)(a),"clearPage",(function(e){if(ft(e,a.state.insertedPages)){ct("Clear an inserted page; deleting it completely..."),a.elements.splice(e,1),a.backgrounds.splice(e,1),a.nUndos.splice(e,1),a.sharedElements.splice(e,1);for(var t=[],n=0;n<a.state.insertedPages.length;n++){var o=a.state.insertedPages[n];e!==o.page&&(o.page>e&&(o.page-=1),t.push(o))}ct("New inserted pages are: "+t.join(", ")),a.setState({noPages:a.state.noPages-1,insertedPages:t,selectedPage:a.state.selectedPage-1},(function(){a.debouncedRedraw()}))}else a.elements[e]=[],a.debouncedRedraw()})),nt((0,o.Z)(a),"clear",(function(){var e=a.state.currentPage;a.clearPage(e);var t=a.context,n={id:a.id,type:We.wi,value:JSON.stringify({page:e,sessionID:t.sessionID})};a.hasChangedSinceLastSave=!0,t.isOwner()&&a.state.transmitOwner?t.log(n,"members"):t.log(n,"owners")})),nt((0,o.Z)(a),"clearAll",(function(e){void 0===e&&(e=!1);var t=a.context,n=a.canvas,o=a.ctx;if(o&&o.clearRect(0,0,n.width,n.height),t.store.removeItem(a.id+"_sketchpad"),a.props.pdf)a.initializePDF().then((function(){a.debouncedRedraw(),a.setState({insertedPages:[]})}));else{var s=a.props.noPages;a.elements=new Array(s),a.backgrounds=new Array(s),a.sharedElements=new Array(s),a.nUndos=new Array(s);for(var i=0;i<s;i++)a.elements[i]=[],a.sharedElements[i]=[],a.backgrounds[i]=null,a.nUndos[i]=0;a.setState({currentPage:0,noPages:s,insertedPages:[]})}var r={id:a.id,type:We.Wp,value:t.sessionID};e||(a.hasChangedSinceLastSave=!0,t.isOwner()&&a.state.transmitOwner?t.log(r,"members"):t.log(r,"owners"))})),nt((0,o.Z)(a),"undo",(function(){var e=a.state.currentPage,t=a.elements[e],n=a.sharedElements[e],o=a.nUndos[e],s=a.ctx,i=a.canvas;s&&s.clearRect(0,0,i.width,i.height),a.renderBackground(e).then((function(){o+=1;for(var s=-1,i=t.length-1,r=i;r>=0;r--){if((s+=1)===o){i=r;break}0===r&&(o=s+1,i=null)}if(ct("Current number of undos: "+o),a.nUndos[e]=o,a.hasChangedSinceLastSave=!0,!j()(i)){ct("UNDO: Redrawing elements 0 to "+i+" out of "+t.length+" elements");for(var l=0;l<=i;l++)a.drawElement(t[l])}for(var c=0;c<n.length;c++)a.drawElement(n[c])}))})),nt((0,o.Z)(a),"redo",(function(){var e=a.state.currentPage,t=a.elements[e],n=a.sharedElements[e],o=a.nUndos[e];if(o>0){var s=$()(t.length-o,0);if(ct("Line index: "+s),s>=0){var i=-1,r=t.length-1;o-=1;for(var l=r;l>=0;l--)if((i+=1)===o){r=l;break}ct("REDO: Redrawing elements "+s+" to "+r+" out of "+t.length+" elements");for(var c=s;c<=r;c++)a.drawElement(t[c]);a.nUndos[e]=o;for(var d=0;d<n.length;d++)a.drawElement(n[d]);a.hasChangedSinceLastSave=!0}}})),nt((0,o.Z)(a),"drawElement",(function(e){e&&("line"===e.type?a.drawLine(e):"text"===e.type?a.drawText(e):"curve"===e.type&&a.drawCurve(e))})),nt((0,o.Z)(a),"drawLine",(function(e){var t=e.startX,n=e.startY,o=e.endX,s=e.endY,i=e.color,r=e.lineWidth,l=e.selected,c=a.ctx;c&&(c.lineWidth=r*a.scaleRatio,c.lineCap="round",c.lineJoin="round",c.shadowBlur=1.5*c.lineWidth,c.strokeStyle=l?"orange":i,c.beginPath(),c.moveTo(t,n),c.lineTo(o,s),c.stroke(),c.closePath())})),nt((0,o.Z)(a),"drawCurve",(function(e){var t=e.points,n=e.color,o=e.lineWidth,s=e.selected,i=a.ctx;i&&(i.lineWidth=o*a.scaleRatio,i.lineCap="round",i.lineJoin="round",s?(i.strokeStyle="orange",i.beginPath(),Se(i,t,a.canvas.width/gt,a.canvas.height/gt,.9,1),i.stroke(),i.closePath()):(i.shadowColor="rgba(128, 128, 128, 0.2)",i.shadowBlur=2*i.lineWidth,i.strokeStyle=n,i.beginPath(),Se(i,t,a.canvas.width/gt,a.canvas.height/gt),i.stroke(),i.closePath()))})),nt((0,o.Z)(a),"drawStart",(function(e){if(e.stopPropagation(),ct("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1)return a.swipeStartX=e.touches[0].screenX,void(a.swipeStartY=e.touches[0].screenY);var t=a.mousePosition(e),n=t.x,o=t.y;if(a.currentPoints=[],a.x=n,a.y=o,a.isMouseDown=!0,a.imageData=a.ctx.getImageData(0,0,a.canvas.width,a.canvas.height),"drawing"===a.state.mode){var s=a.state.currentPage,i=a.nUndos[s];if(i>0){var r=a.elements[s];r.splice(r.length-i),ct("Page "+s+" now has "+r.length+" elements"),a.nUndos[s]=0,a.hasChangedSinceLastSave=!0}a.draw(e)}else if("drag"===a.state.mode){var l=a.ctx;l.isPointInPath(n*gt,o*gt)||(a.deselectElements(),a.onlyRedrawElements()),l.beginPath(),a.draw(e)}else Z()&&a.handleClick(e)})),nt((0,o.Z)(a),"drawEnd",(function(e){if(e.stopPropagation(),J()(a.swipeEndX-a.swipeStartX)>45&&J()(a.swipeEndY-a.swipeStartY)<40)return a.swipeEndX>a.swipeStartX?a.previousPage():a.nextPage(),a.swipeEndX=0,a.swipeEndY=0,a.swipeStartX=0,a.swipeStartY=0,void(a.isMouseDown=!1);if("drawing"===a.state.mode&&a.isMouseDown){var t=a.elements[a.state.currentPage],n=a.context,o=n.user.email||n.anonymousIdentifier,s=a.currentPoints,i=a.canvas,r=i.width,l=i.height;s[0]/=r/gt,s[1]/=l/gt;for(var c=2;c<s.length-2;c+=2){var d=(s[c]+s[c+2])/2,u=(s[c+1]+s[c+3])/2;s[c]=d/(r/gt),s[c+1]=u/(l/gt)}s[s.length-2]/=r/gt,s[s.length-1]/=l/gt;var h={points:s,color:a.state.color,lineWidth:a.state.brushSize*(1+a.force)*.5,page:a.state.currentPage,time:a.time,type:"curve",drawID:ye(6),user:o};t.push(h),a.props.onChange(t),a.ctx.putImageData(a.imageData,0,0),a.drawCurve(h);var p={id:a.id,type:We.D$,value:JSON.stringify(h),noSave:!0};a.hasChangedSinceLastSave=!0,a.state.groupMode||n.isOwner()&&a.state.transmitOwner?n.log(p,"members"):n.log(p,"owners"),a.currentPoints=[]}else if("drag"===a.state.mode&&a.isMouseDown){if(a.ctx.stroke(),a.ctx.closePath(),a.ctx.setLineDash([]),!a.selectedElements){ct("Select elements...");var g=a.elements[a.state.currentPage],m=a.nUndos[a.state.currentPage];a.selectedElements=null;for(var f=[],v=0;v<g.length-m;v++){var w=g[v];w.selected=!1;var y=w.points;if(y)for(var b=0,E=y.length;b<E;b+=2){var P=y[b]*a.canvas.width,S=y[b+1]*a.canvas.height;if(a.ctx.isPointInPath(P,S)){w.selected=!0,f.push(w);break}}else w.x&&w.y&&a.ctx.isPointInPath(w.x*a.canvas.width,w.y*a.canvas.height)&&(w.selected=!0,f.push(w))}f.length>0&&(a.selectedElements=f,a.dragPoints=a.currentPoints)}a.redrawWhenDragging()}a.isMouseDown=!1})),nt((0,o.Z)(a),"draw",(function(e){if(e.stopPropagation(),a.state.swiping&&e.touches&&e.touches.length>1){a.swipeEndX=e.touches[0].screenX,a.swipeEndY=e.touches[0].screenY,a.isMouseDown=!1;var t=a.swipeEndY-a.swipeStartY;a.verticalScroll(t)}else{var n=a.context,o=a.mousePosition(e),s=o.x,i=o.y;if("drag"===a.state.mode&&a.selectedElements&&a.isMouseDown){ct("Drag elements around...");for(var r=(s-a.x)/(a.canvas.width/gt),l=(i-a.y)/(a.canvas.height/gt),c=a.selectedElements,d=0;d<c.length;d++){var u=c[d];if("curve"===u.type)for(var h=u.points,p=0;p<h.length;p++)h[p]+=p%2==0?r:l;else"text"===u.type&&(u.x+=r,u.y+=l)}for(var g=0;g<a.dragPoints.length;g+=2)a.dragPoints[g]+=s-a.x,a.dragPoints[g+1]+=i-a.y;var m=n.user.email||n.anonymousIdentifier,f={id:a.id,type:We.bW,value:JSON.stringify({dx:r,dy:l,page:a.state.currentPage,drawIDs:c.map((function(e){return e.drawID})),user:m,sessionID:n.sessionID}),noSave:!0};return a.hasChangedSinceLastSave=!0,n.isOwner()||a.state.groupMode?n.log(f,"members"):n.log(f),a.x=s,a.y=i,a.redrawWhenDragging()}if(a.isMouseDown&&!a.props.disabled){if("delete"===a.state.mode)return ct("Check whether to delete element..."),a.checkDeletion(e);if(a.currentPoints.push(s),a.currentPoints.push(i),"drawing"===a.state.mode){var v={color:a.state.color,lineWidth:a.state.brushSize*(1+a.force)*.5,startX:a.x,startY:a.y,endX:s,endY:i,shadow:0,type:"line"};a.drawElement(v)}else"drag"!==a.state.mode||a.selectedElements||(vt(a.ctx),a.ctx.lineTo(s,i),a.ctx.stroke());a.x=s,a.y=i}}})),nt((0,o.Z)(a),"toggleTransmit",(function(){a.setState({transmitOwner:!a.state.transmitOwner})})),nt((0,o.Z)(a),"uploadSketches",(function(){a.setState({isExporting:!0},(function(){a.preparePDF((function(e,t){var n=a.context;t.getBase64((function(e){ct("Processing base64 string of PDF document");var t=new FormData,o=a.id+".pdf",s=(0,de.Z)(e,"application/pdf"),r=new File([s],o,{type:"application/pdf"});t.append("file",r);n.uploadFile({formData:t,callback:function(e,t){if(e)a.setState({isExporting:!1,showUploadModal:!0,modalMessage:e.message});else{var o=t.filename,s=n.server+"/"+o;a.setState({isExporting:!1,showUploadModal:!0,modalMessage:i.createElement("span",null,a.props.t("upload-successful"),": ",i.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},s))});var r={text:a.props.t("upload-email",{name:n.user.name})+'<a href="'+s+'">'+s+"</a>.",subject:a.props.t("pdf-uploaded")};n.sendMail(r,n.user.email)}}})}))}))}))})),nt((0,o.Z)(a),"saveAsPNG",(function(){var e=a.state.currentPage,t=a.id+"_"+(e+1)+".png",n=a.canvas;a.backgrounds[e]||(a.ctx.fillStyle="white",a.ctx.fillRect(0,0,n.width,n.height)),n.toBlob((function(e){(0,ce.Z)(e,t)}))})),nt((0,o.Z)(a),"preparePDF",(function(e){void 0===e&&(e=te()),ct("Assembling PDF document object...");var t={content:[],pageSize:{width:a.canvas.width,height:a.canvas.height},pageMargins:[0,0,0,0]},n=0;!function o(){ct("Creating page "+(n+1)),a.renderBackground(n).then((function(){var s=a.sharedElements[n];if(s&&s.length>0)for(var i=0;i<s.length;i++)a.drawElement(s[i]);s=a.elements[n];var r=a.nUndos[n];if(s&&s.length>0){var l=s.length-r;ct("Rendering "+s.length+" elements on page "+n+"...");for(var c=0;c<l;c++)a.drawElement(s[c])}var d=a.canvas.toDataURL();if(t.content.push({image:d,width:a.canvas.width}),!((n+=1)<a.state.noPages))return ct("Creating PDF..."),e(null,u().createPdf(t));o()}))}()})),nt((0,o.Z)(a),"toggleSaveModal",(function(){a.setState({showSaveModal:!a.state.showSaveModal})})),nt((0,o.Z)(a),"saveAsPDF",(function(){a.setState({isExporting:!0},(function(){a.preparePDF((function(e,t){var n=a.id;t.download(n+".pdf",(function(){a.setState({isExporting:!1}),a.debouncedRedraw()}))}))}))})),nt((0,o.Z)(a),"insertPage",(function(e,t){"text"===a.state.mode&&a.insertTextFromInput(),a.elements.splice(e,0,[]),a.backgrounds.splice(e,0,null),a.sharedElements.splice(e,0,0),a.nUndos.splice(e,0,0);for(var n=document.querySelector(".textLayer");n.firstChild;)n.removeChild(n.firstChild);var o=a.context,s=a.state.insertedPages;s.push({page:e,email:t||o.user.email}),a.setState({noPages:a.state.noPages+1,currentPage:e,insertedPages:s},(function(){a.updateURL(a.state.currentPage),a.debouncedRedraw(),t||(a.hasChangedSinceLastSave=!0,o.log({id:a.id,type:We.bM,value:JSON.stringify({pos:e})},o.isOwner()?"members":o.user.email))}))})),nt((0,o.Z)(a),"insertTextFromInput",(function(){var e=parseInt(a.textInput.style.left,10)-a.leftMargin,t=parseInt(a.textInput.style.top,10)-1.2*a.state.fontSize,n=a.textInput.value;a.textInput.value="",a.textInput.style.top=String(parseInt(a.textInput.style.top,10)+1.2*a.state.fontSize)+"px";var o=a.context,s=o.user.email||o.anonymousIdentifier,i=a.state.currentPage,r={value:n,x:e/(a.canvas.width/gt),y:t/(a.canvas.height/gt),color:a.state.color,fontSize:a.state.fontSize,fontFamily:a.state.fontFamily,time:a.time,type:"text",page:i,user:s,drawID:ye(6)};a.drawText(r);var l=a.elements[i],c=a.nUndos[i];c>0&&(l.splice(l.length-c),ct("Page "+i+" now has "+l.length+" elements"),a.nUndos[i]=0),r.shouldLog=!1,l.push(r),a.props.onChange(l)})),nt((0,o.Z)(a),"handleEnter",(function(e){ct("Check if user hit ENTER..."),13===e.keyCode&&a.insertTextFromInput()})),nt((0,o.Z)(a),"drawText",(function(e){var t=e.x,n=e.y,o=e.value,s=e.color,i=e.drawID,r=e.user,l=e.fontSize,c=e.fontFamily,d=e.selected,u=e.shouldLog,h=void 0===u||u,p=a.ctx;p.font=l+"px "+c,p.shadowBlur=0,p.fillStyle=d?"orange":s;var g=X()(t*(a.canvas.width/gt)),m=X()(n*(a.canvas.height/gt))+l;ct("Draw text at x: "+g+" and y: "+m),p.fillText(o,g,m);var f=a.context;if(h){var v={id:a.id,type:We.nO,value:JSON.stringify({x:t,y:n,value:o,color:s,fontSize:l,fontFamily:c,page:a.state.currentPage,drawID:i,user:r,type:"text"})};a.hasChangedSinceLastSave=!0,f.isOwner()||a.state.groupMode?f.log(v,"members"):f.log(v)}})),nt((0,o.Z)(a),"handleClick",(function(e){if(ct("Handle click event..."),"text"===a.state.mode){var t=a.mousePosition(e),n=t.x,o=t.y,s=a.textInput;s.style.left=String(n+a.leftMargin)+"px",s.style.width=String(window.innerWidth-(n+a.leftMargin))+"px",s.style.top=o+"px";var i=q()(a.state.canvasWidth-n,60);ct("Resize to width "+i+"..."),s.style.width=i+"px",s.focus()}else"deletion"===a.state.mode&&(ct("Checking whether a shape has been selected..."),a.checkDeletion(e))})),nt((0,o.Z)(a),"checkDeletion",(function(e){for(var t=a.mousePosition(e),n=t.x,o=t.y,s=a.elements[a.state.currentPage],i=a.nUndos[a.state.currentPage],r=null,l=0;l<s.length-i;l++){var c=s[l];if("curve"===c.type){var d=c.points;if(a.ctx.beginPath(),a.ctx.lineCap="round",a.ctx.lineWidth=q()(c.lineWidth,16),Se(a.ctx,d,a.canvas.width/gt,a.canvas.height/gt,.9,1),a.ctx.closePath(),a.ctx.isPointInStroke(n*gt,o*gt)){ct("Point ("+n+", "+o+") is in path of element with ID "+c.drawID),r=l;break}}else if("text"===c.type){var u=a.ctx.measureText(c.value).width,h=X()(c.x*(a.canvas.width/gt)),p=X()(c.y*(a.canvas.height/gt));if(h<=n&&n<=h+u&&p<=o&&o<=p+c.fontSize){r=l;break}}}if(!j()(r)){var g=s[r].drawID;a.deleteElement(g,r);var m=a.context,f=m.user.email||m.anonymousIdentifier,v={id:a.id,type:We.jd,value:JSON.stringify({drawID:g,page:a.state.currentPage,user:f,sessionID:m.sessionID})};a.hasChangedSinceLastSave=!0,m.isOwner()&&a.state.transmitOwner||a.state.groupMode?m.log(v,"members"):m.log(v,"owners")}})),nt((0,o.Z)(a),"deleteElement",(function(e,t){for(var n,o,s=a.elements[a.state.currentPage],i="delete"===a.state.mode,r=a.nUndos[a.state.currentPage],l=t;l<s.length-r&&s[l].drawID===e;l++)o=l,s[l].selected=!i;for(var c=t;c>=0&&s[c].drawID===e;c--)n=c,s[c].selected=!i;if(i){ct("Delete elements "+n+" to "+o);var d=s.splice(n,o-n+1);s.splice.apply(s,[s.length-r,0].concat(d)),a.nUndos[a.state.currentPage]=r+d.length,a.onlyRedrawElements()}})),nt((0,o.Z)(a),"firstPage",(function(){0!==a.state.currentPage&&(a.canvasWrapper.scrollTop=0,a.selectedElements&&a.deselectElements(),a.setState({currentPage:0},(function(){a.updateURL(a.state.currentPage),a.debouncedRedraw(),a.context.log({id:a.id,type:We.QS,value:a.state.currentPage})})))})),nt((0,o.Z)(a),"lastPage",(function(){a.state.currentPage!==a.state.noPages-1&&(a.canvasWrapper.scrollTop=0,a.selectedElements&&a.deselectElements(),a.setState({currentPage:a.state.noPages-1},(function(){a.updateURL(a.state.currentPage),a.debouncedRedraw(),a.context.log({id:a.id,type:We.$M,value:a.state.currentPage})})))})),nt((0,o.Z)(a),"readURL",(function(){var e=window.location.hash,t=encodeURI(a.id),n=new RegExp(t+"=(\\d+)"),o=e.match(n);return o?q()(Number(o[1])-1,0):0})),nt((0,o.Z)(a),"updateURL",(function(e){var t=String(window.location.hash);if(!Be.Z){var n=encodeURI(a.id);if(t)if(t.includes(n)){var o=new RegExp("("+n+")=\\d+");window.location.hash=re()(t,o,"$1="+(e+1))}else window.location.hash+="&"+n+"="+(e+1);else window.location.hash="#/?"+n+"="+(e+1)}})),nt((0,o.Z)(a),"nextPage",(function(){if(a.state.currentPage<a.state.noPages-1){ct("Should go to next page..."),a.canvasWrapper.scrollTop=0;var e=a.state.currentPage+1;a.selectedElements&&a.deselectElements(),a.props.nodes[a.state.currentPage]&&(0,He.Z)(a.canvasWrapper),"text"===a.state.mode&&a.insertTextFromInput(),a.setState({currentPage:e},(function(){a.updateURL(a.state.currentPage),a.debouncedRedraw(),a.context.log({id:a.id,type:We.tn,value:a.state.currentPage})}))}})),nt((0,o.Z)(a),"previousPage",(function(){if(a.state.currentPage>0){a.canvasWrapper.scrollTop=0;var e=a.state.currentPage-1;a.selectedElements&&a.deselectElements(),a.props.nodes[a.state.currentPage]&&(0,He.Z)(a.canvasWrapper),"text"===a.state.mode&&a.insertTextFromInput(),a.setState({currentPage:e},(function(){a.updateURL(a.state.currentPage),a.debouncedRedraw(),a.context.log({id:a.id,type:We.YF,value:a.state.currentPage})}))}})),nt((0,o.Z)(a),"gotoPage",(function(e,t){void 0===t&&(t=!0),ct("Should go to page "+e+"..."),(e=parseInt(e,10))!==a.state.currentPage?(a.canvasWrapper&&(a.canvasWrapper.scrollTop=0),a.selectedElements&&a.deselectElements(),a.props.nodes[a.state.currentPage]&&(0,He.Z)(a.canvasWrapper),"text"===a.state.mode&&a.insertTextFromInput(),a.setState({currentPage:e,showNavigationModal:!1},(function(){(a.updateURL(a.state.currentPage),a.debouncedRedraw(),t)&&a.context.log({id:a.id,type:We.Db,value:e})}))):a.setState({showNavigationModal:!1})})),nt((0,o.Z)(a),"loadPDF",(function(){var e=document.createElement("input");e.type="file",e.accept=".pdf",e.addEventListener("change",a.handlePDFUpload,!1),e.click()})),nt((0,o.Z)(a),"handlePDFUpload",(function(e){var t=a.context,n=e.target.files,o=new FormData;o.append("file",n[0]),t.uploadFile({formData:o,callback:function(e,n){var o=n.filename,s=t.server+"/"+o;t.updateMetadata("store",a.id,s),a.initializePDF()}})})),nt((0,o.Z)(a),"initializePDF",(function(){ct("Initialize PDF document at "+a.props.pdf+"...");var e=a.context;return new Promise((function(t,n){var o=e.metadata.store[a.id];ot.getDocument({url:a.props.pdf||o,disableFontFace:!1}).promise.then((function(e){ct("Retrieved PDF document... "),a.processPDF(e,(function(e){e?(ct("Encountered error in 'processPDF': "+e.message),n(e)):t()}))})).catch((function(e){ct("Encountered an error in 'initializePDF': "+e.message)}))}))})),nt((0,o.Z)(a),"processPDF",(function(e,t){void 0===t&&(t=te()),ct("PDF loaded...");for(var n=e.numPages,o=new Array(n),s=new Array(n),i=new Array(n),r=new Array(n),l=0;l<n;l++)o[l]=[],s[l]=e.getPage(l+1),i[l]=[],r[l]=0;return Promise.all(s).then((function(e){ct("Retrieved all pages..."),a.backgrounds=e,a.elements=o,a.sharedElements=i,a.nUndos=r,a.setState({currentPage:Be.Z?0:a.readURL(),noPages:n},(function(){a.state.hasRetrievedData&&a.drawPage(a.state.currentPage)})),t(null)})).catch((function(e){ct(e),t(e)}))})),nt((0,o.Z)(a),"save",(function(){if(!a.hasChangedSinceLastSave)return new Promise((function(e){e()}));var e=a.context,t=oe()(a.state,ut),n={elements:a.elements,nUndos:a.nUndos,state:t};return a.hasChangedSinceLastSave=!1,e.anonymous?(ct("Save created elements to local storage..."),e.store.setItem(a.id,n)):(ct("Saving data on server..."),e.saveSketchpadData(a.id,n))})),nt((0,o.Z)(a),"closeResponseModal",(function(){a.setState({showUploadModal:!1,modalMessage:null})})),nt((0,o.Z)(a),"toggleNavigationModal",(function(){a.setState({showNavigationModal:!a.state.showNavigationModal})})),nt((0,o.Z)(a),"toggleDeletePageModal",(function(){a.setState({showDeletePageModal:!a.state.showDeletePageModal})})),nt((0,o.Z)(a),"toggleResetModal",(function(){a.setState({showResetModal:!a.state.showResetModal})})),nt((0,o.Z)(a),"toggleTutorial",(function(){a.setState({showTutorial:!a.state.showTutorial})})),nt((0,o.Z)(a),"toggleSwiping",(function(){a.setState({swiping:!a.state.swiping})})),nt((0,o.Z)(a),"movePointerStart",(function(e){e.stopPropagation(),ct("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1&&(a.swipeStartX=e.touches[0].screenX,a.swipeStartY=e.touches[0].screenY)})),nt((0,o.Z)(a),"movePointerEnd",(function(e){e.stopPropagation(),J()(a.swipeEndX-a.swipeStartX)>45&&J()(a.swipeEndY-a.swipeStartY)<40&&(a.swipeEndX>a.swipeStartX?a.previousPage():a.nextPage(),a.swipeEndX=0,a.swipeEndY=0,a.swipeStartX=0,a.swipeStartY=0),a.hideZoom(),a.hidePointer()})),nt((0,o.Z)(a),"movePointer",(function(e){if(e.stopPropagation(),a.state.swiping&&e.touches&&e.touches.length>1){a.swipeEndX=e.touches[0].screenX,a.swipeEndY=e.touches[0].screenY,a.isMouseDown=!1;var t=a.swipeEndY-a.swipeStartY;a.verticalScroll(t)}else{var n=a.context,o=a.mousePosition(e),s=o.x,i=o.y;if("pointer"===a.state.mode)a.pointer.style.opacity=.7,a.pointer.style.left=s+a.leftMargin+"px",a.pointer.style.top=i+"px";else if("zoom"===a.state.mode){var r=a.zoom,l=r.width,c=r.height,d=l/(2*gt),u=c/(2*gt);a.zoomCtx.clearRect(0,0,l,c);var h=l/gt,p=c/gt,g=s*gt-d/2,m=i*gt-u/2,f=0,v=0;g<0&&(f-=g,h+=h/d*(g=0),d+=g),m<0&&(v-=m,p+=p/u*(m=0),u+=m),a.zoomCtx.drawImage(a.canvas,g,m,d,u,f,v,h,p),a.zoom.style.display="block",a.zoom.style.left=s-d+a.leftMargin+"px",a.zoom.style.top=i-u+"px"}var w={id:a.id,type:"pointer"===a.state.mode?We.$h:We.fT,value:JSON.stringify({x:s/(a.canvas.width/gt),y:i/(a.canvas.height/gt),sessionID:n.sessionID}),noSave:!0};n.log(w,"members")}})),nt((0,o.Z)(a),"toLocalPage",(function(e,t){for(var n=a.state.insertedPages,o=e,s=0;s<n.length;s++){var i=n[s],r=i.page,l=i.email;r<e&&l!==t&&(o+=1)}return o})),nt((0,o.Z)(a),"toOriginalPage",(function(e){for(var t=a.state.insertedPages,n=e,o=0;o<t.length;o++){var s=t[o].page;if(s===e)return null;s<e&&(n-=1)}return ct("Page with index "+e+" corresponds to original page number "+n+"..."),n})),a.force=1,a.scaleRatio=1,a.elements=new Array(t.noPages),a.backgrounds=new Array(t.noPages),a.sharedElements=new Array(t.noPages),a.nUndos=new Array(t.noPages);for(var s=0;s<t.noPages;s++)a.elements[s]=[],a.backgrounds[s]=null,a.sharedElements[s]=[],a.nUndos[s]=0;a.hasChangedSinceLastSave=!1,a.canvas=null,a.ctx=null,a.id=t.id||dt(t);var r=Be.Z?0:a.readURL();return a.state={color:t.color,brushSize:t.brushSize,currentPage:r,fill:t.fill,fontFamily:t.fontFamily,fontSize:t.fontSize,groupMode:t.groupMode,hideInputButtons:t.hideInputButtons||n.presentationMode,hideNavigationButtons:t.hideNavigationButtons||n.presentationMode,hideSaveButtons:t.hideSaveButtons||n.presentationMode,hideTransmitButtons:t.hideTransmitButtons||n.presentationMode,isExporting:!1,modalMessage:null,noPages:t.noPages,insertedPages:[],showUploadModal:!1,mode:"none",showNavigationModal:!1,transmitOwner:t.transmitOwner,showInstructorAnnotations:!0,receiveFrom:{},showDeletePageModal:!1,showResetModal:!1,showTutorial:t.showTutorial,showFeedbackModal:!1,showSaveModal:!1,swiping:!0,verticalOffset:60,hasRetrievedData:!1},a.isMouseDown=!1,a.leftMargin=0,a.debouncedRedraw=v()(a.redraw,100),a}(0,a.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return e.fullscreen?{canvasHeight:window.innerHeight-t.verticalOffset,canvasWidth:window.innerWidth-40}:t.canvasHeight!==e.canvasHeight||t.canvasWidth!==e.canvasWidth?{canvasHeight:e.canvasHeight,canvasWidth:e.canvasWidth}:null};var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.context;this.zoomCtx&&this.zoomCtx.setTransform(gt,0,0,gt,0,0),this.ctx&&this.ctx.setTransform(gt,0,0,gt,0,0),this.props.fullscreen&&window.addEventListener("resize",this.handleResize),window.addEventListener("unload",this.save),(this.props.pdf||t.metadata.store[this.id]?this.initializePDF():Promise.resolve()).then((function(){(t.anonymous?t.getSketchpadVisitorData(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){ct(e)}))})),m().set(".sketch-canvas",{change:function(t){e.force=t}}),t&&(this.unsubscribe=t.subscribe((function(n,o){n!==Ae.Fw&&n!==Ae.E7||(t.anonymous?t.store.getItem(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){ct(e)}));if(n===Ae.KI&&e.initializePDF(),n===We.x$){ct("Hide control buttons in presentation mode...");var a={hideInputButtons:t.presentationMode,hideNavigationButtons:t.presentationMode,hideSaveButtons:t.presentationMode,hideTransmitButtons:t.presentationMode};e.props.fullscreen&&(a.verticalOffset=t.presentationMode?30:60,a.canvasHeight=window.innerHeight-a.verticalOffset,a.canvasWidth=window.innerWidth-40),e.setState(a,(function(){e.debouncedRedraw()}))}else if(n===Ae.Wh){if(o.id!==e.id)return;var s=o.type;if(ct("Received member action of type: "+s),o.email===t.user.email)if(s===We.$h){var i=JSON.parse(o.value),r=i.x,l=i.y;i.sessionID!==t.sessionID&&(r*=e.canvas.width/gt,l*=e.canvas.height/gt,r=r+e.leftMargin+"px",l+="px",e.pointer.style.left=r,e.pointer.style.top=l,e.pointer.style.opacity=.7)}else if(s===We.Ty)e.pointer.style.opacity=0;else if(s===We.fT){var c=JSON.parse(o.value),d=c.x,u=c.y;if(c.sessionID!==t.sessionID){d*=e.canvas.width/gt,u*=e.canvas.height/gt;var h=e.zoom,p=h.width,g=h.height,m=p/(2*gt),f=g/(2*gt);e.zoomCtx.clearRect(0,0,p,g);var v=p/gt,w=g/gt,y=d*gt-m/2,b=u*gt-f/2,E=0,P=0;y<0&&(E-=y,v+=v/m*(y=0),m+=y),b<0&&(P-=b,w+=w/f*(b=0),f+=b),e.zoomCtx.drawImage(e.canvas,y,b,m,f,E,P,v,w);var S=d-m+e.leftMargin+"px",x=u-f+"px";e.zoom.style.top=x,e.zoom.style.left=S,e.zoom.style.display="block"}}else if(s===We.FK)e.zoom.style.display="none";else if(s===We.Qr){var M=JSON.parse(o.value),k=M.diffY;M.sessionID!==t.sessionID&&(k*=e.canvas.height,e.canvasWrapper.scrollTop-=.1*k)}if(t.isOwner()){if(e.state.receiveFrom.name!==o.name&&!o.owner&&!e.state.groupMode)return;o.email===t.user.email&&(s!==We.tn&&s!==We.YF&&s!==We.Db&&s!==We.QS&&s!==We.$M||(ct("Go to page "+o.value+"..."),e.gotoPage(o.value,!1)))}if(s===We.nO||s===We.D$){var C=JSON.parse(o.value),D=e.elements[C.page],Z=e.sharedElements[C.page],I=!1;if(C.user===t.user.email||C.user===t.anonymousIdentifier)for(var O=0;O<D.length;O++)if(D[O].drawID===C.drawID){I=!0;break}I||(C.shouldLog=!1,C.page===e.state.currentPage&&e.state.showInstructorAnnotations&&("text"===C.type?e.drawText(C):e.drawCurve(C)),C.user===t.user.email?D.push(C):Z.push(C),e.props.onChange(D))}else if(s===We.bM){var T=JSON.parse(o.value).pos;o.email!==t.user.email&&(T=e.toLocalPage(T,o.email)),ft(T,e.state.insertedPages)||(ct("Should insert page at "+T+"..."),e.insertPage(T,o.email))}else if(s===We.jd){var R=JSON.parse(o.value),z=R.drawID,L=R.page,F=R.user,H=R.sessionID;if(ct("Should delete element with id "+z+" by user "+F),H!==t.sessionID){for(var U,W=o.email===t.user.email?e.elements[L]:e.sharedElements[L],A=0;A<W.length;A++)if(W[A].drawID===z&&W[A].user===F){U=A;break}(0,N.isPrimitive)(U)&&(W.splice(U,1),e.debouncedRedraw())}}else if(s===We.bW){var j=JSON.parse(o.value),Y=j.drawIDs,X=j.user,K=j.page,J=j.dx,V=j.dy,q=j.sessionID;if(ct("Should drag specified elements by dx: "+J+" and dy: "+V+"..."),q!==t.sessionID){for(var G=o.email===t.user.email?e.elements[K]:e.sharedElements[K],$=0;$<G.length;$++){var _=G[$];if(B()(Y,_.drawID)&&_.user===X)if("curve"===_.type)for(var Q=_.points,ee=0;ee<Q.length;ee++)Q[ee]+=ee%2==0?J:V;else"text"===_.type&&(_.x+=J,_.y+=V)}e.debouncedRedraw()}}else if(s===We.wi){var te=JSON.parse(o.value),ne=te.page,oe=te.sessionID,ae=o.email;if(oe!==t.sessionID)if(ae===t.user.email)e.clearPage(ne);else{for(var se=e.sharedElements[ne],ie=[],re=0;re<se.length;re++){var le=se[re];le.user!==ae&&ie.push(le)}e.sharedElements[ne]=ie,e.debouncedRedraw()}}else if(s===We.Wp&&o.value!==t.sessionID)if(o.email===t.user.email)e.clearAll(!0);else{for(var ce=o.email,de=0;de<e.state.noPages;de++){for(var ue=e.sharedElements[de],he=[],pe=0;pe<ue.length;pe++){var ge=ue[pe];ge.user!==ce&&he.push(ge)}e.sharedElements[de]=he}e.debouncedRedraw()}}}))),this.props.autoSave&&(this.saveInterval=setInterval(this.save,this.props.intervalTime));var n={passive:!1,capture:!0};document.addEventListener("touchstart",this.preventDefaultTouch,n),document.addEventListener("touchend",this.preventDefaultTouch,n),document.addEventListener("touchmove",this.preventDefaultTouch,n),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.props.fullscreen&&document.body.addEventListener("gesturestart",mt),Be.Z||window.addEventListener("hashchange",this.handleHashChange)},n.componentDidUpdate=function(e){var t=this;if(ct("Component did update..."),e.noPages!==this.props.noPages){this.elements=new Array(this.props.noPages),this.backgrounds=new Array(this.props.noPages),this.sharedElements=new Array(this.props.noPages),this.nUndos=new Array(this.props.noPages);for(var n=0;n<this.props.noPages;n++)this.elements[n]=[],this.backgrounds[n]=null,this.sharedElements[n]=[],this.nUndos[n]=0;this.setState({noPages:this.props.noPages},(function(){t.debouncedRedraw()}))}e.pdf!==this.props.pdf&&this.initializePDF(),this.props.canvasWidth===e.canvasWidth&&this.props.canvasHeight===e.canvasHeight||this.debouncedRedraw(),this.props.fill!==e.fill&&this.setState({fill:this.props.fill},this.redraw)},n.componentWillUnmount=function(){this.save(),this.saveInterval&&clearInterval(this.saveInterval),this.unsubscribe&&this.unsubscribe(),window.removeEventListener("resize",this.handleResize),Be.Z||window.removeEventListener("hashchange",this.handleHashChange),window.removeEventListener("unload",this.save);var e={passive:!1};document.removeEventListener("touchstart",this.preventDefaultTouch,e),document.removeEventListener("touchend",this.preventDefaultTouch,e),document.removeEventListener("touchmove",this.preventDefaultTouch,e),document.removeEventListener("visibilitychange",this.handleVisibilityChange,e),this.props.fullscreen&&document.removeEventListener("gesturestart",mt)},n.deselectElements=function(){ct("Deselect elements...");var e=this.selectedElements;if(e)for(var t=0;t<e.length;t++)e[t].selected=!1;this.selectedElements=null,this.dragPoints=null,this.canvasBuffer=null},n.renderProgressModal=function(){return this.state.isExporting?i.createElement(k.Z,{show:this.state.isExporting,onHide:te()},i.createElement(k.Z.Header,null,i.createElement(k.Z.Title,null,this.props.t("generate-pdf")))):null},n.renderUploadModal=function(){return this.state.showUploadModal?i.createElement(k.Z,{show:this.state.showUploadModal,onHide:this.closeResponseModal},i.createElement(k.Z.Header,{closeButton:!0},i.createElement(k.Z.Title,null,this.props.t("server-response"))),i.createElement(k.Z.Body,null,this.state.modalMessage),i.createElement(k.Z.Footer,null,i.createElement(M.Z,{onClick:this.closeResponseModal},this.props.t("close")))):null},n.renderPagination=function(){var e=this;if(this.state.hideNavigationButtons)return null;var t=this.props.t,n=this.state.currentPage;return this.props.dynamicallyHideButtons&&this.state.canvasWidth<600?i.createElement(x.Z,{size:"sm",className:"sketch-pages"},i.createElement(M.Z,{variant:"light",onClick:this.toggleNavigationModal},n+1,"/",this.state.noPages),i.createElement(he.Z,{owner:!0},i.createElement(xe,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"}))):i.createElement(x.Z,{size:"sm",className:"sketch-pages"},i.createElement(M.Z,{variant:"light",onClick:this.toggleNavigationModal},n+1,"/",this.state.noPages),i.createElement(xe,{tooltip:t("goto-first"),onClick:this.firstPage,glyph:"fast-backward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-previous"),onClick:this.previousPage,glyph:"backward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-next"),onClick:this.nextPage,glyph:"forward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-last"),onClick:this.lastPage,glyph:"fast-forward",size:"sm"}),i.createElement(he.Z,{owner:!0},i.createElement(xe,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"})))},n.renderInputButtons=function(){var e=this;return this.state.hideInputButtons?null:i.createElement(ze,{brushSize:this.state.brushSize,color:this.state.color,mode:this.state.mode,fontFamily:this.state.fontFamily,fontSize:this.state.fontSize,onModeChange:function(t){"drag"===e.state.mode&&"drag"!==t?(e.deselectElements(),e.onlyRedrawElements()):"text"===e.state.mode&&e.insertTextFromInput(),e.setState({mode:t}),"pointer"!==t?e.pointer.style.opacity=0:"pointer"===t&&(e.pointer.style.opacity=.7)},onColorChange:function(t){e.setState({color:t})},onBrushSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),"text"===e.state.mode&&e.insertTextFromInput(),e.setState({brushSize:Number(t),mode:"drawing"})},onFontFamilySelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontFamily:t,mode:"text"})},onFontSizeSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontSize:Number(t),mode:"text"})},t:this.props.t})},n.renderRemoveButtons=function(){if(this.state.hideInputButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<900)return null;var e=this.props.t;return i.createElement(x.Z,{size:"sm",className:"sketch-undo-redo sketch-button-group"},i.createElement(xe,{tooltip:e("undo"),onClick:this.undo,glyph:"step-backward",size:"sm"}),i.createElement(xe,{tooltip:e("redo"),glyph:"step-forward",onClick:this.redo,size:"sm"}),i.createElement(xe,{tooltip:e("clear-current"),onClick:this.toggleDeletePageModal,glyph:"eraser",size:"sm"}),i.createElement(xe,{tooltip:e("reset-pages"),onClick:this.toggleResetModal,glyph:"power-off",size:"sm"}))},n.renderSaveButtons=function(){var e=this;if(this.state.hideSaveButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<775)return null;var t=this.context,n=this.props.t;return i.createElement(x.Z,{size:"sm",className:"sketch-save-buttons sketch-button-group"},this.props.pdf?null:i.createElement(xe,{tooltip:n("load-pdf"),onClick:this.loadPDF,size:"sm",glyph:"file"}),i.createElement(xe,{tooltip:n("download"),onClick:this.toggleSaveModal,glyph:"file-pdf",size:"sm"}),i.createElement(xe,{tooltip:t.anonymous?n("save-local"):n("save-server"),onClick:function(){e.save().then((function(){t.addNotification({title:n("saved"),message:t.anonymous?n("saved-local"):n("saved-server"),level:"success",position:"tr"})})).catch((function(e){t.addNotification({title:n("encountered-error"),message:e.message,level:"error",position:"tr"})}))},glyph:"save",size:"sm"}),i.createElement(xe,{tooltip:n("upload-to-server"),onClick:this.uploadSketches,glyph:"upload",size:"sm"}),Z()?i.createElement(xe,{tooltip:this.state.swiping?n("disable-swiping"):n("enable-swiping"),variant:this.state.swiping?"success":"secondary",onClick:this.toggleSwiping,glyph:"fingerprint",size:"sm"}):null)},n.renderTransmitButtons=function(){var e=this;if(this.state.hideTransmitButtons||this.state.canvasWidth<650)return null;var t,n=this.context.userList.filter((function(e){return j()(e.exitTime)})).map((function(e){return{value:e.name,label:e.name}})),o=i.createElement(E.Z,{id:"popover-positioned-right"},i.createElement(S.Z,null,this.props.t("remote-control-by")),i.createElement(P.Z,null,i.createElement(C.ZP,{isClearable:!0,inline:!0,options:n,onChange:function(t){e.setState({receiveFrom:t})}}),i.createElement(T.Z,{defaultValue:this.state.groupMode,onChange:this.toggleGroupMode,legend:this.props.t("group-mode")})));this.props.pdf&&(t=i.createElement(xe,{size:"sm",tooltip:"vertical"===this.state.fill?this.props.t("fill-entire-width"):this.props.t("fit-page"),onClick:function(){var t;t="vertical"===e.state.fill?"horizontal":"vertical",e.setState({fill:t},e.redraw)},glyph:"vertical"===this.state.fill?"fas fa-grip-lines":"fas fa-grip-lines-vertical"}));var a=this.props.t;return i.createElement(i.Fragment,null,i.createElement(he.Z,{owner:!0},i.createElement(x.Z,{size:"sm",className:"sketch-button-group"},i.createElement(xe,{size:"sm",tooltip:this.state.transmitOwner?a("disable-transmissions"):a("enable-transmissions"),variant:this.state.transmitOwner?"success":"light",onClick:this.toggleTransmit,glyph:"bullhorn"}),i.createElement(b.Z,{trigger:"click",placement:"bottom",rootClose:!0,overlay:o},i.createElement(M.Z,{size:"sm",variant:"light"},i.createElement("div",{className:"fa fa-eye"}))),t)),i.createElement(he.Z,{notOwner:!0},i.createElement(x.Z,{size:"sm",className:"sketch-button-group"},i.createElement(xe,{size:"sm",tooltip:this.state.showInstructorAnnotations?a("show-only-own-annotations"):a("show-all-annotations"),variant:this.state.showInstructorAnnotations?"success":"light",onClick:function(){e.setState({showInstructorAnnotations:!e.state.showInstructorAnnotations},(function(){e.debouncedRedraw()}))},glyph:this.state.showInstructorAnnotations?"fa fa-toggle-on":"fa fa-toggle-off"}),t)))},n.verticalScroll=function(e){if(e>30||e<-30){var t=this.context,n={id:this.id,type:We.Qr,value:JSON.stringify({diffY:e/this.canvas.height,sessionID:t.sessionID}),noSave:!0};t.log(n,"members"),this.canvasWrapper.scrollTop-=.1*e}},n.renderFeedbackButtons=function(){var e=this,t=this.toOriginalPage(this.state.currentPage);return!this.props.feedbackButtons||j()(t)?null:i.createElement(i.Fragment,null,i.createElement(z.Z,{key:this.id+"-slide-"+t,id:this.id+"-slide-"+t,customFeedback:!1,vertical:!0,style:{zIndex:3,position:"absolute",top:35,right:20}}),i.createElement(he.Z,{owner:!0},i.createElement(R.Z,{tooltip:this.props.t("open-slide-feedback"),placement:"left"},i.createElement(M.Z,{onClick:function(){return e.setState({showFeedbackModal:!e.state.showFeedbackModal})},variant:"secondary",size:"sm",style:{right:20,top:175,position:"absolute",zIndex:3}},this.props.t("show")))))},n.render=function(){var e,t,n=this;switch(ct("Render sketchpad with height "+this.props.canvasHeight+" and width "+this.props.canvasWidth),this.state.mode){case"drawing":e="crosshair";break;case"text":e="text";break;case"drag":e="move";break;case"delete":e="not-allowed";break;default:e="default"}if("pointer"===this.state.mode||"zoom"===this.state.mode)t={onMouseDown:this.movePointerStart,onMouseMove:this.movePointer,onMouseOut:this.movePointerEnd,onMouseUp:this.movePointerEnd,onTouchCancel:this.movePointerEnd,onTouchEnd:this.movePointerEnd,onTouchMove:this.movePointer,onTouchStart:this.movePointerStart};else if("none"===this.state.mode){var o=function(e){e.stopPropagation(),J()(n.swipeEndX-n.swipeStartX)>45&&J()(n.swipeEndY-n.swipeStartY)<40&&(n.swipeEndX>n.swipeStartX?n.previousPage():n.nextPage(),n.swipeEndX=0,n.swipeEndY=0,n.swipeStartX=0,n.swipeStartY=0)};t={onTouchCancel:o,onTouchEnd:o,onTouchMove:function(e){if(e.stopPropagation(),n.state.swiping&&e.touches&&e.touches.length>1){n.swipeEndX=e.touches[0].screenX,n.swipeEndY=e.touches[0].screenY,n.isMouseDown=!1;var t=n.swipeEndY-n.swipeStartY;n.verticalScroll(t)}},onTouchStart:function(e){e.stopPropagation(),e.touches&&e.touches.length>1&&(n.swipeStartX=e.touches[0].screenX,n.swipeStartY=e.touches[0].screenY)}}}else t={onClick:this.handleClick,onMouseDown:this.drawStart,onMouseMove:this.draw,onMouseOut:this.drawEnd,onMouseUp:this.drawEnd,onTouchCancel:this.drawEnd,onTouchEnd:this.drawEnd,onTouchMove:this.draw,onTouchStart:this.drawStart};var a=i.createElement("canvas",tt({id:this.id+"-canvas",className:"sketch-canvas",width:this.state.canvasWidth*gt,height:this.state.canvasHeight*gt,style:tt({cursor:e,width:this.state.canvasWidth,height:this.state.canvasHeight},this.props.style),ref:function(e){e&&(n.canvas=e,n.ctx=e.getContext("2d"))}},t)),s=i.createElement("canvas",{className:"sketchpad-magnifying-glass",width:this.state.canvasWidth*gt/4,height:this.state.canvasHeight*gt/4,style:{width:this.state.canvasWidth/4,height:this.state.canvasHeight/4},ref:function(e){e&&(n.zoom=e,n.zoomCtx=e.getContext("2d"),n.zoomCtx.imageSmoothingQuality="high")}});return i.createElement(i.Fragment,null,i.createElement(y.Z,{id:this.id,ref:function(e){n.sketchpadPanel=e},className:"modal-container",style:{width:this.state.canvasWidth+2,position:"relative",marginBottom:this.props.fullscreen?"0px":"20px",marginLeft:"auto",marginRight:"auto"},tabIndex:"0"},i.createElement("div",{className:"sketch-panel-heading clearfix unselectable"},this.renderPagination(),this.renderInputButtons(),this.renderRemoveButtons(),this.renderTransmitButtons(),this.renderSaveButtons(),this.context.presentationMode?null:i.createElement(xe,{tooltip:this.state.showTutorial?this.props.t("stop-tutorial"):this.props.t("start-tutorial"),onClick:this.toggleTutorial,glyph:"question",size:"sm"}),i.createElement(ge.Z,{reference:this,id:this.props.voiceID,commands:Ee})),this.renderFeedbackButtons(),i.createElement(wt,{nodes:this.props.nodes,currentPage:this.state.currentPage,toOriginalPage:this.toOriginalPage,key:"overlays"}),i.createElement("div",{className:"canvas-wrapper",style:{width:this.state.canvasWidth,height:this.state.canvasHeight},key:this.state.canvasWidth+"-"+this.state.canvasHeight,ref:function(e){n.canvasWrapper=e}},i.createElement(w.W4,{id:"sketchpadWindow",disabled:O()},a),s,i.createElement("div",tt({className:"textLayer",ref:function(e){n.textLayer=e},style:{pointerEvents:"none"!==this.state.mode?"none":"auto"}},t)),i.createElement("div",{ref:function(e){n.pointer=e},className:"sketch-pointer"})),i.createElement("input",{type:"text",className:"sketch-text-input",style:{display:"text"===this.state.mode?"inline-block":"none",fontSize:this.state.fontSize,fontFamily:this.state.fontFamily,color:this.state.color,width:this.state.canvasWidth},onKeyDown:this.handleEnter,ref:function(e){n.textInput=e}}),this.renderUploadModal(),this.state.showNavigationModal?i.createElement(it,{show:this.state.showNavigationModal,onSelect:this.gotoPage,noPages:this.state.noPages,onHide:this.toggleNavigationModal,t:this.props.t}):null,this.renderProgressModal(),this.state.showResetModal?i.createElement(at,{show:this.state.showResetModal,onSubmit:this.clearAll,onHide:function(){n.setState({showResetModal:!1})},t:this.props.t}):null,this.state.showDeletePageModal?i.createElement(st,{show:this.state.showDeletePageModal,onSubmit:this.clear,onHide:function(){n.setState({showDeletePageModal:!1})},t:this.props.t}):null,this.state.showSaveModal?i.createElement(lt,{show:this.state.showSaveModal,saveAsPDF:this.saveAsPDF,saveAsPNG:this.saveAsPNG,onHide:this.toggleSaveModal,pdf:this.props.pdf,session:this.context,id:this.id,t:this.props.t}):null,this.state.showFeedbackModal?i.createElement(rt,{session:this.context,show:this.state.showFeedbackModal,onHide:function(){n.setState({showFeedbackModal:!n.state.showFeedbackModal})},id:this.id,noPages:this.state.noPages,toOriginalPage:this.toOriginalPage,gotoPage:this.gotoPage,t:this.props.t}):null,this.state.showTutorial?i.createElement(ue.ZP,{steps:qe,showProgress:!0,run:!0}):null),this.sketchpadPanel?i.createElement(pe.Z,{container:this.sketchpadPanel,actions:{ArrowDown:this.nextPage,ArrowUp:this.previousPage}}):null,i.createElement(Ve,{canvas:this.canvas}))},t}(i.Component);yt.defaultProps={autoSave:!0,feedbackButtons:!1,intervalTime:1e4,hideInputButtons:!1,hideNavigationButtons:!1,hideSaveButtons:!1,hideTransmitButtons:!1,brushSize:4,color:"#444444",canvasWidth:1200,canvasHeight:700,fullscreen:!1,fill:"vertical",disabled:!1,fontFamily:"Arial",fontSize:24,nodes:{},noPages:1,pdf:null,showTutorial:!1,dynamicallyHideButtons:!1,transmitOwner:!0,groupMode:!1,voiceID:null,style:{},onChange:function(){}},yt.propTypes={autoSave:l().bool,feedbackButtons:l().bool,intervalTime:l().number,hideInputButtons:l().bool,hideNavigationButtons:l().bool,hideSaveButtons:l().bool,hideTransmitButtons:l().bool,brushSize:l().number,color:l().string,canvasWidth:l().number,canvasHeight:l().number,fullscreen:l().bool,fill:l().oneOf(["vertical","horizontal"]),disabled:l().bool,fontFamily:l().string,fontSize:l().number,nodes:l().object,noPages:l().number,pdf:l().string,showTutorial:l().bool,dynamicallyHideButtons:l().bool,transmitOwner:l().bool,groupMode:l().bool,voiceID:l().string,style:l().object,onChange:l().func},yt.contextType=be.Z;var bt=(0,c.Z)("sketchpad")((0,je.W)(yt))},652501:function(e,t){"use strict";t.Z=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=512);for(var o=atob(e),a=[],s=0;s<o.length;s+=n){for(var i=o.slice(s,s+n),r=new Array(i.length),l=0;l<i.length;l++)r[l]=i.charCodeAt(l);var c=new Uint8Array(r);a.push(c)}return new Blob(a,{type:t})}},238904:function(e,t,n){"use strict";var o=n(928316),a=n(569257),s=n.n(a),i=n(525439);t.Z=function(e){if(e){var t=(0,o.findDOMNode)(e);if(t)for(var n=t.getElementsByClassName("hint-button"),a=0;a<n.length;a++)s()(n[a].innerText,i.a.t("components:close"))&&n[a].click()}}},675252:function(e,t){"use strict";var n=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i;function o(e){setImmediate((function(){throw e}),0)}function a(e){return n.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}var s=function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t,n=e.document,s=!1;n&&n.createElementNS&&(t=n.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in t);var i=/constructor/i.test(e.HTMLElement)||e.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),l=e.setImmediate||e.setTimeout,c=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=a(e)),navigator.msSaveOrOpenBlob(e,t)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=null,c.onwritestart=null,c.onprogress=null,c.onwrite=null,c.onabort=null,c.onerror=null,c.onwriteend=null,function(e,t,n){return new h(e,t||e.name||"download",n)})}function d(){return e.URL||e.webkitURL||e}function u(e){setTimeout((function(){"string"==typeof e?d().revokeObjectURL(e):e.remove()}),4e4)}function h(n,c,h){h||(n=a(n));var p,g=this,m="application/octet-stream"===n.type;function f(){!function(e,t,n){for(var a=(t=[].concat(t)).length;a--;){var s=e["on"+t[a]];if("function"==typeof s)try{s.call(e,n||e)}catch(i){o(i)}}}(g,"writestart progress write writeend".split(" "))}if(g.readyState=g.INIT,s)return p=d().createObjectURL(n),void l((function(){var e,n;t.href=p,t.download=c,e=t,n=new MouseEvent("click"),e.dispatchEvent(n),f(),u(p),g.readyState=g.DONE}),0);!function(){if((r||m&&i)&&e.FileReader){var t=new FileReader;return t.onloadend=function(){var n=r?t.result:t.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(n,"_blank")||(e.location.href=n),n=void 0,g.readyState=g.DONE,f()},t.readAsDataURL(n),void(g.readyState=g.INIT)}p||(p=d().createObjectURL(n)),m?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),g.readyState=g.DONE,f(),u(p)}()}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.Z=s},907756:function(e,t){"use strict";t.Z=function(e){e.stopPropagation()}},995729:function(){},535635:function(){},737684:function(){},286339:function(){},347629:function(){},891940:function(){}}]);