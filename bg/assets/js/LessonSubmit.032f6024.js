"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9080],{897606:function(e,t,s){const i=(0,s(217431).Z)((()=>Promise.all([s.e(3312),s.e(4438)]).then(s.bind(s,603396))));t.Z=i},447610:function(e,t,s){const i=(0,s(217431).Z)((()=>s.e(9036).then(s.bind(s,287576))));t.Z=i},25046:function(e,t,s){s.r(t),s.d(t,{default:function(){return R}});var i=s(202784),n=s(690299),o=s.n(n),a=s(213980),r=s.n(a),l=s(198),c=s(912895),p=s.n(c),h=s(318967),u=s.n(h),m=s(770561),d=s(715318),g=s(294565),f=s(623102),b=s.n(f),y=s(588703),v=s.n(y),S=s(686605),x=s.n(S),E=s(180024),w=s(447610),C=s(897606),L=s(351375),N=s(123103),Z=s(302108),$=s(691334),z=(s(697927),s(741082));var k=function(e,t,s){return{text:s("lesson-completed-msg",{name:e.user.name,lessonName:e.lessonName,namespaceName:e.namespaceName,msg:t||""}),subject:`${e.lessonName} ${s("successfully-completed")}!`}},P=Object.defineProperty,U=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,j=(e,t,s)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,M=(e,t)=>{for(var s in t||(t={}))A.call(t,s)&&j(e,s,t[s]);if(U)for(var s of U(t))O.call(t,s)&&j(e,s,t[s]);return e},T=(e,t,s)=>(j(e,"symbol"!=typeof t?t+"":t,s),s);const q=o()("isle:lesson-submit");class D extends i.Component{constructor(e){super(e),T(this,"createResponseSummaryDoc",(()=>{const e=this.context,t={content:[{text:`${this.props.t("responses-header")} ${e.namespaceName+"/"+e.lessonName}`,style:"header",alignment:"center"}],styles:{header:{fontSize:24,bold:!0,margin:[0,0,0,10]},author:{fontSize:16,italics:!0,margin:[0,0,0,10],alignment:"center"},date:{fontSize:16,italics:!0,alignment:"right",margin:[0,15,0,15]},elapsed:{fontSize:16,italics:!0,alignment:"right",margin:[0,15,0,15]},subheader:{fontSize:18,bold:!0,margin:[0,30,0,10]},question:{fontSize:15,margin:[0,0,0,10],italics:!0}}};b()(e.user)||t.content.push({text:`${this.props.t("by")} ${e.user.name} (${e.user.email})`,style:"author"});const s=new Date;if(t.content.push({text:`${s.toLocaleDateString()} - ${s.toLocaleTimeString()}`,style:"date"}),t.content.push({text:`${this.props.t("elapsed")}: ${x()(e.duration/6e4)}min`,style:"elapsed"}),e.currentUserActions){let s=e.responseVisualizerIds;this.props.coverage&&(s=s.filter((e=>this.props.coverage.includes(e))));for(let i=0;i<s.length;i++){const n=e.responseVisualizers[s[i]];if(t.content.push({text:s[i],style:"subheader"}),n){const{type:o}=n,a=n.ref.props.data.question,r=n.ref.props.data.type;t.content.push({text:(0,g.isPrimitive)(a)?a:u()(a),style:"question"});let l=e.currentUserActions[s[i]];if(l)if(l=l.filter((e=>e.type===o)),l=l.sort(((e,t)=>e.absoluteTime-t.absoluteTime)),this.state.onlyLatest){const e=l[l.length-1];this.addAction(e,t,r,n)}else l.forEach(((e,s)=>{t.content.push({text:this.props.t("submission")+" #"+(s+1)+":"}),this.addAction(e,t,r,n)}))}}}p().createPdf(t).download("responses.pdf")})),T(this,"addAction",((e,t,s,i)=>{if("image"===s)t.content.push({image:e.value,width:500});else if("factor"===s){let s,n=i.ref.props.data.levels;n=n.map(((e,t)=>{let s=(0,g.isPrimitive)(e)?e:u()(e);return s||(s=`${this.props.t("choice")} ${t+1}`),s})),v()(e.value)?(s="",e.value.forEach(((e,t)=>{e&&(s&&(s+=", "),s+=n[t])}))):s=n[e.value],s||(s=this.props.t("none")),t.content.push({text:s})}else t.content.push({text:e.value})})),T(this,"closeUserModal",(()=>{this.setState({showUserModal:!1,visibleLogin:!1,visibleSignup:!1})})),T(this,"login",(e=>{e.stopPropagation(),this.setState({visibleLogin:!0,visibleSignup:!1})})),T(this,"signup",(e=>{e.stopPropagation(),this.setState({visibleSignup:!0,visibleLogin:!1})})),T(this,"closeSignup",(()=>{this.setState({visibleSignup:!1,showUserModal:!1})})),T(this,"closeLogin",(()=>{this.setState({visibleLogin:!1,showUserModal:!1})})),T(this,"handleLatestChange",(()=>{this.setState({onlyLatest:!this.state.onlyLatest})})),T(this,"finalizeSession",(()=>{q("Finalizing session...");const e=this.context;let t;if(this.props.coverage){const e=this.props.coverage.map((e=>`#${e} .submit-button`)).join(", ");t=document.querySelectorAll(e)}else t=document.getElementsByClassName("submit-button");for(let i=0;i<t.length;i++)t[i].innerText===this.props.t("submit")&&t[i].click();e.finalize();let s=this.props.t("lesson-successfully-completed");if(!b()(e.user)&&this.props.sendConfirmationEmail){s+=this.props.t("confirmation-email");const t=k(e,this.props.message,this.props.t);e.sendMail(t,e.user.email)}let n=!1;(e.responseVisualizerIds||[]).forEach((t=>{(e.currentUserActions[t]||[]).length>1&&(n=!0)})),e.addNotification({title:this.props.t("completed"),message:s,level:"success",position:"tr",autoDismiss:0,dismissible:"button",children:i.createElement("div",{style:{marginBottom:"40px"}},n?i.createElement(L.Z,{legend:this.props.t("only-latest"),defaultValue:this.state.onlyLatest,onChange:this.handleLatestChange}):null,i.createElement(m.Z,{variant:"success",size:"sm",style:{float:"right",marginRight:"10px",marginTop:n?"0px":"10px"},onClick:this.createResponseSummaryDoc},this.props.t("download-pdf"))),onRemove:()=>{this.setState({disabled:!1})}}),e.log({id:e.lessonName,type:$.kv,value:this.props.t("lesson-submitted")}),this.setState({disabled:!0}),window.removeEventListener("beforeunload",E.Z)})),T(this,"handleClick",(()=>{this.props.onClick();const e=this.context;if(this.props.requireLogin&&b()(e.user))return this.setState({showUserModal:!0});this.finalizeSession()})),this.state={showUserModal:!1,visibleLogin:!1,visibleSignup:!1,onlyLatest:!0}}componentDidMount(){const e=this.context;this.unsubscribe=e.subscribe((e=>{e!==Z.YQ&&e!==Z.Fw&&e!==Z.E7||this.forceUpdate()}))}componentWillUnmount(){this.unsubscribe&&this.unsubscribe()}render(){const e=!this.context.live||this.state.disabled;return i.createElement("div",{className:`bg-light ${this.props.className}`,style:M({maxWidth:400,margin:"0 auto 0px",padding:"20px",fontFamily:"Arial"},this.props.style)},i.createElement("div",{className:"d-grid gap-2"},i.createElement(m.Z,{disabled:e,variant:"primary",size:"large",onClick:this.handleClick},this.props.label?this.props.label:this.props.t("finish-lesson"))),i.createElement(d.Z,{show:this.state.showUserModal,onHide:this.closeUserModal},i.createElement(d.Z.Header,{closeButton:!0},i.createElement(d.Z.Title,null,this.props.t("authentication"))),i.createElement(d.Z.Body,null,i.createElement("p",null,this.props.t("authentication-prompt"))),i.createElement(d.Z.Footer,{style:{textAlign:"center"}},i.createElement(m.Z,{variant:"primary",onClick:this.login.bind(this),style:{marginRight:"10px"}},this.props.t("login")),i.createElement(m.Z,{onClick:this.signup.bind(this)},this.props.t("signup")))),i.createElement(C.Z,{show:this.state.visibleLogin,onClose:this.closeLogin}),i.createElement(w.Z,{show:this.state.visibleSignup,onClose:this.closeSignup}))}}D.defaultProps={coverage:null,label:null,message:"",requireLogin:!0,sendConfirmationEmail:!0,className:"",style:{},onClick(){}},D.propTypes={coverage:r().arrayOf(r().string),label:r().string,message:r().string,requireLogin:r().bool,sendConfirmationEmail:r().bool,className:r().string,style:r().object,onClick:r().func},D.contextType=N.Z;var R=(0,l.Z)("lesson-submit")((0,z.W)(D))},770561:function(e,t,s){var i=s(72779),n=s.n(i),o=s(202784),a=s(247830),r=s(429658),l=s(552322);const c=o.forwardRef((({as:e,bsPrefix:t,variant:s,size:i,active:o,className:c,...p},h)=>{const u=(0,r.vE)(t,"btn"),[m,{tagName:d}]=(0,a.FT)({tagName:e,...p}),g=d;return(0,l.jsx)(g,{...m,...p,ref:h,className:n()(c,u,o&&"active",s&&`${u}-${s}`,i&&`${u}-${i}`,p.href&&p.disabled&&"disabled")})}));c.displayName="Button",c.defaultProps={variant:"primary",active:!1,disabled:!1},t.Z=c},318967:function(e){var t=function(e,t){return e+s(t)},s=function(e){return null===e||"boolean"==typeof e||void 0===e?"":"number"==typeof e?e.toString():"string"==typeof e?e:Array.isArray(e)?e.reduce(t,""):function(e){return Object.prototype.hasOwnProperty.call(e,"props")}(e)&&Object.prototype.hasOwnProperty.call(e.props,"children")?s(e.props.children):""};s.default=s,e.exports=s}}]);