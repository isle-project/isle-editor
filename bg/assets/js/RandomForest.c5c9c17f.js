"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6634],{184607:function(e,t,r){r.d(t,{DV:function(){return U},OI:function(){return ee},tC:function(){return Y},fA:function(){return te}});var n=r(12860),i=r(240054),a=r.n(i),o=r(287013),s=r.n(o),c=r(700601),l=r.n(c),u=r(798030),p=r.n(u),h=r(686605),m=r.n(h),d=r(605977),f=r.n(d),v=r(894578),y=r(202784),g=r(198),T=r(45562),b=r(309765),E=r(844096),C=r.n(E),x=r(481066),w=r(597909),M=r(497326),Z=r(213980),D=r.n(Z),I=r(770561),q=r(81982),N=r(708579),O=Object.defineProperty,k=function(e,t,r){return function(e,t,r){t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r}(e,"symbol"!=typeof t?t+"":t,r),r},P=function(e){function t(){var t;return t=e.call(this)||this,k((0,M.Z)(t),"toggleFullscreen",(function(){t.setState({fullscreen:!t.state.fullscreen})})),t.state={fullscreen:!1},t}return(0,v.Z)(t,e),t.prototype.render=function(){var e=this.props.t;return y.createElement(y.Fragment,null,y.createElement(N.Z,{id:"fullscreen_tooltip",placement:"bottom",tooltip:e("toggle-fullscreen")},y.createElement(I.Z,{variant:"outline-danger",size:"sm",onClick:this.toggleFullscreen,style:{position:"absolute",top:"10px",right:"32px"}},y.createElement("div",{className:"fa fa-window-maximize"}))),y.createElement(q.Z,{show:this.state.fullscreen,onHide:this.toggleFullscreen,dialogClassName:"modal-100w"},y.createElement(q.Z.Header,{closeButton:!0},y.createElement(q.Z.Title,{as:"h1"},e("decision-tree"))),y.createElement(q.Z.Body,{style:{height:.75*window.innerHeight,width:"100%",fontSize:32,overflow:"scroll"}},y.createElement("div",{className:"decision-tree decision-tree-fullscreen"},this.props.tree)),y.createElement(q.Z.Footer,null,y.createElement(I.Z,{onClick:this.toggleFullscreen},e("close")))))},t}(y.Component);P.propTypes={tree:D().node.isRequired};var S=(0,g.Z)("models")(P),F=/^[+-]?[\d.]+e?[+-]?\d*$/;function R(e,t){if(!e)return null;if(e.category){var r=e.category;return((0,b.isPrimitive)(r)||F.test(r))&&(r=Number(r),C()(r)||(r=r.toFixed(6))),y.createElement("ul",null,y.createElement("li",null,y.createElement("span",{className:"decision-tree-leaf"},t("predict"),": ",r," ")))}return y.createElement("ul",null,y.createElement("li",null,y.createElement("span",null,y.createElement("b",null," ",e.attribute," ",e.predicateName," ",e.pivot," ?")),y.createElement("ul",null,y.createElement("li",null,y.createElement("span",null,t("no")," ( ",e.notMatchedCount," ",t("obs"),") "),R(e.notMatch,t)),y.createElement("li",null,y.createElement("span",null,t("yes")," ( ",e.matchedCount," ",t("obs"),") "),R(e.match,t)))))}var z=function(e){function t(t){var r;return(r=e.call(this,t)||this).state={plotValue:null,plotKey:null,fullscreen:!1},r}(0,v.Z)(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=this;this.tree&&(this.treeWrapper.scrollLeft=.4*this.tree.clientWidth,(0,T.hi)(this.tree,{backgroundColor:"white",style:{fontSize:22}}).then((function(t){var r='<img src="'+t+'" style="display: block; margin: 0 auto; max-width: 100%; max-height: 100%" />';e.setState({plotKey:"\x3c!--IMAGE_LOG:"+(0,x.Z)(6)+"_"+(0,x.Z)(6)+"--\x3e",plotValue:r})})))},r.render=function(){var e=this,t=this.props.t,r=R(this.props.tree,t);return y.createElement("div",{className:"decision-tree-wrapper",ref:function(t){e.treeWrapper=t}},y.createElement("button",{className:"decision-tree-draggable-bar",draggable:"true",onDragStart:function(t){t.dataTransfer.setData("text/html",e.state.plotValue),t.dataTransfer.setData("text/plain",e.state.plotKey)},onClick:function(){(0,w.Z)(e.state.plotValue)},style:{float:"left"}},t("drag-plot")),y.createElement(S,{variant:"outline-danger",size:"sm",onClick:function(){e.setState({fullscreen:!e.state.fullscreen})},tree:r},y.createElement("div",{className:"fa fa-times"})),y.createElement("div",{className:"decision-tree",ref:function(t){e.tree=t}},r))},t}(y.Component),B=(0,g.Z)("models")(z);var A=function(e,t,r,n,i){for(var a=[],o=[],s=e[r],c=t.length-1;c>=0;c--){var l=t[c];n(s[l],i)?a.push(l):o.push(l)}return{match:a,notMatch:o}};function j(e,t){for(var r={},n=t.length-1;n>=0;n--){r[e[t[n]]]=0}for(var i=t.length-1;i>=0;i--){r[e[t[i]]]+=1}return r}function V(e,t){var r,n=j(e,t),i=0;for(var a in n)n[a]>i&&(i=n[a],r=a);return r}function H(e,t){var r=j(e,t),n=0;for(var i in r)if(l()(r,i)){var a=r[i]/t.length;n+=a*(1-a)}return n}function W(e,t){var r=j(e,t),n=0;for(var i in r)if(l()(r,i)){var a=r[i]/t.length;n+=-a*p()(a)}return n}function K(e,t){var r=t.length,n=0,i=0,a=0,o=0;if(!r)return null;if(r<2)return 0;for(var s=0;s<r;s++){var c=e[t[s]];a+=(n=c-i)*(c-(i+=n/(o+=1)))}return a/(o-1)}function L(e,t){var r=t.length;if(!r)return null;for(var n=0,i=0;i<r;i++){n+=(e[t[i]]-n)/(i+1)}return n}var _={"==":function(e,t){return e==t},">=":function(e,t){return e>=t}};function G(e){var t=this,r=e.data[e.response].length;this.importances={};for(var n=0;n<e.predictors.length;n++)this.importances[e.predictors[n]]=0;this.root=X({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:f()(0,r,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||m()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative,criterion:"gini"===e.criterion?H:W},this.importances),this.predict=function(r,n){if(void 0===n){for(var i=r[e.predictors[0]].length,a=new Array(i),o=0;o<i;o++)a[o]=J(t.root,r,o);return a}return J(t.root,r,n)},this.type="classification",this.response=e.response}function X(e,t){var r=e.data,i=e.predictors,o=e.indices,c=e.response,l=e.minItemsCount,u=e.scoreThreshold,p=e.maxTreeDepth,h=e.quantitative,m=e.criterion,d=e.minBucket,f=e.nTry,v=o.length;if(0===p||v<=l)return{category:V(r[c],o)};var y=m(r[c],o),g={},T={gain:0};f&&(a()(i,{size:f}),(0,n.Z)("predictors"));for(var b=v-1;b>=0;b--)for(var E=o[b],C=0;C<i.length;C++){var x=i[C],w=r[x][E],M=void 0,Z=x+(M=s()(h,x)?">=":"==")+w;if(!g[Z]){g[Z]=!0;var D=_[M],I=A(r,o,x,D,w),q=m(r[c],I.match),N=m(r[c],I.notMatch),O=0;O+=q*I.match.length,O+=N*I.notMatch.length;var k=y-(O/=v);k>T.gain&&I.match.length>d&&I.notMatch.length>d&&((T=I).predicateName=M,T.predicate=D,T.attribute=x,T.pivot=w,T.gain=k)}}if(!T.gain||T.gain/y<u)return{category:V(r[c],o)};e.maxTreeDepth=p-1,t[T.attribute]+=T.gain,e.indices=T.match;var P=X(e,t);e.indices=T.notMatch;var S=X(e,t);return{attribute:T.attribute,predicate:T.predicate,predicateName:T.predicateName,pivot:T.pivot,match:P,notMatch:S,matchedCount:T.match.length,notMatchedCount:T.notMatch.length}}function $(e){var t=e.data,r=e.predictors,i=e.indices,o=e.response,c=e.minItemsCount,l=e.scoreThreshold,u=e.maxTreeDepth,p=e.quantitative,h=e.minBucket,m=e.nTry,d=i.length;if(0===u||d<=c)return{category:L(t[o],i)};var f=K(t[o],i),v={},y={gain:0};m&&(a()(r,{size:m}),(0,n.Z)("predictors"));for(var g=d-1;g>=0;g--)for(var T=i[g],b=0;b<r.length;b++){var E=r[b],C=t[E][T],x=void 0,w=E+(x=s()(p,E)?">=":"==")+C;if(!v[w]){v[w]=!0;var M=_[x],Z=A(t,i,E,M,C),D=K(t[o],Z.match),I=K(t[o],Z.notMatch),q=0;q+=D*Z.match.length,q+=I*Z.notMatch.length;var N=f-(q/=d);N>y.gain&&Z.match.length>h&&Z.notMatch.length>h&&((y=Z).predicateName=x,y.predicate=M,y.attribute=E,y.pivot=C,y.gain=N)}}if(!y.gain||y.gain/f<l)return{category:L(t[o],i)};e.maxTreeDepth=u-1,e.indices=y.match;var O=$(e);e.indices=y.notMatch;var k=$(e);return{attribute:y.attribute,predicate:y.predicate,predicateName:y.predicateName,pivot:y.pivot,match:O,notMatch:k,matchedCount:y.match.length,notMatchedCount:y.notMatch.length}}function J(e,t,r){for(;;){if(e.category)return e.category;var n=t[e.attribute][r];e=(0,e.predicate)(n,e.pivot)?e.match:e.notMatch}}function Q(e,t,r){for(var n={},i=0;i<e.length;i++){var a=e[i].predict(t,r);n[a]=n[a]?n[a]+1:1}var o,s=-1;for(var c in n)l()(n,c)&&n[c]>s&&(s=n[c],o=c);return o}var U=G,Y=function(e){var t=this,r=e.data[e.response].length;this.root=$({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:f()(0,r,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||m()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative}),this.predict=function(r,n){if(void 0===n){for(var i=r[e.predictors[0]].length,a=new Array(i),o=0;o<i;o++)a[o]=Number(J(t.root,r,o));return a}return Number(J(t.root,r,n))},this.type="regression",this.response=e.response},ee=function(e){var t=this;this.trees=function(e){for(var t=[],r=e.data[e.response].length,n=f()(0,r,1),i=0;i<e.nTrees;i++)t[i]=a()(n);for(var o=[],s=0;s<e.nTrees;s++){e.indices=t[s];var c=new G(e);o.push(c)}return o}(e),this.importances={};for(var r=0;r<e.predictors.length;r++){var n=e.predictors[r];this.importances[n]=0;for(var i=0;i<this.trees.length;i++)this.importances[n]+=this.trees[i].importances[n];this.importances[n]/=this.trees.length}this.predict=function(r,n){if(void 0===n){for(var i=r[e.predictors[0]].length,a=new Array(i),o=0;o<i;o++)a[o]=Q(t.trees,r,o);return a}return Q(t.trees,r,n)},this.type="classification",this.response=e.response},te=B},862340:function(e,t,r){r.r(t);var n=r(497326),i=r(894578),a=r(467177),o=r(202784),s=r(213980),c=r.n(s),l=r(198),u=r(822736),p=r(770561),h=r(588703),m=r.n(h),d=r(584443),f=r(708579),v=r(184607),y=r(338664),g=r(412042),T=Object.defineProperty,b=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,x=function(e,t,r){return t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},w=function(e,t){for(var r in t||(t={}))E.call(t,r)&&x(e,r,t[r]);if(b)for(var n,i=(0,a.Z)(b(t));!(n=i()).done;){r=n.value;C.call(t,r)&&x(e,r,t[r])}return e},M=0,Z=function(e){var t=e.y,r=e.x,n=e.type,i=e.nTrees,a=e.nTry,o=e.impurityMeasure,s=e.data,c=e.quantitative,l=e.scoreThreshold,u=e.maxTreeDepth,p=e.minItemsCount;try{var h,d;h=m()(r)?r:[r],"Classification"===n&&(d=new v.OI({response:t,predictors:h,data:s,quantitative:c,criterion:o,nTrees:i,nTry:a,scoreThreshold:l,maxTreeDepth:u,minItemsCount:p}));for(var f=[],y=0;y<h.length;y++){var g=h[y];f.push(d.importances[g])}return{forest:d,predictors:h,importances:f}}catch(T){return{}}},D=function(e){function t(t){var r,i,a;r=e.call(this,t)||this,i=(0,n.Z)(r),x(i,"symbol"!=typeof(a="handlePredict")?a+"":a,(function(){r.props.onPredict(r.state.forest,M)})),M+=1;var o=t.y,s=t.x,c=t.type,l=t.nTrees,u=t.nTry,p=t.impurityMeasure,h=t.data,m=t.quantitative,d=t.scoreThreshold,f=t.maxTreeDepth,v=t.minItemsCount;return r.state=w(w({},Z({y:o,x:s,type:c,nTrees:l,nTry:u,impurityMeasure:p,data:h,quantitative:m,scoreThreshold:d,maxTreeDepth:f,minItemsCount:v})),t),r}return(0,i.Z)(t,e),t.getDerivedStateFromProps=function(e,t){if(e.y!==t.y||e.x!==t.x||e.type!==t.type||e.nTrees!==t.nTrees||e.nTry!==t.nTry||e.impurityMeasure!==t.impurityMeasure||e.data!==t.data||e.quantitative!==t.quantitative||e.scoreThreshold!==t.scoreThreshold||e.maxTreeDepth!==t.maxTreeDepth||e.minItemsCount!==t.minItemsCount){var r=e.y,n=e.x,i=e.type,a=e.nTrees,o=e.nTry,s=e.impurityMeasure,c=e.data,l=e.quantitative,u=e.scoreThreshold,p=e.maxTreeDepth,h=e.minItemsCount;return w(w({},Z({y:r,x:n,type:i,nTrees:a,nTry:o,impurityMeasure:s,data:c,quantitative:l,scoreThreshold:u,maxTreeDepth:p,minItemsCount:h})),e)}return null},t.prototype.render=function(){var e=this.state.forest,t=this.props.t;return e?o.createElement("div",{style:{overflowX:"auto",width:"100%"}},o.createElement("span",{className:"title"},t("random-forest-for",{y:this.props.y,counter:M})),o.createElement("p",null,t("created-from-trees",{nTrees:this.props.nTrees,nTry:this.props.nTry})),o.createElement(d.Z,{editable:!0,data:[{type:"bar",x:this.state.predictors,y:this.state.importances}],layout:{xaxis:{title:t("variable")},yaxis:{title:t("importance")}}}),this.props.onPredict?o.createElement(f.Z,{tooltip:t("predictions-attached")},o.createElement(p.Z,{variant:"secondary",size:"sm",style:{marginTop:10},onClick:this.handlePredict},this.props.t("use-model-to-predict"))):null):o.createElement(u.Z,{variant:"danger"},t("missing-attributes"))},t}(o.Component);D.defaultProps={type:"Classification",nTrees:50,nTry:1,impurityMeasure:"gini",scoreThreshold:.01,maxTreeDepth:20,minItemsCount:50,onPredict:null},D.propTypes={data:c().object.isRequired,y:c().oneOfType([c().string,c().instanceOf(g.E)]).isRequired,x:c().oneOfType([c().arrayOf(c().oneOfType([c().string,c().instanceOf(g.E)])),c().string,c().instanceOf(g.E)]).isRequired,type:c().oneOf(["Classification","Regression"]),quantitative:c().arrayOf(c().string).isRequired,nTrees:c().number,nTry:c().number,impurityMeasure:c().oneOf(["gini","entropy"]),scoreThreshold:c().number,maxTreeDepth:c().number,minItemsCount:c().number,onPredict:c().func},t.default=(0,l.Z)("models")((0,y.W)(D))},597909:function(e,t){t.Z=function(e){var t=document.createElement("div");t.innerHTML=e,t.style.position="fixed",t.style.opacity=0,t.style.pointerEvents="none",document.body.appendChild(t),window.getSelection().removeAllRanges();var r=document.createRange();r.selectNode(t),window.getSelection().addRange(r),document.execCommand("copy"),document.body.removeChild(t)}},783679:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(202784);function i(e){var t=(0,n.useRef)(null);return(0,n.useEffect)((function(){t.current=e})),t.current}},658092:function(e,t,r){r.d(t,{Z:function(){return i}});var n=Function.prototype.bind.call(Function.prototype.call,[].slice);function i(e,t){return n(e.querySelectorAll(t))}},12860:function(e,t,r){function n(e){throw new TypeError('"'+e+'" is read-only')}r.d(t,{Z:function(){return n}})}}]);