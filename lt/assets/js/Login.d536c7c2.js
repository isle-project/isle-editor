"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[74438],{603396:function(e,t,s){s.r(t);var a=s(202784),o=s(928316),n=s(789644),i=s.n(n),r=s(213980),l=s.n(r),h=s(690299),p=s.n(h),m=s(198),d=s(770561),c=s(26266),u=s(10863),w=s(830650),g=s(23836),f=s(875084),y=s(715318),v=s(435376),S=s(992500),E=s(862816),I=s(123103),Z=Object.defineProperty,C=(e,t,s)=>(((e,t,s)=>{t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const P=p()("isle:login");class b extends a.Component{constructor(e){super(e),C(this,"handleInputChange",(e=>{e.stopPropagation();const t=e.target,s=t.value,a=t.name;this.setState({[a]:s})})),C(this,"handleForgotPassword",(e=>{if(e.preventDefault(),""===this.state.email)this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.emailInput),invalidInputMessage:this.props.t("enter-email-before-password-reset")});else{this.context.forgotPassword(this.state.email)}})),C(this,"hideAfterDelay",(()=>{setTimeout((()=>{this.setState({showInputOverlay:!1})}),2e3)})),C(this,"handleKeyPress",(e=>{e.stopPropagation(),13===e.charCode&&this.handleSubmit(e)})),C(this,"handleSubmit",(e=>{e.preventDefault();const t={password:this.state.password,email:this.state.email};if(this.state.showTFA){t.token=this.state.token;return this.context.login(t,((e,t,s)=>{e||"ok"!==s.message||this.props.onClose()}))}if(""===t.email)P("Email input field is empty, show message..."),this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.emailInput),invalidInputMessage:this.props.t("enter-email")},this.hideAfterDelay);else if(""===t.password)P("Password input field is empty, show message..."),this.setState({showInputOverlay:!0,overlayTarget:o.findDOMNode(this.passwordInput),invalidInputMessage:this.props.t("enter-password")},this.hideAfterDelay);else{this.context.login(t,((e,t,s)=>{if(!e){const{message:e,type:t}=s;"ok"===e?this.props.onClose():"finish-login-via-tfa"===e?this.setState({showTFA:!0}):this.setState({showInputOverlay:!0,overlayTarget:"no_user"===t?this.emailInput:this.passwordInput,invalidInputMessage:e},this.hideAfterDelay)}}))}})),this.state={email:"",password:"",show:e.show,showTFA:!1,token:"",hasSSO:!1}}static getDerivedStateFromProps(e,t){return e.show!==t.show?{email:"",password:"",show:e.show,showTFA:!1}:null}componentDidMount(){const e=this.context;i().get(e.server+"/saml-xmw/login-type").then((t=>{"SSO"===t.data?window.location.assign(e.server+"/saml-xmw/login-choice?url=/"+e.namespaceName+"/"+e.lessonName):"Both"===t.data&&this.setState({hasSSO:!0})})).catch((e=>{P(e)}))}render(){const e=this.context;return a.createElement(y.Z,{show:this.props.show,className:"login-modal",onHide:this.props.onClose},a.createElement(y.Z.Header,{closeButton:!0},a.createElement(y.Z.Title,{as:"h3"},this.props.t("login"))),a.createElement(y.Z.Body,null,a.createElement(g.Z,{horizontal:!0,className:"d-grid gap-3"},a.createElement(u.Z,{controlId:"form-email"},a.createElement(w.Z,null,this.props.t("email")),a.createElement(c.Z,{name:"email",type:"email",placeholder:"Email",autoComplete:"username",onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,ref:e=>{this.emailInput=e},disabled:this.state.showTFA})),a.createElement(u.Z,{controlId:"form-password"},a.createElement(w.Z,null,this.props.t("password")),a.createElement(c.Z,{name:"password",type:"password",placeholder:"Password",autoComplete:"current-password",onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,ref:e=>{this.passwordInput=e},disabled:this.state.showTFA})),this.state.showTFA?a.createElement(u.Z,{controlId:"form-tfa"},a.createElement(w.Z,null,this.props.t("enter-tfa-token")),a.createElement(c.Z,{name:"token",type:"text",placeholder:this.props.t("enter-token"),onChange:this.handleInputChange,onKeyPress:this.handleKeyPress,autoFocus:!0})):null,a.createElement(d.Z,{variant:"primary",type:"submit",onClick:this.handleSubmit},this.props.t("signin")))),a.createElement(y.Z.Footer,null,a.createElement("button",{className:"forgot-password-button",onClick:this.handleForgotPassword},this.props.t("forgot-password")),this.state.hasSSO?a.createElement("a",{className:"sso-link",href:e.server+"/saml-xmw/login-choice?url=/"+e.namespaceName+"/"+e.lessonName},this.props.t("login-with-sso")):null,!1!==e.settings.allowUserRegistrations?a.createElement(d.Z,{onClick:this.props.onShowSignup,variant:"secondary"},this.props.t("create-account")):null),a.createElement(f.Z,{show:this.state.showInputOverlay,target:this.state.overlayTarget,placement:"right",containerPadding:20},a.createElement(v.Z,{id:"popover-contained"},a.createElement(S.Z,null,this.props.t("invalid")),a.createElement(E.Z,null,this.state.invalidInputMessage))))}}b.defaultProps={onClose(){},onShowSignup(){},show:!1},b.propTypes={onClose:l().func,onShowSignup:l().func,show:l().bool},b.contextType=I.Z,t.default=(0,m.Z)("internal/login")(b)}}]);