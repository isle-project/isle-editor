"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1534],{880441:function(e,t,r){r.r(t);var i=r(202784),s=r(690299),o=r.n(s),a=r(213980),c=r.n(a),d=r(198),n=r(423184),h=r(770561),l=r(380408),u=r(156562),p=r(477704),g=r.n(p),m=r(123103),f=r(741082),b=Object.defineProperty,y=(e,t,r)=>(((e,t,r)=>{t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const S=o()("isle:recorder"),w=document.createElement("script");w.src="https://www.webrtc-experiment.com/EBML.js",w.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(w);const v=e=>{const t=r.g.MediaRecorder;return"function"!=typeof t.isTypeSupported||t.isTypeSupported(e)};function C(e){const t=document.createElement("video");t.muted=!0,t.srcObject=e,t.style.display="none",(document.body||document.documentElement).appendChild(t)}class E extends i.Component{constructor(e){super(e),y(this,"hide",(()=>{this.setState({hidden:!0})})),y(this,"show",(()=>{this.setState({hidden:!1})})),y(this,"handleSourceChange",(e=>{this.audio&&(this.audio=null),this.camera&&(this.camera=null),this.screen&&(this.screen=null),this.recorder&&(this.recorder.destroy(),this.recorder=null),this.setState({selectedSources:e})})),y(this,"storeFile",(()=>{this.recorder.save("recoding.webm")})),y(this,"clearFile",(()=>{this.recorder.clearRecordedData(),this.setState({finished:!1})})),y(this,"uploadFile",(()=>{const e=this.context,{audio:t,camera:r,screen:s}=this.getActiveSources();let o;o=!t||r||s?this.recorderVideoConfig.mimeType:this.recorderAudioConfig.mimeType;const a=this.props.id;let c="recordedFile.webm";a&&(c=a+"_"+c),(0,p.getSeekableBlob)(this.recorder.getBlob(),(t=>{const r=new File([t],c,{type:o}),s=new FormData;s.append("file",r),e.uploadFile({formData:s,callback:(e,t)=>{if(e)return this.handleError(e.message);const r=this.context,s=t.filename,o=r.server+"/"+s;r.addNotification({title:this.props.t("recording-uploaded"),message:this.props.t("recording-uploaded-message"),level:"success",position:"tl",autoDismiss:0,children:i.createElement("span",null,i.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer"},this.props.t("open-link")))}),this.setState({uploaded:!0})}})}))})),y(this,"handleClick",(()=>{this.state.recording?this.stopRecording():this.startRecording()})),y(this,"getActiveSources",(()=>{const e={audio:!1,camera:!1,screen:!1};for(let t=0;t<this.state.selectedSources.length;t++)"audio"===this.state.selectedSources[t]?e.audio=!0:"camera"===this.state.selectedSources[t]?e.camera=!0:"screen"===this.state.selectedSources[t]&&(e.screen=!0);return e}));let t=[];e.audio&&t.push("audio"),e.screen&&t.push("screen"),e.camera&&t.push("camera"),this.state={recording:e.autostart,finished:!1,uploaded:!1,hidden:!1,selectedSources:t}}componentDidMount(){this.props.autostart&&this.startRecording()}componentWillUnmount(){this.props.screen&&this.screen&&this.screen.getVideoTracks().forEach((function(e){e.stop()})),this.props.audio&&this.audio&&this.audio.getAudioTracks().forEach((function(e){e.stop()}))}handleError(e){this.context.addNotification({title:this.props.t("encountered-error"),message:e,level:"error",position:"tr"}),this.setState({recording:!1,finished:!1})}captureScreen(e){r.g.navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"monitor",logicalSurface:!0,cursor:"always"}}).then(e).catch((e=>{const t=this.props.t("failed-to-capture-screen",{msg:e.message});this.handleError(t)}))}captureCamera(e,t){r.g.navigator.mediaDevices.getUserMedia({audio:t,video:!0}).then(e).catch((e=>{const t=this.props.t("failed-to-capture-camera",{msg:e.message});this.handleError(t)}))}captureAudio(e){r.g.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(e).catch((e=>{const t=this.props.t("failed-to-capture-microphone",{msg:e.message});this.handleError(t)}))}startRecording(){if(this.setState({recording:!0,finished:!1,uploaded:!1}),S("Start recording..."),this.recorder)try{this.recorder.startRecording()}catch(e){this.setupRecorder((e=>{this.recorder.startRecording()}))}else this.setupRecorder()}stopRecording(){this.setState({recording:!1,finished:!0}),this.recorder.stopRecording((()=>{(0,p.getSeekableBlob)(this.recorder.getBlob(),(e=>{this.player.src=URL.createObjectURL(e),this.player.muted=!1}))}))}setupRecorder(e=(()=>{})){S("Setting up the recorder...");const{audio:t,camera:r,screen:i}=this.getActiveSources();if(i||r?this.recorderVideoConfig=function({bitsPerSecond:e,screen:t}){const r={mimeType:"video/webm",type:"video",bitsPerSecond:e};return t||(r.recorderType=p.MediaStreamRecorder),r}({bitsPerSecond:this.props.bitsPerSecond,screen:i}):t&&(this.recorderAudioConfig=function({bitsPerSecond:e}){let t="audio/mpeg",r=p.MediaStreamRecorder;return!1===v(t)&&(S(t,"is not supported."),t="audio/ogg",!1===v(t)&&(S(t,"is not supported."),t="audio/webm",!1===v(t)&&(S(t,"is not supported."),t="audio/wav",r=p.StereoAudioRecorder))),{mimeType:t,recorderType:r,type:"audio",bitsPerSecond:e,numberOfAudioChannels:1}}({bitsPerSecond:this.props.bitsPerSecond})),r&&!i){if(this.camera)return this.recorder=g()(this.camera,this.recorderVideoConfig),this.recorder.startRecording(),e();this.captureCamera((t=>{t.width=window.screen.width,t.height=window.screen.height,t.fullcanvas=!0,this.camera=t,this.recorder=g()(t,this.recorderVideoConfig),this.recorder.startRecording(),e()}),t)}if(t&&!i&&!r){if(this.audio)return this.recorder=g()(this.audio,this.recorderAudioConfig),this.recorder.startRecording(),e();this.captureAudio((t=>{this.recorder=g()(t,this.recorderAudioConfig),this.recorder.startRecording(),this.audio=t,e()}))}if(i&&!r&&t){if(this.audio&&this.screen)return this.recorder=g()([this.screen,this.audio],this.recorderVideoConfig),this.recorder.startRecording(),e();this.captureScreen((t=>{C(t),this.captureAudio((r=>{C(r),t.width=window.screen.width,t.height=window.screen.height,t.fullcanvas=!0,this.screen=t,this.audio=r,this.recorder=g()([t,r],this.recorderVideoConfig),this.recorder.startRecording(),e()}))}))}if(i&&!r&&!t){if(this.screen)return this.recorder=g()(this.screen,this.recorderVideoConfig),this.recorder.startRecording(),e();this.captureScreen((t=>{t.width=window.screen.width,t.height=window.screen.height,t.fullcanvas=!0,this.screen=t,this.recorder=g()(t,this.recorderVideoConfig),this.recorder.startRecording(),e()}))}if(this.screen&&this.camera)return this.recorder=g()([this.camera,this.screen],this.recorderVideoConfig),this.recorder.startRecording(),e();i&&r&&this.captureCamera((t=>{C(t),this.captureScreen((r=>{C(r),r.width=window.screen.width,r.height=window.screen.height,r.fullcanvas=!0,this.camera=t,this.screen=r,this.recorder=g()([t,r],this.recorderVideoConfig),this.recorder.startRecording(),e()}))}),t)}renderAudioVideo(){const{audio:e,camera:t,screen:r}=this.getActiveSources();return!e||t||r?r||t?i.createElement("video",{width:"300px",height:"auto",style:{display:this.state.recording?"none":"block"},ref:e=>{this.player=e},controls:!0,autoPlay:!0}):void 0:i.createElement("audio",{style:{display:this.state.recording?"none":"block"},ref:e=>{this.player=e},controls:!0,autoPlay:!0})}render(){const e=this.state.recording?"red":"rgb(100,100,100)";if(this.state.hidden)return null;const t=this.props.style;return i.createElement("div",{className:"recorder-container unselectable",style:t},i.createElement("div",{className:"recorder-rec",style:{color:e}},this.state.recording?"":"REC"),this.state.selectedSources.length>0?i.createElement("div",{className:"recorder-button-container"},i.createElement("button",{"aria-label":this.props.t("toggle-recording"),className:"recorder-button",onClick:this.handleClick,style:{background:e}})):null,this.state.finished||this.state.recording?null:i.createElement(l.Z,{className:"recorder-buttongroup",size:"sm",type:"checkbox",value:this.state.selectedSources,onChange:this.handleSourceChange},i.createElement(u.Z,{id:"recorder-toggle-screen",variant:"light",className:"recorder-togglebutton",disabled:!this.props.screen||this.state.recording,value:"screen"},this.props.t("screen")),i.createElement(u.Z,{id:"recorder-toggle-camera",variant:"light",className:"recorder-togglebutton",disabled:!this.props.camera||this.state.recording,value:"camera"},this.props.t("cam")),i.createElement(u.Z,{id:"recorder-toggle-audio",variant:"light",className:"recorder-togglebutton",disabled:!this.props.audio||this.state.recording,value:"audio"},this.props.t("audio"))),this.state.finished?this.renderAudioVideo():null,i.createElement("div",{style:{background:"rgba(0, 80,255,0.5)"}},this.state.finished?i.createElement(n.Z,null,i.createElement(h.Z,{size:"sm",onClick:this.clearFile,variant:"warning"},this.props.t("clear-file")),this.props.downloadable?i.createElement(h.Z,{size:"sm",onClick:this.storeFile,variant:"primary"},this.props.t("download-file")):null,this.props.uploadable?i.createElement(h.Z,{size:"sm",onClick:this.uploadFile,disabled:this.state.uploaded,variant:"primary"},this.props.t("upload-file")):null):null))}}E.propTypes={audio:c().bool,camera:c().bool,screen:c().bool,autostart:c().bool,downloadable:c().bool,uploadable:c().bool,bitsPerSecond:c().number,style:c().object},E.defaultProps={audio:!1,autostart:!1,bitsPerSecond:128e4,camera:!1,downloadable:!1,screen:!1,uploadable:!1,style:{}},E.contextType=m.Z,t.default=(0,d.Z)("recorder")((0,f.W)(E))}}]);