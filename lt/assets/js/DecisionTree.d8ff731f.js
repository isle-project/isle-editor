"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[60061],{303428:function(e,t,n){n.d(t,{$F:function(){return i},PB:function(){return r}});function r(e){return`data-rr-ui-${e}`}function i(e){return`rrUi${e}`}},658092:function(e,t,n){n.d(t,{Z:function(){return i}});var r=Function.prototype.bind.call(Function.prototype.call,[].slice);function i(e,t){return r(e.querySelectorAll(t))}},18559:function(e,t,n){n.r(t);var r=n(202784),i=n(213980),o=n.n(i),s=n(498614),a=n(822736),c=n(770561),l=n(588703),u=n.n(l),h=n(287013),p=n.n(h),m=n(700601),d=n.n(m),f=n(112114),g=n(609207),y=n(741082),v=n(848285),b=n(55902),T=n(577662),x=Object.defineProperty,M=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,w=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,D=(e,t)=>{for(var n in t||(t={}))C.call(t,n)&&w(e,n,t[n]);if(M)for(var n of M(t))E.call(t,n)&&w(e,n,t[n]);return e};let I=0;function q(e,t,n,r,i){const o={};for(const a in n)d()(n,a)&&(o[a]=[]);const s=i?e=>!(0,b.Z)(e):T.Z;for(let a=0;a<n[e[0]].length;a++){let i=!1;for(let t=0;t<e.length;t++){const o=n[e[t]];if(p()(r,e[t])){if(!(0,b.Z)(o[a])){i=!0;break}}else{const e=o[a];if((0,T.Z)(e)){i=!0;break}}}const c=n[t][a];if(!i&&!s(c)){for(let t=0;t<e.length;t++){const r=n[e[t]];o[e[t]].push(r[a])}o[t].push(c)}}return o}const Z=({x:e,y:t,data:n,type:r,quantitative:i,impurityMeasure:o,scoreThreshold:s,maxTreeDepth:a,minItemsCount:c,omitMissing:l})=>{let h;h=u()(e)?e:[e];try{let e;return"Classification"===r?(l&&(n=q(h,t,n,i,!1)),e=new g.DV({response:t,predictors:h,data:n,quantitative:i,criterion:o,scoreThreshold:s,maxTreeDepth:a,minItemsCount:c})):(l&&(n=q(h,t,n,i,!0)),e=new g.tC({response:t,predictors:h,data:n,quantitative:i,scoreThreshold:s,maxTreeDepth:a,minItemsCount:c})),e}catch(p){return null}};class N extends r.Component{constructor(e){var t;super(e),w(this,"symbol"!=typeof(t="handlePredict")?t+"":t,(()=>{this.props.onPredict(this.state.tree,I)})),I+=1;const{x:n,y:r,data:i,type:o,quantitative:s,impurityMeasure:a,scoreThreshold:c,maxTreeDepth:l,minItemsCount:u,omitMissing:h}=e;this.state=D({tree:Z({x:n,y:r,data:i,type:o,quantitative:s,impurityMeasure:a,scoreThreshold:c,maxTreeDepth:l,minItemsCount:u,omitMissing:h})},e)}static getDerivedStateFromProps(e,t){if(e.y!==t.y||e.x!==t.x||e.type!==t.type||e.impurityMeasure!==t.impurityMeasure||e.data!==t.data||e.quantitative!==t.quantitative||e.scoreThreshold!==t.scoreThreshold||e.maxTreeDepth!==t.maxTreeDepth||e.minItemsCount!==t.minItemsCount||e.omitMissing!==t.omitMissing){const{x:t,y:n,data:r,type:i,quantitative:o,impurityMeasure:s,scoreThreshold:a,maxTreeDepth:c,minItemsCount:l,omitMissing:u}=e;return D({tree:Z({x:t,y:n,data:r,type:i,quantitative:o,impurityMeasure:s,scoreThreshold:a,maxTreeDepth:c,minItemsCount:l,omitMissing:u})},e)}return null}render(){const{tree:e}=this.state,{t:t}=this.props;return e?r.createElement("div",{style:{overflowX:"auto",width:"100%"}},r.createElement("span",{className:"title"},t("decision-tree-for",{y:this.props.y,counter:I})),r.createElement(g.fA,{tree:e.root}),this.props.onPredict?r.createElement(f.Z,{tooltip:t("predictions-attached")},r.createElement(c.Z,{variant:"secondary",size:"sm",style:{marginTop:10},onClick:this.handlePredict},this.props.t("use-model-to-predict"))):null):r.createElement(a.Z,{variant:"danger"},t("missing-attributes"))}}N.defaultProps={impurityMeasure:"gini",scoreThreshold:.0075,maxTreeDepth:5,minItemsCount:50,omitMissing:!0,onPredict:null},N.propTypes={data:o().object.isRequired,y:o().oneOfType([o().string,o().instanceOf(v.E)]).isRequired,x:o().oneOfType([o().arrayOf(o().oneOfType([o().string,o().instanceOf(v.E)])),o().string,o().instanceOf(v.E)]).isRequired,type:o().oneOf(["Classification","Regression"]).isRequired,quantitative:o().arrayOf(o().string).isRequired,impurityMeasure:o().oneOf(["gini","entropy"]),scoreThreshold:o().number,maxTreeDepth:o().number,minItemsCount:o().number,omitMissing:o().bool,onPredict:o().func},t.default=(0,s.Zh)("models")((0,y.W)(N))},609207:function(e,t,n){n.d(t,{DV:function(){return K},OI:function(){return _},tC:function(){return L},fA:function(){return G}});var r=n(240054),i=n.n(r),o=n(798030),s=n.n(o),a=n(686605),c=n.n(a),l=n(605977),u=n.n(l),h=n(202784),p=n(498614),m=n(34002),d=n(309765),f=n(844096),g=n.n(f),y=n(711768),v=n(394362),b=n(213980),T=n.n(b),x=n(770561),M=n(715318),C=n(112114),E=Object.defineProperty,w=(e,t,n)=>(((e,t,n)=>{t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class D extends h.Component{constructor(){super(),w(this,"toggleFullscreen",(()=>{this.setState({fullscreen:!this.state.fullscreen})})),this.state={fullscreen:!1}}render(){const{t:e}=this.props;return h.createElement(h.Fragment,null,h.createElement(C.Z,{id:"fullscreen_tooltip",placement:"bottom",tooltip:e("toggle-fullscreen")},h.createElement(x.Z,{variant:"outline-danger",size:"sm",onClick:this.toggleFullscreen,style:{position:"absolute",top:"10px",right:"32px"}},h.createElement("div",{className:"fa fa-window-maximize"}))),h.createElement(M.Z,{show:this.state.fullscreen,onHide:this.toggleFullscreen,dialogClassName:"modal-100w"},h.createElement(M.Z.Header,{closeButton:!0},h.createElement(M.Z.Title,{as:"h1"},e("decision-tree"))),h.createElement(M.Z.Body,{style:{height:.75*window.innerHeight,width:"100%",fontSize:32,overflow:"scroll"}},h.createElement("div",{className:"decision-tree decision-tree-fullscreen"},this.props.tree)),h.createElement(M.Z.Footer,null,h.createElement(x.Z,{onClick:this.toggleFullscreen},e("close")))))}}D.propTypes={tree:T().node.isRequired};var I=(0,p.Zh)("models")(D);const q=/^[+-]?[\d.]+e?[+-]?\d*$/;function Z(e,t){if(!e)return null;if(e.category){let n=e.category;return((0,d.isPrimitive)(n)||q.test(n))&&(n=Number(n),g()(n)||(n=n.toFixed(6))),h.createElement("ul",null,h.createElement("li",null,h.createElement("span",{className:"decision-tree-leaf"},t("predict"),": ",n," ")))}return h.createElement("ul",null,h.createElement("li",null,h.createElement("span",null,h.createElement("b",null," ",e.attribute," ",e.predicateName," ",e.pivot," ?")),h.createElement("ul",null,h.createElement("li",null,h.createElement("span",null,t("no")," ( ",e.notMatchedCount," ",t("obs"),") "),Z(e.notMatch,t)),h.createElement("li",null,h.createElement("span",null,t("yes")," ( ",e.matchedCount," ",t("obs"),") "),Z(e.match,t)))))}class N extends h.Component{constructor(e){super(e),this.state={plotValue:null,plotKey:null,fullscreen:!1}}componentDidMount(){this.tree&&(this.treeWrapper.scrollLeft=.4*this.tree.clientWidth,(0,m.hi)(this.tree,{backgroundColor:"white",style:{fontSize:22}}).then((e=>{const t=`<img src="${e}" style="display: block; margin: 0 auto; max-width: 100%; max-height: 100%" />`;this.setState({plotKey:`\x3c!--IMAGE_LOG:${(0,y.Z)(6)}_${(0,y.Z)(6)}--\x3e`,plotValue:t})})))}render(){const{t:e}=this.props,t=Z(this.props.tree,e);return h.createElement("div",{className:"decision-tree-wrapper",ref:e=>{this.treeWrapper=e}},h.createElement("button",{className:"decision-tree-draggable-bar",draggable:"true",onDragStart:e=>{e.dataTransfer.setData("text/html",this.state.plotValue),e.dataTransfer.setData("text/plain",this.state.plotKey)},onClick:()=>{(0,v.Z)(this.state.plotValue)},style:{float:"left"}},e("drag-plot")),h.createElement(I,{variant:"outline-danger",size:"sm",onClick:()=>{this.setState({fullscreen:!this.state.fullscreen})},tree:t},h.createElement("div",{className:"fa fa-times"})),h.createElement("div",{className:"decision-tree",ref:e=>{this.tree=e}},t))}}var O=(0,p.Zh)("models")(N);var k=function(e,t,n,r,i){const o=e[n],s=new Int32Array(t.length);let a=0;for(let c=t.length-1;c>=0;c--){const e=t[c];r(o[e],i)?(s[a]=e,a+=1):s[c+a]=e}return{match:new Int32Array(s.buffer,0,a),notMatch:new Int32Array(s.buffer,4*a,s.length-a)}};function P(e,t){const n={};for(let r=t.length-1;r>=0;r--){n[e[t[r]]]=0}for(let r=t.length-1;r>=0;r--){n[e[t[r]]]+=1}return n}function F(e,t){const n=P(e,t);let r,i=0;for(let o in n)n[o]>i&&(i=n[o],r=o);return r}function A(e,t){const n=P(e,t),r=t.length;let i=0;for(let o in n){const e=n[o]/r;i+=e*(1-e)}return i}function S(e,t){const n=P(e,t),r=t.length;let i=0;for(let o in n){const e=n[o]/r;i+=-e*s()(e)}return i}function R(e,t){const n=t.length;let r=0,i=0,o=0,s=0;if(!n)return null;if(n<2)return 0;for(let a=0;a<n;a++){const n=e[t[a]];s+=1,r=n-i,i+=r/s,o+=r*(n-i)}return o/(s-1)}function B(e,t){const n=t.length;if(!n)return null;let r=0;for(let i=0;i<n;i++){r+=(e[t[i]]-r)/(i+1)}return r}const z={"==":(e,t)=>e==t,">=":(e,t)=>e>=t};function $(e){const t=e.data[e.response].length;this.importances={};for(let n=0;n<e.predictors.length;n++)this.importances[e.predictors[n]]=0;this.root=j({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:u()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||c()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative,criterion:"gini"===e.criterion?A:S},this.importances),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=H(this.root,t,e);return r}return H(this.root,t,n)},this.type="classification",this.response=e.response}function j(e,t){const{data:n,predictors:r,indices:o,response:s,minItemsCount:a,scoreThreshold:c,maxTreeDepth:l,quantitative:u,criterion:h,minBucket:p,nTry:m}=e,d=o.length,f=n[s];if(0===l||d<=a)return{category:F(f,o)};const g=h(f,o),y=new Map,v=new Map;r.forEach((e=>{y.set(e,new Map),v.set(e,-1!==u.indexOf(e))}));let b={gain:0};m&&(r=i()(r,{size:m}));for(let i=d-1;i>=0;i--){const e=o[i];for(let t=0;t<r.length;t++){const i=r[t],s=n[i][e];let a,c;v.get(i)?(a=">=",c=Number(s>-1&&s<1?s.toPrecision(2):s.toFixed(2))):(a="==",c=s);const l=y.get(i);if(l.has(c))continue;l.set(c,!0);const u=z[a],m=k(n,o,i,u,c),T=h(f,m.match),x=h(f,m.notMatch);let M=0;M+=T*m.match.length,M+=x*m.notMatch.length,M/=d;const C=g-M;C>b.gain&&m.match.length>p&&m.notMatch.length>p&&(b=m,b.predicateName=a,b.predicate=u,b.attribute=i,b.pivot=c,b.gain=C)}}if(!b.gain||b.gain/g<c)return{category:F(f,o)};e.maxTreeDepth=l-1,t[b.attribute]+=b.gain,e.indices=b.match;const T=j(e,t);e.indices=b.notMatch;const x=j(e,t);return{attribute:b.attribute,predicate:b.predicate,predicateName:b.predicateName,pivot:b.pivot,match:T,notMatch:x,matchedCount:b.match.length,notMatchedCount:b.notMatch.length}}function V(e){const{data:t,predictors:n,indices:r,response:o,minItemsCount:s,scoreThreshold:a,maxTreeDepth:c,quantitative:l,minBucket:u,nTry:h}=e,p=r.length,m=t[o];if(0===c||p<=s)return{category:B(m,r)};const d=R(m,r),f=new Map,g=new Map;n.forEach((e=>{f.set(e,new Map),g.set(e,-1!==l.indexOf(e))}));let y={gain:0};h&&(n=i()(n,{size:h}));for(let i=p-1;i>=0;i--){const e=r[i];for(let i=0;i<n.length;i++){const o=n[i],s=t[o][e];let a,c;g.get(o)?(a=">=",c=Number(s>-1&&s<1?s.toPrecision(2):s.toFixed(2))):(a="==",c=s);const l=f.get(o);if(l.has(c))continue;l.set(c,!0);const h=z[a],v=k(t,r,o,h,c),b=R(m,v.match),T=R(m,v.notMatch);let x=0;x+=b*v.match.length,x+=T*v.notMatch.length,x/=p;const M=d-x;M>y.gain&&v.match.length>u&&v.notMatch.length>u&&(y=v,y.predicateName=a,y.predicate=h,y.attribute=o,y.pivot=c,y.gain=M)}}if(!y.gain||y.gain/d<a)return{category:B(m,r)};e.maxTreeDepth=c-1,e.indices=y.match;const v=V(e);e.indices=y.notMatch;const b=V(e);return{attribute:y.attribute,predicate:y.predicate,predicateName:y.predicateName,pivot:y.pivot,match:v,notMatch:b,matchedCount:y.match.length,notMatchedCount:y.notMatch.length}}function H(e,t,n){for(;;){if(e.category)return e.category;const r=t[e.attribute][n];e=(0,e.predicate)(r,e.pivot)?e.match:e.notMatch}}function W(e,t,n){const r={};for(let s=0;s<e.length;s++){const i=e[s].predict(t,n);r[i]=r[i]?r[i]+1:1}let i,o=-1;for(let s in r)r[s]>o&&(o=r[s],i=s);return i}const K=$,L=function(e){const t=e.data[e.response].length;this.root=V({data:e.data,response:e.response,predictors:e.predictors,indices:e.indices?e.indices:u()(0,t,1),minItemsCount:e.minItemsCount||50,minBucket:e.minBucket||c()((e.minItemsCount||50)/3),scoreThreshold:e.scoreThreshold||.01,maxTreeDepth:e.maxTreeDepth||20,quantitative:e.quantitative}),this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=Number(H(this.root,t,e));return r}return Number(H(this.root,t,n))},this.type="regression",this.response=e.response},_=function(e){this.trees=function(e){const t=[],n=e.data[e.response].length,r=u()(0,n,1);for(let s=0;s<e.nTrees;s++)t[s]=i()(r);const o=[];for(let i=0;i<e.nTrees;i++){e.indices=t[i];const n=new $(e);o.push(n)}return o}(e),this.importances={};for(let t=0;t<e.predictors.length;t++){const n=e.predictors[t];this.importances[n]=0;for(let e=0;e<this.trees.length;e++)this.importances[n]+=this.trees[e].importances[n];this.importances[n]/=this.trees.length}this.predict=(t,n)=>{if(void 0===n){const n=t[e.predictors[0]].length,r=new Array(n);for(let e=0;e<n;e++)r[e]=W(this.trees,t,e);return r}return W(this.trees,t,n)},this.type="classification",this.response=e.response},G=O},394362:function(e,t){t.Z=function(e){const t=document.createElement("div");t.innerHTML=e,t.style.position="fixed",t.style.opacity=0,t.style.pointerEvents="none",document.body.appendChild(t),window.getSelection().removeAllRanges();const n=document.createRange();n.selectNode(t),window.getSelection().addRange(n),document.execCommand("copy"),document.body.removeChild(t)}}}]);