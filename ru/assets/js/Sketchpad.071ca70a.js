(self.webpackChunk=self.webpackChunk||[]).push([[5050],{109168:function(e,t,n){"use strict";n.d(t,{xV:function(){return re},W4:function(){return he},sN:function(){return W}});var a=n(497326),o=n(894578),s=n(202784),i=n(213980),r=n.n(i),l=n(72779),c=n.n(l);function d(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return"function"==typeof e&&e.apply(void 0,n)}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var h="react-contextmenu",p="react-contextmenu--visible",g="react-contextmenu-wrapper",m="react-contextmenu-item",f="react-contextmenu-item--active",v="react-contextmenu-item--disabled",w="react-contextmenu-item--divider",y="react-contextmenu-item--selected",b="react-contextmenu-submenu",E={},P=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),S="REACT_CONTEXTMENU_SHOW",x="REACT_CONTEXTMENU_HIDE";function M(e,t,n){var a;void 0===n&&(n=window),"function"==typeof window.CustomEvent?a=new window.CustomEvent(e,{detail:t}):(a=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),n&&(n.dispatchEvent(a),Object.assign(E,t))}function k(e,t){void 0===e&&(e={}),M(S,Object.assign({},e,{type:S}),t)}function C(e,t){void 0===e&&(e={}),M(x,Object.assign({},e,{type:x}),t)}var D=Object.defineProperty,Z=function(e,t,n){return function(e,t,n){t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},I=new function(){var e=this;Z(this,"handleShowEvent",(function(t){for(var n in e.callbacks)u(e.callbacks,n)&&e.callbacks[n].show(t)})),Z(this,"handleHideEvent",(function(t){for(var n in e.callbacks)u(e.callbacks,n)&&e.callbacks[n].hide(t)})),Z(this,"register",(function(t,n){var a=Math.random().toString(36).substring(7);return e.callbacks[a]={show:t,hide:n},a})),Z(this,"unregister",(function(t){t&&e.callbacks[t]&&delete e.callbacks[t]})),this.callbacks={},P&&(window.addEventListener(S,this.handleShowEvent),window.addEventListener(x,this.handleHideEvent))},O=n(467177),T=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,H=function(e,t,n){return t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},B=function(e,t,n){return H(e,"symbol"!=typeof t?t+"":t,n),n},U=function(e){function t(){var t;return t=e.apply(this,arguments)||this,B((0,a.Z)(t),"handleClick",(function(e){0!==e.button&&1!==e.button&&e.preventDefault(),t.props.disabled||t.props.divider||(d(t.props.onClick,e,Object.assign({},t.props.data,E.data),E.target),t.props.preventClose||C())})),t}return(0,o.Z)(t,e),t.prototype.render=function(){var e,t,n,a=this,o=this.props,i=o.attributes,r=o.children,l=o.className,d=o.disabled,u=o.divider,h=o.selected,p=c()(l,m,i.className,((e={})[c()(v,i.disabledClassName)]=d,e[c()(w,i.dividerClassName)]=u,e[c()(y,i.selectedClassName)]=h,e));return s.createElement("div",(t=function(e,t){for(var n in t||(t={}))L.call(t,n)&&H(e,n,t[n]);if(N)for(var a,o=(0,O.Z)(N(t));!(a=o()).done;)n=a.value,F.call(t,n)&&H(e,n,t[n]);return e}({},i),n={className:p,role:"menuitem",tabIndex:"-1","aria-disabled":d?"true":"false",ref:function(e){a.ref=e},onMouseMove:this.props.onMouseMove,onMouseLeave:this.props.onMouseLeave,onTouchEnd:this.handleClick,onClick:this.handleClick},R(t,z(n))),u?null:r)},t}(s.Component);B(U,"propTypes",{attributes:r().object,children:r().node,className:r().string,data:r().object,disabled:r().bool,divider:r().bool,onClick:r().func,onMouseLeave:r().func,onMouseMove:r().func,preventClose:r().bool,selected:r().bool}),B(U,"defaultProps",{attributes:{},children:null,className:"",data:{},disabled:!1,divider:!1,onClick:function(){return null},onMouseMove:function(){return null},onMouseLeave:function(){return null},preventClose:!1,selected:!1});var W=U,A=Object.defineProperty,j=function(e,t,n){return function(e,t,n){t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Y=function(e){function t(t){var n;return n=e.call(this,t)||this,j((0,a.Z)(n),"handleKeyNavigation",(function(e){if(!1!==n.state.isVisible)switch(e.keyCode){case 37:case 27:e.preventDefault(),n.hideMenu(e);break;case 38:e.preventDefault(),n.selectChildren(!0);break;case 40:e.preventDefault(),n.selectChildren(!1);break;case 39:n.tryToOpenSubMenu(e);break;case 13:e.preventDefault(),n.tryToOpenSubMenu(e);var t=n.seletedItemRef&&n.seletedItemRef.props&&n.seletedItemRef.props.disabled;n.seletedItemRef&&n.seletedItemRef.ref instanceof HTMLElement&&!t?n.seletedItemRef.ref.click():n.hideMenu(e)}})),j((0,a.Z)(n),"handleForceClose",(function(){n.setState({forceSubMenuOpen:!1})})),j((0,a.Z)(n),"tryToOpenSubMenu",(function(e){n.state.selectedItem&&n.state.selectedItem.type===n.getSubMenuType()&&(e.preventDefault(),n.setState({forceSubMenuOpen:!0}))})),j((0,a.Z)(n),"selectChildren",(function(e){var t=n.state.selectedItem,a=[],o=0,i={};if(s.Children.forEach(n.props.children,(function e(t,r){t&&([W,n.getSubMenuType()].indexOf(t.type)<0?s.Children.forEach(t.props?t.props.children:[],e):t.props.divider||(t.props.disabled&&(++o,i[r]=!0),a.push(t)))})),o!==a.length){var r=function(t){var n=t;do{e?--n:++n,n<0?n=a.length-1:n>=a.length&&(n=0)}while(n!==t&&i[n]);return n===t?null:n}(a.indexOf(t));null!==r&&n.setState({selectedItem:a[r],forceSubMenuOpen:!1})}})),j((0,a.Z)(n),"onChildMouseMove",(function(e){n.state.selectedItem!==e&&n.setState({selectedItem:e,forceSubMenuOpen:!1})})),j((0,a.Z)(n),"onChildMouseLeave",(function(){n.setState({selectedItem:null,forceSubMenuOpen:!1})})),j((0,a.Z)(n),"renderChildren",(function(e){return s.Children.map(e,(function(e){var t={};return s.isValidElement(e)?[W,n.getSubMenuType()].indexOf(e.type)<0?(t.children=n.renderChildren(e.props?e.props.children:[]),s.cloneElement(e,t)):(t.onMouseLeave=n.onChildMouseLeave.bind((0,a.Z)(n)),e.type===n.getSubMenuType()&&(t.forceOpen=n.state.forceSubMenuOpen&&n.state.selectedItem===e,t.forceClose=n.handleForceClose,t.parentKeyNavigationHandler=n.handleKeyNavigation),e.props.divider||n.state.selectedItem!==e?(t.onMouseMove=function(){return n.onChildMouseMove(e)},s.cloneElement(e,t)):(t.selected=!0,t.ref=function(e){n.seletedItemRef=e},s.cloneElement(e,t))):e}))})),n.seletedItemRef=null,n.state={selectedItem:null,forceSubMenuOpen:!1},n}return(0,o.Z)(t,e),t}(s.Component);j(Y,"propTypes",{children:r().node.isRequired});var X=Y,K=Object.defineProperty,J=Object.defineProperties,V=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,_=function(e,t,n){return t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Q=function(e,t){for(var n in t||(t={}))G.call(t,n)&&_(e,n,t[n]);if(q)for(var a,o=(0,O.Z)(q(t));!(a=o()).done;){n=a.value;$.call(t,n)&&_(e,n,t[n])}return e},ee=function(e,t){return J(e,V(t))},te=function(e,t,n){return _(e,"symbol"!=typeof t?t+"":t,n),n},ne=function(e){function t(t){var n;return n=e.call(this,t)||this,te((0,a.Z)(n),"getMenuPosition",(function(){var e=window,t=e.innerWidth,a=e.innerHeight,o=n.subMenu.getBoundingClientRect(),s={};return o.bottom>a?s.bottom=0:s.top=0,o.right<t?s.left="100%":s.right="100%",s})),te((0,a.Z)(n),"getRTLMenuPosition",(function(){var e=window.innerHeight,t=n.subMenu.getBoundingClientRect(),a={};return t.bottom>e?a.bottom=0:a.top=0,t.left<0?a.left="100%":a.right="100%",a})),te((0,a.Z)(n),"hideMenu",(function(e){e.preventDefault(),n.hideSubMenu(e)})),te((0,a.Z)(n),"hideSubMenu",(function(e){e.detail&&e.detail.id&&n.menu&&e.detail.id!==n.menu.id||(n.props.forceOpen&&n.props.forceClose(),n.setState({visible:!1,selectedItem:null}),n.unregisterHandlers())})),te((0,a.Z)(n),"handleClick",(function(e){e.preventDefault(),n.props.disabled||(d(n.props.onClick,e,Object.assign({},n.props.data,E.data),E.target),n.props.onClick&&!n.props.preventCloseOnClick&&C())})),te((0,a.Z)(n),"handleMouseEnter",(function(){n.closetimer&&clearTimeout(n.closetimer),n.props.disabled||n.state.visible||(n.opentimer=setTimeout((function(){return n.setState({visible:!0,selectedItem:null})}),n.props.hoverDelay))})),te((0,a.Z)(n),"handleMouseLeave",(function(){n.opentimer&&clearTimeout(n.opentimer),n.state.visible&&(n.closetimer=setTimeout((function(){return n.setState({visible:!1,selectedItem:null})}),n.props.hoverDelay))})),te((0,a.Z)(n),"menuRef",(function(e){n.menu=e})),te((0,a.Z)(n),"subMenuRef",(function(e){n.subMenu=e})),te((0,a.Z)(n),"registerHandlers",(function(){document.removeEventListener("keydown",n.props.parentKeyNavigationHandler),document.addEventListener("keydown",n.handleKeyNavigation)})),te((0,a.Z)(n),"unregisterHandlers",(function(e){document.removeEventListener("keydown",n.handleKeyNavigation),e||document.addEventListener("keydown",n.props.parentKeyNavigationHandler)})),n.state=Object.assign({},n.state,{visible:!1}),n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.listenId=I.register((function(){}),this.hideSubMenu)},n.getSubMenuType=function(){return t},n.shouldComponentUpdate=function(e,t){return this.isVisibilityChange=!(this.state.visible===t.visible&&this.props.forceOpen===e.forceOpen||this.state.visible&&e.forceOpen||this.props.forceOpen&&t.visible),!0},n.componentDidUpdate=function(){var e=this;if(this.isVisibilityChange)if(this.props.forceOpen||this.state.visible){(window.requestAnimationFrame||setTimeout)((function(){var t=e.props.rtl?e.getRTLMenuPosition():e.getMenuPosition();e.subMenu.style.removeProperty("top"),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("left"),e.subMenu.style.removeProperty("right"),u(t,"top")&&(e.subMenu.style.top=t.top),u(t,"left")&&(e.subMenu.style.left=t.left),u(t,"bottom")&&(e.subMenu.style.bottom=t.bottom),u(t,"right")&&(e.subMenu.style.right=t.right),e.subMenu.classList.add(p),e.registerHandlers(),e.setState({selectedItem:null})}))}else{this.subMenu.addEventListener("transitionend",(function t(){e.subMenu.removeEventListener("transitionend",t),e.subMenu.style.removeProperty("bottom"),e.subMenu.style.removeProperty("right"),e.subMenu.style.top=0,e.subMenu.style.left="100%",e.unregisterHandlers()})),this.subMenu.classList.remove(p)}},n.componentWillUnmount=function(){this.listenId&&I.unregister(this.listenId),this.opentimer&&clearTimeout(this.opentimer),this.closetimer&&clearTimeout(this.closetimer),this.unregisterHandlers(!0)},n.render=function(){var e,t=this.props,n=t.children,a=t.attributes,o=t.disabled,i=t.title,r=t.selected,l=this.state.visible,d={ref:this.menuRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,className:c()(m,b,a.listClassName),style:{position:"relative"}},u={className:c()(m,a.className,(e={},e[c()(v,a.disabledClassName)]=o,e[c()(f,a.visibleClassName)]=l,e[c()(y,a.selectedClassName)]=r,e)),onMouseMove:this.props.onMouseMove,onMouseOut:this.props.onMouseOut,onClick:this.handleClick},p={ref:this.subMenuRef,style:{position:"absolute",transition:"opacity 1ms",top:0,left:"100%"},className:c()(h,this.props.className)};return s.createElement("nav",ee(Q({},d),{role:"menuitem",tabIndex:"-1","aria-haspopup":"true"}),s.createElement("div",Q(Q({},a),u),i),s.createElement("nav",ee(Q({},p),{role:"menu",tabIndex:"-1"}),this.renderChildren(n)))},t}(X);te(ne,"propTypes",{children:r().node.isRequired,attributes:r().object,title:r().node.isRequired,className:r().string,disabled:r().bool,hoverDelay:r().number,rtl:r().bool,selected:r().bool,onMouseMove:r().func,onMouseOut:r().func,forceOpen:r().bool,forceClose:r().func,parentKeyNavigationHandler:r().func}),te(ne,"defaultProps",{disabled:!1,hoverDelay:500,attributes:{},className:"",rtl:!1,selected:!1,onMouseMove:function(){return null},onMouseOut:function(){return null},forceOpen:!1,forceClose:function(){return null},parentKeyNavigationHandler:function(){return null}});var ae=ne,oe=Object.defineProperty,se=function(e,t,n){return function(e,t,n){t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},ie=function(e){function t(t){var n;return n=e.call(this,t)||this,se((0,a.Z)(n),"registerHandlers",(function(){document.addEventListener("mousedown",n.handleOutsideClick),document.addEventListener("touchstart",n.handleOutsideClick),n.props.preventHideOnScroll||document.addEventListener("scroll",n.handleHide),n.props.preventHideOnContextMenu||document.addEventListener("contextmenu",n.handleHide),document.addEventListener("keydown",n.handleKeyNavigation),n.props.preventHideOnResize||window.addEventListener("resize",n.handleHide)})),se((0,a.Z)(n),"unregisterHandlers",(function(){document.removeEventListener("mousedown",n.handleOutsideClick),document.removeEventListener("touchstart",n.handleOutsideClick),document.removeEventListener("scroll",n.handleHide),document.removeEventListener("contextmenu",n.handleHide),document.removeEventListener("keydown",n.handleKeyNavigation),window.removeEventListener("resize",n.handleHide)})),se((0,a.Z)(n),"handleShow",(function(e){if(e.detail.id===n.props.id&&!n.state.isVisible){var t=e.detail.position,a=t.x,o=t.y;n.setState({isVisible:!0,x:a,y:o}),n.registerHandlers(),d(n.props.onShow,e)}})),se((0,a.Z)(n),"handleHide",(function(e){!n.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==n.props.id||(n.unregisterHandlers(),n.setState({isVisible:!1,selectedItem:null,forceSubMenuOpen:!1}),d(n.props.onHide,e))})),se((0,a.Z)(n),"handleOutsideClick",(function(e){n.menu.contains(e.target)||C()})),se((0,a.Z)(n),"handleMouseLeave",(function(e){e.preventDefault(),d(n.props.onMouseLeave,e,Object.assign({},n.props.data,E.data),E.target),n.props.hideOnLeave&&C()})),se((0,a.Z)(n),"handleContextMenu",(function(e){e.preventDefault(),n.handleHide(e)})),se((0,a.Z)(n),"hideMenu",(function(e){27!==e.keyCode&&13!==e.keyCode||C()})),se((0,a.Z)(n),"getMenuPosition",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var a={top:t,left:e};if(!n.menu)return a;var o=window,s=o.innerWidth,i=o.innerHeight,r=n.menu.getBoundingClientRect();return t+r.height>i&&(a.top-=r.height),e+r.width>s&&(a.left-=r.width),a.top<0&&(a.top=r.height<i?(i-r.height)/2:0),a.left<0&&(a.left=r.width<s?(s-r.width)/2:0),a})),se((0,a.Z)(n),"getRTLMenuPosition",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var a={top:t,left:e};if(!n.menu)return a;var o=window,s=o.innerWidth,i=o.innerHeight,r=n.menu.getBoundingClientRect();return a.left=e-r.width,t+r.height>i&&(a.top-=r.height),a.left<0&&(a.left+=r.width),a.top<0&&(a.top=r.height<i?(i-r.height)/2:0),a.left+r.width>s&&(a.left=r.width<s?(s-r.width)/2:0),a})),se((0,a.Z)(n),"menuRef",(function(e){n.menu=e})),n.state=Object.assign({},n.state,{x:0,y:0,isVisible:!1}),n}(0,o.Z)(t,e);var n=t.prototype;return n.getSubMenuType=function(){return ae},n.componentDidMount=function(){this.listenId=I.register(this.handleShow,this.handleHide)},n.componentDidUpdate=function(){var e=this,t=window.requestAnimationFrame||setTimeout;this.state.isVisible?t((function(){var n=e.state,a=n.x,o=n.y,s=e.props.rtl?e.getRTLMenuPosition(a,o):e.getMenuPosition(a,o),i=s.top,r=s.left;t((function(){e.menu&&(e.menu.style.top=i+"px",e.menu.style.left=r+"px",e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))})):t((function(){e.menu&&(e.menu.style.opacity=0,e.menu.style.pointerEvents="none")}))},n.componentWillUnmount=function(){this.listenId&&I.unregister(this.listenId),this.unregisterHandlers()},n.render=function(){var e,t=this.props,n=t.children,a=t.className,o=t.style,i=this.state.isVisible,r=Object.assign({},o,{position:"fixed",opacity:0,pointerEvents:"none"}),l=c()(h,a,((e={})[p]=i,e));return s.createElement("nav",{role:"menu",tabIndex:"-1",ref:this.menuRef,style:r,className:l,onContextMenu:this.handleContextMenu,onMouseLeave:this.handleMouseLeave},this.renderChildren(n))},t}(X);se(ie,"propTypes",{id:r().string.isRequired,children:r().node.isRequired,data:r().object,className:r().string,hideOnLeave:r().bool,rtl:r().bool,onHide:r().func,onMouseLeave:r().func,onShow:r().func,preventHideOnContextMenu:r().bool,preventHideOnResize:r().bool,preventHideOnScroll:r().bool,style:r().object}),se(ie,"defaultProps",{className:"",data:{},hideOnLeave:!1,rtl:!1,onHide:function(){return null},onMouseLeave:function(){return null},onShow:function(){return null},preventHideOnContextMenu:!1,preventHideOnResize:!1,preventHideOnScroll:!1,style:{}});var re=ie,le=Object.defineProperty,ce=function(e,t,n){return function(e,t,n){t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},de=["input","textarea"],ue=function(e){function t(){var t;return t=e.apply(this,arguments)||this,ce((0,a.Z)(t),"touchHandled",!1),ce((0,a.Z)(t),"handleMouseDown",(function(e){t.props.holdToDisplay>=0&&0===e.button&&(e.persist(),e.stopPropagation(),t.mouseDownTimeoutId=setTimeout((function(){return t.handleContextClick(e)}),t.props.holdToDisplay)),d(t.props.attributes.onMouseDown,e)})),ce((0,a.Z)(t),"handleMouseUp",(function(e){0===e.button&&clearTimeout(t.mouseDownTimeoutId),d(t.props.attributes.onMouseUp,e)})),ce((0,a.Z)(t),"handleMouseOut",(function(e){0===e.button&&clearTimeout(t.mouseDownTimeoutId),d(t.props.attributes.onMouseOut,e)})),ce((0,a.Z)(t),"handleTouchstart",(function(e){t.touchHandled=!1,t.props.holdToDisplay>=0&&(e.persist(),e.stopPropagation(),t.touchstartTimeoutId=setTimeout((function(){t.handleContextClick(e),t.touchHandled=!0}),t.props.holdToDisplay)),d(t.props.attributes.onTouchStart,e)})),ce((0,a.Z)(t),"handleTouchEnd",(function(e){t.touchHandled&&e.preventDefault(),clearTimeout(t.touchstartTimeoutId),d(t.props.attributes.onTouchEnd,e)})),ce((0,a.Z)(t),"handleContextMenu",(function(e){e.button===t.props.mouseButton&&t.handleContextClick(e),d(t.props.attributes.onContextMenu,e)})),ce((0,a.Z)(t),"handleMouseClick",(function(e){e.button===t.props.mouseButton?t.handleContextClick(e):t.props.holdToDisplay>0&&C(),d(t.props.attributes.onClick,e)})),ce((0,a.Z)(t),"handleContextClick",(function(e){if(!(t.props.disable||t.props.disableIfShiftIsPressed&&e.shiftKey)){var n=document.activeElement;if(!(n&&(-1!==de.indexOf(n.tagName.toLowerCase())||n.isContentEditable))&&"CANVAS"!==n.tagName){e.preventDefault(),e.stopPropagation();var a=e.clientX||e.touches&&e.touches[0].pageX,o=e.clientY||e.touches&&e.touches[0].pageY;t.props.posX&&(a-=t.props.posX),t.props.posY&&(o-=t.props.posY),C();var s=d(t.props.collect,t.props),i={position:{x:a,y:o},target:t.elem,id:t.props.id};s&&"function"==typeof s.then?s.then((function(t){i.data=Object.assign({},t,{target:e.target}),k(i)})):(i.data=Object.assign({},s,{target:e.target}),k(i))}}})),ce((0,a.Z)(t),"elemRef",(function(e){t.elem=e})),t}return(0,o.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.renderTag,n=e.attributes,a=e.children,o=Object.assign({},n,{className:c()(g,n.className),onContextMenu:this.handleContextMenu,onClick:this.handleMouseClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onTouchStart:this.handleTouchstart,onTouchEnd:this.handleTouchEnd,onMouseOut:this.handleMouseOut,ref:this.elemRef});return s.createElement(t,o,a)},t}(s.Component);ue.propTypes={id:r().string.isRequired,children:r().node.isRequired,attributes:r().object,collect:r().func,disable:r().bool,holdToDisplay:r().number,posX:r().number,posY:r().number,renderTag:r().elementType,mouseButton:r().number,disableIfShiftIsPressed:r().bool},ue.defaultProps={attributes:{},collect:function(){return null},disable:!1,holdToDisplay:1e3,renderTag:"div",posX:0,posY:0,mouseButton:2,disableIfShiftIsPressed:!1};var he=ue;Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable},280441:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return bt}});var a=n(497326),o=n(894578),s=n(467177),i=n(202784),r=n(213980),l=n.n(r),c=n(198),d=n(912895),u=n.n(d),h=n(690299),p=n.n(h),g=n(366441),m=n.n(g),f=n(780594),v=n.n(f),w=n(109168),y=n(260952),b=n(109361),E=n(435376),P=n(175891),S=n(203858),x=n(423184),M=n(770561),k=n(81982),C=n(931776),D=n(891719),Z=n.n(D),I=n(561647),O=n.n(I),T=n(413262),R=n(708579),z=n(269891),N=n(309765),L=n(588703),F=n.n(L),H=n(287013),B=n.n(H),U=n(830324),W=n.n(U),A=n(409961),j=n.n(A),Y=n(686605),X=n.n(Y),K=n(32593),J=n.n(K),V=n(557106),q=n.n(V),G=n(783158),$=n.n(G),_=n(695688),Q=n.n(_),ee=n(306830),te=n.n(ee),ne=n(635314),ae=n.n(ne),oe=n(437069),se=n.n(oe),ie=n(302467),re=n.n(ie),le=n(24551),ce=n(675252),de=n(652501),ue=n(189263),he=n(476709),pe=n(884968),ge=n(923723),me=n(344843),fe=n.n(me),ve=n(38226),we=n.n(ve);var ye=function(e,t,n){void 0===e&&(e=32),void 0===t&&(t=48),void 0===n&&(n=126);for(var a=new Array(e),o=0;o<e;o++)a[o]=we()(t,n);return fe().apply(null,a)},be=n(267682),Ee=JSON.parse('[{"command":"nextPage","trigger":"next","description":"Go to next page"},{"command":"prevPage","trigger":"previous","description":"Go to the previous next page"},{"command":"firstPage","trigger":["first","First"],"description":"Jump to the first page"},{"command":"lastPage","trigger":"last","description":"Jump to the last page"}]'),Pe=p()("isle:sketchpad:curve");var Se=function(e,t,n,a,o,s,i){if(Pe("Received points: "+t.length),void 0===t||t.length<2)return new Float32Array(0);var r;o="number"==typeof o?o:.9,s="number"==typeof s?s:30;var l=1,c=t.length,d=0,u=new Float32Array((c-2)*s+2+(i?2*s:0)),h=new Float32Array(s+2<<2),p=4;t=t.slice(0);for(var g=0;g<t.length;g+=2)t[g]=t[g]*n,t[g+1]=t[g+1]*a;for(r=t.slice(0),i?(r.unshift(t[c-1]),r.unshift(t[c-2]),r.push(t[0],t[1])):(r.unshift(t[1]),r.unshift(t[0]),r.push(t[c-2],t[c-1])),h[0]=1;l<s;l++){var m=l/s,f=m*m,v=f*m,w=2*v,y=3*f;h[p++]=w-y+1,h[p++]=y-w,h[p++]=v-2*f+m,h[p++]=v-f}function b(e,t,n,a){for(var o,i=2;i<n;i+=2){var r=e[i],l=e[i+1],c=e[i+2],h=e[i+3],p=(c-e[i-2])*a,g=(h-e[i-1])*a,m=(e[i+4]-r)*a,f=(e[i+5]-l)*a,v=0;for(o=0;o<s;o++){var w=t[v++],y=t[v++],b=t[v++],E=t[v++];u[d++]=w*r+y*c+b*p+E*m,u[d++]=w*l+y*h+b*g+E*f}}}for(h[++p]=1,b(r,h,c,o),i&&((r=[]).push(t[c-4],t[c-3],t[c-2],t[c-1],t[0],t[1],t[2],t[3]),b(r,h,4,o)),c=i?0:t.length-2,u[d++]=t[c++],u[d]=t[c],l=0,c=u.length;l<c;l+=2){var E=(u[l]+u[l+2])/2,P=(u[l+1]+u[l+3])/2;e.lineTo(u[l],u[l+1],E,P)}return e.lineTo(u[l],u[l+1],u[l+2],u[l+3]),u},xe=function(e){var t=e.tooltip,n=e.onClick,a=e.glyph,o=e.label,s=e.disabled,r=e.size,l=e.variant,c=void 0===l?"light":l;return i.createElement(R.Z,{placement:"bottom",tooltip:t},i.createElement(M.Z,{variant:c,size:r,onClick:n,disabled:s,"aria-label":t},a?i.createElement("div",{className:"fa fa-"+a}):null,o))},Me=n(65420),ke=n(226010),Ce=n(155061),De=Object.defineProperty,Ze=function(e,t,n){return function(e,t,n){t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Ie=["#000000","#FF6900","#FCB900","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#9900EF"],Oe=[4,5,6,7,8,9,10,11,12,14,18,20,22,24,30,36,42],Te=[8,9,10,11,12,14,18,24,30,36,48,60,72],Re=function(e){function t(t){var n;return n=e.call(this,t)||this,Ze((0,a.Z)(n),"toggleColorPicker",(function(){n.setState({showColorPicker:!n.state.showColorPicker})})),Ze((0,a.Z)(n),"toggleDrawingMode",(function(){n.props.onModeChange("drawing"===n.props.mode?"none":"drawing")})),Ze((0,a.Z)(n),"toggleDragMode",(function(){n.props.onModeChange("drag"===n.props.mode?"none":"drag")})),Ze((0,a.Z)(n),"toggleDeleteMode",(function(){n.props.onModeChange("delete"===n.props.mode?"none":"delete")})),Ze((0,a.Z)(n),"togglePointerMode",(function(){n.props.onModeChange("pointer"===n.props.mode?"none":"pointer")})),Ze((0,a.Z)(n),"toggleZoomMode",(function(){n.props.onModeChange("zoom"===n.props.mode?"none":"zoom")})),Ze((0,a.Z)(n),"toggleTextMode",(function(){n.props.onModeChange("text"===n.props.mode?"none":"text")})),Ze((0,a.Z)(n),"handleColorChange",(function(e){n.props.onColorChange(e.hex),n.setState({showColorPicker:!n.state.showColorPicker})})),n.state={showColorPicker:!1},n}return(0,o.Z)(t,e),t.prototype.render=function(){var e=this.props.t;return i.createElement(i.Fragment,null,i.createElement(x.Z,{size:"sm",className:"sketch-drag-delete-modes sketch-button-group"},i.createElement(xe,{tooltip:e("drag-mode"),size:"sm",variant:"drag"===this.props.mode?"success":"secondary",onClick:this.toggleDragMode,glyph:"arrows-alt"}),i.createElement(xe,{tooltip:e("delete-mode"),size:"sm",variant:"delete"===this.props.mode?"success":"secondary",onClick:this.toggleDeleteMode,glyph:"times"}),i.createElement(xe,{tooltip:e("magnifying-glass"),size:"sm",variant:"zoom"===this.props.mode?"success":"secondary",onClick:this.toggleZoomMode,glyph:"search-plus"}),i.createElement(xe,{tooltip:e("pointer-mode"),size:"sm",variant:"pointer"===this.props.mode?"success":"secondary",onClick:this.togglePointerMode,glyph:"circle"})),i.createElement(x.Z,{size:"sm",className:"sketch-drawing-buttons"},i.createElement(xe,{tooltip:e("drawing-mode"),glyph:"paint-brush",size:"sm",variant:"drawing"===this.props.mode?"success":"secondary",onClick:this.toggleDrawingMode}),i.createElement(ke.Z,{id:"sketch-brush-size-dropdown",size:"sm",variant:"light",title:this.props.brushSize,onSelect:this.props.onBrushSelect},Oe.map((function(e,t){return i.createElement(Ce.Z,{key:t,eventKey:e},e)})))),i.createElement(x.Z,{size:"sm"},i.createElement(R.Z,{placement:"right",tooltip:e("change-brush-color")},i.createElement(M.Z,{size:"sm",onClick:this.toggleColorPicker,style:{background:this.props.color,color:"white"}},"Col"))),i.createElement(x.Z,{size:"sm",className:"sketch-text-buttons"},i.createElement(xe,{size:"sm",variant:"text"===this.props.mode?"success":"secondary",onClick:this.toggleTextMode,tooltip:e("text-mode"),glyph:"font"}),i.createElement(ke.Z,{id:"sketch-font-dropdown",size:"sm",variant:"text"===this.props.mode?"success":"secondary",title:this.props.fontFamily,onSelect:this.props.onFontFamilySelect},i.createElement(Ce.Z,{eventKey:"Arial"},"Arial"),i.createElement(Ce.Z,{eventKey:"Helvetica"},"Helvetica"),i.createElement(Ce.Z,{eventKey:"Times"},"Times"),i.createElement(Ce.Z,{eventKey:"Courier"},"Courier"),i.createElement(Ce.Z,{eventKey:"Verdana"},"Verdana"),i.createElement(Ce.Z,{eventKey:"Palatino"},"Palatino")),i.createElement(ke.Z,{id:"sketch-font-size-dropdown",size:"sm",variant:"light",title:this.props.fontSize,onSelect:this.props.onFontSizeSelect},Te.map((function(e,t){return i.createElement(Ce.Z,{key:t,eventKey:e},e)})))),i.createElement("div",{className:"sketch-colorpicker",style:{display:this.state.showColorPicker?"initial":"none"}},i.createElement(Me.Z,{color:this.props.color,colors:Ie,onChangeComplete:this.handleColorChange,triangle:"top-right"})))},t}(i.Component);Re.propTypes={brushSize:l().number.isRequired,color:l().string.isRequired,fontFamily:l().string.isRequired,fontSize:l().number.isRequired,mode:l().string.isRequired,onBrushSelect:l().func.isRequired,onColorChange:l().func.isRequired,onFontFamilySelect:l().func.isRequired,onFontSizeSelect:l().func.isRequired,onModeChange:l().func.isRequired};var ze=Re,Ne=p()("isle:sketchpad:harmonize-sketchpad-elements");var Le=function(e,t,n,a){void 0===n&&(n=[]),void 0===a&&(a=[]),n=n.map((function(e){return e.page})),a=a.map((function(e){return e.page}));for(var o=0;o<n.length;o++){var s=n[o];a.includes(s)||(Ne("Removing elements from page "+s),e.splice(s,1),t.splice(s,1))}for(var i=0;i<a.length;i++){var r=a[i];n.includes(r)||(Ne("Adding an empty page at position "+r),e.splice(r,0,[]),t.splice(r,0,0))}},Fe=n(525263),He=n(238904),Be=n(289973),Ue=n(907756),We=n(382617),Ae=n(10206),je=n(338664),Ye=Object.defineProperty,Xe=function(e,t,n){return function(e,t,n){t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=typeof t?t+"":t,n),n},Ke=p()("isle:lesson:sketchpad-contextmenu"),Je=function(e){function t(){var t;return t=e.apply(this,arguments)||this,Xe((0,a.Z)(t),"copyToClipboard",(function(){var e;if(Ke("Copying page to clipboard... "),t.props.canvas){var n=t.props.canvas.toDataURL();e='<img alt="Sketchpad Page" src="'+n+'" />',document.addEventListener("copy",a),document.execCommand("copy"),document.removeEventListener("copy",a)}function a(t){t.clipboardData.setData("text/html ",e),t.clipboardData.setData("text/plain ",e),t.preventDefault()}})),t}return(0,o.Z)(t,e),t.prototype.render=function(){return i.createElement(w.xV,{id:"sketchpadWindow"},i.createElement(w.sN,{onClick:this.copyToClipboard},this.props.t("copy")))},t}(i.Component);Je.propTypes={canvas:l().object},Je.defaultProps={canvas:null};var Ve=(0,c.Z)("sketchpad")(Je),qe=JSON.parse('[{"target":".sketch-drawing-buttons","content":"In the drawing mode, you can draw lines on the sketchpad. Try it out. Also try changing the brush size and brush color."},{"target":".sketch-pages","content":"Use the + button to insert a new page and the other buttons for navigation."},{"target":".sketch-text-buttons","content":"In the text mode, you can insert text annotations. Click on a point on the sketchpad to create a note and insert it by hitting ENTER."},{"target":".sketch-drag-delete-modes","content":"The drag and delete modes allow you to move around and delete created elements, respectively. Once either mode is selected, simply click on an element on the page to drag or delete it. The laser pointer and magnifying glass may be used to highlight and zoom in on parts of the current slide."},{"target":".sketch-undo-redo","content":"The undo button allows you to revert the last additions you made to the slides, while the redo button can redraw elements which were previously undone."},{"target":".sketch-save-buttons","content":"You can either export the current page as an image file or all pages as a PDF document. Alternatively, your notes can also be uploaded directly to the ISLE server by clicking the button to the right. Once the upload is finished, make sure to save the displayed link to the uploaded file."},{"target":".sketch-save-buttons","content":"Your notes are autosaved in the cloud and will be accessible when opening the lesson again in the future. However, to make sure the latest changes are saved, you are advised to click the \\"Save in browser\\" button before closing the page."}]'),Ge=Object.defineProperty,$e=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,et=function(e,t,n){return t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},tt=function(e,t){for(var n in t||(t={}))_e.call(t,n)&&et(e,n,t[n]);if($e)for(var a,o=(0,s.Z)($e(t));!(a=o()).done;){n=a.value;Qe.call(t,n)&&et(e,n,t[n])}return e},nt=function(e,t,n){return et(e,"symbol"!=typeof t?t+"":t,n),n},at=n(932976),ot=(0,Fe.Z)((function(){return n.e(3512).then(n.bind(n,229171))})),st=(0,Fe.Z)((function(){return n.e(1217).then(n.bind(n,930884))})),it=(0,Fe.Z)((function(){return n.e(3471).then(n.bind(n,343559))})),rt=(0,Fe.Z)((function(){return n.e(4553).then(n.bind(n,405728))})),lt=(0,Fe.Z)((function(){return n.e(2087).then(n.bind(n,497828))})),ct=p()("isle:sketchpad"),dt=(0,le.Z)("sketchpad"),ut=["isExporting","showColorPicker","showUploadModal","showNavigationModal","showResetModal","showFeedbackModal","showSaveModal","hideInputButtons","hideNavigationButtons","hideSaveButtons","hideTransmitButtons"],ht=/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&//=]*))/g,pt=/([a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,})/gi,gt=window.devicePixelRatio||1;function mt(e){e.preventDefault()}function ft(e,t){for(var n=!1,a=0;a<t.length;a++){t[a].page===e&&(n=!0)}return n}function vt(e){e.setLineDash([2,15]),e.lineWidth=2,e.strokeStyle="orange",e.lineCap="round",e.lineJoin="round",e.shadowBlur=0}at&&at.GlobalWorkerOptions&&(at.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js");var wt=function(e){ct("Rendering overlays...");for(var t=se()(e.nodes),n=[],a=e.toOriginalPage(e.currentPage),o=0;o<t.length;o++){var s=e.nodes[t[o]],r="invisible-page";t[o]===String(a+1)&&(r="sketch-node-container"),W()(s)&&s.component?s.style?(t[o]===String(a+1)&&(r="sketch-node-container-basic"),n.push(i.createElement("div",{key:o,style:s.style,className:r,onKeyDown:Ue.Z},s.component))):n.push(i.createElement("div",{key:o,className:r,onKeyDown:Ue.Z},s.component)):n.push(i.createElement("div",{key:o,className:r,onKeyDown:Ue.Z},s))}return i.createElement("div",{className:"sketchpad-overlays"},n)},yt=function(e){function t(t,n){var o;o=e.call(this,t)||this,nt((0,a.Z)(o),"handleHashChange",(function(){var e=o.readURL();e>0&&o.gotoPage(e)})),nt((0,a.Z)(o),"handleResize",(function(){o.setState({canvasHeight:window.innerHeight-o.state.verticalOffset,canvasWidth:window.innerWidth-40},(function(){o.debouncedRedraw()}))})),nt((0,a.Z)(o),"retrieveData",(function(e){if(ct("Retrieved data from previous session..."),W()(e)){if(F()(e.elements))for(var t=0;t<e.elements.length;t++)o.elements[t]=e.elements[t];if(F()(e.nUndos))for(var n=0;n<e.nUndos.length;n++)o.nUndos[n]=e.nUndos[n];if(F()(e.sharedElements)){for(var a=0;a<e.sharedElements.length;a++)o.sharedElements[a]=e.sharedElements[a];o.context.anonymous&&Le(o.elements,o.nUndos,o.state.insertedPages,e.state.insertedPages)}else o.sharedElements=new Array(e.elements.length).fill([]);for(var s=0;s<e.state.insertedPages.length;s++){var i=e.state.insertedPages[s].page;o.backgrounds.splice(i,0,null)}var r=Be.Z?0:o.readURL();ct("Go to page "+r),e.state.currentPage=r,e.state.noPages=o.backgrounds.length,e.state=ae()(e.state,ut),e.state.hasRetrievedData=!0,o.setState(e.state,(function(){o.debouncedRedraw()}))}else o.setState({hasRetrievedData:!0},(function(){o.debouncedRedraw()}))})),nt((0,a.Z)(o),"toggleGroupMode",(function(){o.setState({groupMode:!o.state.groupMode})})),nt((0,a.Z)(o),"hidePointer",(function(){var e={id:o.id,type:We.Ty,value:!0,noSave:!0};o.context.log(e,"members"),o.pointer.style.opacity=0})),nt((0,a.Z)(o),"hideZoom",(function(){var e={id:o.id,type:We.FK,value:!0,noSave:!0};o.context.log(e,"members"),o.zoom.style.display="none"})),nt((0,a.Z)(o),"preventDefaultTouch",(function(e){e.target!==o.canvas&&e.target!==o.textLayer&&e.target!==o.canvasWrapper||e.preventDefault()})),nt((0,a.Z)(o),"handleVisibilityChange",(function(){document.hidden||o.debouncedRedraw()})),nt((0,a.Z)(o),"renderBackground",(function(e){o.renderingTask&&o.renderingTask.cancel();var t=o.canvas,n=o.ctx,a=o.backgrounds[e];if(a){var s;ct("Found background for page "+e+"...");var i=a.getViewport({scale:1}),r=o.state.fill||(i.width>i.height?"vertical":"horizontal");s="vertical"===r?o.state.canvasHeight/i.height:o.state.canvasWidth/i.width;for(var l=a.getViewport({scale:s}),c=o.textLayer;c.firstChild;)c.removeChild(c.firstChild);"vertical"===r?(o.canvas.height=l.height*gt,o.canvas.width=l.width*gt,o.canvas.style.left=(o.state.canvasWidth-l.width)/2+"px",o.canvas.style["border-style"]="solid",o.canvas.style["border-color"]="black",o.canvas.style["border-width"]="0px 1px 0px 1px",o.canvas.style.width=l.width+"px",o.canvas.style.height=l.height+"px",c.style.width=l.width+"px",c.style.height=l.height+"px",o.leftMargin=(o.state.canvasWidth-l.width)/2,c.style.left=o.leftMargin+"px"):(o.canvas.height=l.height*gt,o.canvas.width=(l.width-15)*gt,o.canvas.style.left="0px",o.canvas.style.border="none",o.canvas.style.height=l.height+"px",o.canvas.style.width=l.width-15+"px",c.style.width=l.width-15+"px",c.style.height=l.height+"px",o.leftMargin=0,c.style.left="0px");var d=Q()(o.canvas.width*o.canvas.width+o.canvas.height*o.canvas.height);o.scaleRatio=d/(1768*gt),o.ctx.setTransform(gt,0,0,gt,0,0);var u={canvasContext:o.ctx,viewport:l};return a.getTextContent().then((function(e){at.renderTextLayer({textContent:e,container:c,viewport:l,textDivs:[]}).promise.then((function(){var e=c.innerHTML,t=re()(e,ht,'<a href="$1">$1</a>');t=re()(t,pt,'<a href="mailto:$1">$1</a>'),c.innerHTML=t}))})),o.renderingTask=a.render(u),o.renderingTask.promise.then((function(){o.backgroundData=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height),ct("Background rendered for page "+e)})).catch((function(e){ct("Encountered error in `renderBackground`: "+e.message)}))}return o.backgroundData=null,n&&(o.props.pdf||n.setTransform(gt,0,0,gt,0,0),n.clearRect(0,0,t.width,t.height)),Promise.resolve()})),nt((0,a.Z)(o),"redraw",(function(){var e=o.state.currentPage;ct("Redrawing page "+(e+1));var t=o.nUndos[e];o.renderBackground(e).then((function(){var n=o.sharedElements[e];if(o.state.showInstructorAnnotations){ct("Rendering "+n.length+" shared elements on page "+e+"...");for(var a=0;a<n.length;a++)o.drawElement(n[a])}n=o.elements[e],ct("Rendering "+n.length+" own elements on page "+e+"...");for(var s=0;s<n.length-t;s++)o.drawElement(n[s]);o.renderingTask=null})).catch((function(e){o.renderingTask=null}))})),nt((0,a.Z)(o),"onlyRedrawElements",(function(){o.backgroundData?o.ctx.putImageData(o.backgroundData,0,0):o.ctx.clearRect(0,0,o.canvas.width,o.canvas.height);var e=o.state.currentPage,t=o.sharedElements[e];if(o.state.showInstructorAnnotations){ct("Rendering "+t.length+" shared elements on page "+e+"...");for(var n=0;n<t.length;n++)o.drawElement(t[n])}t=o.elements[e],ct("Rendering "+t.length+" own elements on page "+e+"...");for(var a=o.nUndos[e],s=0;s<t.length-a;s++)o.drawElement(t[s])})),nt((0,a.Z)(o),"redrawWhenDragging",(function(){if(!o.canvasBuffer){o.canvasBuffer=document.createElement("canvas"),o.canvasBuffer.width=o.canvas.width,o.canvasBuffer.height=o.canvas.height,ct("Prepare data for non-dragged elements..."),o.backgroundData?o.ctx.putImageData(o.backgroundData,0,0):(o.ctx.fillStyle="white",o.ctx.fillRect(0,0,o.canvas.width,o.canvas.height));var e=o.state.currentPage,t=o.sharedElements[e];if(o.state.showInstructorAnnotations){ct("Rendering "+t.length+" shared elements on page "+e+"...");for(var n=0;n<t.length;n++)o.drawElement(t[n])}t=o.elements[e],ct("Rendering "+t.length+" own elements on page "+e+"...");for(var a=o.nUndos[e],s=0;s<t.length-a;s++)o.selectedElements&&B()(o.selectedElements,t[s])||o.drawElement(t[s]);var i=o.canvasBuffer.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(o.canvas,0,0,o.canvas.width/gt,o.canvas.height/gt)}o.ctx.drawImage(o.canvasBuffer,0,0);var r=o.selectedElements;if(r)for(var l=0;l<r.length;l++)o.drawElement(r[l]);var c=o.ctx;if(c.beginPath(),vt(c),o.dragPoints)for(var d=0;d<o.dragPoints.length;d+=2){var u=o.dragPoints[d],h=o.dragPoints[d+1];o.ctx.lineTo(u,h)}c.stroke(),c.closePath(),c.setLineDash([])})),nt((0,a.Z)(o),"drawPage",(function(e){var t=o.ctx,n=o.canvas;t&&t.clearRect(0,0,n.width,n.height),o.renderBackground(e);var a=o.sharedElements[e];if(o.state.showInstructorAnnotations)for(var s=0;s<a.length;s++)o.drawElement(a[s]);a=o.elements[e];for(var i=o.nUndos[e],r=0;r<a.length-i;r++)o.drawElement(a[r])})),nt((0,a.Z)(o),"mousePosition",(function(e){var t=e.clientX,n=e.clientY;e.touches&&e.touches.length>0&&(t=e.touches[0].clientX,n=e.touches[0].clientY);var a=o.canvas.getBoundingClientRect();return{x:t-a.left,y:n-a.top}})),nt((0,a.Z)(o),"clearPage",(function(e){if(ft(e,o.state.insertedPages)){ct("Clear an inserted page; deleting it completely..."),o.elements.splice(e,1),o.backgrounds.splice(e,1),o.nUndos.splice(e,1),o.sharedElements.splice(e,1);for(var t=[],n=0;n<o.state.insertedPages.length;n++){var a=o.state.insertedPages[n];e!==a.page&&(a.page>e&&(a.page-=1),t.push(a))}ct("New inserted pages are: "+t.join(", ")),o.setState({noPages:o.state.noPages-1,insertedPages:t,selectedPage:o.state.selectedPage-1},(function(){o.debouncedRedraw()}))}else o.elements[e]=[],o.debouncedRedraw()})),nt((0,a.Z)(o),"clear",(function(){var e=o.state.currentPage;o.clearPage(e);var t=o.context,n={id:o.id,type:We.wi,value:JSON.stringify({page:e,sessionID:t.sessionID})};o.hasChangedSinceLastSave=!0,t.isOwner()&&o.state.transmitOwner?t.log(n,"members"):t.log(n,"owners")})),nt((0,a.Z)(o),"clearAll",(function(e){void 0===e&&(e=!1);var t=o.context,n=o.canvas,a=o.ctx;if(a&&a.clearRect(0,0,n.width,n.height),t.store.removeItem(o.id+"_sketchpad"),o.props.pdf)o.initializePDF().then((function(){o.debouncedRedraw(),o.setState({insertedPages:[]})}));else{var s=o.props.noPages;o.elements=new Array(s),o.backgrounds=new Array(s),o.sharedElements=new Array(s),o.nUndos=new Array(s);for(var i=0;i<s;i++)o.elements[i]=[],o.sharedElements[i]=[],o.backgrounds[i]=null,o.nUndos[i]=0;o.setState({currentPage:0,noPages:s,insertedPages:[]})}var r={id:o.id,type:We.Wp,value:t.sessionID};e||(o.hasChangedSinceLastSave=!0,t.isOwner()&&o.state.transmitOwner?t.log(r,"members"):t.log(r,"owners"))})),nt((0,a.Z)(o),"undo",(function(){var e=o.state.currentPage,t=o.elements[e],n=o.sharedElements[e],a=o.nUndos[e],s=o.ctx,i=o.canvas;s&&s.clearRect(0,0,i.width,i.height),o.renderBackground(e).then((function(){a+=1;for(var s=-1,i=t.length-1,r=i;r>=0;r--){if((s+=1)===a){i=r;break}0===r&&(a=s+1,i=null)}if(ct("Current number of undos: "+a),o.nUndos[e]=a,o.hasChangedSinceLastSave=!0,!j()(i)){ct("UNDO: Redrawing elements 0 to "+i+" out of "+t.length+" elements");for(var l=0;l<=i;l++)o.drawElement(t[l])}for(var c=0;c<n.length;c++)o.drawElement(n[c])}))})),nt((0,a.Z)(o),"redo",(function(){var e=o.state.currentPage,t=o.elements[e],n=o.sharedElements[e],a=o.nUndos[e];if(a>0){var s=$()(t.length-a,0);if(ct("Line index: "+s),s>=0){var i=-1,r=t.length-1;a-=1;for(var l=r;l>=0;l--)if((i+=1)===a){r=l;break}ct("REDO: Redrawing elements "+s+" to "+r+" out of "+t.length+" elements");for(var c=s;c<=r;c++)o.drawElement(t[c]);o.nUndos[e]=a;for(var d=0;d<n.length;d++)o.drawElement(n[d]);o.hasChangedSinceLastSave=!0}}})),nt((0,a.Z)(o),"drawElement",(function(e){e&&("line"===e.type?o.drawLine(e):"text"===e.type?o.drawText(e):"curve"===e.type&&o.drawCurve(e))})),nt((0,a.Z)(o),"drawLine",(function(e){var t=e.startX,n=e.startY,a=e.endX,s=e.endY,i=e.color,r=e.lineWidth,l=e.selected,c=o.ctx;c&&(c.lineWidth=r*o.scaleRatio,c.lineCap="round",c.lineJoin="round",c.shadowBlur=1.5*c.lineWidth,c.strokeStyle=l?"orange":i,c.beginPath(),c.moveTo(t,n),c.lineTo(a,s),c.stroke(),c.closePath())})),nt((0,a.Z)(o),"drawCurve",(function(e){var t=e.points,n=e.color,a=e.lineWidth,s=e.selected,i=o.ctx;i&&(i.lineWidth=a*o.scaleRatio,i.lineCap="round",i.lineJoin="round",s?(i.strokeStyle="orange",i.beginPath(),Se(i,t,o.canvas.width/gt,o.canvas.height/gt,.9,1),i.stroke(),i.closePath()):(i.shadowColor="rgba(128, 128, 128, 0.2)",i.shadowBlur=2*i.lineWidth,i.strokeStyle=n,i.beginPath(),Se(i,t,o.canvas.width/gt,o.canvas.height/gt),i.stroke(),i.closePath()))})),nt((0,a.Z)(o),"drawStart",(function(e){if(e.stopPropagation(),ct("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1)return o.swipeStartX=e.touches[0].screenX,void(o.swipeStartY=e.touches[0].screenY);var t=o.mousePosition(e),n=t.x,a=t.y;if(o.currentPoints=[],o.x=n,o.y=a,o.isMouseDown=!0,o.imageData=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height),"drawing"===o.state.mode){var s=o.state.currentPage,i=o.nUndos[s];if(i>0){var r=o.elements[s];r.splice(r.length-i),ct("Page "+s+" now has "+r.length+" elements"),o.nUndos[s]=0,o.hasChangedSinceLastSave=!0}o.draw(e)}else if("drag"===o.state.mode){var l=o.ctx;l.isPointInPath(n*gt,a*gt)||(o.deselectElements(),o.onlyRedrawElements()),l.beginPath(),o.draw(e)}else Z()&&o.handleClick(e)})),nt((0,a.Z)(o),"drawEnd",(function(e){if(e.stopPropagation(),J()(o.swipeEndX-o.swipeStartX)>45&&J()(o.swipeEndY-o.swipeStartY)<40)return o.swipeEndX>o.swipeStartX?o.previousPage():o.nextPage(),o.swipeEndX=0,o.swipeEndY=0,o.swipeStartX=0,o.swipeStartY=0,void(o.isMouseDown=!1);if("drawing"===o.state.mode&&o.isMouseDown){var t=o.elements[o.state.currentPage],n=o.context,a=n.user.email||n.anonymousIdentifier,s=o.currentPoints,i=o.canvas,r=i.width,l=i.height;s[0]/=r/gt,s[1]/=l/gt;for(var c=2;c<s.length-2;c+=2){var d=(s[c]+s[c+2])/2,u=(s[c+1]+s[c+3])/2;s[c]=d/(r/gt),s[c+1]=u/(l/gt)}s[s.length-2]/=r/gt,s[s.length-1]/=l/gt;var h={points:s,color:o.state.color,lineWidth:o.state.brushSize*(1+o.force)*.5,page:o.state.currentPage,time:o.time,type:"curve",drawID:ye(6),user:a};t.push(h),o.props.onChange(t),o.ctx.putImageData(o.imageData,0,0),o.drawCurve(h);var p={id:o.id,type:We.D$,value:JSON.stringify(h),noSave:!0};o.hasChangedSinceLastSave=!0,o.state.groupMode||n.isOwner()&&o.state.transmitOwner?n.log(p,"members"):n.log(p,"owners"),o.currentPoints=[]}else if("drag"===o.state.mode&&o.isMouseDown){if(o.ctx.stroke(),o.ctx.closePath(),o.ctx.setLineDash([]),!o.selectedElements){ct("Select elements...");var g=o.elements[o.state.currentPage],m=o.nUndos[o.state.currentPage];o.selectedElements=null;for(var f=[],v=0;v<g.length-m;v++){var w=g[v];w.selected=!1;var y=w.points;if(y)for(var b=0,E=y.length;b<E;b+=2){var P=y[b]*o.canvas.width,S=y[b+1]*o.canvas.height;if(o.ctx.isPointInPath(P,S)){w.selected=!0,f.push(w);break}}else w.x&&w.y&&o.ctx.isPointInPath(w.x*o.canvas.width,w.y*o.canvas.height)&&(w.selected=!0,f.push(w))}f.length>0&&(o.selectedElements=f,o.dragPoints=o.currentPoints)}o.redrawWhenDragging()}o.isMouseDown=!1})),nt((0,a.Z)(o),"draw",(function(e){if(e.stopPropagation(),o.state.swiping&&e.touches&&e.touches.length>1){o.swipeEndX=e.touches[0].screenX,o.swipeEndY=e.touches[0].screenY,o.isMouseDown=!1;var t=o.swipeEndY-o.swipeStartY;o.verticalScroll(t)}else{var n=o.context,a=o.mousePosition(e),s=a.x,i=a.y;if("drag"===o.state.mode&&o.selectedElements&&o.isMouseDown){ct("Drag elements around...");for(var r=(s-o.x)/(o.canvas.width/gt),l=(i-o.y)/(o.canvas.height/gt),c=o.selectedElements,d=0;d<c.length;d++){var u=c[d];if("curve"===u.type)for(var h=u.points,p=0;p<h.length;p++)h[p]+=p%2==0?r:l;else"text"===u.type&&(u.x+=r,u.y+=l)}for(var g=0;g<o.dragPoints.length;g+=2)o.dragPoints[g]+=s-o.x,o.dragPoints[g+1]+=i-o.y;var m=n.user.email||n.anonymousIdentifier,f={id:o.id,type:We.bW,value:JSON.stringify({dx:r,dy:l,page:o.state.currentPage,drawIDs:c.map((function(e){return e.drawID})),user:m,sessionID:n.sessionID}),noSave:!0};return o.hasChangedSinceLastSave=!0,n.isOwner()||o.state.groupMode?n.log(f,"members"):n.log(f),o.x=s,o.y=i,o.redrawWhenDragging()}if(o.isMouseDown&&!o.props.disabled){if("delete"===o.state.mode)return ct("Check whether to delete element..."),o.checkDeletion(e);if(o.currentPoints.push(s),o.currentPoints.push(i),"drawing"===o.state.mode){var v={color:o.state.color,lineWidth:o.state.brushSize*(1+o.force)*.5,startX:o.x,startY:o.y,endX:s,endY:i,shadow:0,type:"line"};o.drawElement(v)}else"drag"!==o.state.mode||o.selectedElements||(vt(o.ctx),o.ctx.lineTo(s,i),o.ctx.stroke());o.x=s,o.y=i}}})),nt((0,a.Z)(o),"toggleTransmit",(function(){o.setState({transmitOwner:!o.state.transmitOwner})})),nt((0,a.Z)(o),"uploadSketches",(function(){o.setState({isExporting:!0},(function(){o.preparePDF((function(e,t){var n=o.context;t.getBase64((function(e){ct("Processing base64 string of PDF document");var t=new FormData,a=o.id+".pdf",s=(0,de.Z)(e,"application/pdf"),r=new File([s],a,{type:"application/pdf"});t.append("file",r);n.uploadFile({formData:t,callback:function(e,t){if(e)o.setState({isExporting:!1,showUploadModal:!0,modalMessage:e.message});else{var a=t.filename,s=n.server+"/"+a;o.setState({isExporting:!1,showUploadModal:!0,modalMessage:i.createElement("span",null,o.props.t("upload-successful"),": ",i.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},s))});var r={text:o.props.t("upload-email",{name:n.user.name})+'<a href="'+s+'">'+s+"</a>.",subject:o.props.t("pdf-uploaded")};n.sendMail(r,n.user.email)}}})}))}))}))})),nt((0,a.Z)(o),"saveAsPNG",(function(){var e=o.state.currentPage,t=o.id+"_"+(e+1)+".png",n=o.canvas;o.backgrounds[e]||(o.ctx.fillStyle="white",o.ctx.fillRect(0,0,n.width,n.height)),n.toBlob((function(e){(0,ce.Z)(e,t)}))})),nt((0,a.Z)(o),"preparePDF",(function(e){void 0===e&&(e=te()),ct("Assembling PDF document object...");var t={content:[],pageSize:{width:o.canvas.width,height:o.canvas.height},pageMargins:[0,0,0,0]},n=0;!function a(){ct("Creating page "+(n+1)),o.renderBackground(n).then((function(){var s=o.sharedElements[n];if(s&&s.length>0)for(var i=0;i<s.length;i++)o.drawElement(s[i]);s=o.elements[n];var r=o.nUndos[n];if(s&&s.length>0){var l=s.length-r;ct("Rendering "+s.length+" elements on page "+n+"...");for(var c=0;c<l;c++)o.drawElement(s[c])}var d=o.canvas.toDataURL();if(t.content.push({image:d,width:o.canvas.width}),!((n+=1)<o.state.noPages))return ct("Creating PDF..."),e(null,u().createPdf(t));a()}))}()})),nt((0,a.Z)(o),"toggleSaveModal",(function(){o.setState({showSaveModal:!o.state.showSaveModal})})),nt((0,a.Z)(o),"saveAsPDF",(function(){o.setState({isExporting:!0},(function(){o.preparePDF((function(e,t){var n=o.id;t.download(n+".pdf",(function(){o.setState({isExporting:!1}),o.debouncedRedraw()}))}))}))})),nt((0,a.Z)(o),"insertPage",(function(e,t){"text"===o.state.mode&&o.insertTextFromInput(),o.elements.splice(e,0,[]),o.backgrounds.splice(e,0,null),o.sharedElements.splice(e,0,0),o.nUndos.splice(e,0,0);for(var n=document.querySelector(".textLayer");n.firstChild;)n.removeChild(n.firstChild);var a=o.context,s=o.state.insertedPages;s.push({page:e,email:t||a.user.email}),o.setState({noPages:o.state.noPages+1,currentPage:e,insertedPages:s},(function(){o.updateURL(o.state.currentPage),o.debouncedRedraw(),t||(o.hasChangedSinceLastSave=!0,a.log({id:o.id,type:We.bM,value:JSON.stringify({pos:e})},a.isOwner()?"members":a.user.email))}))})),nt((0,a.Z)(o),"insertTextFromInput",(function(){var e=parseInt(o.textInput.style.left,10)-o.leftMargin,t=parseInt(o.textInput.style.top,10)-1.2*o.state.fontSize,n=o.textInput.value;o.textInput.value="",o.textInput.style.top=String(parseInt(o.textInput.style.top,10)+1.2*o.state.fontSize)+"px";var a=o.context,s=a.user.email||a.anonymousIdentifier,i=o.state.currentPage,r={value:n,x:e/(o.canvas.width/gt),y:t/(o.canvas.height/gt),color:o.state.color,fontSize:o.state.fontSize,fontFamily:o.state.fontFamily,time:o.time,type:"text",page:i,user:s,drawID:ye(6)};o.drawText(r);var l=o.elements[i],c=o.nUndos[i];c>0&&(l.splice(l.length-c),ct("Page "+i+" now has "+l.length+" elements"),o.nUndos[i]=0),r.shouldLog=!1,l.push(r),o.props.onChange(l)})),nt((0,a.Z)(o),"handleEnter",(function(e){ct("Check if user hit ENTER..."),13===e.keyCode&&o.insertTextFromInput()})),nt((0,a.Z)(o),"drawText",(function(e){var t=e.x,n=e.y,a=e.value,s=e.color,i=e.drawID,r=e.user,l=e.fontSize,c=e.fontFamily,d=e.selected,u=e.shouldLog,h=void 0===u||u,p=o.ctx;p.font=l+"px "+c,p.shadowBlur=0,p.fillStyle=d?"orange":s;var g=X()(t*(o.canvas.width/gt)),m=X()(n*(o.canvas.height/gt))+l;ct("Draw text at x: "+g+" and y: "+m),p.fillText(a,g,m);var f=o.context;if(h){var v={id:o.id,type:We.nO,value:JSON.stringify({x:t,y:n,value:a,color:s,fontSize:l,fontFamily:c,page:o.state.currentPage,drawID:i,user:r,type:"text"})};o.hasChangedSinceLastSave=!0,f.isOwner()||o.state.groupMode?f.log(v,"members"):f.log(v)}})),nt((0,a.Z)(o),"handleClick",(function(e){if(ct("Handle click event..."),"text"===o.state.mode){var t=o.mousePosition(e),n=t.x,a=t.y,s=o.textInput;s.style.left=String(n+o.leftMargin)+"px",s.style.width=String(window.innerWidth-(n+o.leftMargin))+"px",s.style.top=a+"px";var i=q()(o.state.canvasWidth-n,60);ct("Resize to width "+i+"..."),s.style.width=i+"px",s.focus()}else"deletion"===o.state.mode&&(ct("Checking whether a shape has been selected..."),o.checkDeletion(e))})),nt((0,a.Z)(o),"checkDeletion",(function(e){for(var t=o.mousePosition(e),n=t.x,a=t.y,s=o.elements[o.state.currentPage],i=o.nUndos[o.state.currentPage],r=null,l=0;l<s.length-i;l++){var c=s[l];if("curve"===c.type){var d=c.points;if(o.ctx.beginPath(),o.ctx.lineCap="round",o.ctx.lineWidth=q()(c.lineWidth,16),Se(o.ctx,d,o.canvas.width/gt,o.canvas.height/gt,.9,1),o.ctx.closePath(),o.ctx.isPointInStroke(n*gt,a*gt)){ct("Point ("+n+", "+a+") is in path of element with ID "+c.drawID),r=l;break}}else if("text"===c.type){var u=o.ctx.measureText(c.value).width,h=X()(c.x*(o.canvas.width/gt)),p=X()(c.y*(o.canvas.height/gt));if(h<=n&&n<=h+u&&p<=a&&a<=p+c.fontSize){r=l;break}}}if(!j()(r)){var g=s[r].drawID;o.deleteElement(g,r);var m=o.context,f=m.user.email||m.anonymousIdentifier,v={id:o.id,type:We.jd,value:JSON.stringify({drawID:g,page:o.state.currentPage,user:f,sessionID:m.sessionID})};o.hasChangedSinceLastSave=!0,m.isOwner()&&o.state.transmitOwner||o.state.groupMode?m.log(v,"members"):m.log(v,"owners")}})),nt((0,a.Z)(o),"deleteElement",(function(e,t){for(var n,a,s=o.elements[o.state.currentPage],i="delete"===o.state.mode,r=o.nUndos[o.state.currentPage],l=t;l<s.length-r&&s[l].drawID===e;l++)a=l,s[l].selected=!i;for(var c=t;c>=0&&s[c].drawID===e;c--)n=c,s[c].selected=!i;if(i){ct("Delete elements "+n+" to "+a);var d=s.splice(n,a-n+1);s.splice.apply(s,[s.length-r,0].concat(d)),o.nUndos[o.state.currentPage]=r+d.length,o.onlyRedrawElements()}})),nt((0,a.Z)(o),"firstPage",(function(){0!==o.state.currentPage&&(o.canvasWrapper.scrollTop=0,o.selectedElements&&o.deselectElements(),o.setState({currentPage:0},(function(){o.updateURL(o.state.currentPage),o.debouncedRedraw(),o.context.log({id:o.id,type:We.QS,value:o.state.currentPage})})))})),nt((0,a.Z)(o),"lastPage",(function(){o.state.currentPage!==o.state.noPages-1&&(o.canvasWrapper.scrollTop=0,o.selectedElements&&o.deselectElements(),o.setState({currentPage:o.state.noPages-1},(function(){o.updateURL(o.state.currentPage),o.debouncedRedraw(),o.context.log({id:o.id,type:We.$M,value:o.state.currentPage})})))})),nt((0,a.Z)(o),"readURL",(function(){var e=window.location.hash,t=encodeURI(o.id),n=new RegExp(t+"=(\\d+)"),a=e.match(n);return a?q()(Number(a[1])-1,0):0})),nt((0,a.Z)(o),"updateURL",(function(e){var t=String(window.location.hash);if(!Be.Z){var n=encodeURI(o.id);if(t)if(t.includes(n)){var a=new RegExp("("+n+")=\\d+");window.location.hash=re()(t,a,"$1="+(e+1))}else window.location.hash+="&"+n+"="+(e+1);else window.location.hash="#/?"+n+"="+(e+1)}})),nt((0,a.Z)(o),"nextPage",(function(){if(o.state.currentPage<o.state.noPages-1){ct("Should go to next page..."),o.canvasWrapper.scrollTop=0;var e=o.state.currentPage+1;o.selectedElements&&o.deselectElements(),o.props.nodes[o.state.currentPage]&&(0,He.Z)(o.canvasWrapper),"text"===o.state.mode&&o.insertTextFromInput(),o.setState({currentPage:e},(function(){o.updateURL(o.state.currentPage),o.debouncedRedraw(),o.context.log({id:o.id,type:We.tn,value:o.state.currentPage})}))}})),nt((0,a.Z)(o),"previousPage",(function(){if(o.state.currentPage>0){o.canvasWrapper.scrollTop=0;var e=o.state.currentPage-1;o.selectedElements&&o.deselectElements(),o.props.nodes[o.state.currentPage]&&(0,He.Z)(o.canvasWrapper),"text"===o.state.mode&&o.insertTextFromInput(),o.setState({currentPage:e},(function(){o.updateURL(o.state.currentPage),o.debouncedRedraw(),o.context.log({id:o.id,type:We.YF,value:o.state.currentPage})}))}})),nt((0,a.Z)(o),"gotoPage",(function(e,t){void 0===t&&(t=!0),ct("Should go to page "+e+"..."),(e=parseInt(e,10))!==o.state.currentPage?(o.canvasWrapper&&(o.canvasWrapper.scrollTop=0),o.selectedElements&&o.deselectElements(),o.props.nodes[o.state.currentPage]&&(0,He.Z)(o.canvasWrapper),"text"===o.state.mode&&o.insertTextFromInput(),o.setState({currentPage:e,showNavigationModal:!1},(function(){(o.updateURL(o.state.currentPage),o.debouncedRedraw(),t)&&o.context.log({id:o.id,type:We.Db,value:e})}))):o.setState({showNavigationModal:!1})})),nt((0,a.Z)(o),"loadPDF",(function(){var e=document.createElement("input");e.type="file",e.accept=".pdf",e.addEventListener("change",o.handlePDFUpload,!1),e.click()})),nt((0,a.Z)(o),"handlePDFUpload",(function(e){var t=o.context,n=e.target.files,a=new FormData;a.append("file",n[0]),t.uploadFile({formData:a,callback:function(e,n){var a=n.filename,s=t.server+"/"+a;t.updateMetadata("store",o.id,s),o.initializePDF()}})})),nt((0,a.Z)(o),"initializePDF",(function(){ct("Initialize PDF document at "+o.props.pdf+"...");var e=o.context;return new Promise((function(t,n){var a=e.metadata.store[o.id];at.getDocument({url:o.props.pdf||a,disableFontFace:!1}).promise.then((function(e){ct("Retrieved PDF document... "),o.processPDF(e,(function(e){e?(ct("Encountered error in 'processPDF': "+e.message),n(e)):t()}))})).catch((function(e){ct("Encountered an error in 'initializePDF': "+e.message)}))}))})),nt((0,a.Z)(o),"processPDF",(function(e,t){void 0===t&&(t=te()),ct("PDF loaded...");for(var n=e.numPages,a=new Array(n),s=new Array(n),i=new Array(n),r=new Array(n),l=0;l<n;l++)a[l]=[],s[l]=e.getPage(l+1),i[l]=[],r[l]=0;return Promise.all(s).then((function(e){ct("Retrieved all pages..."),o.backgrounds=e,o.elements=a,o.sharedElements=i,o.nUndos=r,o.setState({currentPage:Be.Z?0:o.readURL(),noPages:n},(function(){o.state.hasRetrievedData&&o.drawPage(o.state.currentPage)})),t(null)})).catch((function(e){ct(e),t(e)}))})),nt((0,a.Z)(o),"save",(function(){if(!o.hasChangedSinceLastSave)return new Promise((function(e){e()}));var e=o.context,t=ae()(o.state,ut),n={elements:o.elements,nUndos:o.nUndos,state:t};return o.hasChangedSinceLastSave=!1,e.anonymous?(ct("Save created elements to local storage..."),e.store.setItem(o.id,n)):(ct("Saving data on server..."),e.saveSketchpadData(o.id,n))})),nt((0,a.Z)(o),"closeResponseModal",(function(){o.setState({showUploadModal:!1,modalMessage:null})})),nt((0,a.Z)(o),"toggleNavigationModal",(function(){o.setState({showNavigationModal:!o.state.showNavigationModal})})),nt((0,a.Z)(o),"toggleDeletePageModal",(function(){o.setState({showDeletePageModal:!o.state.showDeletePageModal})})),nt((0,a.Z)(o),"toggleResetModal",(function(){o.setState({showResetModal:!o.state.showResetModal})})),nt((0,a.Z)(o),"toggleTutorial",(function(){o.setState({showTutorial:!o.state.showTutorial})})),nt((0,a.Z)(o),"toggleSwiping",(function(){o.setState({swiping:!o.state.swiping})})),nt((0,a.Z)(o),"movePointerStart",(function(e){e.stopPropagation(),ct("`onMouseDown` or `onTouchStart` event fired..."),e.touches&&e.touches.length>1&&(o.swipeStartX=e.touches[0].screenX,o.swipeStartY=e.touches[0].screenY)})),nt((0,a.Z)(o),"movePointerEnd",(function(e){e.stopPropagation(),J()(o.swipeEndX-o.swipeStartX)>45&&J()(o.swipeEndY-o.swipeStartY)<40&&(o.swipeEndX>o.swipeStartX?o.previousPage():o.nextPage(),o.swipeEndX=0,o.swipeEndY=0,o.swipeStartX=0,o.swipeStartY=0),o.hideZoom(),o.hidePointer()})),nt((0,a.Z)(o),"movePointer",(function(e){if(e.stopPropagation(),o.state.swiping&&e.touches&&e.touches.length>1){o.swipeEndX=e.touches[0].screenX,o.swipeEndY=e.touches[0].screenY,o.isMouseDown=!1;var t=o.swipeEndY-o.swipeStartY;o.verticalScroll(t)}else{var n=o.context,a=o.mousePosition(e),s=a.x,i=a.y;if("pointer"===o.state.mode)o.pointer.style.opacity=.7,o.pointer.style.left=s+o.leftMargin+"px",o.pointer.style.top=i+"px";else if("zoom"===o.state.mode){var r=o.zoom,l=r.width,c=r.height,d=l/(2*gt),u=c/(2*gt);o.zoomCtx.clearRect(0,0,l,c);var h=l/gt,p=c/gt,g=s*gt-d/2,m=i*gt-u/2,f=0,v=0;g<0&&(f-=g,h+=h/d*(g=0),d+=g),m<0&&(v-=m,p+=p/u*(m=0),u+=m),o.zoomCtx.drawImage(o.canvas,g,m,d,u,f,v,h,p),o.zoom.style.display="block",o.zoom.style.left=s-d+o.leftMargin+"px",o.zoom.style.top=i-u+"px"}var w={id:o.id,type:"pointer"===o.state.mode?We.$h:We.fT,value:JSON.stringify({x:s/(o.canvas.width/gt),y:i/(o.canvas.height/gt),sessionID:n.sessionID}),noSave:!0};n.log(w,"members")}})),nt((0,a.Z)(o),"toLocalPage",(function(e,t){for(var n=o.state.insertedPages,a=e,s=0;s<n.length;s++){var i=n[s],r=i.page,l=i.email;r<e&&l!==t&&(a+=1)}return a})),nt((0,a.Z)(o),"toOriginalPage",(function(e){for(var t=o.state.insertedPages,n=e,a=0;a<t.length;a++){var s=t[a].page;if(s===e)return null;s<e&&(n-=1)}return ct("Page with index "+e+" corresponds to original page number "+n+"..."),n})),o.force=1,o.scaleRatio=1,o.elements=new Array(t.noPages),o.backgrounds=new Array(t.noPages),o.sharedElements=new Array(t.noPages),o.nUndos=new Array(t.noPages);for(var s=0;s<t.noPages;s++)o.elements[s]=[],o.backgrounds[s]=null,o.sharedElements[s]=[],o.nUndos[s]=0;o.hasChangedSinceLastSave=!1,o.canvas=null,o.ctx=null,o.id=t.id||dt(t);var r=Be.Z?0:o.readURL();return o.state={color:t.color,brushSize:t.brushSize,currentPage:r,fill:t.fill,fontFamily:t.fontFamily,fontSize:t.fontSize,groupMode:t.groupMode,hideInputButtons:t.hideInputButtons||n.presentationMode,hideNavigationButtons:t.hideNavigationButtons||n.presentationMode,hideSaveButtons:t.hideSaveButtons||n.presentationMode,hideTransmitButtons:t.hideTransmitButtons||n.presentationMode,isExporting:!1,modalMessage:null,noPages:t.noPages,insertedPages:[],showUploadModal:!1,mode:"none",showNavigationModal:!1,transmitOwner:t.transmitOwner,showInstructorAnnotations:!0,receiveFrom:{},showDeletePageModal:!1,showResetModal:!1,showTutorial:t.showTutorial,showFeedbackModal:!1,showSaveModal:!1,swiping:!0,verticalOffset:60,hasRetrievedData:!1},o.isMouseDown=!1,o.leftMargin=0,o.debouncedRedraw=v()(o.redraw,100),o}(0,o.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return e.fullscreen?{canvasHeight:window.innerHeight-t.verticalOffset,canvasWidth:window.innerWidth-40}:t.canvasHeight!==e.canvasHeight||t.canvasWidth!==e.canvasWidth?{canvasHeight:e.canvasHeight,canvasWidth:e.canvasWidth}:null};var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.context;this.zoomCtx&&this.zoomCtx.setTransform(gt,0,0,gt,0,0),this.ctx&&this.ctx.setTransform(gt,0,0,gt,0,0),this.props.fullscreen&&window.addEventListener("resize",this.handleResize),window.addEventListener("unload",this.save),(this.props.pdf||t.metadata.store[this.id]?this.initializePDF():Promise.resolve()).then((function(){(t.anonymous?t.getSketchpadVisitorData(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){ct(e)}))})),m().set(".sketch-canvas",{change:function(t){e.force=t}}),t&&(this.unsubscribe=t.subscribe((function(n,a){n!==Ae.Fw&&n!==Ae.E7||(t.anonymous?t.store.getItem(e.id):t.getSketchpadUserData(e.id)).then(e.retrieveData).catch((function(e){ct(e)}));if(n===Ae.KI&&e.initializePDF(),n===We.x$){ct("Hide control buttons in presentation mode...");var o={hideInputButtons:t.presentationMode,hideNavigationButtons:t.presentationMode,hideSaveButtons:t.presentationMode,hideTransmitButtons:t.presentationMode};e.props.fullscreen&&(o.verticalOffset=t.presentationMode?30:60,o.canvasHeight=window.innerHeight-o.verticalOffset,o.canvasWidth=window.innerWidth-40),e.setState(o,(function(){e.debouncedRedraw()}))}else if(n===Ae.Wh){if(a.id!==e.id)return;var s=a.type;if(ct("Received member action of type: "+s),a.email===t.user.email)if(s===We.$h){var i=JSON.parse(a.value),r=i.x,l=i.y;i.sessionID!==t.sessionID&&(r*=e.canvas.width/gt,l*=e.canvas.height/gt,r=r+e.leftMargin+"px",l+="px",e.pointer.style.left=r,e.pointer.style.top=l,e.pointer.style.opacity=.7)}else if(s===We.Ty)e.pointer.style.opacity=0;else if(s===We.fT){var c=JSON.parse(a.value),d=c.x,u=c.y;if(c.sessionID!==t.sessionID){d*=e.canvas.width/gt,u*=e.canvas.height/gt;var h=e.zoom,p=h.width,g=h.height,m=p/(2*gt),f=g/(2*gt);e.zoomCtx.clearRect(0,0,p,g);var v=p/gt,w=g/gt,y=d*gt-m/2,b=u*gt-f/2,E=0,P=0;y<0&&(E-=y,v+=v/m*(y=0),m+=y),b<0&&(P-=b,w+=w/f*(b=0),f+=b),e.zoomCtx.drawImage(e.canvas,y,b,m,f,E,P,v,w);var S=d-m+e.leftMargin+"px",x=u-f+"px";e.zoom.style.top=x,e.zoom.style.left=S,e.zoom.style.display="block"}}else if(s===We.FK)e.zoom.style.display="none";else if(s===We.Qr){var M=JSON.parse(a.value),k=M.diffY;M.sessionID!==t.sessionID&&(k*=e.canvas.height,e.canvasWrapper.scrollTop-=.1*k)}if(t.isOwner()){if(e.state.receiveFrom.name!==a.name&&!a.owner&&!e.state.groupMode)return;a.email===t.user.email&&(s!==We.tn&&s!==We.YF&&s!==We.Db&&s!==We.QS&&s!==We.$M||(ct("Go to page "+a.value+"..."),e.gotoPage(a.value,!1)))}if(s===We.nO||s===We.D$){var C=JSON.parse(a.value),D=e.elements[C.page],Z=e.sharedElements[C.page],I=!1;if(C.user===t.user.email||C.user===t.anonymousIdentifier)for(var O=0;O<D.length;O++)if(D[O].drawID===C.drawID){I=!0;break}I||(C.shouldLog=!1,C.page===e.state.currentPage&&e.state.showInstructorAnnotations&&("text"===C.type?e.drawText(C):e.drawCurve(C)),C.user===t.user.email?D.push(C):Z.push(C),e.props.onChange(D))}else if(s===We.bM){var T=JSON.parse(a.value).pos;a.email!==t.user.email&&(T=e.toLocalPage(T,a.email)),ft(T,e.state.insertedPages)||(ct("Should insert page at "+T+"..."),e.insertPage(T,a.email))}else if(s===We.jd){var R=JSON.parse(a.value),z=R.drawID,L=R.page,F=R.user,H=R.sessionID;if(ct("Should delete element with id "+z+" by user "+F),H!==t.sessionID){for(var U,W=a.email===t.user.email?e.elements[L]:e.sharedElements[L],A=0;A<W.length;A++)if(W[A].drawID===z&&W[A].user===F){U=A;break}(0,N.isPrimitive)(U)&&(W.splice(U,1),e.debouncedRedraw())}}else if(s===We.bW){var j=JSON.parse(a.value),Y=j.drawIDs,X=j.user,K=j.page,J=j.dx,V=j.dy,q=j.sessionID;if(ct("Should drag specified elements by dx: "+J+" and dy: "+V+"..."),q!==t.sessionID){for(var G=a.email===t.user.email?e.elements[K]:e.sharedElements[K],$=0;$<G.length;$++){var _=G[$];if(B()(Y,_.drawID)&&_.user===X)if("curve"===_.type)for(var Q=_.points,ee=0;ee<Q.length;ee++)Q[ee]+=ee%2==0?J:V;else"text"===_.type&&(_.x+=J,_.y+=V)}e.debouncedRedraw()}}else if(s===We.wi){var te=JSON.parse(a.value),ne=te.page,ae=te.sessionID,oe=a.email;if(ae!==t.sessionID)if(oe===t.user.email)e.clearPage(ne);else{for(var se=e.sharedElements[ne],ie=[],re=0;re<se.length;re++){var le=se[re];le.user!==oe&&ie.push(le)}e.sharedElements[ne]=ie,e.debouncedRedraw()}}else if(s===We.Wp&&a.value!==t.sessionID)if(a.email===t.user.email)e.clearAll(!0);else{for(var ce=a.email,de=0;de<e.state.noPages;de++){for(var ue=e.sharedElements[de],he=[],pe=0;pe<ue.length;pe++){var ge=ue[pe];ge.user!==ce&&he.push(ge)}e.sharedElements[de]=he}e.debouncedRedraw()}}}))),this.props.autoSave&&(this.saveInterval=setInterval(this.save,this.props.intervalTime));var n={passive:!1,capture:!0};document.addEventListener("touchstart",this.preventDefaultTouch,n),document.addEventListener("touchend",this.preventDefaultTouch,n),document.addEventListener("touchmove",this.preventDefaultTouch,n),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.props.fullscreen&&document.body.addEventListener("gesturestart",mt),Be.Z||window.addEventListener("hashchange",this.handleHashChange)},n.componentDidUpdate=function(e){var t=this;if(ct("Component did update..."),e.noPages!==this.props.noPages){this.elements=new Array(this.props.noPages),this.backgrounds=new Array(this.props.noPages),this.sharedElements=new Array(this.props.noPages),this.nUndos=new Array(this.props.noPages);for(var n=0;n<this.props.noPages;n++)this.elements[n]=[],this.backgrounds[n]=null,this.sharedElements[n]=[],this.nUndos[n]=0;this.setState({noPages:this.props.noPages},(function(){t.debouncedRedraw()}))}e.pdf!==this.props.pdf&&this.initializePDF(),this.props.canvasWidth===e.canvasWidth&&this.props.canvasHeight===e.canvasHeight||this.debouncedRedraw(),this.props.fill!==e.fill&&this.setState({fill:this.props.fill},this.redraw)},n.componentWillUnmount=function(){this.save(),this.saveInterval&&clearInterval(this.saveInterval),this.unsubscribe&&this.unsubscribe(),window.removeEventListener("resize",this.handleResize),Be.Z||window.removeEventListener("hashchange",this.handleHashChange),window.removeEventListener("unload",this.save);var e={passive:!1};document.removeEventListener("touchstart",this.preventDefaultTouch,e),document.removeEventListener("touchend",this.preventDefaultTouch,e),document.removeEventListener("touchmove",this.preventDefaultTouch,e),document.removeEventListener("visibilitychange",this.handleVisibilityChange,e),this.props.fullscreen&&document.removeEventListener("gesturestart",mt)},n.deselectElements=function(){ct("Deselect elements...");var e=this.selectedElements;if(e)for(var t=0;t<e.length;t++)e[t].selected=!1;this.selectedElements=null,this.dragPoints=null,this.canvasBuffer=null},n.renderProgressModal=function(){return this.state.isExporting?i.createElement(k.Z,{show:this.state.isExporting,onHide:te()},i.createElement(k.Z.Header,null,i.createElement(k.Z.Title,null,this.props.t("generate-pdf")))):null},n.renderUploadModal=function(){return this.state.showUploadModal?i.createElement(k.Z,{show:this.state.showUploadModal,onHide:this.closeResponseModal},i.createElement(k.Z.Header,{closeButton:!0},i.createElement(k.Z.Title,null,this.props.t("server-response"))),i.createElement(k.Z.Body,null,this.state.modalMessage),i.createElement(k.Z.Footer,null,i.createElement(M.Z,{onClick:this.closeResponseModal},this.props.t("close")))):null},n.renderPagination=function(){var e=this;if(this.state.hideNavigationButtons)return null;var t=this.props.t,n=this.state.currentPage;return this.props.dynamicallyHideButtons&&this.state.canvasWidth<600?i.createElement(x.Z,{size:"sm",className:"sketch-pages"},i.createElement(M.Z,{variant:"light",onClick:this.toggleNavigationModal},n+1,"/",this.state.noPages),i.createElement(he.Z,{owner:!0},i.createElement(xe,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"}))):i.createElement(x.Z,{size:"sm",className:"sketch-pages"},i.createElement(M.Z,{variant:"light",onClick:this.toggleNavigationModal},n+1,"/",this.state.noPages),i.createElement(xe,{tooltip:t("goto-first"),onClick:this.firstPage,glyph:"fast-backward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-previous"),onClick:this.previousPage,glyph:"backward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-next"),onClick:this.nextPage,glyph:"forward",size:"sm"}),i.createElement(xe,{tooltip:t("goto-last"),onClick:this.lastPage,glyph:"fast-forward",size:"sm"}),i.createElement(he.Z,{owner:!0},i.createElement(xe,{tooltip:t("insert-page"),onClick:function(){var t=e.state.currentPage+1;e.insertPage(t)},glyph:"plus",size:"sm"})))},n.renderInputButtons=function(){var e=this;return this.state.hideInputButtons?null:i.createElement(ze,{brushSize:this.state.brushSize,color:this.state.color,mode:this.state.mode,fontFamily:this.state.fontFamily,fontSize:this.state.fontSize,onModeChange:function(t){"drag"===e.state.mode&&"drag"!==t?(e.deselectElements(),e.onlyRedrawElements()):"text"===e.state.mode&&e.insertTextFromInput(),e.setState({mode:t}),"pointer"!==t?e.pointer.style.opacity=0:"pointer"===t&&(e.pointer.style.opacity=.7)},onColorChange:function(t){e.setState({color:t})},onBrushSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),"text"===e.state.mode&&e.insertTextFromInput(),e.setState({brushSize:Number(t),mode:"drawing"})},onFontFamilySelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontFamily:t,mode:"text"})},onFontSizeSelect:function(t){"drag"===e.state.mode&&(e.deselectElements(),e.onlyRedrawElements()),e.setState({fontSize:Number(t),mode:"text"})},t:this.props.t})},n.renderRemoveButtons=function(){if(this.state.hideInputButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<900)return null;var e=this.props.t;return i.createElement(x.Z,{size:"sm",className:"sketch-undo-redo sketch-button-group"},i.createElement(xe,{tooltip:e("undo"),onClick:this.undo,glyph:"step-backward",size:"sm"}),i.createElement(xe,{tooltip:e("redo"),glyph:"step-forward",onClick:this.redo,size:"sm"}),i.createElement(xe,{tooltip:e("clear-current"),onClick:this.toggleDeletePageModal,glyph:"eraser",size:"sm"}),i.createElement(xe,{tooltip:e("reset-pages"),onClick:this.toggleResetModal,glyph:"power-off",size:"sm"}))},n.renderSaveButtons=function(){var e=this;if(this.state.hideSaveButtons||this.props.dynamicallyHideButtons&&this.state.canvasWidth<775)return null;var t=this.context,n=this.props.t;return i.createElement(x.Z,{size:"sm",className:"sketch-save-buttons sketch-button-group"},this.props.pdf?null:i.createElement(xe,{tooltip:n("load-pdf"),onClick:this.loadPDF,size:"sm",glyph:"file"}),i.createElement(xe,{tooltip:n("download"),onClick:this.toggleSaveModal,glyph:"file-pdf",size:"sm"}),i.createElement(xe,{tooltip:t.anonymous?n("save-local"):n("save-server"),onClick:function(){e.save().then((function(){t.addNotification({title:n("saved"),message:t.anonymous?n("saved-local"):n("saved-server"),level:"success",position:"tr"})})).catch((function(e){t.addNotification({title:n("encountered-error"),message:e.message,level:"error",position:"tr"})}))},glyph:"save",size:"sm"}),i.createElement(xe,{tooltip:n("upload-to-server"),onClick:this.uploadSketches,glyph:"upload",size:"sm"}),Z()?i.createElement(xe,{tooltip:this.state.swiping?n("disable-swiping"):n("enable-swiping"),variant:this.state.swiping?"success":"secondary",onClick:this.toggleSwiping,glyph:"fingerprint",size:"sm"}):null)},n.renderTransmitButtons=function(){var e=this;if(this.state.hideTransmitButtons||this.state.canvasWidth<650)return null;var t,n=this.context.userList.filter((function(e){return j()(e.exitTime)})).map((function(e){return{value:e.name,label:e.name}})),a=i.createElement(E.Z,{id:"popover-positioned-right"},i.createElement(S.Z,null,this.props.t("remote-control-by")),i.createElement(P.Z,null,i.createElement(C.ZP,{isClearable:!0,inline:!0,options:n,onChange:function(t){e.setState({receiveFrom:t})}}),i.createElement(T.Z,{defaultValue:this.state.groupMode,onChange:this.toggleGroupMode,legend:this.props.t("group-mode")})));this.props.pdf&&(t=i.createElement(xe,{size:"sm",tooltip:"vertical"===this.state.fill?this.props.t("fill-entire-width"):this.props.t("fit-page"),onClick:function(){var t;t="vertical"===e.state.fill?"horizontal":"vertical",e.setState({fill:t},e.redraw)},glyph:"vertical"===this.state.fill?"fas fa-grip-lines":"fas fa-grip-lines-vertical"}));var o=this.props.t;return i.createElement(i.Fragment,null,i.createElement(he.Z,{owner:!0},i.createElement(x.Z,{size:"sm",className:"sketch-button-group"},i.createElement(xe,{size:"sm",tooltip:this.state.transmitOwner?o("disable-transmissions"):o("enable-transmissions"),variant:this.state.transmitOwner?"success":"light",onClick:this.toggleTransmit,glyph:"bullhorn"}),i.createElement(b.Z,{trigger:"click",placement:"bottom",rootClose:!0,overlay:a},i.createElement(M.Z,{size:"sm",variant:"light"},i.createElement("div",{className:"fa fa-eye"}))),t)),i.createElement(he.Z,{notOwner:!0},i.createElement(x.Z,{size:"sm",className:"sketch-button-group"},i.createElement(xe,{size:"sm",tooltip:this.state.showInstructorAnnotations?o("show-only-own-annotations"):o("show-all-annotations"),variant:this.state.showInstructorAnnotations?"success":"light",onClick:function(){e.setState({showInstructorAnnotations:!e.state.showInstructorAnnotations},(function(){e.debouncedRedraw()}))},glyph:this.state.showInstructorAnnotations?"fa fa-toggle-on":"fa fa-toggle-off"}),t)))},n.verticalScroll=function(e){if(e>30||e<-30){var t=this.context,n={id:this.id,type:We.Qr,value:JSON.stringify({diffY:e/this.canvas.height,sessionID:t.sessionID}),noSave:!0};t.log(n,"members"),this.canvasWrapper.scrollTop-=.1*e}},n.renderFeedbackButtons=function(){var e=this,t=this.toOriginalPage(this.state.currentPage);return!this.props.feedbackButtons||j()(t)?null:i.createElement(i.Fragment,null,i.createElement(z.Z,{key:this.id+"-slide-"+t,id:this.id+"-slide-"+t,customFeedback:!1,vertical:!0,style:{zIndex:3,position:"absolute",top:35,right:20}}),i.createElement(he.Z,{owner:!0},i.createElement(R.Z,{tooltip:this.props.t("open-slide-feedback"),placement:"left"},i.createElement(M.Z,{onClick:function(){return e.setState({showFeedbackModal:!e.state.showFeedbackModal})},variant:"secondary",size:"sm",style:{right:20,top:175,position:"absolute",zIndex:3}},this.props.t("show")))))},n.render=function(){var e,t,n=this;switch(ct("Render sketchpad with height "+this.props.canvasHeight+" and width "+this.props.canvasWidth),this.state.mode){case"drawing":e="crosshair";break;case"text":e="text";break;case"drag":e="move";break;case"delete":e="not-allowed";break;default:e="default"}if("pointer"===this.state.mode||"zoom"===this.state.mode)t={onMouseDown:this.movePointerStart,onMouseMove:this.movePointer,onMouseOut:this.movePointerEnd,onMouseUp:this.movePointerEnd,onTouchCancel:this.movePointerEnd,onTouchEnd:this.movePointerEnd,onTouchMove:this.movePointer,onTouchStart:this.movePointerStart};else if("none"===this.state.mode){var a=function(e){e.stopPropagation(),J()(n.swipeEndX-n.swipeStartX)>45&&J()(n.swipeEndY-n.swipeStartY)<40&&(n.swipeEndX>n.swipeStartX?n.previousPage():n.nextPage(),n.swipeEndX=0,n.swipeEndY=0,n.swipeStartX=0,n.swipeStartY=0)};t={onTouchCancel:a,onTouchEnd:a,onTouchMove:function(e){if(e.stopPropagation(),n.state.swiping&&e.touches&&e.touches.length>1){n.swipeEndX=e.touches[0].screenX,n.swipeEndY=e.touches[0].screenY,n.isMouseDown=!1;var t=n.swipeEndY-n.swipeStartY;n.verticalScroll(t)}},onTouchStart:function(e){e.stopPropagation(),e.touches&&e.touches.length>1&&(n.swipeStartX=e.touches[0].screenX,n.swipeStartY=e.touches[0].screenY)}}}else t={onClick:this.handleClick,onMouseDown:this.drawStart,onMouseMove:this.draw,onMouseOut:this.drawEnd,onMouseUp:this.drawEnd,onTouchCancel:this.drawEnd,onTouchEnd:this.drawEnd,onTouchMove:this.draw,onTouchStart:this.drawStart};var o=i.createElement("canvas",tt({id:this.id+"-canvas",className:"sketch-canvas",width:this.state.canvasWidth*gt,height:this.state.canvasHeight*gt,style:tt({cursor:e,width:this.state.canvasWidth,height:this.state.canvasHeight},this.props.style),ref:function(e){e&&(n.canvas=e,n.ctx=e.getContext("2d"))}},t)),s=i.createElement("canvas",{className:"sketchpad-magnifying-glass",width:this.state.canvasWidth*gt/4,height:this.state.canvasHeight*gt/4,style:{width:this.state.canvasWidth/4,height:this.state.canvasHeight/4},ref:function(e){e&&(n.zoom=e,n.zoomCtx=e.getContext("2d"),n.zoomCtx.imageSmoothingQuality="high")}});return i.createElement(i.Fragment,null,i.createElement(y.Z,{id:this.id,ref:function(e){n.sketchpadPanel=e},className:"modal-container",style:{width:this.state.canvasWidth+2,position:"relative",marginBottom:this.props.fullscreen?"0px":"20px",marginLeft:"auto",marginRight:"auto"},tabIndex:"0"},i.createElement("div",{className:"sketch-panel-heading clearfix unselectable"},this.renderPagination(),this.renderInputButtons(),this.renderRemoveButtons(),this.renderTransmitButtons(),this.renderSaveButtons(),this.context.presentationMode?null:i.createElement(xe,{tooltip:this.state.showTutorial?this.props.t("stop-tutorial"):this.props.t("start-tutorial"),onClick:this.toggleTutorial,glyph:"question",size:"sm"}),i.createElement(ge.Z,{reference:this,id:this.props.voiceID,commands:Ee})),this.renderFeedbackButtons(),i.createElement(wt,{nodes:this.props.nodes,currentPage:this.state.currentPage,toOriginalPage:this.toOriginalPage,key:"overlays"}),i.createElement("div",{className:"canvas-wrapper",style:{width:this.state.canvasWidth,height:this.state.canvasHeight},key:this.state.canvasWidth+"-"+this.state.canvasHeight,ref:function(e){n.canvasWrapper=e}},i.createElement(w.W4,{id:"sketchpadWindow",disabled:O()},o),s,i.createElement("div",tt({className:"textLayer",ref:function(e){n.textLayer=e},style:{pointerEvents:"none"!==this.state.mode?"none":"auto"}},t)),i.createElement("div",{ref:function(e){n.pointer=e},className:"sketch-pointer"})),i.createElement("input",{type:"text",className:"sketch-text-input",style:{display:"text"===this.state.mode?"inline-block":"none",fontSize:this.state.fontSize,fontFamily:this.state.fontFamily,color:this.state.color,width:this.state.canvasWidth},onKeyDown:this.handleEnter,ref:function(e){n.textInput=e}}),this.renderUploadModal(),this.state.showNavigationModal?i.createElement(it,{show:this.state.showNavigationModal,onSelect:this.gotoPage,noPages:this.state.noPages,onHide:this.toggleNavigationModal,t:this.props.t}):null,this.renderProgressModal(),this.state.showResetModal?i.createElement(ot,{show:this.state.showResetModal,onSubmit:this.clearAll,onHide:function(){n.setState({showResetModal:!1})},t:this.props.t}):null,this.state.showDeletePageModal?i.createElement(st,{show:this.state.showDeletePageModal,onSubmit:this.clear,onHide:function(){n.setState({showDeletePageModal:!1})},t:this.props.t}):null,this.state.showSaveModal?i.createElement(lt,{show:this.state.showSaveModal,saveAsPDF:this.saveAsPDF,saveAsPNG:this.saveAsPNG,onHide:this.toggleSaveModal,pdf:this.props.pdf,session:this.context,id:this.id,t:this.props.t}):null,this.state.showFeedbackModal?i.createElement(rt,{session:this.context,show:this.state.showFeedbackModal,onHide:function(){n.setState({showFeedbackModal:!n.state.showFeedbackModal})},id:this.id,noPages:this.state.noPages,toOriginalPage:this.toOriginalPage,gotoPage:this.gotoPage,t:this.props.t}):null,this.state.showTutorial?i.createElement(ue.ZP,{steps:qe,showProgress:!0,run:!0}):null),this.sketchpadPanel?i.createElement(pe.Z,{container:this.sketchpadPanel,actions:{ArrowDown:this.nextPage,ArrowUp:this.previousPage}}):null,i.createElement(Ve,{canvas:this.canvas}))},t}(i.Component);yt.defaultProps={autoSave:!0,feedbackButtons:!1,intervalTime:1e4,hideInputButtons:!1,hideNavigationButtons:!1,hideSaveButtons:!1,hideTransmitButtons:!1,brushSize:4,color:"#444444",canvasWidth:1200,canvasHeight:700,fullscreen:!1,fill:"vertical",disabled:!1,fontFamily:"Arial",fontSize:24,nodes:{},noPages:1,pdf:null,showTutorial:!1,dynamicallyHideButtons:!1,transmitOwner:!0,groupMode:!1,voiceID:null,style:{},onChange:function(){}},yt.propTypes={autoSave:l().bool,feedbackButtons:l().bool,intervalTime:l().number,hideInputButtons:l().bool,hideNavigationButtons:l().bool,hideSaveButtons:l().bool,hideTransmitButtons:l().bool,brushSize:l().number,color:l().string,canvasWidth:l().number,canvasHeight:l().number,fullscreen:l().bool,fill:l().oneOf(["vertical","horizontal"]),disabled:l().bool,fontFamily:l().string,fontSize:l().number,nodes:l().object,noPages:l().number,pdf:l().string,showTutorial:l().bool,dynamicallyHideButtons:l().bool,transmitOwner:l().bool,groupMode:l().bool,voiceID:l().string,style:l().object,onChange:l().func},yt.contextType=be.Z;var bt=(0,c.Z)("sketchpad")((0,je.W)(yt))},652501:function(e,t){"use strict";t.Z=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=512);for(var a=atob(e),o=[],s=0;s<a.length;s+=n){for(var i=a.slice(s,s+n),r=new Array(i.length),l=0;l<i.length;l++)r[l]=i.charCodeAt(l);var c=new Uint8Array(r);o.push(c)}return new Blob(o,{type:t})}},238904:function(e,t,n){"use strict";var a=n(928316),o=n(569257),s=n.n(o),i=n(525439);t.Z=function(e){if(e){var t=(0,a.findDOMNode)(e);if(t)for(var n=t.getElementsByClassName("hint-button"),o=0;o<n.length;o++)s()(n[o].innerText,i.a.t("components:close"))&&n[o].click()}}},675252:function(e,t){"use strict";var n=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i;function a(e){setImmediate((function(){throw e}),0)}function o(e){return n.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}var s=function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t,n=e.document,s=!1;n&&n.createElementNS&&(t=n.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in t);var i=/constructor/i.test(e.HTMLElement)||e.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),l=e.setImmediate||e.setTimeout,c=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=o(e)),navigator.msSaveOrOpenBlob(e,t)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=null,c.onwritestart=null,c.onprogress=null,c.onwrite=null,c.onabort=null,c.onerror=null,c.onwriteend=null,function(e,t,n){return new h(e,t||e.name||"download",n)})}function d(){return e.URL||e.webkitURL||e}function u(e){setTimeout((function(){"string"==typeof e?d().revokeObjectURL(e):e.remove()}),4e4)}function h(n,c,h){h||(n=o(n));var p,g=this,m="application/octet-stream"===n.type;function f(){!function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var s=e["on"+t[o]];if("function"==typeof s)try{s.call(e,n||e)}catch(i){a(i)}}}(g,"writestart progress write writeend".split(" "))}if(g.readyState=g.INIT,s)return p=d().createObjectURL(n),void l((function(){var e,n;t.href=p,t.download=c,e=t,n=new MouseEvent("click"),e.dispatchEvent(n),f(),u(p),g.readyState=g.DONE}),0);!function(){if((r||m&&i)&&e.FileReader){var t=new FileReader;return t.onloadend=function(){var n=r?t.result:t.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(n,"_blank")||(e.location.href=n),n=void 0,g.readyState=g.DONE,f()},t.readAsDataURL(n),void(g.readyState=g.INIT)}p||(p=d().createObjectURL(n)),m?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),g.readyState=g.DONE,f(),u(p)}()}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.Z=s},907756:function(e,t){"use strict";t.Z=function(e){e.stopPropagation()}},995729:function(){},535635:function(){},737684:function(){},286339:function(){},347629:function(){},891940:function(){}}]);